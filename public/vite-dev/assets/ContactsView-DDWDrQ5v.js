import{m as k,u as j}from"./globalConfig-DaGjiImb.js";import{a as O,u as R}from"./index-BaHWIRRA.js";import{n as Y,p as W,w as X,j as K,E as B,k as J,m as N,g as x}from"./dashboard-CGLIihvy.js";import{_ as M,u as d,o as n,n as A,p as r,e as u,t as c,j as Z,l as h,m as f,k as T,a as g,W as ee,L as D,q as U,c as L,F as G,i as q,h as F,r as te,f as Q,g as se,U as oe}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as ae,g as re,_ as le,c as ne}from"./Table-qO3GIpbk.js";import{u as V}from"./timeHelper-BT38nsET.js";import{S as ie}from"./Spinner-B-aSVz3z.js";import{_ as P}from"./BaseCell-DrTvutGD.js";import{T as ce}from"./Thumbnail-DLjRBBx8.js";import{v as ue}from"./mutationHelpers-3VTcoJiD.js";import{u as de}from"./vue-router-CNCrM2WK.js";import{g as he,a as me}from"./CustomAttributes-CrR_sV2i.js";import{F as pe}from"./DashboardIcon-CPXNa31t.js";import{C as _e}from"./ContactInfoPanel-B5ZrvSx2.js";import{_ as ge}from"./TableFooter-DOGhqcuD.js";import{F as Ce}from"./Index-0SoIkjHw.js";import{c as z}from"./helper-DcGaBm2u.js";import{u as fe,d as Te,O as v,a as Se,b as Ae,A as ye,D as Ee,e as $,g as be}from"./customViewsHelper-CUYWEnfe.js";import{v as Fe}from"./validations-BcBAK3o6.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./index-C2DForDf.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./utils.esm-CA3tRshB.js";import"./index-BP-sUqpX.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./exports-CsC-x4VI.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";import"./index-DaWXXnfb.js";import"./index-BO4rcqbh.js";import"./Icon-Dtj3LCzD.js";import"./constants-lVAyZKq6.js";import"./useMessageFormatter-CoQTTzFX.js";import"./InboxName-DzICaIqB.js";import"./agentHelper-C7QvnyM_.js";import"./index-Cq2yv_RT.js";import"./ContextMenu-CbEc-VsQ.js";import"./AddLabel-CnIX2z1Y.js";import"./labelColor-5G4vXyDu.js";import"./vue-upload-component-ChbSM2aG.js";import"./MultiselectDropdown-Cp046MCC.js";import"./MultiselectDropdownItems-DEUXvTsY.js";import"./vuedraggable.umd-rGNd3eNJ.js";function we(){var e=Y(arguments),t=e.text,a=e.options,l=e.metadata;return W(t,a,l)}function Ie(){return X(we,arguments)}const ve={props:{headerTitle:{type:String,default:""},searchQuery:{type:String,default:""},segmentsId:{type:[String,Number],default:0}},emits:["onToggleSaveFilter","onToggleEditFilter","onToggleDeleteFilter","onToggleCreate","onToggleFilter","onToggleImport","onExportSubmit","onSearchSubmit","onInputSearch"],setup(){const{isAdmin:e}=K();return{isAdmin:e}},data(){return{showCreateModal:!1,showImportModal:!1}},computed:{searchButtonClass(){return this.searchQuery!==""?"opacity-100 translate-x-0 visible":"-translate-x-px opacity-0 invisible"},...k({getAppliedContactFilters:"contacts/getAppliedContactFilters"}),hasAppliedFilters(){return this.getAppliedContactFilters.length},hasActiveSegments(){return this.segmentsId!==0},exportDescription(){return this.hasAppliedFilters?this.$t("EXPORT_CONTACTS.CONFIRM.FILTERED_MESSAGE"):this.$t("EXPORT_CONTACTS.CONFIRM.MESSAGE")}},methods:{onToggleSegmentsModal(){this.$emit("onToggleSaveFilter")},onToggleEditSegmentsModal(){this.$emit("onToggleEditFilter")},onToggleDeleteSegmentsModal(){this.$emit("onToggleDeleteFilter")},toggleCreate(){this.$emit("onToggleCreate")},toggleFilter(){this.$emit("onToggleFilter")},toggleImport(){this.$emit("onToggleImport")},async submitExport(){await this.$refs.confirmExportContactsDialog.showConfirmation()&&this.$emit("onExportSubmit")},submitSearch(){this.$emit("onSearchSubmit")},inputSearch(e){this.$emit("onInputSearch",e)}}},Oe={class:"bg-white border-b dark:bg-slate-900 border-slate-50 dark:border-slate-800"},Ne={class:"flex justify-between w-full px-4 py-2"},Re={class:"flex flex-col items-center w-full gap-2 md:flex-row"},Le={class:"flex justify-between w-full gap-2"},ke={class:"flex items-center justify-center max-w-full min-w-[6.25rem]"},Me={class:"m-0 mx-2 my-0 overflow-hidden text-xl text-slate-900 dark:text-slate-100 whitespace-nowrap text-ellipsis"},Pe={class:"max-w-[400px] min-w-[100px] flex items-center relative mx-2"},xe={class:"flex items-center absolute h-full left-2.5"},De=["placeholder","value"],Ue={class:"flex gap-1"},Be={key:0,class:"flex gap-2"},Ve={key:1,class:"relative"},$e={key:0,class:"absolute w-2 h-2 rounded-full top-1 right-3 bg-slate-500 dark:bg-slate-500"};function Ge(e,t,a,l,o,s){const S=d("woot-sidemenu-icon"),p=d("fluent-icon"),m=d("woot-button"),C=d("woot-confirm-modal");return n(),A("header",Oe,[r("div",Ne,[r("div",Re,[r("div",Le,[r("div",ke,[u(S),r("h1",Me,c(a.headerTitle),1)]),r("div",Pe,[r("div",xe,[u(p,{icon:"search",class:"h-5 text-sm leading-9 text-slate-700 dark:text-slate-200"})]),r("input",{type:"text",placeholder:e.$t("CONTACTS_PAGE.SEARCH_INPUT_PLACEHOLDER"),class:"!pl-9 !pr-[3.75rem] !text-sm !w-full !h-[2.375rem] !m-0 border-slate-100 dark:border-slate-600",value:a.searchQuery,onKeyup:t[0]||(t[0]=Z((..._)=>s.submitSearch&&s.submitSearch(..._),["enter"])),onInput:t[1]||(t[1]=(..._)=>s.inputSearch&&s.inputSearch(..._))},null,40,De),u(m,{"is-loading":!1,class:"absolute h-8 px-2 py-0 ml-2 transition-transform duration-100 ease-linear clear right-1","class-names":s.searchButtonClass,onClick:s.submitSearch},{default:h(()=>[f(c(e.$t("CONTACTS_PAGE.SEARCH_BUTTON")),1)]),_:1},8,["class-names","onClick"])])]),r("div",Ue,[s.hasActiveSegments?(n(),A("div",Be,[u(m,{class:"clear [&>span]:hidden xs:[&>span]:block","color-scheme":"secondary",icon:"edit",onClick:s.onToggleEditSegmentsModal},{default:h(()=>[f(c(e.$t("CONTACTS_PAGE.FILTER_CONTACTS_EDIT")),1)]),_:1},8,["onClick"]),u(m,{class:"clear [&>span]:hidden xs:[&>span]:block","color-scheme":"alert",icon:"delete",onClick:s.onToggleDeleteSegmentsModal},{default:h(()=>[f(c(e.$t("CONTACTS_PAGE.FILTER_CONTACTS_DELETE")),1)]),_:1},8,["onClick"])])):T("",!0),s.hasActiveSegments?T("",!0):(n(),A("div",Ve,[s.hasAppliedFilters?(n(),A("div",$e)):T("",!0),u(m,{class:"clear [&>span]:hidden xs:[&>span]:block","color-scheme":"secondary","data-testid":"create-new-contact",icon:"filter",onClick:s.toggleFilter},{default:h(()=>[f(c(e.$t("CONTACTS_PAGE.FILTER_CONTACTS")),1)]),_:1},8,["onClick"])])),s.hasAppliedFilters&&!s.hasActiveSegments?(n(),g(m,{key:2,class:"clear [&>span]:hidden xs:[&>span]:block","color-scheme":"alert",variant:"clear",icon:"save",onClick:s.onToggleSegmentsModal},{default:h(()=>[f(c(e.$t("CONTACTS_PAGE.FILTER_CONTACTS_SAVE")),1)]),_:1},8,["onClick"])):T("",!0),u(m,{class:"clear [&>span]:hidden xs:[&>span]:block","color-scheme":"success",icon:"person-add","data-testid":"create-new-contact",onClick:s.toggleCreate},{default:h(()=>[f(c(e.$t("CREATE_CONTACT.BUTTON_LABEL")),1)]),_:1},8,["onClick"]),l.isAdmin?(n(),g(m,{key:3,"color-scheme":"info",icon:"upload",class:"clear [&>span]:hidden xs:[&>span]:block",onClick:s.toggleImport},{default:h(()=>[f(c(e.$t("IMPORT_CONTACTS.BUTTON_LABEL")),1)]),_:1},8,["onClick"])):T("",!0),l.isAdmin?(n(),g(m,{key:4,"color-scheme":"info",icon:"download",class:"clear [&>span]:hidden xs:[&>span]:block",onClick:s.submitExport},{default:h(()=>[f(c(e.$t("EXPORT_CONTACTS.BUTTON_LABEL")),1)]),_:1},8,["onClick"])):T("",!0)])])]),u(C,{ref:"confirmExportContactsDialog",title:e.$t("EXPORT_CONTACTS.CONFIRM.TITLE"),description:s.exportDescription,"confirm-label":e.$t("EXPORT_CONTACTS.CONFIRM.YES"),"cancel-label":e.$t("EXPORT_CONTACTS.CONFIRM.NO")},null,8,["title","description","confirm-label","cancel-label"])])}const qe=M(ve,[["render",Ge]]),Qe={class:"items-start flex flex-col my-0 mx-2"},ze={class:"overflow-hidden text-base whitespace-nowrap text-ellipsis"},He={class:"button clear small link text-slate-600 dark:text-slate-200"},je={__name:"NameCell",props:{row:{type:Object,required:!0}},setup(e){const t=de(),a=ee("openContactInfoPanel"),l=ue("accounts/isRTL");return(o,s)=>{const S=d("router-link"),p=d("woot-button");return n(),g(P,null,{default:h(()=>[u(p,{variant:"clear",class:"!px-0",onClick:s[0]||(s[0]=()=>D(a)(e.row.original.id))},{default:h(()=>[r("div",{class:U(["items-center flex",{"flex-row-reverse":D(l)}])},[u(ce,{size:"32px",src:e.row.original.thumbnail,username:e.row.original.name,status:e.row.original.availability_status},null,8,["src","username","status"]),r("div",Qe,[r("h6",ze,[u(S,{to:`/app/accounts/${D(t).params.accountId}/contacts/${e.row.original.id}`,class:"text-sm font-medium m-0 capitalize"},{default:h(()=>[f(c(e.row.original.name),1)]),_:1},8,["to"])]),r("button",He,c(o.$t("CONTACTS_PAGE.LIST.VIEW_DETAILS")),1)])],2)]),_:1})]),_:1})}}},Ye=["href"],We={__name:"EmailCell",props:{email:{type:String,required:!0}},setup(e){return(t,a)=>(n(),g(P,null,{default:h(()=>[r("a",{target:"_blank",rel:"noopener noreferrer nofollow",class:"text-woot-500 dark:text-woot-500",href:`mailto:${e.email}`},c(e.email),9,Ye)]),_:1}))}},Xe={__name:"TelCell",props:{phoneNumber:{type:String,default:""},defaultCountry:{type:String,default:""}},setup(e){const t=e,a=L(()=>{if(!t.phoneNumber)return"";try{const l=Ie(t.phoneNumber,t.defaultCountry);return l?l.formatInternational():t.phoneNumber}catch{return t.phoneNumber}});return(l,o)=>(n(),g(P,{content:a.value},null,8,["content"]))}},Ke={__name:"CountryCell",props:{countryCode:{type:String,default:""},country:{type:String,default:""}},setup(e){const t=e,a=L(()=>t.countryCode?he(t.countryCode):""),l=L(()=>t.country?`${a.value} ${t.country}`:"");return(o,s)=>(n(),g(P,{content:l.value},null,8,["content"]))}},Je=["href"],Ze={__name:"ProfilesCell",props:{profiles:{type:Object,required:!0}},setup(e){const t=e,a=L(()=>Object.keys(t.profiles).filter(l=>t.profiles[l]));return(l,o)=>(n(),g(P,{class:"flex gap-2 items-center text-slate-300 dark:text-slate-400"},{default:h(()=>[a.value.length?(n(!0),A(G,{key:0},q(a.value,s=>(n(),A("a",{key:s,href:`https://${s}.com/${e.profiles[s]}`,target:"_blank",class:"hover:text-slate-500",rel:"noopener noreferrer nofollow"},[u(pe,{class:"size-4",icon:`brand-${s}`},null,8,["icon"])],8,Je))),128)):T("",!0)]),_:1}))}},et={class:"flex-1 h-full overflow-auto bg-white dark:bg-slate-900"},tt={class:"overflow-x-auto"},st={key:2,class:"flex items-center justify-center text-base"},ot={__name:"ContactsTable",props:{contacts:{type:Array,default:()=>[]},showSearchEmptyState:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["onSortChange"],setup(e,{emit:t}){const a=e,l=t,{t:o}=j(),s=L(()=>a.isLoading?[]:a.contacts.map(i=>{const b=i.additional_attributes||{},{last_activity_at:E}=i,{created_at:w}=i;return{...i,profiles:b.social_profiles||{},last_activity_at:E?V(E):null,created_at:w?V(w):null}})),S=i=>F("span",{class:i.getValue()?"":"text-slate-300 dark:text-slate-700"},i.getValue()?i.getValue():"---"),p=ne(),m=[p.accessor("name",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.NAME"),cell:i=>F(je,i),size:250}),p.accessor("email",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.EMAIL_ADDRESS"),cell:i=>F(We,{email:i.getValue()}),size:250}),p.accessor("phone_number",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.PHONE_NUMBER"),size:200,cell:i=>F(Xe,{phoneNumber:i.getValue(),defaultCountry:i.row.original.country_code})}),p.accessor("company_name",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.COMPANY"),size:200,cell:S}),p.accessor("city",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.CITY"),cell:S,size:200}),p.accessor("country",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.COUNTRY"),size:200,cell:i=>F(Ke,{countryCode:i.row.original.country_code,country:i.getValue()})}),p.accessor("profiles",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.SOCIAL_PROFILES"),size:200,enableSorting:!1,cell:i=>F(Ze,{profiles:i.getValue()})}),p.accessor("last_activity_at",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.LAST_ACTIVITY"),size:200,cell:S}),p.accessor("created_at",{header:o("CONTACTS_PAGE.LIST.TABLE_HEADER.CREATED_AT"),size:200,cell:S})],C=te([{last_activity_at:"desc"}]),_=ae({get data(){return s.value},columns:m,enableMultiSort:!1,getCoreRowModel:re(),state:{get sorting(){return C.value}},onSortingChange:i=>{const b=i(C.value),[E]=b;E?(C.value=b,l("onSortChange",{[E.id]:E.desc?"desc":"asc"})):(C.value=[{last_activity_at:"desc"}],l("onSortChange",{}))}});return(i,b)=>(n(),A("section",et,[r("section",tt,[u(le,{fixed:"",table:D(_)},null,8,["table"])]),e.showSearchEmptyState?(n(),g(B,{key:0,title:i.$t("CONTACTS_PAGE.LIST.404")},null,8,["title"])):!e.isLoading&&!e.contacts.length?(n(),g(B,{key:1,title:i.$t("CONTACTS_PAGE.LIST.NO_CONTACTS")},null,8,["title"])):T("",!0),e.isLoading?(n(),A("div",st,[u(ie),r("span",null,c(i.$t("CONTACTS_PAGE.LIST.LOADING_MESSAGE")),1)])):T("",!0)]))}},at={components:{ContactForm:me},props:{show:{type:Boolean,default:!1}},emits:["cancel","update:show"],computed:{...k({uiFlags:"contacts/getUIFlags"}),localShow:{get(){return this.show},set(e){this.$emit("update:show",e)}}},methods:{onCancel(){this.$emit("cancel")},onSuccess(){this.$emit("cancel")},async onSubmit(e){await this.$store.dispatch("contacts/create",e)}}},rt={class:"flex flex-col h-auto overflow-auto"};function lt(e,t,a,l,o,s){const S=d("woot-modal-header"),p=d("ContactForm"),m=d("woot-modal");return n(),g(m,{show:s.localShow,"onUpdate:show":t[0]||(t[0]=C=>s.localShow=C),"on-close":s.onCancel,"modal-type":"right-aligned"},{default:h(()=>[r("div",rt,[u(S,{"header-title":e.$t("CREATE_CONTACT.TITLE"),"header-content":e.$t("CREATE_CONTACT.DESC")},null,8,["header-title","header-content"]),u(p,{"in-progress":e.uiFlags.isCreating,"on-submit":s.onSubmit,onSuccess:s.onSuccess,onCancel:s.onCancel},null,8,["in-progress","on-submit","onSuccess","onCancel"])])]),_:1},8,["show","on-close"])}const nt=M(at,[["render",lt]]),it={components:{Modal:J},props:{onClose:{type:Function,default:()=>{}}},data(){return{show:!0,file:""}},computed:{...k({uiFlags:"contacts/getUIFlags"}),csvUrl(){return"/downloads/import-contacts-sample.csv"}},mounted(){O(N.IMPORT_MODAL_OPEN)},methods:{async uploadFile(){try{if(!this.file)return;await this.$store.dispatch("contacts/import",this.file),this.onClose(),R(this.$t("IMPORT_CONTACTS.SUCCESS_MESSAGE")),O(N.IMPORT_SUCCESS)}catch(e){R(e.message||this.$t("IMPORT_CONTACTS.ERROR_MESSAGE")),O(N.IMPORT_FAILURE)}},handleFileUpload(){this.file=this.$refs.file.files[0]}}},ct={class:"flex flex-col h-auto overflow-auto"},ut=["href"],dt={class:"flex flex-col p-8"},ht={class:"w-full"},mt={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"},pt={class:"w-full"};function _t(e,t,a,l,o,s){const S=d("woot-modal-header"),p=d("woot-button"),m=d("Modal");return n(),g(m,{show:o.show,"onUpdate:show":t[2]||(t[2]=C=>o.show=C),"on-close":a.onClose},{default:h(()=>[r("div",ct,[u(S,{"header-title":e.$t("IMPORT_CONTACTS.TITLE")},{default:h(()=>[r("p",null,[f(c(e.$t("IMPORT_CONTACTS.DESC"))+" ",1),r("a",{href:s.csvUrl,download:"import-contacts-sample"},c(e.$t("IMPORT_CONTACTS.DOWNLOAD_LABEL")),9,ut)])]),_:1},8,["header-title"]),r("div",dt,[r("div",ht,[r("label",null,[r("span",null,c(e.$t("IMPORT_CONTACTS.FORM.LABEL")),1),r("input",{id:"file",ref:"file",type:"file",accept:"text/csv",onChange:t[0]||(t[0]=(...C)=>s.handleFileUpload&&s.handleFileUpload(...C))},null,544)])]),r("div",mt,[r("div",pt,[u(p,{disabled:e.uiFlags.isCreating||!o.file,loading:e.uiFlags.isCreating,onClick:s.uploadFile},{default:h(()=>[f(c(e.$t("IMPORT_CONTACTS.FORM.SUBMIT")),1)]),_:1},8,["disabled","loading","onClick"]),r("button",{class:"button clear",onClick:t[1]||(t[1]=Q((...C)=>a.onClose&&a.onClose(...C),["prevent"]))},c(e.$t("IMPORT_CONTACTS.FORM.CANCEL")),1)])])])])]),_:1},8,["show","on-close"])}const gt=M(it,[["render",_t]]),Ct={components:{FilterInputBox:Ce},props:{onClose:{type:Function,default:()=>{}},initialFilterTypes:{type:Array,default:()=>[]},initialAppliedFilters:{type:Array,default:()=>[]},isSegmentsView:{type:Boolean,default:!1},activeSegmentName:{type:String,default:""}},emits:["applyFilter","clearFilters","updateSegment"],setup(){const{setFilterAttributes:e}=fe({filteri18nKey:"CONTACTS_FILTER",attributeModel:"contact_attribute"});return{setFilterAttributes:e}},data(){return{show:!0,appliedFilters:this.initialAppliedFilters,activeSegmentNewName:this.activeSegmentName,filterTypes:this.initialFilterTypes,filterGroups:[],allCustomAttributes:[],filterAttributeGroups:Te,attributeModel:"contact_attribute",filtersFori18n:"CONTACTS_FILTER",validationErrors:{}}},computed:{...k({getAppliedContactFilters:"contacts/getAppliedContactFilters"}),hasAppliedFilters(){return this.getAppliedContactFilters.length},filterModalHeaderTitle(){return this.isSegmentsView?this.$t("CONTACTS_FILTER.EDIT_CUSTOM_SEGMENT"):this.$t("CONTACTS_FILTER.TITLE")},filterModalSubTitle(){return this.isSegmentsView?this.$t("CONTACTS_FILTER.CUSTOM_VIEWS_SUBTITLE"):this.$t("CONTACTS_FILTER.SUBTITLE")}},mounted(){const{filterGroups:e,filterTypes:t}=this.setFilterAttributes();this.filterTypes=[...this.filterTypes,...t],this.filterGroups=e,this.getAppliedContactFilters.length?this.appliedFilters=[...this.getAppliedContactFilters]:this.isSegmentsView||this.appliedFilters.push({attribute_key:"name",filter_operator:"equal_to",values:"",query_operator:"and",attribute_model:"standard"})},methods:{getOperatorTypes(e){switch(e){case"list":return v;case"text":return Ae;case"number":return v;case"link":return v;case"date":return Se;case"checkbox":return v;default:return v}},customAttributeInputType(e){switch(e){case"date":return"date";case"text":return"plain_text";case"list":return"search_select";case"checkbox":return"search_select";default:return"plain_text"}},getAttributeModel(e){return this.filterTypes.find(a=>a.attributeKey===e).attributeModel},getInputType(e,t){if((e==="created_at"||e==="last_activity_at")&&t==="days_before")return"plain_text";const a=this.filterTypes.find(l=>l.attributeKey===e);return a==null?void 0:a.inputType},getOperators(e){const t=this.filterTypes.find(a=>a.attributeKey===e);return t==null?void 0:t.filterOperators},getDropdownValues(e){const t=this.$store.getters["attributes/getAttributesByModel"](this.attributeModel);if(t.find(o=>o.attribute_key===e&&o.attribute_display_type==="checkbox")||e==="blocked")return[{id:!0,name:this.$t("FILTER.ATTRIBUTE_LABELS.TRUE")},{id:!1,name:this.$t("FILTER.ATTRIBUTE_LABELS.FALSE")}];if(t.find(o=>o.attribute_key===e&&o.attribute_display_type==="list"))return t.find(o=>o.attribute_key===e).attribute_values.map(o=>({id:o,name:o}));switch(e){case"country_code":return z;default:return}},appendNewFilter(){this.isSegmentsView?this.setQueryOperatorOnLastQuery():this.appliedFilters.push({attribute_key:"name",filter_operator:"equal_to",values:"",query_operator:"and"})},setQueryOperatorOnLastQuery(){const e=this.appliedFilters.length-1;this.appliedFilters[e]={...this.appliedFilters[e],query_operator:"and"},this.$nextTick(()=>{this.appliedFilters.push({attribute_key:"name",filter_operator:"equal_to",values:"",query_operator:"and"})})},removeFilter(e){this.appliedFilters.length<=1?R(this.$t("CONTACTS_FILTER.FILTER_DELETE_ERROR")):this.appliedFilters.splice(e,1)},submitFilterQuery(){this.validationErrors=Fe(this.appliedFilters),Object.keys(this.validationErrors).length===0&&(this.$store.dispatch("contacts/setContactFilters",JSON.parse(JSON.stringify(this.appliedFilters))),this.$emit("applyFilter",this.appliedFilters),O(N.APPLY_FILTER,{applied_filters:this.appliedFilters.map(e=>({key:e.attribute_key,operator:e.filter_operator,query_operator:e.query_operator}))}))},updateSegment(){this.$emit("updateSegment",this.appliedFilters,this.activeSegmentNewName)},resetFilter(e,t){this.appliedFilters[e].filter_operator=this.filterTypes.find(a=>a.attributeKey===t.attribute_key).filterOperators[0].value,this.appliedFilters[e].values=""},showUserInput(e){return!(e==="is_present"||e==="is_not_present")},clearFilters(){this.$emit("clearFilters"),this.onClose()}}},ft={class:"text-slate-600 dark:text-slate-200"},Tt={class:"p-8"},St={key:0},At={key:0,class:"message"},yt={class:"input-label"},Et={class:"p-4 mb-4 border border-solid rounded-lg bg-slate-25 dark:bg-slate-900 border-slate-50 dark:border-slate-700/50"},bt={class:"mt-4"},Ft={class:"w-full"},wt={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"};function It(e,t,a,l,o,s){const S=d("woot-modal-header"),p=d("FilterInputBox"),m=d("woot-button");return n(),A("div",null,[u(S,{"header-title":s.filterModalHeaderTitle},{default:h(()=>[r("p",ft,c(s.filterModalSubTitle),1)]),_:1},8,["header-title"]),r("div",Tt,[a.isSegmentsView?(n(),A("div",St,[r("label",{class:U(["input-label",{error:!o.activeSegmentNewName}])},[f(c(e.$t("CONTACTS_FILTER.SEGMENT_LABEL"))+" ",1),se(r("input",{"onUpdate:modelValue":t[0]||(t[0]=C=>o.activeSegmentNewName=C),type:"text",class:"bg-white folder-input border-slate-75 dark:border-slate-600 dark:bg-slate-900 text-slate-900 dark:text-slate-100"},null,512),[[oe,o.activeSegmentNewName]]),o.activeSegmentNewName?T("",!0):(n(),A("span",At,c(e.$t("CONTACTS_FILTER.EMPTY_VALUE_ERROR")),1))],2),r("label",yt,c(e.$t("CONTACTS_FILTER.SEGMENT_QUERY_LABEL")),1)])):T("",!0),r("div",Et,[(n(!0),A(G,null,q(o.appliedFilters,(C,_)=>(n(),g(p,{key:_,modelValue:o.appliedFilters[_],"onUpdate:modelValue":i=>o.appliedFilters[_]=i,"filter-groups":o.filterGroups,"grouped-filters":"","input-type":s.getInputType(o.appliedFilters[_].attribute_key,o.appliedFilters[_].filter_operator),operators:s.getOperators(o.appliedFilters[_].attribute_key),"dropdown-values":s.getDropdownValues(o.appliedFilters[_].attribute_key),"show-query-operator":_!==o.appliedFilters.length-1,"show-user-input":s.showUserInput(o.appliedFilters[_].filter_operator),"error-message":o.validationErrors[`filter_${_}`]?e.$t("CONTACTS_FILTER.ERRORS.VALUE_REQUIRED"):"",onResetFilter:i=>s.resetFilter(_,o.appliedFilters[_]),onRemoveFilter:i=>s.removeFilter(_)},null,8,["modelValue","onUpdate:modelValue","filter-groups","input-type","operators","dropdown-values","show-query-operator","show-user-input","error-message","onResetFilter","onRemoveFilter"]))),128)),r("div",bt,[u(m,{icon:"add","color-scheme":"success",variant:"smooth",size:"small",onClick:s.appendNewFilter},{default:h(()=>[f(c(e.$t("CONTACTS_FILTER.ADD_NEW_FILTER")),1)]),_:1},8,["onClick"]),s.hasAppliedFilters&&!a.isSegmentsView?(n(),g(m,{key:0,icon:"subtract","color-scheme":"alert",variant:"smooth",size:"small",onClick:s.clearFilters},{default:h(()=>[f(c(e.$t("CONTACTS_FILTER.CLEAR_ALL_FILTERS")),1)]),_:1},8,["onClick"])):T("",!0)])]),r("div",Ft,[r("div",wt,[u(m,{class:"button clear",onClick:Q(a.onClose,["prevent"])},{default:h(()=>[f(c(e.$t("CONTACTS_FILTER.CANCEL_BUTTON_LABEL")),1)]),_:1},8,["onClick"]),a.isSegmentsView?(n(),g(m,{key:0,disabled:!o.activeSegmentNewName,onClick:s.updateSegment},{default:h(()=>[f(c(e.$t("CONTACTS_FILTER.UPDATE_BUTTON_LABEL")),1)]),_:1},8,["disabled","onClick"])):(n(),g(m,{key:1,onClick:s.submitFilterQuery},{default:h(()=>[f(c(e.$t("CONTACTS_FILTER.SUBMIT_BUTTON_LABEL")),1)]),_:1},8,["onClick"]))])])])])}const vt=M(Ct,[["render",It],["__scopeId","data-v-812d391a"]]),y=1,Ot=1,Nt={components:{ContactsHeader:qe,ContactsTable:ot,TableFooter:ge,ContactInfoPanel:_e,CreateContact:nt,ImportContacts:gt,ContactsAdvancedFilters:vt,AddCustomViews:ye,DeleteCustomViews:Ee},provide(){return{openContactInfoPanel:this.openContactInfoPanel}},props:{label:{type:String,default:""},segmentsId:{type:[String,Number],default:0}},data(){return{searchQuery:"",showCreateModal:!1,showImportModal:!1,selectedContactId:"",sortConfig:{last_activity_at:"desc"},showFiltersModal:!1,contactFilterItems:$.map(e=>({...e,attributeName:this.$t(`CONTACTS_FILTER.ATTRIBUTES.${e.attributeI18nKey}`)})),segmentsQuery:{},filterType:Ot,showAddSegmentsModal:!1,showDeleteSegmentsModal:!1,appliedFilter:[]}},computed:{...k({records:"contacts/getContacts",uiFlags:"contacts/getUIFlags",meta:"contacts/getMeta",segments:"customViews/getCustomViews",getAppliedContactFilters:"contacts/getAppliedContactFilters"}),showEmptySearchResult(){return!!this.searchQuery&&this.records.length===0},hasAppliedFilters(){return this.getAppliedContactFilters.length},hasActiveSegments(){return this.activeSegment&&this.segmentsId!==0},isContactAndLabelDashboard(){return this.$route.name==="contacts_dashboard"||this.$route.name==="contacts_labels_dashboard"},pageTitle(){return this.hasActiveSegments?this.activeSegment.name:this.label?`#${this.label}`:this.$t("CONTACTS_PAGE.HEADER")},selectedContact(){if(this.selectedContactId)return this.records.find(t=>this.selectedContactId===t.id)},showContactViewPane(){return this.selectedContactId!==""},wrapClass(){return this.showContactViewPane?"w-[75%]":"w-full"},pageParameter(){var t;const e=Number((t=this.$route.query)==null?void 0:t.page);return!Number.isNaN(e)&&e>=y?e:y},activeSegment(){if(this.segmentsId){const[e]=this.segments.filter(t=>t.id===Number(this.segmentsId));return e}},activeSegmentName(){var e;return(e=this.activeSegment)==null?void 0:e.name}},watch:{label(){this.fetchContacts(y),this.hasAppliedFilters&&this.clearFilters()},activeSegment(){if(this.hasActiveSegments){const e=this.activeSegment.query;this.fetchSavedFilteredContact(e,y)}this.hasAppliedFilters&&this.$route.name==="contacts_dashboard"?this.fetchFilteredContacts(y):this.fetchContacts(y)}},mounted(){this.fetchContacts(this.pageParameter)},methods:{updatePageParam(e){window.history.pushState({},null,`${this.$route.path}?page=${e}`)},getSortAttribute(){let e=Object.keys(this.sortConfig).reduce((t,a)=>{const l=this.sortConfig[a];return l?`${l==="asc"?"":"-"}${a}`:t},"");return e||(this.sortConfig={last_activity_at:"desc"},e="-last_activity_at"),e},fetchContacts(e){if(this.isContactAndLabelDashboard){this.updatePageParam(e);let t="";this.searchQuery.charAt(0)==="+"?t=this.searchQuery.substring(1):t=this.searchQuery;const a={page:e,sortAttr:this.getSortAttribute(),label:this.label};t?this.$store.dispatch("contacts/search",{search:encodeURIComponent(t),...a}):this.$store.dispatch("contacts/get",a)}},fetchSavedFilteredContact(e,t){this.hasActiveSegments&&(this.updatePageParam(t),this.$store.dispatch("contacts/filter",{queryPayload:e,page:t}))},fetchFilteredContacts(e){if(this.hasAppliedFilters){const t=this.segmentsQuery;this.updatePageParam(e),this.$store.dispatch("contacts/filter",{queryPayload:t,page:e})}},onInputSearch(e){const t=e.target.value,a=!!this.searchQuery&&t==="";this.searchQuery=t,a&&this.fetchContacts(y)},onSearchSubmit(){this.selectedContactId="",this.searchQuery&&this.fetchContacts(y)},onPageChange(e){if(this.selectedContactId="",this.segmentsId!==0){const t=this.activeSegment.query;this.fetchSavedFilteredContact(t,e)}this.hasAppliedFilters?this.fetchFilteredContacts(e):this.fetchContacts(e)},openContactInfoPanel(e){this.selectedContactId=e,this.showContactInfoPanelPane=!0},closeContactInfoPanel(){this.selectedContactId="",this.showContactInfoPanelPane=!1},onToggleCreate(){this.showCreateModal=!this.showCreateModal},onToggleSaveFilters(){this.showAddSegmentsModal=!0},onCloseAddSegmentsModal(){this.showAddSegmentsModal=!1},onToggleDeleteFilters(){this.showDeleteSegmentsModal=!0},onCloseDeleteSegmentsModal(){this.showDeleteSegmentsModal=!1},onToggleImport(){this.showImportModal=!this.showImportModal},onSortChange(e){this.sortConfig=e,this.fetchContacts(this.meta.currentPage);const t=Object.entries(e).find(a=>!!a[1])||[];O(N.APPLY_SORT,{appliedOn:t[0],order:t[1]})},onToggleFilters(){this.hasActiveSegments&&this.initializeSegmentToFilterModal(this.activeSegment),this.showFiltersModal=!0},closeAdvanceFiltersModal(){this.showFiltersModal=!1,this.appliedFilter=[]},onApplyFilter(e){this.closeContactInfoPanel(),this.segmentsQuery=x(e),this.$store.dispatch("contacts/filter",{queryPayload:x(e)}),this.showFiltersModal=!1},onUpdateSegment(e,t){const a={...this.activeSegment,name:t,query:x(e)};this.$store.dispatch("customViews/update",a),this.closeAdvanceFiltersModal()},clearFilters(){this.$store.dispatch("contacts/clearContactFilters"),this.fetchContacts(this.pageParameter)},onExportSubmit(){let e={payload:[]};this.hasActiveSegments?e=this.activeSegment.query:this.hasAppliedFilters&&(e=x(this.getAppliedContactFilters));try{this.$store.dispatch("contacts/export",{...e,label:this.label}),R(this.$t("EXPORT_CONTACTS.SUCCESS_MESSAGE"))}catch(t){R(t.message||this.$t("EXPORT_CONTACTS.ERROR_MESSAGE"))}},setParamsForEditSegmentModal(){return{countries:z,filterTypes:$,allCustomAttributes:this.$store.getters["attributes/getAttributesByModel"]("contact_attribute")}},initializeSegmentToFilterModal(e){var a;const t=(a=e==null?void 0:e.query)==null?void 0:a.payload;Array.isArray(t)&&this.appliedFilter.push(...t.map(l=>({attribute_key:l.attribute_key,attribute_model:l.attribute_model,filter_operator:l.filter_operator,values:Array.isArray(l.values)?be(l,this.setParamsForEditSegmentModal()):[],query_operator:l.query_operator,custom_attribute_type:l.custom_attribute_type})))},openSavedItemInSegment(){const t=this.segments[this.segments.length-1].id;this.$router.push({name:"contacts_segments_dashboard",params:{id:t}})},openLastItemAfterDeleteInSegment(){this.segments.length>0?this.openSavedItemInSegment():(this.$router.push({name:"contacts_dashboard"}),this.fetchContacts(y))}}},Rt={class:"flex flex-row w-full"};function Lt(e,t,a,l,o,s){const S=d("ContactsHeader"),p=d("ContactsTable"),m=d("TableFooter"),C=d("AddCustomViews"),_=d("DeleteCustomViews"),i=d("ContactInfoPanel"),b=d("CreateContact"),E=d("ImportContacts"),w=d("woot-modal"),H=d("ContactsAdvancedFilters");return n(),A("div",Rt,[r("div",{class:U(["flex flex-col h-full",s.wrapClass])},[u(S,{"search-query":o.searchQuery,"header-title":s.pageTitle,"segments-id":a.segmentsId,"this-selected-contact-id":"",onOnInputSearch:s.onInputSearch,onOnToggleCreate:s.onToggleCreate,onOnToggleFilter:s.onToggleFilters,onOnSearchSubmit:s.onSearchSubmit,onOnToggleImport:s.onToggleImport,onOnExportSubmit:s.onExportSubmit,onOnToggleSaveFilter:s.onToggleSaveFilters,onOnToggleDeleteFilter:s.onToggleDeleteFilters,onOnToggleEditFilter:s.onToggleFilters},null,8,["search-query","header-title","segments-id","onOnInputSearch","onOnToggleCreate","onOnToggleFilter","onOnSearchSubmit","onOnToggleImport","onOnExportSubmit","onOnToggleSaveFilter","onOnToggleDeleteFilter","onOnToggleEditFilter"]),u(p,{contacts:e.records,"show-search-empty-state":s.showEmptySearchResult,"is-loading":e.uiFlags.isFetching,"active-contact-id":o.selectedContactId,onOnSortChange:s.onSortChange},null,8,["contacts","show-search-empty-state","is-loading","active-contact-id","onOnSortChange"]),u(m,{class:"border-t border-slate-75 dark:border-slate-700/50","current-page":Number(e.meta.currentPage),"total-count":e.meta.count,"page-size":15,onPageChange:s.onPageChange},null,8,["current-page","total-count","onPageChange"])],2),o.showAddSegmentsModal?(n(),g(C,{key:0,"custom-views-query":o.segmentsQuery,"filter-type":o.filterType,"open-last-saved-item":s.openSavedItemInSegment,onClose:s.onCloseAddSegmentsModal},null,8,["custom-views-query","filter-type","open-last-saved-item","onClose"])):T("",!0),o.showDeleteSegmentsModal?(n(),g(_,{key:1,show:o.showDeleteSegmentsModal,"onUpdate:show":t[0]||(t[0]=I=>o.showDeleteSegmentsModal=I),"active-custom-view":s.activeSegment,"custom-views-id":a.segmentsId,"active-filter-type":o.filterType,"open-last-item-after-delete":s.openLastItemAfterDeleteInSegment,onClose:s.onCloseDeleteSegmentsModal},null,8,["show","active-custom-view","custom-views-id","active-filter-type","open-last-item-after-delete","onClose"])):T("",!0),s.showContactViewPane?(n(),g(i,{key:2,contact:s.selectedContact,"on-close":s.closeContactInfoPanel},null,8,["contact","on-close"])):T("",!0),u(b,{show:o.showCreateModal,onCancel:s.onToggleCreate},null,8,["show","onCancel"]),u(w,{show:o.showImportModal,"onUpdate:show":t[1]||(t[1]=I=>o.showImportModal=I),"on-close":s.onToggleImport},{default:h(()=>[o.showImportModal?(n(),g(E,{key:0,"on-close":s.onToggleImport},null,8,["on-close"])):T("",!0)]),_:1},8,["show","on-close"]),u(w,{show:o.showFiltersModal,"onUpdate:show":t[2]||(t[2]=I=>o.showFiltersModal=I),"on-close":s.closeAdvanceFiltersModal,size:"medium"},{default:h(()=>[o.showFiltersModal?(n(),g(H,{key:0,"on-close":s.closeAdvanceFiltersModal,"initial-filter-types":o.contactFilterItems,"initial-applied-filters":o.appliedFilter,"active-segment-name":s.activeSegmentName,"is-segments-view":s.hasActiveSegments,onApplyFilter:s.onApplyFilter,onUpdateSegment:s.onUpdateSegment,onClearFilters:s.clearFilters},null,8,["on-close","initial-filter-types","initial-applied-filters","active-segment-name","is-segments-view","onApplyFilter","onUpdateSegment","onClearFilters"])):T("",!0)]),_:1},8,["show","on-close"])])}const ws=M(Nt,[["render",Lt]]);export{ws as default};
