const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmojiInput-CQAMhbBI.js","assets/timeHelper-BT38nsET.js","assets/Spinner-B-aSVz3z.js","assets/_plugin-vue_export-helper-CvYNw_mv.js","assets/Spinner-BEUeMke2.css","assets/Thumbnail-DLjRBBx8.js","assets/Thumbnail-Cduzbvtn.css","assets/globalConfig-DaGjiImb.js","assets/_commonjsHelpers-BosuxZz1.js","assets/index-BO4rcqbh.js","assets/utils.esm-CA3tRshB.js","assets/exports-CsC-x4VI.js","assets/vue-router-CNCrM2WK.js","assets/index-BP-sUqpX.js","assets/mutationHelpers-3VTcoJiD.js","assets/index-DaWXXnfb.js","assets/timeHelper-CQh3h4mo.css","assets/Index-CtF_0wrY.js","assets/Icon-Dtj3LCzD.js","assets/EmojiInput-gYFa3zQ-.css"])))=>i.map(i=>d[i]);
import{m as yt,k as ts,u as Is,e as ht,A as Qi,l as Zi,n as Ji,o as An,_ as eo,a as Bt,M as Vs,f as to}from"./globalConfig-DaGjiImb.js";import{_ as je,o as O,n as se,p as q,t as fe,b as ha,m as Ke,k as he,q as st,r as Ze,u as ae,H as rt,g as He,j as so,e as oe,F as vt,i as Et,a as _e,l as Oe,c as We,T as jn,w as Fn,P as ws,L as at,f as ot,af as Tn,U as si,ag as ni,a6 as ai,B as Yn,W as no,V as ao,v as Gs,a3 as io,a2 as oo,ah as ro,R as _a,S as lo,d as co,C as uo}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{s as ho,b as ma,c as ii,v as En,u as rn,f as oi,g as _o}from"./mutationHelpers-3VTcoJiD.js";import{t as mo,j as Xn,C as hs,v as po,x as ri,u as Hs,y as fo,c as pa,b as fa,_ as go,z as li,B as Rs,F as ci,L as bo,H as vo,R as Ht,D as ga,O as $n,G as Hn,J as Ao,K as To,M as di,P as Eo,o as So,Q as Un,T as yo,U as Io,q as ui,V as wo,X as Ro}from"./dashboard-CGLIihvy.js";import{L as Co,A as Mo,d as hi,c as No,_ as ps,b as Oo,S as ko,M as _i,T as xo,e as Lo,f as Po,h as Bo,R as Do,i as Vo,j as Go,k as Fo,l as $o,m as Ho}from"./CustomAttributes-CrR_sV2i.js";import{u as Je,a as Kt}from"./index-BaHWIRRA.js";import{u as Uo,a as mi,b as Us}from"./useAI-wLJAkZPm.js";import{M as Wo}from"./MultiselectDropdown-Cp046MCC.js";import{u as Jt,d as jo}from"./useKeyboardNavigableList-Cfstgo2Q.js";import{S as zn}from"./Spinner-B-aSVz3z.js";import{T as qn,A as Yo}from"./Thumbnail-DLjRBBx8.js";import{M as Xo}from"./MultiselectDropdownItems-DEUXvTsY.js";import{D as zo}from"./vuedraggable.umd-rGNd3eNJ.js";import{r as qo,a as Ko,b as ba,c as Qo}from"./macroHelper-BAX1mbBw.js";import{_ as Zo}from"./BackButton-YZy1EtJv.js";import{I as Jo}from"./InboxName-DzICaIqB.js";import{u as Kn,r as on,e as er,m as tr}from"./index-C2DForDf.js";import{w as $t,z as Ts,y as sr,L as Es,d as Ss,B as nr,j as ar,D as ir}from"./DashboardIcon-CPXNa31t.js";import{e as or,f as rr,g as va,h as Aa,i as Ta,j as lr}from"./events-Ch9G9t6H.js";import{s as cr}from"./CustomSnoozeModal-C-8tQQe1.js";import{_ as pi,a as fi}from"./DropdownList-BAxlWPFC.js";import{_ as dr}from"./UserAvatarWithName-BHDu0HJS.js";import{k as ur}from"./keyboardEventListenerMixins-Du6EPVcl.js";import{w as hr,x as Wn,y as _r,a as mr,R as pr,z as Sn,q as yn,p as Ks,A as fr,B as gi,W as gr}from"./timeHelper-BT38nsET.js";import{F as br,a as vr}from"./vue-upload-component-ChbSM2aG.js";import{u as Qn}from"./useMessageFormatter-CoQTTzFX.js";import{d as bi,a as Ar,t as Tr,b as Er,r as Sr}from"./utils.esm-CA3tRshB.js";import{I as yr}from"./IframeLoader-BAMW9xzX.js";import{b as Ir}from"./portalHelper-trLcR8pg.js";import{r as Ws,t as _s,a as os}from"./index-BP-sUqpX.js";import{d as wr,B as St}from"./vue-router-CNCrM2WK.js";import{d as Rr}from"./index-ChSFqGPn.js";import{M as fs}from"./MessageTypeHelper-CjbF8VpS.js";import{b as Cr,_ as Mr}from"./typing-cGLaWCAF.js";import{_ as Nr}from"./ContextMenu-CbEc-VsQ.js";import{A as Or}from"./AddCanned-Cd1FYIf_.js";import{a as kr}from"./DateHelper-D7GM2F2-.js";import{s as xr,c as Lr}from"./exports-CsC-x4VI.js";function Pr(e,t){Ws(2,arguments);var s=_s(e),i=_s(t);return s.getFullYear()-i.getFullYear()}var Br=36e5;function Dr(e,t){Ws(2,arguments);var s=hr(e,t)/Br;return s>0?Math.floor(s):Math.ceil(s)}function Vr(e,t){Ws(2,arguments);var s=_s(e),i=_s(t),o=Wn(s,i),n=Math.abs(Pr(s,i));s.setFullYear("1584"),i.setFullYear("1584");var r=Wn(s,i)===-o,c=o*(n-r);return c===0?0:c}function Ps(e,t){if(Ws(2,arguments),!t||typeof t!="object")return new Date(NaN);var s="years"in t?os(t.years):0,i="months"in t?os(t.months):0,o="weeks"in t?os(t.weeks):0,n="days"in t?os(t.days):0,r="hours"in t?os(t.hours):0,c="minutes"in t?os(t.minutes):0,v="seconds"in t?os(t.seconds):0,x=mo(_s(e),i+s*12),h=ho(x,n+o*7),d=c+r*60,C=v+d*60,j=C*1e3,V=new Date(h.getTime()-j);return V}function Gr(e){var t=e.start,s=e.end;Ws(1,arguments);var i=_s(t),o=_s(s);if(!ma(i))throw new RangeError("Start Date is invalid");if(!ma(o))throw new RangeError("End Date is invalid");var n={years:0,months:0,days:0,hours:0,minutes:0,seconds:0},r=Wn(i,o);n.years=Math.abs(Vr(i,o));var c=Ps(i,{years:r*n.years});n.months=Math.abs(_r(c,o));var v=Ps(c,{months:r*n.months});n.days=Math.abs(wr(v,o));var x=Ps(v,{days:r*n.days});n.hours=Math.abs(Dr(x,o));var h=Ps(x,{hours:r*n.hours});n.minutes=Math.abs(Rr(h,o));var d=Ps(h,{minutes:r*n.minutes});return n.seconds=Math.abs(mr(d,o)),n}const Fr={props:{title:{type:String,required:!0},value:{type:[String,Number],default:""},compact:{type:Boolean,default:!1}}},$r={class:"items-center flex justify-between mb-1.5"},Hr={class:"text-sm font-medium text-slate-800 dark:text-slate-100"},Ur={key:0,class:"break-words"};function Wr(e,t,s,i,o,n){return O(),se("div",{class:st(["overflow-auto",s.compact?"py-0 px-0":"py-3 px-4"])},[q("div",$r,[q("span",Hr,fe(s.title),1),ha(e.$slots,"button")]),s.value?(O(),se("div",Ur,[ha(e.$slots,"default",{},()=>[Ke(fe(s.value),1)])])):he("",!0)],2)}const vi=je(Fr,[["render",Wr]]),jr={components:{Spinner:zn,LabelDropdown:Co,AddLabel:Mo},setup(){const{isAdmin:e}=Xn(),{savedLabels:t,activeLabels:s,accountLabels:i,addLabelToConversation:o,removeLabelFromConversation:n}=Uo(),r=Ze(!1),c=()=>{r.value=!r.value},v=()=>{r.value=!1};return Jt({KeyL:{action:h=>{h.preventDefault(),c()}},Escape:{action:()=>{r.value&&c()},allowOnFocusedInput:!0}}),{isAdmin:e,savedLabels:t,activeLabels:s,accountLabels:i,addLabelToConversation:o,removeLabelFromConversation:n,showSearchDropdownLabel:r,closeDropdownLabel:v,toggleLabels:c}},data(){return{selectedLabels:[]}},computed:{...yt({conversationUiFlags:"conversationLabels/getUIFlags"})}},Yr={class:"sidebar-labels-wrap"},Xr={key:0,class:"contact-conversation--list"},zr={class:"dropdown-wrap"};function qr(e,t,s,i,o,n){const r=ae("AddLabel"),c=ae("woot-label"),v=ae("LabelDropdown"),x=ae("Spinner"),h=rt("on-clickaway");return O(),se("div",Yr,[e.conversationUiFlags.isFetching?(O(),_e(x,{key:1})):(O(),se("div",Xr,[He((O(),se("div",{class:"label-wrap",onKeyup:t[0]||(t[0]=so((...d)=>i.closeDropdownLabel&&i.closeDropdownLabel(...d),["esc"]))},[oe(r,{onAdd:i.toggleLabels},null,8,["onAdd"]),(O(!0),se(vt,null,Et(i.activeLabels,d=>(O(),_e(c,{key:d.id,title:d.title,description:d.description,"show-close":"",color:d.color,variant:"smooth",class:"max-w-[calc(100%-0.5rem)]",onRemove:i.removeLabelFromConversation},null,8,["title","description","color","onRemove"]))),128)),q("div",zr,[q("div",{class:st([{"dropdown-pane--open":i.showSearchDropdownLabel},"dropdown-pane"])},[i.showSearchDropdownLabel?(O(),_e(v,{key:0,"account-labels":i.accountLabels,"selected-labels":i.savedLabels,"allow-creation":i.isAdmin,onAdd:i.addLabelToConversation,onRemove:i.removeLabelFromConversation},null,8,["account-labels","selected-labels","allow-creation","onAdd","onRemove"])):he("",!0)],2)])],32)),[[h,i.closeDropdownLabel]])]))])}const Kr=je(jr,[["render",qr],["__scopeId","data-v-0b2b048a"]]),Qr={components:{ContactDetailsItem:vi,MultiselectDropdown:Wo,ConversationLabels:Kr},props:{conversationId:{type:[Number,String],required:!0}},setup(){const{agentsList:e}=mi();return{agentsList:e}},data(){return{priorityOptions:[{id:null,name:this.$t("CONVERSATION.PRIORITY.OPTIONS.NONE"),thumbnail:"/assets/images/dashboard/priority/none.svg"},{id:ts.URGENT,name:this.$t("CONVERSATION.PRIORITY.OPTIONS.URGENT"),thumbnail:`/assets/images/dashboard/priority/${ts.URGENT}.svg`},{id:ts.HIGH,name:this.$t("CONVERSATION.PRIORITY.OPTIONS.HIGH"),thumbnail:`/assets/images/dashboard/priority/${ts.HIGH}.svg`},{id:ts.MEDIUM,name:this.$t("CONVERSATION.PRIORITY.OPTIONS.MEDIUM"),thumbnail:`/assets/images/dashboard/priority/${ts.MEDIUM}.svg`},{id:ts.LOW,name:this.$t("CONVERSATION.PRIORITY.OPTIONS.LOW"),thumbnail:`/assets/images/dashboard/priority/${ts.LOW}.svg`}]}},computed:{...yt({currentChat:"getSelectedChat",currentUser:"getCurrentUser",teams:"teams/getTeams"}),hasAnAssignedTeam(){var e,t;return!!((t=(e=this.currentChat)==null?void 0:e.meta)!=null&&t.team)},teamsList(){return this.hasAnAssignedTeam?[{id:0,name:this.$t("TEAMS_SETTINGS.LIST.NONE")},...this.teams]:this.teams},assignedAgent:{get(){return this.currentChat.meta.assignee},set(e){const t=e?e.id:0;this.$store.dispatch("setCurrentChatAssignee",e),this.$store.dispatch("assignAgent",{conversationId:this.currentChat.id,agentId:t}).then(()=>{Je(this.$t("CONVERSATION.CHANGE_AGENT"))})}},assignedTeam:{get(){return this.currentChat.meta.team},set(e){const t=this.currentChat.id,s=e?e.id:0;this.$store.dispatch("setCurrentChatTeam",{team:e,conversationId:t}),this.$store.dispatch("assignTeam",{conversationId:t,teamId:s}).then(()=>{Je(this.$t("CONVERSATION.CHANGE_TEAM"))})}},assignedPriority:{get(){return this.priorityOptions.find(t=>t.id===this.currentChat.priority)||this.priorityOptions[0]},set(e){var o;const t=this.currentChat.id,s=(o=this.currentChat)==null?void 0:o.priority,i=e?e.id:null;this.$store.dispatch("setCurrentChatPriority",{priority:i,conversationId:t}),this.$store.dispatch("assignPriority",{conversationId:t,priority:i}).then(()=>{Kt(hs.CHANGE_PRIORITY,{oldValue:s,newValue:i,from:"Conversation Sidebar"}),Je(this.$t("CONVERSATION.PRIORITY.CHANGE_PRIORITY.SUCCESSFUL",{priority:e.name,conversationId:t}))})}},showSelfAssign(){return!this.assignedAgent||this.assignedAgent.id!==this.currentUser.id}},methods:{onSelfAssign(){const{account_id:e,availability_status:t,available_name:s,email:i,id:o,name:n,role:r,avatar_url:c}=this.currentUser,v={account_id:e,availability_status:t,available_name:s,email:i,id:o,name:n,role:r,thumbnail:c};this.assignedAgent=v},onClickAssignAgent(e){this.assignedAgent&&this.assignedAgent.id===e.id?this.assignedAgent=null:this.assignedAgent=e},onClickAssignTeam(e){this.assignedTeam&&this.assignedTeam.id===e.id?this.assignedTeam=null:this.assignedTeam=e},onClickAssignPriority(e){const t=this.assignedPriority&&this.assignedPriority.id===e.id;this.assignedPriority=t?null:e}}},Zr={class:"bg-white dark:bg-slate-900"},Jr={class:"multiselect-wrap--small"},el={class:"multiselect-wrap--small"},tl={class:"multiselect-wrap--small"};function sl(e,t,s,i,o,n){const r=ae("woot-button"),c=ae("ContactDetailsItem"),v=ae("MultiselectDropdown"),x=ae("ConversationLabels");return O(),se("div",Zr,[q("div",Jr,[oe(c,{compact:"",title:e.$t("CONVERSATION_SIDEBAR.ASSIGNEE_LABEL")},{button:Oe(()=>[n.showSelfAssign?(O(),_e(r,{key:0,icon:"arrow-right",variant:"link",size:"small",onClick:n.onSelfAssign},{default:Oe(()=>[Ke(fe(e.$t("CONVERSATION_SIDEBAR.SELF_ASSIGN")),1)]),_:1},8,["onClick"])):he("",!0)]),_:1},8,["title"]),oe(v,{options:i.agentsList,"selected-item":n.assignedAgent,"multiselector-title":e.$t("AGENT_MGMT.MULTI_SELECTOR.TITLE.AGENT"),"multiselector-placeholder":e.$t("AGENT_MGMT.MULTI_SELECTOR.PLACEHOLDER"),"no-search-result":e.$t("AGENT_MGMT.MULTI_SELECTOR.SEARCH.NO_RESULTS.AGENT"),"input-placeholder":e.$t("AGENT_MGMT.MULTI_SELECTOR.SEARCH.PLACEHOLDER.AGENT"),onSelect:n.onClickAssignAgent},null,8,["options","selected-item","multiselector-title","multiselector-placeholder","no-search-result","input-placeholder","onSelect"])]),q("div",el,[oe(c,{compact:"",title:e.$t("CONVERSATION_SIDEBAR.TEAM_LABEL")},null,8,["title"]),oe(v,{options:n.teamsList,"selected-item":n.assignedTeam,"multiselector-title":e.$t("AGENT_MGMT.MULTI_SELECTOR.TITLE.TEAM"),"multiselector-placeholder":e.$t("AGENT_MGMT.MULTI_SELECTOR.PLACEHOLDER"),"no-search-result":e.$t("AGENT_MGMT.MULTI_SELECTOR.SEARCH.NO_RESULTS.TEAM"),"input-placeholder":e.$t("AGENT_MGMT.MULTI_SELECTOR.SEARCH.PLACEHOLDER.INPUT"),onSelect:n.onClickAssignTeam},null,8,["options","selected-item","multiselector-title","multiselector-placeholder","no-search-result","input-placeholder","onSelect"])]),q("div",tl,[oe(c,{compact:"",title:e.$t("CONVERSATION.PRIORITY.TITLE")},null,8,["title"]),oe(v,{options:o.priorityOptions,"selected-item":n.assignedPriority,"multiselector-title":e.$t("CONVERSATION.PRIORITY.TITLE"),"multiselector-placeholder":e.$t("CONVERSATION.PRIORITY.CHANGE_PRIORITY.SELECT_PLACEHOLDER"),"no-search-result":e.$t("CONVERSATION.PRIORITY.CHANGE_PRIORITY.NO_RESULTS"),"input-placeholder":e.$t("CONVERSATION.PRIORITY.CHANGE_PRIORITY.INPUT_PLACEHOLDER"),onSelect:n.onClickAssignPriority},null,8,["options","selected-item","multiselector-title","multiselector-placeholder","no-search-result","input-placeholder","onSelect"])]),oe(c,{compact:"",title:e.$t("CONVERSATION_SIDEBAR.ACCORDION.CONVERSATION_LABELS")},null,8,["title"]),oe(x,{"conversation-id":s.conversationId},null,8,["conversation-id"])])}const nl=je(Qr,[["render",sl]]),al={components:{Thumbnail:qn},props:{usersList:{type:Array,default:()=>[]},size:{type:String,default:"24px"},showMoreThumbnailsCount:{type:Boolean,default:!1},moreThumbnailsText:{type:String,default:""},gap:{type:String,default:"normal",validator(e){return["normal","","tight"].includes(e)}}}},il={class:"overlapping-thumbnails"},ol={key:0,class:"thumbnail-more-text"};function rl(e,t,s,i,o,n){const r=ae("Thumbnail"),c=rt("tooltip");return O(),se("div",il,[(O(!0),se(vt,null,Et(s.usersList,v=>He((O(),_e(r,{key:v.id,title:v.name,src:v.thumbnail,username:v.name,"has-border":"",size:s.size,class:st(`overlapping-thumbnail gap-${s.gap}`)},null,8,["title","src","username","size","class"])),[[c,v.name]])),128)),s.showMoreThumbnailsCount?(O(),se("span",ol,fe(s.moreThumbnailsText),1)):he("",!0)])}const ll=je(al,[["render",rl],["__scopeId","data-v-44d47396"]]),cl={components:{Spinner:zn,ThumbnailGroup:ll,MultiselectDropdownItems:Xo},props:{conversationId:{type:[Number,String],required:!0}},setup(){const{agentsList:e}=mi(!1);return{agentsList:e}},data(){return{selectedWatchers:[],showDropDown:!1}},computed:{...yt({watchersUiFlas:"conversationWatchers/getUIFlags",currentUser:"getCurrentUser"}),watchersFromStore(){return this.$store.getters["conversationWatchers/getByConversationId"](this.conversationId)},watchersList:{get(){return this.selectedWatchers},set(e){this.selectedWatchers=[...e];const t=e.map(s=>s.id);this.updateParticipant(t)}},isUserWatching(){return this.selectedWatchers.some(e=>e.id===this.currentUser.id)},thumbnailList(){return this.selectedWatchers.slice(0,4)},moreAgentCount(){return this.watchersList.length-4},moreThumbnailsText(){return this.moreAgentCount>1?this.$t("CONVERSATION_PARTICIPANTS.REMANING_PARTICIPANTS_TEXT",{count:this.moreAgentCount}):this.$t("CONVERSATION_PARTICIPANTS.REMANING_PARTICIPANT_TEXT",{count:1})},showMoreThumbs(){return this.moreAgentCount>0},totalWatchersText(){return this.selectedWatchers.length>1?this.$t("CONVERSATION_PARTICIPANTS.TOTAL_PARTICIPANTS_TEXT",{count:this.selectedWatchers.length}):this.$t("CONVERSATION_PARTICIPANTS.TOTAL_PARTICIPANT_TEXT",{count:1})}},watch:{conversationId(){this.fetchParticipants()},watchersFromStore(e=[]){this.selectedWatchers=[...e]}},mounted(){this.fetchParticipants(),this.$store.dispatch("agents/get")},methods:{fetchParticipants(){const e=this.conversationId;this.$store.dispatch("conversationWatchers/show",{conversationId:e})},async updateParticipant(e){const t=this.conversationId;let s=this.$t("CONVERSATION_PARTICIPANTS.API.SUCCESS_MESSAGE");try{await this.$store.dispatch("conversationWatchers/update",{conversationId:t,userIds:e})}catch(i){s=(i==null?void 0:i.message)||this.$t("CONVERSATION_PARTICIPANTS.API.ERROR_MESSAGE")}finally{Je(s)}this.fetchParticipants()},onOpenDropdown(){this.showDropDown=!0},onCloseDropdown(){this.showDropDown=!1},onClickItem(e){if(this.watchersList.some(s=>s.id===e.id)){const s=this.watchersList.filter(i=>i.id!==e.id);this.watchersList=[...s]}else this.watchersList=[...this.watchersList,e]},onSelfAssign(){this.watchersList=[...this.selectedWatchers,this.currentUser]}}},dl={class:"relative bg-white dark:bg-slate-900"},ul={class:"flex justify-between"},hl={class:"flex justify-between w-full mb-1"},_l={key:0,class:"m-0 text-sm total-watchers"},ml={key:1,class:"m-0 text-sm text-slate-400 dark:text-slate-700"},pl={class:"flex items-center justify-between"},fl={key:0,class:"m-0 text-sm text-slate-300 dark:text-slate-300"},gl={class:"flex items-center justify-between mb-1"},bl={class:"m-0 overflow-hidden text-sm whitespace-nowrap text-ellipsis text-slate-800 dark:text-slate-100"};function vl(e,t,s,i,o,n){const r=ae("Spinner"),c=ae("woot-button"),v=ae("ThumbnailGroup"),x=ae("MultiselectDropdownItems"),h=rt("tooltip"),d=rt("on-clickaway");return O(),se("div",dl,[q("div",ul,[q("div",hl,[q("div",null,[n.watchersList.length?(O(),se("p",_l,[e.watchersUiFlas.isFetching?(O(),_e(r,{key:0,size:"tiny"})):he("",!0),Ke(" "+fe(n.totalWatchersText),1)])):(O(),se("p",ml,fe(e.$t("CONVERSATION_PARTICIPANTS.NO_PARTICIPANTS_TEXT")),1))]),He(oe(c,{title:e.$t("CONVERSATION_PARTICIPANTS.ADD_PARTICIPANTS"),icon:"settings",size:"tiny",variant:"smooth","color-scheme":"secondary",onClick:n.onOpenDropdown},null,8,["title","onClick"]),[[h,e.$t("CONVERSATION_PARTICIPANTS.ADD_PARTICIPANTS"),void 0,{left:!0}]])])]),q("div",pl,[oe(v,{"more-thumbnails-text":n.moreThumbnailsText,"show-more-thumbnails-count":n.showMoreThumbs,"users-list":n.thumbnailList},null,8,["more-thumbnails-text","show-more-thumbnails-count","users-list"]),n.isUserWatching?(O(),se("p",fl,fe(e.$t("CONVERSATION_PARTICIPANTS.YOU_ARE_WATCHING")),1)):(O(),_e(c,{key:1,icon:"arrow-right",variant:"link",size:"small",onClick:n.onSelfAssign},{default:Oe(()=>[Ke(fe(e.$t("CONVERSATION_PARTICIPANTS.WATCH_CONVERSATION")),1)]),_:1},8,["onClick"]))]),He((O(),se("div",{class:st([{"dropdown-pane--open":o.showDropDown},"dropdown-pane"])},[q("div",gl,[q("h4",bl,fe(e.$t("CONVERSATION_PARTICIPANTS.ADD_PARTICIPANTS")),1),oe(c,{icon:"dismiss",size:"tiny","color-scheme":"secondary",variant:"clear",onClick:n.onCloseDropdown},null,8,["onClick"])]),oe(x,{options:i.agentsList,"selected-items":o.selectedWatchers,"has-thumbnail":"",onSelect:n.onClickItem},null,8,["options","selected-items","onSelect"])],2)),[[d,()=>{n.onCloseDropdown()}]])])}const Al=je(cl,[["render",vl],["__scopeId","data-v-cfa1df8a"]]),Tl={class:"conversation--details"},El=["href"],Sl={__name:"ConversationInfo",props:{conversationAttributes:{type:Object,default:()=>({})},contactAttributes:{type:Object,default:()=>({})}},setup(e){const t=e,s=We(()=>t.conversationAttributes.referer),i=We(()=>{var d;return(d=t.conversationAttributes.initiated_at)==null?void 0:d.timestamp}),o=We(()=>t.conversationAttributes.browser),n=We(()=>{if(!o.value)return"";const{browser_name:d="",browser_version:C=""}=o.value;return`${d} ${C}`}),r=We(()=>po(t.conversationAttributes.browser_language)),c=We(()=>{if(!o.value)return"";const{platform_name:d="",platform_version:C=""}=o.value;return`${d} ${C}`}),v=We(()=>t.contactAttributes.created_at_ip),x=We(()=>[{content:i,title:"CONTACT_PANEL.INITIATED_AT"},{content:r,title:"CONTACT_PANEL.BROWSER_LANGUAGE"},{content:s,title:"CONTACT_PANEL.INITIATED_FROM",type:"link"},{content:n,title:"CONTACT_PANEL.BROWSER"},{content:c,title:"CONTACT_PANEL.OS"},{content:v,title:"CONTACT_PANEL.IP_ADDRESS"}].filter(d=>!!d.content.value)),h=["[&>*:nth-child(odd)]:!bg-white [&>*:nth-child(even)]:!bg-slate-25","dark:[&>*:nth-child(odd)]:!bg-slate-900 dark:[&>*:nth-child(even)]:!bg-slate-800/50"];return(d,C)=>(O(),se("div",Tl,[q("div",{class:st(h)},[(O(!0),se(vt,null,Et(x.value,j=>(O(),_e(vi,{key:j.title,title:d.$t(j.title),value:j.content.value,class:"border-b border-solid border-slate-50 dark:border-slate-700/50"},{default:Oe(()=>[j.type==="link"?(O(),se("a",{key:0,href:s.value,rel:"noopener noreferrer nofollow",target:"_blank",class:"text-woot-400 dark:text-woot-600"},fe(s.value),9,El)):he("",!0)]),_:2},1032,["title","value"]))),128))]),oe(hi,{"start-at":x.value.length%2===0?"even":"odd","attribute-class":"conversation--attribute","attribute-from":"conversation_panel","attribute-type":"conversation_attribute"},null,8,["start-at"])]))}},yl={props:{macro:{type:Object,required:!0}},computed:{resolvedMacro(){return this.macro.actions.map(e=>({actionName:qo(e.action_name),actionValue:this.getActionValue(e.action_name,e.action_params)}))},...yt({labels:"labels/getLabels",teams:"teams/getTeams",agents:"agents/getAgents"})},methods:{getActionValue(e,t){return{assign_team:Ko(this.teams,t),add_label:ba(this.labels,t),remove_label:ba(this.labels,t),assign_agent:Qo(this.agents,t),mute_conversation:null,snooze_conversation:null,resolve_conversation:null,remove_assigned_team:null,send_webhook_event:t[0],send_message:t[0],send_email_transcript:t[0],add_private_note:t[0]}[e]||""}}},Il={class:"macro-preview absolute max-h-[22.5rem] w-64 rounded-md bg-white dark:bg-slate-800 shadow-lg bottom-8 right-8 overflow-y-auto p-4 text-left rtl:text-right"},wl={class:"text-sm text-slate-800 dark:text-slate-100 mb-4"},Rl={key:0,class:"top-[0.390625rem] absolute -bottom-1 left-0 w-px bg-slate-75 dark:bg-slate-600"},Cl={class:"text-xs text-slate-500 dark:text-slate-400 mb-1"},Ml={class:"text-slate-800 dark:text-slate-100"};function Nl(e,t,s,i,o,n){return O(),se("div",Il,[q("h6",wl,fe(s.macro.name),1),(O(!0),se(vt,null,Et(n.resolvedMacro,(r,c)=>(O(),se("div",{key:c,class:"relative pl-4 macro-block"},[c!==s.macro.actions.length-1?(O(),se("div",Rl)):he("",!0),t[0]||(t[0]=q("div",{class:"absolute -left-[0.21875rem] top-[0.2734375rem] w-2 h-2 rounded-full bg-white dark:bg-slate-200 border-2 border-solid border-slate-100 dark:border-slate-600"},null,-1)),q("p",Cl,fe(r.actionName),1),q("p",Ml,fe(r.actionValue),1)]))),128))])}const Ol=je(yl,[["render",Nl],["__scopeId","data-v-873d670a"]]),kl={components:{MacroPreview:Ol},props:{macro:{type:Object,required:!0},conversationId:{type:[Number,String],required:!0}},data(){return{isExecuting:!1,showPreview:!1}},methods:{async executeMacro(e){try{this.isExecuting=!0,await this.$store.dispatch("macros/execute",{macroId:e.id,conversationIds:[this.conversationId]}),Kt(hs.EXECUTED_A_MACRO),Je(this.$t("MACROS.EXECUTE.EXECUTED_SUCCESSFULLY"))}catch{Je(this.$t("MACROS.ERROR"))}finally{this.isExecuting=!1}},toggleMacroPreview(){this.showPreview=!this.showPreview},closeMacroPreview(){this.showPreview=!1}}},xl={class:"macro button secondary clear"},Ll={class:"overflow-hidden whitespace-nowrap text-ellipsis"},Pl={class:"flex items-center gap-1 macros-actions"};function Bl(e,t,s,i,o,n){const r=ae("woot-button"),c=ae("MacroPreview"),v=rt("tooltip"),x=rt("on-clickaway");return O(),se("div",xl,[q("span",Ll,fe(s.macro.name),1),q("div",Pl,[He(oe(r,{size:"tiny",variant:"smooth","color-scheme":"secondary",icon:"info",onClick:t[0]||(t[0]=h=>n.toggleMacroPreview(s.macro))},null,512),[[v,e.$t("MACROS.EXECUTE.PREVIEW"),void 0,{"left-start":!0}]]),He(oe(r,{size:"tiny",variant:"smooth","color-scheme":"secondary",icon:"play-circle","is-loading":o.isExecuting,onClick:t[1]||(t[1]=h=>n.executeMacro(s.macro))},null,8,["is-loading"]),[[v,e.$t("MACROS.EXECUTE.BUTTON_TOOLTIP"),void 0,{"left-start":!0}]])]),oe(jn,{name:"menu-slide"},{default:Oe(()=>[o.showPreview?He((O(),_e(c,{key:0,macro:s.macro},null,8,["macro"])),[[x,n.closeMacroPreview]]):he("",!0)]),_:1})])}const Dl=je(kl,[["render",Bl],["__scopeId","data-v-2f76b8b3"]]),Vl={components:{MacroItem:Dl},props:{conversationId:{type:[Number,String],required:!0}},setup(){const{accountScopedUrl:e}=ri();return{accountScopedUrl:e}},computed:{...yt({macros:["macros/getMacros"],uiFlags:"macros/getUIFlags"})},mounted(){this.$store.dispatch("macros/get")}},Gl={key:0,class:"macros_list--empty-state"},Fl={class:"flex flex-col items-center justify-center h-full"},$l={key:2,class:"macros-list"};function Hl(e,t,s,i,o,n){const r=ae("woot-button"),c=ae("router-link"),v=ae("woot-loading-state"),x=ae("MacroItem");return O(),se("div",null,[!e.uiFlags.isFetching&&!e.macros.length?(O(),se("div",Gl,[q("p",Fl,fe(e.$t("MACROS.LIST.404")),1),oe(c,{to:i.accountScopedUrl("settings/macros")},{default:Oe(()=>[oe(r,{variant:"smooth",icon:"add",size:"tiny",class:"macros_add-button"},{default:Oe(()=>[Ke(fe(e.$t("MACROS.HEADER_BTN_TXT")),1)]),_:1})]),_:1},8,["to"])])):he("",!0),e.uiFlags.isFetching?(O(),_e(v,{key:1,message:e.$t("MACROS.LOADING")},null,8,["message"])):he("",!0),!e.uiFlags.isFetching&&e.macros.length?(O(),se("div",$l,[(O(!0),se(vt,null,Et(e.macros,h=>(O(),_e(x,{key:h.id,macro:h,"conversation-id":s.conversationId},null,8,["macro","conversation-id"]))),128))])):he("",!0)])}const Ul=je(Vl,[["render",Hl],["__scopeId","data-v-0d65aee0"]]),Wl={class:"overflow-y-auto bg-white border-l dark:bg-slate-900 text-slate-900 dark:text-slate-300 border-slate-50 dark:border-slate-800/50 rtl:border-l-0 rtl:border-r contact--panel"},jl={class:"list-group"},Yl={key:0,class:"conversation--actions"},Xl={key:1,class:"conversation--actions"},zl={key:2},ql={key:3},Kl={key:4},Ql={__name:"ContactPanel",props:{conversationId:{type:[Number,String],required:!0},inboxId:{type:Number,default:void 0},onToggle:{type:Function,default:()=>{}}},setup(e){const t=e,{updateUISettings:s,isContactSidebarItemOpen:i,conversationSidebarItemsOrder:o,toggleSidebarUIState:n}=Hs(),r=Ze(!1),c=Ze([]),v=ii(),x=En("getSelectedChat"),h=We(()=>t.conversationId),d=En("conversationMetadata/getConversationMetadata"),C=We(()=>d.value(h.value)),j=We(()=>C.value.additional_attributes||{}),V=We(()=>{var p;return(p=x.value.meta)==null?void 0:p.channel}),X=En("contacts/getContact"),Y=We(()=>{var p,M;return(M=(p=x.value.meta)==null?void 0:p.sender)==null?void 0:M.id}),I=We(()=>X.value(Y.value)),f=We(()=>I.value.additional_attributes||{}),g=()=>{Y.value&&v.dispatch("contacts/show",{id:Y.value})};Fn(h,(p,M)=>{p&&p!==M&&g()}),Fn(Y,g);const y=t.onToggle,a=()=>{r.value=!1,s({conversation_sidebar_items_order:c.value})};return ws(()=>{c.value=o.value,g(),v.dispatch("attributes/get",0)}),(p,M)=>{const P=ae("woot-feature-toggle");return O(),se("div",Wl,[oe(No,{contact:I.value,"channel-type":V.value,onTogglePanel:at(y)},null,8,["contact","channel-type","onTogglePanel"]),q("div",jl,[oe(at(zo),{list:c.value,animation:"200","ghost-class":"ghost",handle:".drag-handle","item-key":"name",onStart:M[6]||(M[6]=G=>r.value=!0),onEnd:a},{item:Oe(({element:G})=>[(O(),se("div",{key:G.name,class:"bg-white dark:bg-gray-800"},[G.name==="conversation_actions"?(O(),se("div",Yl,[oe(ps,{title:p.$t("CONVERSATION_SIDEBAR.ACCORDION.CONVERSATION_ACTIONS"),"is-open":at(i)("is_conv_actions_open"),onToggle:M[0]||(M[0]=N=>at(n)("is_conv_actions_open",N))},{default:Oe(()=>[oe(nl,{"conversation-id":h.value,"inbox-id":e.inboxId},null,8,["conversation-id","inbox-id"])]),_:1},8,["title","is-open"])])):G.name==="conversation_participants"?(O(),se("div",Xl,[oe(ps,{title:p.$t("CONVERSATION_PARTICIPANTS.SIDEBAR_TITLE"),"is-open":at(i)("is_conv_participants_open"),onToggle:M[1]||(M[1]=N=>at(n)("is_conv_participants_open",N))},{default:Oe(()=>[oe(Al,{"conversation-id":h.value,"inbox-id":e.inboxId},null,8,["conversation-id","inbox-id"])]),_:1},8,["title","is-open"])])):G.name==="conversation_info"?(O(),se("div",zl,[oe(ps,{title:p.$t("CONVERSATION_SIDEBAR.ACCORDION.CONVERSATION_INFO"),"is-open":at(i)("is_conv_details_open"),compact:"",onToggle:M[2]||(M[2]=N=>at(n)("is_conv_details_open",N))},{default:Oe(()=>[oe(Sl,{"conversation-attributes":j.value,"contact-attributes":f.value},null,8,["conversation-attributes","contact-attributes"])]),_:1},8,["title","is-open"])])):G.name==="contact_attributes"?(O(),se("div",ql,[oe(ps,{title:p.$t("CONVERSATION_SIDEBAR.ACCORDION.CONTACT_ATTRIBUTES"),"is-open":at(i)("is_contact_attributes_open"),compact:"",onToggle:M[3]||(M[3]=N=>at(n)("is_contact_attributes_open",N))},{default:Oe(()=>[oe(hi,{"attribute-type":"contact_attribute","attribute-from":"conversation_contact_panel","contact-id":I.value.id,"empty-state-message":p.$t("CONVERSATION_CUSTOM_ATTRIBUTES.NO_RECORDS_FOUND")},null,8,["contact-id","empty-state-message"])]),_:1},8,["title","is-open"])])):G.name==="previous_conversation"?(O(),se("div",Kl,[I.value.id?(O(),_e(ps,{key:0,title:p.$t("CONVERSATION_SIDEBAR.ACCORDION.PREVIOUS_CONVERSATION"),"is-open":at(i)("is_previous_conv_open"),compact:"",onToggle:M[4]||(M[4]=N=>at(n)("is_previous_conv_open",N))},{default:Oe(()=>[oe(Oo,{"contact-id":I.value.id,"conversation-id":h.value},null,8,["contact-id","conversation-id"])]),_:1},8,["title","is-open"])):he("",!0)])):G.name==="macros"?(O(),_e(P,{key:5,"feature-key":"macros"},{default:Oe(()=>[oe(ps,{title:p.$t("CONVERSATION_SIDEBAR.ACCORDION.MACROS"),"is-open":at(i)("is_macro_open"),compact:"",onToggle:M[5]||(M[5]=N=>at(n)("is_macro_open",N))},{default:Oe(()=>[oe(Ul,{"conversation-id":h.value},null,8,["conversation-id"])]),_:1},8,["title","is-open"])]),_:1})):he("",!0)]))]),_:1},8,["list"])])])}}},Zl=je(Ql,[["__scopeId","data-v-488f5a06"]]),Jl={props:{show:{type:Boolean,default:!1},currentChat:{type:Object,default:()=>({})}},emits:["cancel","update:show"],setup(){return{v$:Kn()}},data(){return{email:"",selectedType:"",isSubmitting:!1}},validations:{email:{required:on,email:er,minLength:tr(4)}},computed:{localShow:{get(){return this.show},set(e){this.$emit("update:show",e)}},sentToOtherEmailAddress(){return this.selectedType==="other_email_address"},isFormValid(){return this.selectedType?this.sentToOtherEmailAddress?!!this.email&&!this.v$.email.$error:!0:!1},selectedEmailAddress(){const{meta:e}=this.currentChat;switch(this.selectedType){case"contact":return e.sender.email;case"assignee":return e.assignee.email;case"other_email_address":return this.email;default:return""}}},methods:{onCancel(){this.$emit("cancel")},async onSubmit(){this.isSubmitting=!1;try{await this.$store.dispatch("sendEmailTranscript",{email:this.selectedEmailAddress,conversationId:this.currentChat.id}),Je(this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_SUCCESS")),this.onCancel()}catch{Je(this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_ERROR"))}finally{this.isSubmitting=!1}}}},ec={class:"flex flex-col h-auto overflow-auto"},tc={class:"w-full"},sc={key:0,class:"flex items-center gap-2"},nc={for:"contact"},ac={key:1,class:"flex items-center gap-2"},ic={for:"assignee"},oc={class:"flex items-center gap-2"},rc={for:"other_email_address"},lc={key:2,class:"w-[50%] mt-1"},cc=["placeholder"],dc={key:0,class:"message"},uc={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"};function hc(e,t,s,i,o,n){const r=ae("woot-modal-header"),c=ae("woot-submit-button"),v=ae("woot-modal");return O(),_e(v,{show:n.localShow,"onUpdate:show":t[7]||(t[7]=x=>n.localShow=x),"on-close":n.onCancel},{default:Oe(()=>[q("div",ec,[oe(r,{"header-title":e.$t("EMAIL_TRANSCRIPT.TITLE"),"header-content":e.$t("EMAIL_TRANSCRIPT.DESC")},null,8,["header-title","header-content"]),q("form",{class:"w-full",onSubmit:t[6]||(t[6]=ot((...x)=>n.onSubmit&&n.onSubmit(...x),["prevent"]))},[q("div",tc,[s.currentChat.meta.sender&&s.currentChat.meta.sender.email?(O(),se("div",sc,[He(q("input",{id:"contact","onUpdate:modelValue":t[0]||(t[0]=x=>o.selectedType=x),type:"radio",name:"selectedType",value:"contact"},null,512),[[Tn,o.selectedType]]),q("label",nc,fe(e.$t("EMAIL_TRANSCRIPT.FORM.SEND_TO_CONTACT")),1)])):he("",!0),s.currentChat.meta.assignee?(O(),se("div",ac,[He(q("input",{id:"assignee","onUpdate:modelValue":t[1]||(t[1]=x=>o.selectedType=x),type:"radio",name:"selectedType",value:"assignee"},null,512),[[Tn,o.selectedType]]),q("label",ic,fe(e.$t("EMAIL_TRANSCRIPT.FORM.SEND_TO_AGENT")),1)])):he("",!0),q("div",oc,[He(q("input",{id:"other_email_address","onUpdate:modelValue":t[2]||(t[2]=x=>o.selectedType=x),type:"radio",name:"selectedType",value:"other_email_address"},null,512),[[Tn,o.selectedType]]),q("label",rc,fe(e.$t("EMAIL_TRANSCRIPT.FORM.SEND_TO_OTHER_EMAIL_ADDRESS")),1)]),n.sentToOtherEmailAddress?(O(),se("div",lc,[q("label",{class:st({error:i.v$.email.$error})},[He(q("input",{"onUpdate:modelValue":t[3]||(t[3]=x=>o.email=x),type:"text",placeholder:e.$t("EMAIL_TRANSCRIPT.FORM.EMAIL.PLACEHOLDER"),onInput:t[4]||(t[4]=(...x)=>i.v$.email.$touch&&i.v$.email.$touch(...x))},null,40,cc),[[si,o.email]]),i.v$.email.$error?(O(),se("span",dc,fe(e.$t("EMAIL_TRANSCRIPT.FORM.EMAIL.ERROR")),1)):he("",!0)],2)])):he("",!0)]),q("div",uc,[oe(c,{"button-text":e.$t("EMAIL_TRANSCRIPT.SUBMIT"),disabled:!n.isFormValid},null,8,["button-text","disabled"]),q("button",{class:"button clear",onClick:t[5]||(t[5]=ot((...x)=>n.onCancel&&n.onCancel(...x),["prevent"]))},fe(e.$t("EMAIL_TRANSCRIPT.CANCEL")),1)])],32)])]),_:1},8,["show","on-close"])}const _c=je(Jl,[["render",hc]]),mc={class:"relative flex items-center justify-end resolve-actions"},pc={class:"button-group"},fc={key:0,class:"dropdown-pane dropdown-pane--open left-auto top-[2.625rem] mt-0.5 right-0 max-w-[12.5rem] min-w-[9.75rem]"},gc={__name:"ResolveAction",setup(e){const t=ii(),s=rn(),{t:i}=Is(),o=Ze(null),n=Ze(!1),[r,c]=fo(),v=()=>c(!1),x=()=>c(!0),h=We(()=>s.getSelectedChat.value),d=We(()=>h.value.status===$t.STATUS_TYPE.OPEN),C=We(()=>h.value.status===$t.STATUS_TYPE.PENDING),j=We(()=>h.value.status===$t.STATUS_TYPE.RESOLVED),V=We(()=>h.value.status===$t.STATUS_TYPE.SNOOZED),X=We(()=>C.value?"primary":d.value?"success":j.value?"warning":""),Y=We(()=>!C.value&&!V.value),I=We(()=>C.value||V.value),f=()=>{const P=document.querySelectorAll(".conversations-list .conversation"),G=document.querySelector("div.conversations-list div.conversation.active"),N=[...P].indexOf(G),F=P.length-1;return{all:P,activeIndex:N,lastIndex:F}},g=()=>{document.querySelector("ninja-keys").open({parent:"snooze_conversation"})},y=(P,G)=>{v(),n.value=!0,t.dispatch("toggleStatus",{conversationId:h.value.id,status:P,snoozedUntil:G}).then(()=>{Je(i("CONVERSATION.CHANGE_STATUS")),n.value=!1})},a=()=>{y($t.STATUS_TYPE.OPEN)},p=()=>{y($t.STATUS_TYPE.RESOLVED)};return Jt({"Alt+KeyM":{action:()=>{var P;return(P=o.value)==null?void 0:P.$el.click()},allowOnFocusedInput:!0},"Alt+KeyE":{action:async()=>{await y($t.STATUS_TYPE.RESOLVED)}},"$mod+Alt+KeyE":{action:async P=>{const{all:G,activeIndex:N,lastIndex:F}=f();await y($t.STATUS_TYPE.RESOLVED),N<F?G[N+1].click():G.length>1&&(G[0].click(),document.querySelector(".conversations-list").scrollTop=0),P.preventDefault()}}}),pa(or,a),pa(rr,p),(P,G)=>{const N=ae("woot-button"),F=rt("on-clickaway");return O(),se("div",mc,[q("div",pc,[d.value?(O(),_e(N,{key:0,"class-names":"resolve","color-scheme":"success",icon:"checkmark",emoji:"✅","is-loading":n.value,onClick:p},{default:Oe(()=>[Ke(fe(P.$t("CONVERSATION.HEADER.RESOLVE_ACTION")),1)]),_:1},8,["is-loading"])):j.value?(O(),_e(N,{key:1,"class-names":"resolve","color-scheme":"warning",icon:"arrow-redo",emoji:"👀","is-loading":n.value,onClick:a},{default:Oe(()=>[Ke(fe(at(i)("CONVERSATION.HEADER.REOPEN_ACTION")),1)]),_:1},8,["is-loading"])):I.value?(O(),_e(N,{key:2,"class-names":"resolve","color-scheme":"primary",icon:"person","is-loading":n.value,onClick:a},{default:Oe(()=>[Ke(fe(at(i)("CONVERSATION.HEADER.OPEN_ACTION")),1)]),_:1},8,["is-loading"])):he("",!0),Y.value?(O(),_e(N,{key:3,ref_key:"arrowDownButtonRef",ref:o,"color-scheme":X.value,disabled:n.value,icon:"chevron-down",emoji:"🔽",onClick:x},null,8,["color-scheme","disabled"])):he("",!0)]),at(r)?He((O(),se("div",fc,[oe(go,{class:"mb-0"},{default:Oe(()=>[C.value?he("",!0):(O(),_e(fa,{key:0},{default:Oe(()=>[oe(N,{variant:"clear","color-scheme":"secondary",size:"small",icon:"snooze",onClick:G[0]||(G[0]=()=>g())},{default:Oe(()=>[Ke(fe(at(i)("CONVERSATION.RESOLVE_DROPDOWN.SNOOZE_UNTIL")),1)]),_:1})]),_:1})),C.value?he("",!0):(O(),_e(fa,{key:1},{default:Oe(()=>[oe(N,{variant:"clear","color-scheme":"secondary",size:"small",icon:"book-clock",onClick:G[1]||(G[1]=()=>y(at($t).STATUS_TYPE.PENDING))},{default:Oe(()=>[Ke(fe(at(i)("CONVERSATION.RESOLVE_DROPDOWN.MARK_PENDING")),1)]),_:1})]),_:1}))]),_:1})])),[[F,v]]):he("",!0)])}}},bc=je(gc,[["__scopeId","data-v-41cd360a"]]),vc={components:{EmailTranscriptModal:_c,ResolveAction:bc},data(){return{showEmailActionsModal:!1}},computed:{...yt({currentChat:"getSelectedChat"})},mounted(){ht.on(va,this.mute),ht.on(Aa,this.unmute),ht.on(Ta,this.toggleEmailActionsModal)},unmounted(){ht.off(va,this.mute),ht.off(Aa,this.unmute),ht.off(Ta,this.toggleEmailActionsModal)},methods:{mute(){this.$store.dispatch("muteConversation",this.currentChat.id),Je(this.$t("CONTACT_PANEL.MUTED_SUCCESS"))},unmute(){this.$store.dispatch("unmuteConversation",this.currentChat.id),Je(this.$t("CONTACT_PANEL.UNMUTED_SUCCESS"))},toggleEmailActionsModal(){this.showEmailActionsModal=!this.showEmailActionsModal}}},Ac={class:"relative flex items-center gap-2 actions--container"};function Tc(e,t,s,i,o,n){const r=ae("woot-button"),c=ae("ResolveAction"),v=ae("EmailTranscriptModal"),x=rt("tooltip");return O(),se("div",Ac,[e.currentChat.muted?He((O(),_e(r,{key:1,variant:"clear","color-scheme":"secondary",icon:"speaker-1",onClick:n.unmute},null,8,["onClick"])),[[x,e.$t("CONTACT_PANEL.UNMUTE_CONTACT"),void 0,{left:!0}]]):He((O(),_e(r,{key:0,variant:"clear","color-scheme":"secondary",icon:"speaker-mute",onClick:n.mute},null,8,["onClick"])),[[x,e.$t("CONTACT_PANEL.MUTE_CONTACT")]]),He(oe(r,{variant:"clear","color-scheme":"secondary",icon:"share",onClick:n.toggleEmailActionsModal},null,8,["onClick"]),[[x,e.$t("CONTACT_PANEL.SEND_TRANSCRIPT")]]),oe(c,{"conversation-id":e.currentChat.id,status:e.currentChat.status},null,8,["conversation-id","status"]),o.showEmailActionsModal?(O(),_e(v,{key:2,show:o.showEmailActionsModal,"current-chat":e.currentChat,onCancel:n.toggleEmailActionsModal},null,8,["show","current-chat","onCancel"])):he("",!0)])}const Ec=je(vc,[["render",Tc],["__scopeId","data-v-337d2f97"]]);class Sc extends li{constructor(){super("integrations/linear",{accountScoped:!0})}getTeams(){return axios.get(`${this.url}/teams`)}getTeamEntities(t){return axios.get(`${this.url}/team_entities?team_id=${t}`)}createIssue(t){return axios.post(`${this.url}/create_issue`,t)}link_issue(t,s,i){return axios.post(`${this.url}/link_issue`,{issue_id:s,conversation_id:t,title:i})}getLinkedIssue(t){return axios.get(`${this.url}/linked_issues?conversation_id=${t}`)}unlinkIssue(t){return axios.post(`${this.url}/unlink_issue`,{link_id:t})}searchIssues(t){return axios.get(`${this.url}/search_issue?q=${t}`)}}const ns=new Sc,yc={class:"flex items-center justify-end w-full gap-2 mt-2"},Ic={__name:"LinkIssue",props:{conversationId:{type:[Number,String],required:!0},title:{type:String,default:null}},emits:["close"],setup(e,{emit:t}){const s=e,i=t,{t:o}=Is(),n=Ze([]),r=Ze(!1),c=Ze({id:null,name:""}),v=Ze(!1),x=Ze(!1),h=Ze(""),d=()=>{n.value=[],r.value=!r.value},C=We(()=>c.value.id?c.value.name:o("INTEGRATION_SETTINGS.LINEAR.LINK.SELECT")),j=We(()=>!c.value.id||x.value),V=f=>{c.value=f,d()},X=()=>{i("close")},Y=async f=>{if(n.value=[],!!f){h.value=f;try{v.value=!0;const g=await ns.searchIssues(f);n.value=g.data.map(y=>({id:y.id,name:`${y.identifier} ${y.title}`,icon:"status",iconColor:y.state.color}))}catch(g){const y=Ts(g,o("INTEGRATION_SETTINGS.LINEAR.LINK.ERROR"));Je(y)}finally{v.value=!1}}},I=async()=>{const{id:f}=c.value;try{x.value=!0,await ns.link_issue(s.conversationId,f,s.title),Je(o("INTEGRATION_SETTINGS.LINEAR.LINK.LINK_SUCCESS")),h.value="",n.value=[],X()}catch(g){const y=Ts(g,o("INTEGRATION_SETTINGS.LINEAR.LINK.LINK_ERROR"));Je(y)}finally{x.value=!1}};return(f,g)=>{const y=ae("woot-button"),a=rt("on-clickaway");return O(),se("div",{class:st(["flex flex-col justify-between",r.value?"h-[256px]":"gap-2"])},[oe(fi,{"right-icon":"chevron-down","button-text":C.value,class:"justify-between w-full h-[2.5rem] py-1.5 px-3 rounded-xl border border-slate-50 bg-slate-25 dark:border-slate-600 dark:bg-slate-900 hover:bg-slate-50 dark:hover:bg-slate-900/50",onClick:d},ni({_:2},[r.value?{name:"dropdown",fn:Oe(()=>[n.value?He((O(),_e(pi,{key:0,"show-clear-filter":!1,"list-items":n.value,"active-filter-id":c.value.id,"is-loading":v.value,"input-placeholder":f.$t("INTEGRATION_SETTINGS.LINEAR.LINK.SEARCH"),"loading-placeholder":f.$t("INTEGRATION_SETTINGS.LINEAR.LINK.LOADING"),"enable-search":"",class:"left-0 flex flex-col w-full overflow-y-auto h-fit !max-h-[160px] md:left-auto md:right-0 top-10",onOnSearch:Y,onSelect:V},null,8,["list-items","active-filter-id","is-loading","input-placeholder","loading-placeholder"])),[[a,d]]):he("",!0)]),key:"0"}:void 0]),1032,["button-text"]),q("div",yc,[oe(y,{class:"px-4 rounded-xl button clear outline-woot-200/50 outline",onClick:ot(X,["prevent"])},{default:Oe(()=>[Ke(fe(f.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.CANCEL")),1)]),_:1}),oe(y,{"is-disabled":j.value,class:"px-4 rounded-xl","is-loading":x.value,onClick:ot(I,["prevent"])},{default:Oe(()=>[Ke(fe(f.$t("INTEGRATION_SETTINGS.LINEAR.LINK.TITLE")),1)]),_:1},8,["is-disabled","is-loading"])])],2)}}},wc={title:{required:on},teamId:{required:on}},Rc={key:0,class:"mt-1 message"},Cc=Object.assign({name:"SearchableDropdown"},{__name:"SearchableDropdown",props:{type:{type:String,required:!0},label:{type:String,default:null},items:{type:Array,required:!0},value:{type:[Number,String],default:null},placeholder:{type:String,default:null},error:{type:String,default:null}},emits:["change"],setup(e,{emit:t}){const s=e,i=t,o=Ze(!1),n=()=>{o.value=!o.value},r=d=>{i("change",d,s.type),n()},c=We(()=>!!s.error),v=We(()=>s.value?s.items.find(d=>d.id===s.value):null),x=We(()=>{var d;return((d=v.value)==null?void 0:d.name)||s.placeholder}),h=We(()=>{var d;return((d=v.value)==null?void 0:d.id)||null});return(d,C)=>{const j=rt("on-clickaway");return O(),se("div",{class:st(["flex w-full",e.type==="stateId"&&o.value?"h-[150px]":"gap-2"])},[q("label",{class:st(["w-full",{error:c.value}])},[Ke(fe(e.label)+" ",1),oe(fi,{"right-icon":"chevron-down","button-text":x.value,class:"justify-between w-full h-[2.5rem] py-1.5 px-3 rounded-xl border border-slate-50 bg-slate-25 dark:border-slate-600 dark:bg-slate-900 hover:bg-slate-50 dark:hover:bg-slate-900/50",onClick:n},ni({_:2},[o.value?{name:"dropdown",fn:Oe(()=>[He(oe(pi,{"show-clear-filter":!1,"list-items":e.items,"active-filter-id":h.value,"input-placeholder":e.placeholder,"enable-search":"",class:"left-0 flex flex-col w-full overflow-y-auto h-fit !max-h-[160px] md:left-auto md:right-0 top-10",onSelect:r},null,8,["list-items","active-filter-id","input-placeholder"]),[[j,n]])]),key:"0"}:void 0]),1032,["button-text"]),c.value?(O(),se("span",Rc,fe(e.error),1)):he("",!0)],2)],2)}}}),Mc=["placeholder"],Nc={class:"flex flex-col gap-4"},Oc={class:"flex items-center justify-end w-full gap-2 mt-8"},kc={__name:"CreateIssue",props:{conversationId:{type:[Number,String],required:!0},title:{type:String,default:null}},emits:["close"],setup(e,{emit:t}){const s=e,i=t,{t:o}=Is(),n=Ze([]),r=Ze([]),c=Ze([]),v=Ze([]),x=Ze([]),h=[{id:0,name:"No priority"},{id:1,name:"Urgent"},{id:2,name:"High"},{id:3,name:"Normal"},{id:4,name:"Low"}],d=["Backlog","Todo","In Progress","Done","Canceled"],C=Ze(!1),j={borderRadius:"12px",fontSize:"14px"},V=ai({title:"",description:"",teamId:"",assigneeId:"",labelId:"",stateId:"",priority:"",projectId:""}),X=Kn(wc,V),Y=We(()=>X.value.title.$invalid||C.value),I=We(()=>X.value.title.$error?o("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.TITLE.REQUIRED_ERROR"):""),f=We(()=>X.value.teamId.$error?o("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.TEAM.REQUIRED_ERROR"):""),g=We(()=>[{type:"teamId",label:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.TEAM.LABEL",items:n.value,placeholder:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.TEAM.SEARCH",error:f.value},{type:"assigneeId",label:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.ASSIGNEE.LABEL",items:r.value,placeholder:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.ASSIGNEE.SEARCH",error:""},{type:"labelId",label:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.LABEL.LABEL",items:v.value,placeholder:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.LABEL.SEARCH",error:""},{type:"priority",label:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.PRIORITY.LABEL",items:h,placeholder:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.PRIORITY.SEARCH",error:""},{type:"projectId",label:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.PROJECT.LABEL",items:c.value,placeholder:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.PROJECT.SEARCH",error:""},{type:"stateId",label:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.STATUS.LABEL",items:x.value,placeholder:"INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.STATUS.SEARCH",error:""}]),y=()=>i("close"),a=async()=>{try{const G=await ns.getTeams();n.value=G.data}catch(G){const N=Ts(G,o("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.LOADING_TEAM_ERROR"));Je(N)}},p=async()=>{try{const G=await ns.getTeamEntities(V.teamId);r.value=G.data.users,v.value=G.data.labels,c.value=G.data.projects,x.value=d.map(N=>G.data.states.find(F=>F.name===N)).filter(Boolean)}catch(G){const N=Ts(G,o("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.LOADING_TEAM_ENTITIES_ERROR"));Je(N)}},M=(G,N)=>{V[N]=G.id,N==="teamId"&&(V.assigneeId="",V.stateId="",V.labelId="",V.projectId="",p())},P=async()=>{if(X.value.$touch(),X.value.$invalid)return;const G={team_id:V.teamId,title:V.title,description:V.description||void 0,assignee_id:V.assigneeId||void 0,project_id:V.projectId||void 0,state_id:V.stateId||void 0,priority:V.priority||void 0,label_ids:V.labelId?[V.labelId]:void 0};try{C.value=!0;const N=await ns.createIssue(G),{id:F}=N.data;await ns.link_issue(s.conversationId,F,s.title),Je(o("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.CREATE_SUCCESS")),y()}catch(N){const F=Ts(N,o("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.CREATE_ERROR"));Je(F)}finally{C.value=!1}};return ws(a),(G,N)=>{const F=ae("woot-input"),pe=ae("woot-button");return O(),se("div",null,[oe(F,{modelValue:V.title,"onUpdate:modelValue":N[0]||(N[0]=k=>V.title=k),class:st([{error:at(X).title.$error},"w-full"]),styles:{...j,padding:"6px 12px"},label:G.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.TITLE.LABEL"),placeholder:G.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.TITLE.PLACEHOLDER"),error:I.value,onInput:at(X).title.$touch},null,8,["modelValue","class","styles","label","placeholder","error","onInput"]),q("label",null,[Ke(fe(G.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.DESCRIPTION.LABEL"))+" ",1),He(q("textarea",{"onUpdate:modelValue":N[1]||(N[1]=k=>V.description=k),style:Yn({...j,padding:"8px 12px"}),rows:"3",class:"text-sm",placeholder:G.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.FORM.DESCRIPTION.PLACEHOLDER")},null,12,Mc),[[si,V.description]])]),q("div",Nc,[(O(!0),se(vt,null,Et(g.value,k=>(O(),_e(Cc,{key:k.type,type:k.type,value:V[k.type],label:G.$t(k.label),items:k.items,placeholder:G.$t(k.placeholder),error:k.error,onChange:M},null,8,["type","value","label","items","placeholder","error"]))),128))]),q("div",Oc,[oe(pe,{class:"px-4 rounded-xl button clear outline-woot-200/50 outline",onClick:ot(y,["prevent"])},{default:Oe(()=>[Ke(fe(G.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.CANCEL")),1)]),_:1}),oe(pe,{"is-disabled":Y.value,class:"px-4 rounded-xl","is-loading":C.value,onClick:ot(P,["prevent"])},{default:Oe(()=>[Ke(fe(G.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.CREATE")),1)]),_:1},8,["is-disabled","is-loading"])])])}}},xc={class:"flex flex-col h-auto overflow-auto"},Lc={class:"flex flex-col h-auto overflow-auto"},Pc={class:"flex flex-col px-8 pb-4"},Bc={key:0,class:"flex flex-col px-8 pb-4"},Dc={key:1,class:"flex flex-col px-8 pb-4"},Vc={__name:"CreateOrLinkIssue",props:{accountId:{type:[Number,String],required:!0},conversation:{type:Object,required:!0}},emits:["close"],setup(e,{emit:t}){const s=e,i=t,{t:o}=Is(),n=Ze(0),r=We(()=>{const{meta:{sender:{name:h=null}={}}={}}=s.conversation;return o("INTEGRATION_SETTINGS.LINEAR.LINK.LINK_TITLE",{conversationId:s.conversation.id,name:h})}),c=Ze([{key:0,name:o("INTEGRATION_SETTINGS.LINEAR.CREATE")},{key:1,name:o("INTEGRATION_SETTINGS.LINEAR.LINK.TITLE")}]),v=()=>{i("close")},x=h=>{n.value=h};return(h,d)=>{const C=ae("woot-modal-header"),j=ae("woot-tabs-item"),V=ae("woot-tabs");return O(),se("div",xc,[oe(C,{"header-title":h.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.TITLE"),"header-content":h.$t("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK.DESCRIPTION")},null,8,["header-title","header-content"]),q("div",Lc,[q("div",Pc,[oe(V,{class:"ltr:[&>ul]:pl-0 rtl:[&>ul]:pr-0",index:n.value,onChange:x},{default:Oe(()=>[(O(!0),se(vt,null,Et(c.value,(X,Y)=>(O(),_e(j,{key:X.key,index:Y,name:X.name,"show-badge":!1},null,8,["index","name"]))),128))]),_:1},8,["index"])]),n.value===0?(O(),se("div",Bc,[oe(kc,{"account-id":e.accountId,"conversation-id":e.conversation.id,title:r.value,onClose:v},null,8,["account-id","conversation-id","title"])])):(O(),se("div",Dc,[oe(Ic,{"conversation-id":e.conversation.id,title:r.value,onClose:v},null,8,["conversation-id","title"])]))])])}}},Gc={class:"flex flex-row justify-between"},Fc={class:"flex items-center justify-center gap-1 h-[24px] px-2 py-1 border rounded-lg border-ash-200"},$c={class:"text-xs font-medium text-ash-900"},Hc={class:"flex items-center gap-0.5"},Uc={__name:"IssueHeader",props:{identifier:{type:String,required:!0},issueUrl:{type:String,required:!0}},emits:["unlinkIssue"],setup(e,{emit:t}){const s=e,i=t,o=no("isUnlinking"),n=()=>{i("unlinkIssue")},r=()=>{window.open(s.issueUrl,"_blank")};return(c,v)=>{const x=ae("fluent-icon"),h=ae("woot-button");return O(),se("div",Gc,[q("div",Fc,[oe(x,{icon:"linear",size:"19",class:"text-[#5E6AD2]","view-box":"0 0 19 19"}),q("span",$c,fe(e.identifier),1)]),q("div",Hc,[oe(h,{variant:"clear","color-scheme":"secondary",class:"h-[24px]","is-loading":at(o),onClick:n},{default:Oe(()=>[at(o)?he("",!0):(O(),_e(x,{key:0,icon:"unlink",size:"12",type:"outline","icon-lib":"lucide"}))]),_:1},8,["is-loading"]),oe(h,{variant:"clear",class:"h-[24px]","color-scheme":"secondary",onClick:r},{default:Oe(()=>[oe(x,{icon:"arrow-up-right",size:"14"})]),_:1})])])}}},Wc={class:"absolute flex flex-col items-start bg-white dark:bg-slate-800 z-50 px-4 py-3 border border-solid border-ash-200 w-[384px] rounded-xl gap-4 max-h-96 overflow-auto"},jc={class:"flex flex-col w-full"},Yc={class:"mt-2 text-sm font-medium text-ash-900"},Xc={key:0,class:"mt-1 text-sm text-ash-800 line-clamp-3"},zc={class:"flex flex-row items-center h-6 gap-2"},qc={key:1,class:"w-px h-3 bg-ash-200"},Kc={class:"flex items-center gap-1 py-1"},Qc={class:"text-xs text-ash-900"},Zc={key:2,class:"w-px h-3 bg-ash-200"},Jc={key:3,class:"flex items-center gap-1 py-1"},e1={class:"text-xs text-ash-900"},t1={key:0,class:"flex flex-wrap items-center gap-1"},s1={class:"flex items-center"},n1={class:"text-xs text-ash-800"},a1={__name:"Issue",props:{issue:{type:Object,required:!0},linkId:{type:String,required:!0}},emits:["unlinkIssue"],setup(e,{emit:t}){const s=e,i=t,o={1:"Urgent",2:"High",3:"Medium",4:"Low"},n=We(()=>{const{createdAt:h}=s.issue;return oi(new Date(h),"hh:mm a, MMM dd")}),r=We(()=>{const h=s.issue.assignee;if(!h)return null;const{name:d,avatarUrl:C}=h;return{name:d,thumbnail:C}}),c=We(()=>{var h;return((h=s.issue.labels)==null?void 0:h.nodes)||[]}),v=We(()=>o[s.issue.priority]),x=()=>{i("unlinkIssue",s.linkId)};return(h,d)=>{const C=ae("fluent-icon"),j=ae("woot-label");return O(),se("div",Wc,[q("div",jc,[oe(Uc,{identifier:e.issue.identifier,"link-id":e.linkId,"issue-url":e.issue.url,onUnlinkIssue:x},null,8,["identifier","link-id","issue-url"]),q("span",Yc,fe(e.issue.title),1),e.issue.description?(O(),se("span",Xc,fe(e.issue.description),1)):he("",!0)]),q("div",zc,[r.value?(O(),_e(dr,{key:0,user:r.value,class:"py-1"},null,8,["user"])):he("",!0),r.value?(O(),se("div",qc)):he("",!0),q("div",Kc,[oe(C,{icon:"status",size:"14",style:Yn({color:e.issue.state.color})},null,8,["style"]),q("h6",Qc,fe(e.issue.state.name),1)]),v.value?(O(),se("div",Zc)):he("",!0),v.value?(O(),se("div",Jc,[oe(C,{icon:`priority-${v.value.toLowerCase()}`,size:"14","view-box":"0 0 12 12"},null,8,["icon"]),q("h6",e1,fe(v.value),1)])):he("",!0)]),c.value.length?(O(),se("div",t1,[(O(!0),se(vt,null,Et(c.value,V=>(O(),_e(j,{key:V.id,title:V.name,description:V.description,color:V.color,variant:"smooth",small:""},null,8,["title","description","color"]))),128))])):he("",!0),q("div",s1,[q("span",n1,fe(h.$t("INTEGRATION_SETTINGS.LINEAR.ISSUE.CREATED_AT",{createdAt:n.value})),1)])])}}},i1={key:0,class:"text-xs font-medium text-ash-800"},o1=Object.assign({name:"Linear"},{__name:"index",props:{conversationId:{type:[Number,String],required:!0}},setup(e){const t=e,s=rn(),{t:i}=Is(),o=Ze(null),n=Ze(!1),r=Ze(!1),c=Ze(!1);ao("isUnlinking",c);const v=s.getCurrentAccountId,x=We(()=>s.getConversationById.value(t.conversationId)),h=We(()=>o.value===null?i("INTEGRATION_SETTINGS.LINEAR.ADD_OR_LINK_BUTTON"):null),d=async()=>{o.value=null;try{const I=(await ns.getLinkedIssue(t.conversationId)).data;o.value=I&&I.length?I[0]:null}catch{}},C=async Y=>{try{c.value=!0,await ns.unlinkIssue(Y),o.value=null,Je(i("INTEGRATION_SETTINGS.LINEAR.UNLINK.SUCCESS"))}catch(I){const f=Ts(I,i("INTEGRATION_SETTINGS.LINEAR.UNLINK.ERROR"));Je(f)}finally{c.value=!1}},j=()=>{o.value||(r.value=!0),n.value=!0},V=()=>{r.value=!1,d()},X=()=>{n.value=!1};return Fn(()=>t.conversationId,()=>{d()}),ws(()=>{d()}),(Y,I)=>{const f=ae("fluent-icon"),g=ae("woot-button"),y=ae("woot-modal"),a=rt("on-clickaway"),p=rt("tooltip");return O(),se("div",{class:st(["relative",{group:o.value}])},[He((O(),_e(g,{variant:"clear","color-scheme":"secondary",onClick:j},{default:Oe(()=>[oe(f,{icon:"linear",size:"19",class:"text-[#5E6AD2]","view-box":"0 0 19 19"}),o.value?(O(),se("span",i1,fe(o.value.issue.identifier),1)):he("",!0)]),_:1})),[[a,X],[p,h.value]]),o.value?(O(),_e(a1,{key:0,issue:o.value.issue,"link-id":o.value.id,class:"absolute right-0 top-[40px] invisible group-hover:visible",onUnlinkIssue:C},null,8,["issue","link-id"])):he("",!0),oe(y,{show:r.value,"onUpdate:show":I[0]||(I[0]=M=>r.value=M),"on-close":V,"close-on-backdrop-click":!1,class:"!items-start [&>div]:!top-12 [&>div]:sticky"},{default:Oe(()=>[oe(Vc,{conversation:x.value,"account-id":at(v),onClose:V},null,8,["conversation","account-id"])]),_:1},8,["show"])],2)}}}),r1={components:{BackButton:Zo,InboxName:Jo,MoreActions:Ec,Thumbnail:qn,SLACardLabel:ko,Linear:o1},mixins:[Rs],props:{chat:{type:Object,default:()=>{}},isContactPanelOpen:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},isInboxView:{type:Boolean,default:!1}},emits:["contactPanelToggle"],setup(e,{emit:t}){Jt({"Alt+KeyO":{action:()=>t("contactPanelToggle")}})},computed:{...yt({currentChat:"getSelectedChat",accountId:"getCurrentAccountId",isFeatureEnabledonAccount:"accounts/isFeatureEnabledonAccount",appIntegrations:"integrations/getAppIntegrations"}),chatMetadata(){return this.chat.meta},backButtonUrl(){const{params:{accountId:e,inbox_id:t,label:s,teamId:i},name:o}=this.$route;return sr({accountId:e,inboxId:t,label:s,teamId:i,conversationType:o==="conversation_mentions"?"mention":""})},isHMACVerified(){return this.isAWebWidgetInbox?this.chatMetadata.hmac_verified:!0},currentContact(){return this.$store.getters["contacts/getContact"](this.chat.meta.sender.id)},isSnoozed(){return this.currentChat.status===$t.STATUS_TYPE.SNOOZED},snoozedDisplayText(){const{snoozed_until:e}=this.currentChat;return e?`${this.$t("CONVERSATION.HEADER.SNOOZED_UNTIL")} ${cr(e)}`:this.$t("CONVERSATION.HEADER.SNOOZED_UNTIL_NEXT_REPLY")},contactPanelToggleText(){return`${this.isContactPanelOpen?this.$t("CONVERSATION.HEADER.CLOSE"):this.$t("CONVERSATION.HEADER.OPEN")} ${this.$t("CONVERSATION.HEADER.DETAILS")}`},inbox(){const{inbox_id:e}=this.chat;return this.$store.getters["inboxes/getInbox"](e)},hasMultipleInboxes(){return this.$store.getters["inboxes/getInboxes"].length>1},hasSlaPolicyId(){var e;return(e=this.chat)==null?void 0:e.sla_policy_id},isLinearIntegrationEnabled(){return this.appIntegrations.find(e=>e.id==="linear"&&!!e.hooks.length)},isLinearFeatureEnabled(){return this.isFeatureEnabledonAccount(this.accountId,ci.LINEAR)}}},l1={class:"flex flex-col items-center justify-between px-4 py-2 bg-white border-b dark:bg-slate-900 border-slate-50 dark:border-slate-800/50 md:flex-row"},c1={class:"flex items-center justify-start max-w-full min-w-0 w-fit"},d1={class:"flex flex-col items-start min-w-0 ml-2 overflow-hidden rtl:ml-0 rtl:mr-2 w-fit"},u1={class:"flex flex-row items-center max-w-full gap-1 p-0 m-0 w-fit"},h1={class:"text-base font-medium leading-tight text-slate-900 dark:text-slate-100"},_1={class:"flex items-center gap-2 overflow-hidden text-xs conversation--header--actions text-ellipsis whitespace-nowrap"},m1={key:1,class:"font-medium text-yellow-600 dark:text-yellow-500"};function p1(e,t,s,i,o,n){const r=ae("BackButton"),c=ae("Thumbnail"),v=ae("woot-button"),x=ae("fluent-icon"),h=ae("InboxName"),d=ae("SLACardLabel"),C=ae("Linear"),j=ae("MoreActions"),V=rt("tooltip");return O(),se("div",l1,[q("div",{class:st(["flex flex-col items-center justify-center flex-1 w-full min-w-0",s.isInboxView?"sm:flex-row":"md:flex-row"])},[q("div",c1,[s.showBackButton?(O(),_e(r,{key:0,"back-url":n.backButtonUrl,class:"ltr:ml-0 rtl:mr-0 rtl:ml-4"},null,8,["back-url"])):he("",!0),oe(c,{src:n.currentContact.thumbnail,badge:e.inboxBadge,username:n.currentContact.name,status:n.currentContact.availability_status},null,8,["src","badge","username","status"]),q("div",d1,[q("div",u1,[oe(v,{variant:"link","color-scheme":"secondary",class:"[&>span]:overflow-hidden [&>span]:whitespace-nowrap [&>span]:text-ellipsis min-w-0",onClick:t[0]||(t[0]=ot(X=>e.$emit("contactPanelToggle"),["prevent"]))},{default:Oe(()=>[q("span",h1,fe(n.currentContact.name),1)]),_:1}),n.isHMACVerified?he("",!0):He((O(),_e(x,{key:0,size:"14",class:"text-yellow-600 dark:text-yellow-500 my-0 mx-0 min-w-[14px]",icon:"warning"},null,512)),[[V,e.$t("CONVERSATION.UNVERIFIED_SESSION")]])]),q("div",_1,[n.hasMultipleInboxes?(O(),_e(h,{key:0,inbox:n.inbox},null,8,["inbox"])):he("",!0),n.isSnoozed?(O(),se("span",m1,fe(n.snoozedDisplayText),1)):he("",!0),oe(v,{class:"p-0",size:"small",variant:"link",onClick:t[1]||(t[1]=X=>e.$emit("contactPanelToggle"))},{default:Oe(()=>[Ke(fe(n.contactPanelToggleText),1)]),_:1})])])]),q("div",{class:st(["flex flex-row items-center justify-end flex-grow gap-2 mt-3 header-actions-wrap lg:mt-0",{"justify-end":s.isContactPanelOpen}])},[n.hasSlaPolicyId?(O(),_e(d,{key:0,chat:s.chat,"show-extended-info":""},null,8,["chat"])):he("",!0),n.isLinearIntegrationEnabled&&n.isLinearFeatureEnabled?(O(),_e(C,{key:1,"conversation-id":e.currentChat.id},null,8,["conversation-id"])):he("",!0),oe(j,{"conversation-id":e.currentChat.id},null,8,["conversation-id"])],2)],2)])}const f1=je(r1,[["render",p1],["__scopeId","data-v-0a8e3ddf"]]),g1={components:{LoadingState:bo},props:{config:{type:Array,default:()=>[]},currentChat:{type:Object,default:()=>({})},isVisible:{type:Boolean,default:!1},position:{type:Number,required:!0}},data(){return{hasOpenedAtleastOnce:!1,iframeLoading:!0}},computed:{dashboardAppContext(){return{conversation:this.currentChat,contact:this.$store.getters["contacts/getContact"](this.contactId),currentAgent:this.currentAgent}},contactId(){var e,t,s;return(s=(t=(e=this.currentChat)==null?void 0:e.meta)==null?void 0:t.sender)==null?void 0:s.id},currentAgent(){const{id:e,name:t,email:s}=this.$store.getters.getCurrentUser;return{id:e,name:t,email:s}}},watch:{isVisible(){this.isVisible&&(this.hasOpenedAtleastOnce=!0)}},mounted(){window.onmessage=e=>{typeof e.data!="string"||e.data!=="chatwoot-dashboard-app:fetch-info"||this.onIframeLoad(0)}},methods:{getFrameId(e){return`dashboard-app--frame-${this.position}-${e}`},onIframeLoad(e){const t=document.getElementById(this.getFrameId(e)),s={event:"appContext",data:this.dashboardAppContext};t.contentWindow.postMessage(JSON.stringify(s),"*"),this.iframeLoading=!1}}},b1={key:0,class:"dashboard-app--container"},v1=["id","src","onLoad"];function A1(e,t,s,i,o,n){const r=ae("LoadingState");return o.hasOpenedAtleastOnce?(O(),se("div",b1,[(O(!0),se(vt,null,Et(s.config,(c,v)=>(O(),se("div",{key:v,class:"dashboard-app--list"},[o.iframeLoading?(O(),_e(r,{key:0,message:e.$t("DASHBOARD_APPS.LOADING_MESSAGE"),class:"dashboard-app_loading-container"},null,8,["message"])):he("",!0),c.type==="frame"&&c.url?(O(),se("iframe",{key:1,id:n.getFrameId(v),src:c.url,onLoad:()=>n.onIframeLoad(v)},null,40,v1)):he("",!0)]))),128))])):he("",!0)}const T1=je(g1,[["render",A1],["__scopeId","data-v-b8f04844"]]),E1={class:"h-full w-full bg-white dark:bg-slate-900 border border-slate-100 dark:border-white/10 rounded-lg p-4 flex flex-col"},S1={class:"flex-1 flex items-center justify-center"},y1=["src","alt"],I1={class:"mt-auto"},w1={class:"text-base text-slate-800 dark:text-slate-100 font-interDisplay font-semibold tracking-[0.3px]"},R1={class:"text-slate-600 dark:text-slate-400 text-sm"},Qs={__name:"OnboardingFeatureCard",props:{imageSrc:{type:String,default:""},imageAlt:{type:String,default:""},title:{type:String,default:""},description:{type:String,default:""},to:{type:String,default:""},linkText:{type:String,default:""}},setup(e){return(t,s)=>{const i=ae("router-link");return O(),se("div",E1,[q("div",S1,[q("img",{src:e.imageSrc,alt:e.imageAlt,class:"h-36 w-auto mx-auto"},null,8,y1)]),q("div",I1,[q("p",w1,fe(e.title),1),q("p",R1,fe(e.description),1),e.to?(O(),_e(i,{key:0,to:{name:e.to},class:"no-underline text-woot-500 text-sm font-medium"},{default:Oe(()=>[q("span",null,fe(e.linkText),1),s[0]||(s[0]=q("span",{class:"ml-2"},fe("→"),-1))]),_:1},8,["to"])):he("",!0)])])}}},C1={class:"min-h-screen lg:max-w-5xl max-w-4xl mx-auto grid grid-cols-2 grid-rows-[auto_1fr_1fr] auto-rows-min gap-4 p-8 w-full font-inter overflow-auto"},M1={class:"col-span-full self-start"},N1={class:"text-xl font-semibold text-slate-900 dark:text-white font-interDisplay tracking-[0.3px]"},O1={class:"text-slate-600 dark:text-slate-400 max-w-2xl text-base"},k1={__name:"OnboardingView",setup(e){const t=rn(),{t:s}=Is(),i=We(()=>t["globalConfig/get"].value),o=We(()=>t.getCurrentUser.value),n=We(()=>{const r=new Date().getHours();let c;return r<12?c="ONBOARDING.GREETING_MORNING":r<18?c="ONBOARDING.GREETING_AFTERNOON":c="ONBOARDING.GREETING_EVENING",s(c,{name:o.value.name,installationName:i.value.installationName})});return(r,c)=>(O(),se("div",C1,[q("div",M1,[q("p",N1,fe(n.value),1),q("p",O1,fe(r.$t("ONBOARDING.DESCRIPTION",{installationName:i.value.installationName})),1)]),oe(Qs,{"image-src":"/dashboard/images/onboarding/omnichannel-inbox.png","image-alt":"Omnichannel",to:"settings_inbox_new",title:r.$t("ONBOARDING.ALL_CONVERSATION.TITLE"),description:r.$t("ONBOARDING.ALL_CONVERSATION.DESCRIPTION"),"link-text":r.$t("ONBOARDING.ALL_CONVERSATION.NEW_LINK")},null,8,["title","description","link-text"]),oe(Qs,{"image-src":"/dashboard/images/onboarding/teams.png","image-alt":"Teams",to:"settings_teams_new",title:r.$t("ONBOARDING.TEAM_MEMBERS.TITLE"),description:r.$t("ONBOARDING.TEAM_MEMBERS.DESCRIPTION"),"link-text":r.$t("ONBOARDING.TEAM_MEMBERS.NEW_LINK")},null,8,["title","description","link-text"]),oe(Qs,{"image-src":"/dashboard/images/onboarding/canned-responses.png","image-alt":"Canned responses",to:"canned_list",title:r.$t("ONBOARDING.CANNED_RESPONSES.TITLE"),description:r.$t("ONBOARDING.CANNED_RESPONSES.DESCRIPTION"),"link-text":r.$t("ONBOARDING.CANNED_RESPONSES.NEW_LINK")},null,8,["title","description","link-text"]),oe(Qs,{"image-src":"/dashboard/images/onboarding/labels.png","image-alt":"Labels",to:"labels_list",title:r.$t("ONBOARDING.LABELS.TITLE"),description:r.$t("ONBOARDING.LABELS.DESCRIPTION"),"link-text":r.$t("ONBOARDING.LABELS.NEW_LINK")},null,8,["title","description","link-text"])]))}},x1={components:{Hotkey:vo},data(){return{keyShortcuts:[{key:"K",description:this.$t("CONVERSATION.EMPTY_STATE.CMD_BAR")},{key:"/",description:this.$t("CONVERSATION.EMPTY_STATE.KEYBOARD_SHORTCUTS")}]}}},L1={class:"flex flex-col gap-2 mt-9"},P1={class:"flex items-center gap-2"},B1={class:"text-sm font-medium text-center text-slate-700 dark:text-slate-300"};function D1(e,t,s,i,o,n){const r=ae("Hotkey");return O(),se("div",L1,[(O(!0),se(vt,null,Et(o.keyShortcuts,c=>(O(),se("div",{key:c.key,class:"flex items-center gap-2"},[q("div",P1,[oe(r,{"custom-class":"w-8 h-6 text-sm font-medium border-b-2 text-slate-7000 dark:text-slate-100 bg-slate-100 dark:bg-slate-700 border-slate-300 dark:border-slate-500"},{default:Oe(()=>t[0]||(t[0]=[Ke(" ⌘ ")])),_:1}),oe(r,{"custom-class":"w-8 h-6 text-sm font-medium border-b-2 text-slate-700 dark:text-slate-100 bg-slate-100 dark:bg-slate-700 border-slate-300 dark:border-slate-500"},{default:Oe(()=>[Ke(fe(c.key),1)]),_:2},1024)]),q("span",B1,fe(c.description),1)]))),128))])}const V1=je(x1,[["render",D1]]),G1="/vite-dev/assets/no-chat-dark-BSWrQBd3.svg",F1="/vite-dev/assets/no-chat-okxWD-4P.svg",$1={components:{FeaturePlaceholder:V1},props:{message:{type:String,required:!0}}},H1={class:"flex flex-col items-center justify-center h-full"},U1={class:"text-sm text-slate-800 dark:text-slate-200 font-medium text-center"};function W1(e,t,s,i,o,n){const r=ae("FeaturePlaceholder");return O(),se("div",H1,[t[1]||(t[1]=q("img",{class:"m-4 w-32 hidden dark:block",src:G1,alt:"No Chat dark"},null,-1)),t[2]||(t[2]=q("img",{class:"m-4 w-32 block dark:hidden",src:F1,alt:"No Chat"},null,-1)),q("span",U1,[Ke(fe(s.message)+" ",1),t[0]||(t[0]=q("br",null,null,-1))]),oe(r)])}const j1=je($1,[["render",W1]]),Y1={components:{OnboardingView:k1,EmptyStateMessage:j1},props:{isOnExpandedLayout:{type:Boolean,default:!1}},setup(){const{isAdmin:e}=Xn(),{accountScopedUrl:t}=ri();return{isAdmin:e,accountScopedUrl:t}},computed:{...yt({currentChat:"getSelectedChat",allConversations:"getAllConversations",inboxesList:"inboxes/getInboxes",uiFlags:"inboxes/getUIFlags",loadingChatList:"getChatListLoadingStatus"}),loadingIndicatorMessage(){return this.uiFlags.isFetching?this.$t("CONVERSATION.LOADING_INBOXES"):this.$t("CONVERSATION.LOADING_CONVERSATIONS")},conversationMissingMessage(){return this.isOnExpandedLayout?this.$t("CONVERSATION.404"):this.$t("CONVERSATION.SELECT_A_CONVERSATION")},newInboxURL(){return this.accountScopedUrl("settings/inboxes/new")},emptyClassName(){return!this.inboxesList.length&&!this.uiFlags.isFetching&&!this.loadingChatList&&this.isAdmin?"h-full overflow-auto w-full":"flex-1 min-w-0 px-0 flex flex-col items-center justify-center h-full"}}},X1={key:1,class:"clearfix mx-auto"},z1={key:2,class:"flex flex-col items-center justify-center h-full"};function q1(e,t,s,i,o,n){const r=ae("woot-loading-state"),c=ae("OnboardingView"),v=ae("EmptyStateMessage");return O(),se("div",{class:st(n.emptyClassName)},[e.uiFlags.isFetching||e.loadingChatList?(O(),_e(r,{key:0,message:n.loadingIndicatorMessage},null,8,["message"])):he("",!0),!e.inboxesList.length&&!e.uiFlags.isFetching&&!e.loadingChatList?(O(),se("div",X1,[i.isAdmin?(O(),_e(c,{key:0})):(O(),_e(v,{key:1,message:e.$t("CONVERSATION.NO_INBOX_AGENT")},null,8,["message"]))])):!e.uiFlags.isFetching&&!e.loadingChatList?(O(),se("div",z1,[e.allConversations.length?e.allConversations.length&&!e.currentChat.id?(O(),_e(v,{key:1,message:n.conversationMissingMessage},null,8,["message"])):he("",!0):(O(),_e(v,{key:0,message:e.$t("CONVERSATION.NO_MESSAGE_1")},null,8,["message"]))])):he("",!0)],2)}const K1=je(Y1,[["render",q1]]),Q1={components:{MessagePreview:_i},props:{message:{type:Object,required:!0}},emits:["dismiss"]},Z1={class:"reply-editor bg-slate-50 dark:bg-slate-800 rounded-md py-1 pl-2 pr-1 text-xs tracking-wide mt-2 flex items-center gap-1.5 -mx-2"},J1={class:"flex-grow gap-1 mt-px text-xs truncate"};function ed(e,t,s,i,o,n){const r=ae("fluent-icon"),c=ae("MessagePreview"),v=ae("woot-button"),x=rt("tooltip");return O(),se("div",Z1,[oe(r,{class:"flex-shrink-0 icon",icon:"arrow-reply",size:"14"}),q("div",J1,[Ke(fe(e.$t("CONVERSATION.REPLYBOX.REPLYING_TO"))+" ",1),oe(c,{message:s.message,"show-message-type":!1,"default-empty-message":e.$t("CONVERSATION.REPLY_MESSAGE_NOT_FOUND"),class:"inline"},null,8,["message","default-empty-message"])]),He(oe(v,{"color-scheme":"secondary",icon:"dismiss",variant:"clear",size:"tiny",class:"flex-shrink-0",onClick:t[0]||(t[0]=ot(h=>e.$emit("dismiss"),["stop"]))},null,512),[[x,e.$t("CONVERSATION.REPLYBOX.DISMISS_REPLY")]])])}const td=je(Q1,[["render",ed]]),sd={name:"ReplyTopPanel",props:{mode:{type:String,default:Ht.REPLY},isMessageLengthReachingThreshold:{type:Boolean,default:()=>!1},charactersRemaining:{type:Number,default:()=>0},popoutReplyBox:{type:Boolean,default:!1}},emits:["setReplyMode","togglePopout"],setup(e,{emit:t}){const s=r=>{t("setReplyMode",r)},i=()=>{s(Ht.REPLY)},o=()=>{s(Ht.NOTE)};return Jt({"Alt+KeyP":{action:()=>o(),allowOnFocusedInput:!0},"Alt+KeyL":{action:()=>i(),allowOnFocusedInput:!0}}),{handleReplyClick:i,handleNoteClick:o}},computed:{replyButtonClass(){return{"is-active":this.mode===Ht.REPLY}},noteButtonClass(){return{"is-active":this.mode===Ht.NOTE}},charLengthClass(){return this.charactersRemaining<0?"text-red-600":"text-slate-600"},characterLengthWarning(){return this.charactersRemaining<0?`${-this.charactersRemaining} ${ga.NEGATIVE}`:`${this.charactersRemaining} ${ga.UNDER_50}`}}},nd={class:"flex justify-between bg-black-50 dark:bg-slate-800"},ad={class:"button-group"},id={class:"flex items-center mx-4 my-0"},od={key:0,class:"text-xs"};function rd(e,t,s,i,o,n){const r=ae("woot-button");return O(),se("div",nd,[q("div",ad,[oe(r,{variant:"clear",class:st(["button--reply",n.replyButtonClass]),onClick:i.handleReplyClick},{default:Oe(()=>[Ke(fe(e.$t("CONVERSATION.REPLYBOX.REPLY")),1)]),_:1},8,["class","onClick"]),oe(r,{class:st(["button--note",n.noteButtonClass]),variant:"clear","color-scheme":"warning",onClick:i.handleNoteClick},{default:Oe(()=>[Ke(fe(e.$t("CONVERSATION.REPLYBOX.PRIVATE_NOTE")),1)]),_:1},8,["class","onClick"])]),q("div",id,[s.isMessageLengthReachingThreshold?(O(),se("div",od,[q("span",{class:st(n.charLengthClass)},fe(n.characterLengthWarning),3)])):he("",!0)]),s.popoutReplyBox?(O(),_e(r,{key:0,variant:"clear",icon:"dismiss","color-scheme":"secondary","class-names":"popout-button",onClick:t[0]||(t[0]=c=>e.$emit("togglePopout"))})):(O(),_e(r,{key:1,variant:"clear",icon:"resize-large","color-scheme":"secondary","class-names":"popout-button",onClick:t[1]||(t[1]=c=>e.$emit("togglePopout"))}))])}const ld=je(sd,[["render",rd],["__scopeId","data-v-21b01666"]]);class cd extends li{constructor(){super("integrations/dyte",{accountScoped:!0})}createAMeeting(t){return axios.post(`${this.url}/create_a_meeting`,{conversation_id:t})}addParticipantToMeeting(t){return axios.post(`${this.url}/add_participant_to_meeting`,{message_id:t})}}const Ai=new cd,dd={props:{conversationId:{type:Number,default:0}},data(){return{isLoading:!1}},computed:{...yt({appIntegrations:"integrations/getAppIntegrations"}),isVideoIntegrationEnabled(){return this.appIntegrations.find(e=>e.id==="dyte"&&!!e.hooks.length)}},mounted(){this.appIntegrations.length||this.$store.dispatch("integrations/get")},methods:{async onClick(){this.isLoading=!0;try{await Ai.createAMeeting(this.conversationId)}catch{Je(this.$t("INTEGRATION_SETTINGS.DYTE.CREATE_ERROR"))}finally{this.isLoading=!1}}}};function ud(e,t,s,i,o,n){const r=ae("woot-button"),c=rt("tooltip");return n.isVideoIntegrationEnabled?He((O(),_e(r,{key:0,icon:"video","is-loading":o.isLoading,"color-scheme":"secondary",variant:"smooth",size:"small",onClick:n.onClick},null,8,["is-loading","onClick"])),[[c,e.$t("INTEGRATION_SETTINGS.DYTE.START_VIDEO_CALL_HELP_TEXT"),void 0,{"top-end":!0}]]):he("",!0)}const hd=je(dd,[["render",ud]]),_d={emits:["close"],setup(){const{updateUISettings:e}=Hs(),{recordAnalytics:t}=Us(),s=Kn();return{updateUISettings:e,v$:s,recordAnalytics:t}},data(){return{value:""}},validations:{value:{required:on}},methods:{onClose(){this.$emit("close")},onDismiss(){Je(this.$t("INTEGRATION_SETTINGS.OPEN_AI.CTA_MODAL.DISMISS_MESSAGE")),this.updateUISettings({is_open_ai_cta_modal_dismissed:!0}),this.onClose()},async finishOpenAI(){var t,s;const e={app_id:"openai",settings:{api_key:this.value}};try{await this.$store.dispatch("integrations/createHook",e),this.alertMessage=this.$t("INTEGRATION_SETTINGS.OPEN_AI.CTA_MODAL.SUCCESS_MESSAGE"),this.recordAnalytics($n.ADDED_AI_INTEGRATION_VIA_CTA_BUTTON),this.onClose()}catch(i){const o=(s=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:s.message;this.alertMessage=o||this.$t("INTEGRATION_APPS.ADD.API.ERROR_MESSAGE")}finally{Je(this.alertMessage)}},openOpenAIDoc(){window.open("https://www.chatwoot.com/blog/v2-17","_blank")}}},md={class:"flex-1 min-w-0 px-0"},pd={class:"w-full mt-2"},fd={class:"flex flex-row justify-between w-full gap-2 px-0 py-2"},gd={class:"flex items-center gap-1"};function bd(e,t,s,i,o,n){const r=ae("woot-modal-header"),c=ae("woot-input"),v=ae("woot-button");return O(),se("div",md,[oe(r,{"header-title":e.$t("INTEGRATION_SETTINGS.OPEN_AI.CTA_MODAL.TITLE"),"header-content":e.$t("INTEGRATION_SETTINGS.OPEN_AI.CTA_MODAL.DESC")},null,8,["header-title","header-content"]),q("form",{class:"flex flex-col flex-wrap modal-content",onSubmit:t[1]||(t[1]=ot((...x)=>n.finishOpenAI&&n.finishOpenAI(...x),["prevent"]))},[q("div",pd,[oe(c,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=x=>o.value=x),type:"text",class:st({error:i.v$.value.$error}),placeholder:e.$t("INTEGRATION_SETTINGS.OPEN_AI.CTA_MODAL.KEY_PLACEHOLDER"),onBlur:i.v$.value.$touch},null,8,["modelValue","class","placeholder","onBlur"])]),q("div",fd,[oe(v,{variant:"link",onClick:ot(n.openOpenAIDoc,["prevent"])},{default:Oe(()=>[Ke(fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.CTA_MODAL.BUTTONS.NEED_HELP")),1)]),_:1},8,["onClick"]),q("div",gd,[oe(v,{variant:"clear",onClick:ot(n.onDismiss,["prevent"])},{default:Oe(()=>[Ke(fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.CTA_MODAL.BUTTONS.DISMISS")),1)]),_:1},8,["onClick"]),oe(v,{"is-disabled":i.v$.value.$invalid},{default:Oe(()=>[Ke(fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.CTA_MODAL.BUTTONS.FINISH")),1)]),_:1},8,["is-disabled"])])])],32)])}const vd=je(_d,[["render",bd]]),Ad={},Td={class:"animation-container margin-top-1"},Ed={class:"ai-typing--wrap"};function Sd(e,t){const s=ae("fluent-icon");return O(),se("div",Td,[q("div",Ed,[oe(s,{icon:"wand",size:"14",class:"ai-typing--icon"}),q("label",null,fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.ASSISTANCE_MODAL.AI_WRITING")),1)]),t[0]||(t[0]=q("span",{class:"loader"},null,-1)),t[1]||(t[1]=q("span",{class:"loader"},null,-1)),t[2]||(t[2]=q("span",{class:"loader"},null,-1))])}const yd=je(Ad,[["render",Sd],["__scopeId","data-v-ddf88734"]]),Id={components:{AILoader:yd},props:{aiOption:{type:String,required:!0}},emits:["close","applyText"],setup(){const{formatMessage:e}=Qn(),{draftMessage:t,processEvent:s,recordAnalytics:i}=Us();return{draftMessage:t,processEvent:s,recordAnalytics:i,formatMessage:e}},data(){return{generatedContent:"",isGenerating:!0}},computed:{headerTitle(){var t;const e=(t=this.aiOption)==null?void 0:t.toUpperCase();return e?this.$t("INTEGRATION_SETTINGS.OPEN_AI.WITH_AI",{option:this.$t(`INTEGRATION_SETTINGS.OPEN_AI.OPTIONS.${e}`)}):""}},mounted(){this.generateAIContent(this.aiOption)},methods:{onClose(){this.$emit("close")},async generateAIContent(e="rephrase"){this.isGenerating=!0,this.generatedContent=await this.processEvent(e),this.isGenerating=!1},applyText(){this.recordAnalytics(this.aiOption),this.$emit("applyText",this.generatedContent),this.onClose()}}},wd={class:"flex flex-col"},Rd={key:0,class:"w-full"},Cd={class:"mt-1 text-base text-slate-700 dark:text-slate-100"},Md={class:"mt-1 text-base text-slate-700 dark:text-slate-100"},Nd={key:1},Od={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"};function kd(e,t,s,i,o,n){const r=ae("woot-modal-header"),c=ae("AILoader"),v=ae("woot-button"),x=rt("dompurify-html");return O(),se("div",wd,[oe(r,{"header-title":n.headerTitle},null,8,["header-title"]),q("form",{class:"flex flex-col w-full modal-content",onSubmit:t[0]||(t[0]=ot((...h)=>n.applyText&&n.applyText(...h),["prevent"]))},[i.draftMessage?(O(),se("div",Rd,[q("h4",Cd,fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.ASSISTANCE_MODAL.DRAFT_TITLE")),1),He(q("p",null,null,512),[[x,i.formatMessage(i.draftMessage,!1)]]),q("h4",Md,fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.ASSISTANCE_MODAL.GENERATED_TITLE")),1)])):he("",!0),q("div",null,[o.isGenerating?(O(),_e(c,{key:0})):He((O(),se("p",Nd,null,512)),[[x,i.formatMessage(o.generatedContent,!1)]])]),q("div",Od,[oe(v,{variant:"clear",onClick:ot(n.onClose,["prevent"])},{default:Oe(()=>[Ke(fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.ASSISTANCE_MODAL.BUTTONS.CANCEL")),1)]),_:1},8,["onClick"]),oe(v,{disabled:!o.generatedContent},{default:Oe(()=>[Ke(fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.ASSISTANCE_MODAL.BUTTONS.APPLY")),1)]),_:1},8,["disabled"])])],32)])}const xd=je(Id,[["render",kd],["__scopeId","data-v-47c2018d"]]),Ld={emits:["open"],methods:{onClick(){this.$emit("open")}}},Pd={class:"relative"};function Bd(e,t,s,i,o,n){const r=ae("woot-button");return O(),se("div",Pd,[oe(r,{icon:"wand","color-scheme":"secondary",variant:"smooth",size:"small","class-names":"cta-btn cta-btn-light dark:cta-btn-dark hover:cta-btn-light-hover dark:hover:cta-btn-dark-hover",onClick:n.onClick},{default:Oe(()=>[Ke(fe(e.$t("INTEGRATION_SETTINGS.OPEN_AI.AI_ASSIST")),1)]),_:1},8,["onClick"]),t[0]||(t[0]=q("div",{class:"radar-ping-animation absolute top-0 right-0 -mt-1 -mr-1 rounded-full w-3 h-3 bg-woot-500 dark:bg-woot-500"},null,-1)),t[1]||(t[1]=q("div",{class:"absolute top-0 right-0 -mt-1 -mr-1 rounded-full w-3 h-3 bg-woot-500 dark:bg-woot-500 opacity-50"},null,-1))])}const Dd=je(Ld,[["render",Bd],["__scopeId","data-v-6f841b19"]]),Vd={components:{AIAssistanceModal:xd,AICTAModal:vd,AIAssistanceCTAButton:Dd},emits:["replaceText"],setup(e,{emit:t}){const{uiSettings:s,updateUISettings:i}=Hs(),{isAIIntegrationEnabled:o,draftMessage:n,recordAnalytics:r}=Us(),{isAdmin:c}=Xn(),v=Ze(""),x=d=>{v.value=d};return Jt({"$mod+KeyZ":{action:()=>{v.value&&(t("replaceText",v.value),v.value="")},allowOnFocusedInput:!0}}),{uiSettings:s,updateUISettings:i,isAdmin:c,initialMessage:v,initializeMessage:x,recordAnalytics:r,isAIIntegrationEnabled:o,draftMessage:n}},data:()=>({showAIAssistanceModal:!1,showAICtaModal:!1,aiOption:""}),computed:{...yt({isAChatwootInstance:"globalConfig/isAChatwootInstance"}),isAICTAModalDismissed(){return this.uiSettings.is_open_ai_cta_modal_dismissed},shouldShowAIAssistCTAButtonForAdmin(){return this.isAdmin&&!this.isAIIntegrationEnabled&&!this.isAICTAModalDismissed&&this.isAChatwootInstance},shouldShowAIAssistCTAButton(){return this.isAIIntegrationEnabled&&!this.isAICTAModalDismissed}},mounted(){ht.on(lr,this.onAIAssist),this.initializeMessage(this.draftMessage)},methods:{hideAIAssistanceModal(){this.recordAnalytics("DISMISS_AI_SUGGESTION",{aiOption:this.aiOption}),this.showAIAssistanceModal=!1},openAIAssist(){this.isAICTAModalDismissed||this.updateUISettings({is_open_ai_cta_modal_dismissed:!0}),this.initializeMessage(this.draftMessage),document.querySelector("ninja-keys").open({parent:"ai_assist"})},hideAICtaModal(){this.showAICtaModal=!1},openAICta(){this.showAICtaModal=!0},onAIAssist(e){this.aiOption=e,this.showAIAssistanceModal=!0},insertText(e){this.$emit("replaceText",e)}}},Gd={key:0,class:"relative"},Fd={key:1,class:"relative"};function $d(e,t,s,i,o,n){const r=ae("AIAssistanceCTAButton"),c=ae("woot-button"),v=ae("AIAssistanceModal"),x=ae("woot-modal"),h=ae("AICTAModal"),d=rt("tooltip");return O(),se("div",null,[i.isAIIntegrationEnabled?(O(),se("div",Gd,[n.shouldShowAIAssistCTAButton?(O(),_e(r,{key:0,onOpen:n.openAIAssist},null,8,["onOpen"])):He((O(),_e(c,{key:1,icon:"wand","color-scheme":"secondary",variant:"smooth",size:"small",onClick:n.openAIAssist},null,8,["onClick"])),[[d,e.$t("INTEGRATION_SETTINGS.OPEN_AI.AI_ASSIST"),void 0,{"top-end":!0}]]),oe(x,{show:e.showAIAssistanceModal,"onUpdate:show":t[0]||(t[0]=C=>e.showAIAssistanceModal=C),"on-close":n.hideAIAssistanceModal},{default:Oe(()=>[oe(v,{"ai-option":e.aiOption,onApplyText:n.insertText,onClose:n.hideAIAssistanceModal},null,8,["ai-option","onApplyText","onClose"])]),_:1},8,["show","on-close"])])):n.shouldShowAIAssistCTAButtonForAdmin?(O(),se("div",Fd,[oe(r,{onClick:n.openAICta},null,8,["onClick"]),oe(x,{show:e.showAICtaModal,"onUpdate:show":t[1]||(t[1]=C=>e.showAICtaModal=C),"on-close":n.hideAICtaModal},{default:Oe(()=>[oe(h,{onClose:n.hideAICtaModal},null,8,["onClose"])]),_:1},8,["show","on-close"])])):he("",!0)])}const Hd=je(Vd,[["render",$d]]),Ud={name:"ReplyBottomPanel",components:{FileUpload:br,VideoCallButton:hd,AIAssistanceButton:Hd},mixins:[Rs],props:{mode:{type:String,default:Ht.REPLY},onSend:{type:Function,default:()=>{}},sendButtonText:{type:String,default:""},recordingAudioDurationText:{type:String,default:"00:00"},inbox:{type:Object,default:()=>({})},showFileUpload:{type:Boolean,default:!1},showAudioRecorder:{type:Boolean,default:!1},onFileUpload:{type:Function,default:()=>{}},toggleEmojiPicker:{type:Function,default:()=>{}},toggleAudioRecorder:{type:Function,default:()=>{}},toggleAudioRecorderPlayPause:{type:Function,default:()=>{}},isRecordingAudio:{type:Boolean,default:!1},recordingAudioState:{type:String,default:""},isSendDisabled:{type:Boolean,default:!1},showEditorToggle:{type:Boolean,default:!1},isOnPrivateNote:{type:Boolean,default:!1},enableMultipleFileUpload:{type:Boolean,default:!0},hasWhatsappTemplates:{type:Boolean,default:!1},conversationId:{type:Number,required:!0},message:{type:String,default:""},newConversationModalActive:{type:Boolean,default:!1},portalSlug:{type:String,required:!0}},emits:["replaceText","toggleInsertArticle","toggleEditor","selectWhatsappTemplate"],setup(){const{setSignatureFlagForInbox:e,fetchSignatureFlagFromUISettings:t}=Hs(),s=Ze(!1);return Jt({"Alt+KeyA":{action:()=>{document.querySelector("#conversationAttachment").click()},allowOnFocusedInput:!0}}),{setSignatureFlagForInbox:e,fetchSignatureFlagFromUISettings:t,uploadRef:s}},computed:{...yt({accountId:"getCurrentAccountId",isFeatureEnabledonAccount:"accounts/isFeatureEnabledonAccount",uiFlags:"integrations/getUIFlags"}),isNote(){return this.mode===Ht.NOTE},wrapClass(){return{"is-note-mode":this.isNote}},buttonClass(){return{warning:this.isNote}},showAttachButton(){return this.showFileUpload||this.isNote},showAudioRecorderButton(){return this.isALineChannel?!1:this.isFeatureEnabledonAccount(this.accountId,ci.VOICE_RECORDER)&&this.showAudioRecorder},showAudioPlayStopButton(){return this.showAudioRecorder&&this.isRecordingAudio},allowedFileTypes(){return this.isATwilioWhatsAppChannel?Qi:this.isALineChannel?Zi:Ji},enableDragAndDrop(){return!this.newConversationModalActive},audioRecorderPlayStopIcon(){switch(this.recordingAudioState){case"playing":return"microphone-pause";case"paused":return"microphone-play";case"stopped":return"microphone-play";default:return"microphone-stop"}},showMessageSignatureButton(){return!this.isOnPrivateNote},sendWithSignature(){return this.fetchSignatureFlagFromUISettings(this.channelType)},signatureToggleTooltip(){return this.sendWithSignature?this.$t("CONVERSATION.FOOTER.DISABLE_SIGN_TOOLTIP"):this.$t("CONVERSATION.FOOTER.ENABLE_SIGN_TOOLTIP")},enableInsertArticleInReply(){return this.portalSlug},isFetchingAppIntegrations(){return this.uiFlags.isFetching}},mounted(){vr.start()},methods:{toggleMessageSignature(){this.setSignatureFlagForInbox(this.channelType,!this.sendWithSignature)},replaceText(e){this.$emit("replaceText",e)},toggleInsertArticle(){this.$emit("toggleInsertArticle")}}},Wd={class:"left-wrap"},jd={class:"fixed top-0 bottom-0 left-0 right-0 z-20 flex flex-col items-center justify-center w-full h-full gap-2 text-slate-900 dark:text-slate-50 bg-modal-backdrop-light dark:bg-modal-backdrop-dark"},Yd={class:"text-2xl break-words text-slate-900 dark:text-slate-50"},Xd={class:"right-wrap"};function zd(e,t,s,i,o,n){const r=ae("woot-button"),c=ae("FileUpload"),v=ae("VideoCallButton"),x=ae("AIAssistanceButton"),h=ae("fluent-icon"),d=rt("tooltip");return O(),se("div",{class:st(["bottom-box",n.wrapClass])},[q("div",Wd,[He(oe(r,{title:e.$t("CONVERSATION.REPLYBOX.TIP_EMOJI_ICON"),icon:"emoji","color-scheme":"secondary",variant:"smooth",size:"small",onClick:s.toggleEmojiPicker},null,8,["title","onClick"]),[[d,e.$t("CONVERSATION.REPLYBOX.TIP_EMOJI_ICON"),void 0,{"top-end":!0}]]),He((O(),_e(c,{ref:"uploadRef","input-id":"conversationAttachment",size:4096*4096,accept:n.allowedFileTypes,multiple:s.enableMultipleFileUpload,drop:n.enableDragAndDrop,"drop-directory":!1,data:{direct_upload_url:"/rails/active_storage/direct_uploads",direct_upload:!0},onInputFile:s.onFileUpload},{default:Oe(()=>[n.showAttachButton?(O(),_e(r,{key:0,"class-names":"button--upload",title:e.$t("CONVERSATION.REPLYBOX.TIP_ATTACH_ICON"),icon:"attach","color-scheme":"secondary",variant:"smooth",size:"small"},null,8,["title"])):he("",!0)]),_:1},8,["accept","multiple","drop","onInputFile"])),[[d,e.$t("CONVERSATION.REPLYBOX.TIP_ATTACH_ICON"),void 0,{"top-end":!0}]]),n.showAudioRecorderButton?He((O(),_e(r,{key:0,icon:s.isRecordingAudio?"microphone-off":"microphone","color-scheme":s.isRecordingAudio?"alert":"secondary",variant:"smooth",size:"small",onClick:s.toggleAudioRecorder},null,8,["icon","color-scheme","onClick"])),[[d,e.$t("CONVERSATION.REPLYBOX.TIP_AUDIORECORDER_ICON"),void 0,{"top-end":!0}]]):he("",!0),s.showEditorToggle?He((O(),_e(r,{key:1,icon:"quote","color-scheme":"secondary",variant:"smooth",size:"small",onClick:t[0]||(t[0]=C=>e.$emit("toggleEditor"))},null,512)),[[d,e.$t("CONVERSATION.REPLYBOX.TIP_FORMAT_ICON"),void 0,{"top-end":!0}]]):he("",!0),n.showAudioPlayStopButton?(O(),_e(r,{key:2,icon:n.audioRecorderPlayStopIcon,"color-scheme":"secondary",variant:"smooth",size:"small",onClick:s.toggleAudioRecorderPlayPause},{default:Oe(()=>[q("span",null,fe(s.recordingAudioDurationText),1)]),_:1},8,["icon","onClick"])):he("",!0),n.showMessageSignatureButton?He((O(),_e(r,{key:3,icon:"signature","color-scheme":"secondary",variant:"smooth",size:"small",title:n.signatureToggleTooltip,onClick:n.toggleMessageSignature},null,8,["title","onClick"])),[[d,n.signatureToggleTooltip,void 0,{"top-end":!0}]]):he("",!0),s.hasWhatsappTemplates?He((O(),_e(r,{key:4,icon:"whatsapp","color-scheme":"secondary",variant:"smooth",size:"small",title:e.$t("CONVERSATION.FOOTER.WHATSAPP_TEMPLATES"),onClick:t[1]||(t[1]=C=>e.$emit("selectWhatsappTemplate"))},null,8,["title"])),[[d,e.$t("CONVERSATION.FOOTER.WHATSAPP_TEMPLATES"),void 0,{"top-end":!0}]]):he("",!0),(e.isAWebWidgetInbox||e.isAPIInbox)&&!s.isOnPrivateNote?(O(),_e(v,{key:5,"conversation-id":s.conversationId},null,8,["conversation-id"])):he("",!0),n.isFetchingAppIntegrations?he("",!0):(O(),_e(x,{key:6,"conversation-id":s.conversationId,"is-private-note":s.isOnPrivateNote,message:s.message,onReplaceText:n.replaceText},null,8,["conversation-id","is-private-note","message","onReplaceText"])),oe(jn,{name:"modal-fade"},{default:Oe(()=>[He(q("div",jd,[oe(h,{icon:"cloud-backup",size:"40"}),q("h4",Yd,fe(e.$t("CONVERSATION.REPLYBOX.DRAG_DROP")),1)],512),[[Gs,i.uploadRef&&i.uploadRef.dropActive]])]),_:1}),n.enableInsertArticleInReply?He((O(),_e(r,{key:7,icon:"document-text-link","color-scheme":"secondary",variant:"smooth",size:"small",title:e.$t("HELP_CENTER.ARTICLE_SEARCH.OPEN_ARTICLE_SEARCH"),onClick:n.toggleInsertArticle},null,8,["title","onClick"])),[[d,e.$t("HELP_CENTER.ARTICLE_SEARCH.OPEN_ARTICLE_SEARCH"),void 0,{"top-end":!0}]]):he("",!0)]),q("div",Xd,[oe(r,{size:"small","class-names":n.buttonClass,"is-disabled":s.isSendDisabled,onClick:s.onSend},{default:Oe(()=>[Ke(fe(s.sendButtonText),1)]),_:1},8,["class-names","is-disabled","onClick"])])],2)}const qd=je(Ud,[["render",zd],["__scopeId","data-v-56531fc3"]]),Kd={class:"flex flex-col py-1"},Qd={class:"flex items-center justify-between py-2 mb-1"},Zd={class:"text-base text-slate-900 dark:text-slate-25"},Jd={class:"relative"},eu={class:"absolute ltr:left-0 rtl:right-0 w-8 top-0.5 h-8 flex justify-center items-center"},tu=["placeholder","value"],su={__name:"Header",props:{title:{type:String,default:"Chatwoot"}},emits:["search","close"],setup(e,{emit:t}){const s=t,i=Ze(null),o=Ze("");ws(()=>{i.value.focus()});const n=v=>{s("search",v.target.value)},r=()=>{s("close")};return Jt({Slash:{action:v=>{v.preventDefault(),i.value.focus()}},Escape:{action:()=>{r()},allowOnFocusedInput:!0}}),(v,x)=>{const h=ae("woot-button"),d=ae("fluent-icon");return O(),se("div",Kd,[q("div",Qd,[q("h3",Zd,fe(e.title),1),oe(h,{variant:"clear",size:"tiny","color-scheme":"secondary",icon:"dismiss",onClick:r})]),q("div",Jd,[q("div",eu,[oe(d,{icon:"search",class:"",size:"18"})]),q("input",{ref_key:"searchInputRef",ref:i,type:"text",placeholder:v.$t("HELP_CENTER.ARTICLE_SEARCH.PLACEHOLDER"),class:"block w-full !h-9 ltr:!pl-8 rtl:!pr-8 dark:!bg-slate-700 !bg-slate-25 text-sm rounded-md leading-8 text-slate-700 shadow-sm ring-2 ring-transparent ring-slate-300 border border-solid border-slate-300 placeholder:text-slate-400 focus:border-woot-600 focus:ring-woot-200 !mb-0 focus:bg-slate-25 dark:focus:bg-slate-700 dark:focus:ring-woot-700",value:o.value,onInput:n},null,40,tu)])])}}},nu={name:"ArticleSearchResultItem",props:{id:{type:Number,default:0},title:{type:String,default:"Untitled"},url:{type:String,default:""},category:{type:String,default:""},locale:{type:String,default:""}},emits:["insert","preview"],methods:{handleInsert(e){e.stopPropagation(),this.$emit("insert",this.id)},handlePreview(e){e.stopPropagation(),this.$emit("preview",this.id)},async handleCopy(e){e.stopPropagation(),await Hn(this.url),Je(this.$t("CONTACT_PANEL.COPY_SUCCESSFUL"))}}},au={class:"w-full mb-0 -mx-1 text-sm rounded-sm ltr:text-left rtl:text-right text-slate-900 dark:text-slate-25 hover:underline group-hover:underline"},iu={class:"flex content-between items-center gap-0.5 w-full"},ou={class:"w-full mb-0 text-sm ltr:text-left rtl:text-right text-slate-600 dark:text-slate-300"},ru={class:"flex gap-0.5"};function lu(e,t,s,i,o,n){const r=ae("woot-button");return O(),se("button",{class:"flex flex-col w-full gap-1 px-2 py-1 bg-white border border-transparent border-solid rounded-md cursor-pointer dark:bg-slate-900 hover:bg-slate-25 hover:dark:bg-slate-800 group focus:outline-none focus:bg-slate-25 focus:border-slate-500 dark:focus:border-slate-400 dark:focus:bg-slate-800",onClick:t[0]||(t[0]=(...c)=>n.handlePreview&&n.handlePreview(...c))},[q("h4",au,fe(s.title),1),q("div",iu,[q("p",ou,fe(s.locale)+" "+fe(" / ")+" "+fe(s.category||e.$t("HELP_CENTER.ARTICLE_SEARCH_RESULT.UNCATEGORIZED")),1),q("div",ru,[oe(r,{title:e.$t("HELP_CENTER.ARTICLE_SEARCH_RESULT.COPY_LINK"),variant:"hollow","color-scheme":"secondary",size:"tiny",icon:"copy",class:"invisible group-hover:visible",onClick:n.handleCopy},null,8,["title","onClick"]),oe(r,{class:"insert-button",variant:"smooth","color-scheme":"secondary",size:"tiny",onClick:n.handleInsert},{default:Oe(()=>[Ke(fe(e.$t("HELP_CENTER.ARTICLE_SEARCH_RESULT.INSERT_ARTICLE")),1)]),_:1},8,["onClick"])])])])}const cu=je(nu,[["render",lu]]),du={name:"SearchResults",components:{SearchResultItem:cu},props:{articles:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},searchQuery:{type:String,default:""}},emits:["preview","insert"],computed:{showNoResults(){return this.searchQuery&&this.articles.length===0}},methods:{handlePreview(e){this.$emit("preview",e)},handleInsert(e){this.$emit("insert",e)}}},uu={class:"flex justify-end h-full gap-1 py-4 overflow-y-auto bg-white dark:bg-slate-900"},hu={class:"flex flex-col w-full gap-1"},_u={key:0,class:"empty-state-message"},mu={key:1,class:"empty-state-message"};function pu(e,t,s,i,o,n){const r=ae("SearchResultItem");return O(),se("div",uu,[q("div",hu,[s.isLoading?(O(),se("div",_u,fe(e.$t("HELP_CENTER.ARTICLE_SEARCH_RESULT.SEARCH_LOADER")),1)):n.showNoResults?(O(),se("div",mu,fe(e.$t("HELP_CENTER.ARTICLE_SEARCH_RESULT.NO_RESULT")),1)):(O(!0),se(vt,{key:2},Et(s.articles,c=>(O(),_e(r,{id:c.id,key:c.id,title:c.title,body:c.content,url:c.url,category:c.category.name,locale:c.localeName,onPreview:n.handlePreview,onInsert:n.handleInsert},null,8,["id","title","body","url","category","locale","onPreview","onInsert"]))),128))])])}const fu=je(du,[["render",pu],["__scopeId","data-v-c8009ce7"]]),gu={name:"ArticleView",components:{IframeLoader:yr},props:{url:{type:String,default:""}},emits:["back","insert"],methods:{onBack(e){e.stopPropagation(),this.$emit("back")},onInsert(e){e.stopPropagation(),this.$emit("insert")}}},bu={class:"h-full w-full flex flex-col flex-1 overflow-hidden"},vu={class:"py-1"},Au={class:"-ml-4 h-full overflow-y-auto"},Tu={class:"w-full h-full min-h-0"},Eu={class:"flex justify-end gap-2 py-2"};function Su(e,t,s,i,o,n){const r=ae("woot-button"),c=ae("IframeLoader");return O(),se("div",bu,[q("div",vu,[oe(r,{variant:"link",size:"small",icon:"chevron-left",onClick:n.onBack},{default:Oe(()=>[Ke(fe(e.$t("HELP_CENTER.ARTICLE_SEARCH.BACK_RESULTS")),1)]),_:1},8,["onClick"])]),q("div",Au,[q("div",Tu,[oe(c,{url:s.url},null,8,["url"])])]),q("div",Eu,[oe(r,{variant:"hollow",size:"small","is-expanded":"","color-scheme":"secondary",icon:"chevron-left",onClick:n.onBack},{default:Oe(()=>[Ke(fe(e.$t("HELP_CENTER.ARTICLE_SEARCH.BACK")),1)]),_:1},8,["onClick"]),oe(r,{size:"small","is-expanded":"",icon:"arrow-download",onClick:n.onInsert},{default:Oe(()=>[Ke(fe(e.$t("HELP_CENTER.ARTICLE_SEARCH.INSERT_ARTICLE")),1)]),_:1},8,["onClick"])])])}const yu=je(gu,[["render",Su]]),Iu={name:"ArticleSearchPopover",components:{SearchHeader:su,SearchResults:fu,ArticleView:yu},mixins:[Ao],props:{selectedPortalSlug:{type:String,required:!0}},emits:["close","insert"],data(){return{searchQuery:"",isLoading:!1,searchResults:[],activeId:"",debounceSearch:()=>{}}},computed:{articleViewerUrl(){const e=this.activeArticle(this.activeId);if(!e)return"";const t=document.body.classList.contains("dark"),s=new URL(e.url);return s.searchParams.set("show_plain_layout","true"),t&&s.searchParams.set("theme","dark"),`${s}`},searchResultsWithUrl(){return this.searchResults.map(e=>({...e,localeName:this.localeName(e.category.locale||"en"),url:this.generateArticleUrl(e)}))}},mounted(){this.fetchArticlesByQuery(this.searchQuery),this.debounceSearch=bi(this.fetchArticlesByQuery,500,!1)},methods:{generateArticleUrl(e){return Ir(this.selectedPortalSlug,"","",e.slug)},activeArticle(e){return this.searchResultsWithUrl.find(t=>t.id===e)},onSearch(e){this.searchQuery=e,this.activeId="",this.debounceSearch(e)},onClose(){this.$emit("close"),this.searchQuery="",this.activeId="",this.searchResults=[]},async fetchArticlesByQuery(e){try{const t=e?"":"views";this.isLoading=!0,this.searchResults=[];const{data:s}=await To.searchArticles({portalSlug:this.selectedPortalSlug,query:e,sort:t});this.searchResults=s.payload,this.isLoading=!0}catch{}finally{this.isLoading=!1}},handlePreview(e){this.activeId=e},onBack(){this.activeId=""},onInsert(e){const t=this.activeArticle(e||this.activeId);this.$emit("insert",t),Je(this.$t("HELP_CENTER.ARTICLE_SEARCH.SUCCESS_ARTICLE_INSERTED")),this.onClose()}}},wu={class:"fixed top-0 left-0 z-50 flex items-center justify-center w-screen h-screen bg-modal-backdrop-light dark:bg-modal-backdrop-dark"},Ru={class:"flex flex-col px-4 pb-4 rounded-md shadow-md border border-solid border-slate-50 dark:border-slate-800 bg-white dark:bg-slate-900 z-[1000] max-w-[720px] md:w-[20rem] lg:w-[24rem] xl:w-[28rem] 2xl:w-[32rem] h-[calc(100vh-20rem)] max-h-[40rem]"};function Cu(e,t,s,i,o,n){const r=ae("SearchHeader"),c=ae("ArticleView"),v=ae("SearchResults"),x=rt("on-clickaway");return O(),se("div",wu,[He((O(),se("div",Ru,[oe(r,{title:e.$t("HELP_CENTER.ARTICLE_SEARCH.TITLE"),class:"w-full sticky top-0 bg-[inherit]",onClose:n.onClose,onSearch:n.onSearch},null,8,["title","onClose","onSearch"]),o.activeId?(O(),_e(c,{key:0,url:n.articleViewerUrl,onBack:n.onBack,onInsert:n.onInsert},null,8,["url","onBack","onInsert"])):(O(),_e(v,{key:1,"search-query":o.searchQuery,"is-loading":o.isLoading,"portal-slug":s.selectedPortalSlug,articles:n.searchResultsWithUrl,onPreview:n.handlePreview,onInsert:n.onInsert},null,8,["search-query","is-loading","portal-slug","articles","onPreview","onInsert"]))])),[[x,n.onClose]])])}const Mu=je(Iu,[["render",Cu]]);function wt(e,t,s,i){return new(s||(s=Promise))(function(o,n){function r(x){try{v(i.next(x))}catch(h){n(h)}}function c(x){try{v(i.throw(x))}catch(h){n(h)}}function v(x){var h;x.done?o(x.value):(h=x.value,h instanceof s?h:new s(function(d){d(h)})).then(r,c)}v((i=i.apply(e,t||[])).next())})}let js=class{constructor(){this.listeners={}}on(t,s,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(s),i==null?void 0:i.once){const o=()=>{this.un(t,o),this.un(t,s)};return this.on(t,o),o}return()=>this.un(t,s)}un(t,s){var i;(i=this.listeners[t])===null||i===void 0||i.delete(s)}once(t,s){return this.on(t,s,{once:!0})}unAll(){this.listeners={}}emit(t,...s){this.listeners[t]&&this.listeners[t].forEach(i=>i(...s))}};const Ea={decode:function(e,t){return wt(this,void 0,void 0,function*(){const s=new AudioContext({sampleRate:t});return s.decodeAudioData(e).finally(()=>s.close())})},createBuffer:function(e,t){return typeof e[0]=="number"&&(e=[e]),function(s){const i=s[0];if(i.some(o=>o>1||o<-1)){const o=i.length;let n=0;for(let r=0;r<o;r++){const c=Math.abs(i[r]);c>n&&(n=c)}for(const r of s)for(let c=0;c<o;c++)r[c]/=n}}(e),{duration:t,length:e[0].length,sampleRate:e[0].length/t,numberOfChannels:e.length,getChannelData:s=>e==null?void 0:e[s],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function Ti(e,t){const s=t.xmlns?document.createElementNS(t.xmlns,e):document.createElement(e);for(const[i,o]of Object.entries(t))if(i==="children")for(const[n,r]of Object.entries(t))typeof r=="string"?s.appendChild(document.createTextNode(r)):s.appendChild(Ti(n,r));else i==="style"?Object.assign(s.style,o):i==="textContent"?s.textContent=o:s.setAttribute(i,o.toString());return s}function Sa(e,t,s){const i=Ti(e,t||{});return s==null||s.appendChild(i),i}var Nu=Object.freeze({__proto__:null,createElement:Sa,default:Sa});const Ou={fetchBlob:function(e,t,s){return wt(this,void 0,void 0,function*(){const i=yield fetch(e,s);if(i.status>=400)throw new Error(`Failed to fetch ${e}: ${i.status} (${i.statusText})`);return function(o,n){wt(this,void 0,void 0,function*(){if(!o.body||!o.headers)return;const r=o.body.getReader(),c=Number(o.headers.get("Content-Length"))||0;let v=0;const x=d=>wt(this,void 0,void 0,function*(){v+=(d==null?void 0:d.length)||0;const C=Math.round(v/c*100);n(C)}),h=()=>wt(this,void 0,void 0,function*(){let d;try{d=yield r.read()}catch{return}d.done||(x(d.value),yield h())});h()})}(i.clone(),t),i.blob()})}};class ku extends js{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),t.playbackRate!=null&&this.onMediaEvent("canplay",()=>{t.playbackRate!=null&&(this.media.playbackRate=t.playbackRate)},{once:!0})}onMediaEvent(t,s,i){return this.media.addEventListener(t,s,i),()=>this.media.removeEventListener(t,s,i)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return this.media.canPlayType(t)!==""}setSrc(t,s){const i=this.getSrc();if(t&&i===t)return;this.revokeSrc();const o=s instanceof Blob&&(this.canPlayType(s.type)||!t)?URL.createObjectURL(s):t;try{this.media.src=o}catch{this.media.src=t}}destroy(){this.media.pause(),this.isExternalMedia||(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(t){this.media=t}play(){return wt(this,void 0,void 0,function*(){return this.media.play()})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=t}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,s){s!=null&&(this.media.preservesPitch=s),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}class ys extends js{constructor(t,s){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.subscriptions=[],this.options=t;const i=this.parentFromOptionsContainer(t.container);this.parent=i;const[o,n]=this.initHtml();i.appendChild(o),this.container=o,this.scrollContainer=n.querySelector(".scroll"),this.wrapper=n.querySelector(".wrapper"),this.canvasWrapper=n.querySelector(".canvases"),this.progressWrapper=n.querySelector(".progress"),this.cursor=n.querySelector(".cursor"),s&&n.appendChild(s),this.initEvents()}parentFromOptionsContainer(t){let s;if(typeof t=="string"?s=document.querySelector(t):t instanceof HTMLElement&&(s=t),!s)throw new Error("Container not found");return s}initEvents(){const t=s=>{const i=this.wrapper.getBoundingClientRect(),o=s.clientX-i.left,n=s.clientY-i.top;return[o/i.width,n/i.height]};if(this.wrapper.addEventListener("click",s=>{const[i,o]=t(s);this.emit("click",i,o)}),this.wrapper.addEventListener("dblclick",s=>{const[i,o]=t(s);this.emit("dblclick",i,o)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:s,scrollWidth:i,clientWidth:o}=this.scrollContainer,n=s/i,r=(s+o)/i;this.emit("scroll",n,r,s,s+o)}),typeof ResizeObserver=="function"){const s=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{s().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const t=this.parent.clientWidth;t===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=t,this.reRender())}initDrag(){this.subscriptions.push(function(t,s,i,o,n=3,r=0,c=100){if(!t)return()=>{};const v=matchMedia("(pointer: coarse)").matches;let x=()=>{};const h=d=>{if(d.button!==r)return;d.preventDefault(),d.stopPropagation();let C=d.clientX,j=d.clientY,V=!1;const X=Date.now(),Y=a=>{if(a.preventDefault(),a.stopPropagation(),v&&Date.now()-X<c)return;const p=a.clientX,M=a.clientY,P=p-C,G=M-j;if(V||Math.abs(P)>n||Math.abs(G)>n){const N=t.getBoundingClientRect(),{left:F,top:pe}=N;V||(i==null||i(C-F,j-pe),V=!0),s(P,G,p-F,M-pe),C=p,j=M}},I=a=>{if(V){const p=a.clientX,M=a.clientY,P=t.getBoundingClientRect(),{left:G,top:N}=P;o==null||o(p-G,M-N)}x()},f=a=>{a.relatedTarget&&a.relatedTarget!==document.documentElement||I(a)},g=a=>{V&&(a.stopPropagation(),a.preventDefault())},y=a=>{V&&a.preventDefault()};document.addEventListener("pointermove",Y),document.addEventListener("pointerup",I),document.addEventListener("pointerout",f),document.addEventListener("pointercancel",f),document.addEventListener("touchmove",y,{passive:!1}),document.addEventListener("click",g,{capture:!0}),x=()=>{document.removeEventListener("pointermove",Y),document.removeEventListener("pointerup",I),document.removeEventListener("pointerout",f),document.removeEventListener("pointercancel",f),document.removeEventListener("touchmove",y),setTimeout(()=>{document.removeEventListener("click",g,{capture:!0})},10)}};return t.addEventListener("pointerdown",h),()=>{x(),t.removeEventListener("pointerdown",h)}}(this.wrapper,(t,s,i)=>{this.emit("drag",Math.max(0,Math.min(1,i/this.wrapper.getBoundingClientRect().width)))},t=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))},t=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))}))}getHeight(t,s){var i;const o=((i=this.audioData)===null||i===void 0?void 0:i.numberOfChannels)||1;if(t==null)return 128;if(!isNaN(Number(t)))return Number(t);if(t==="auto"){const n=this.parent.clientHeight||128;return s!=null&&s.every(r=>!r.overlay)?n/o:n}return 128}initHtml(){const t=document.createElement("div"),s=t.attachShadow({mode:"open"}),i=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return s.innerHTML=`
      <style${i?` nonce="${i}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[t,s]}setOptions(t){if(this.options.container!==t.container){const s=this.parentFromOptionsContainer(t.container);s.appendChild(this.container),this.parent=s}t.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){const{scrollWidth:s}=this.scrollContainer,i=s*t;this.setScroll(i)}destroy(){var t,s;this.subscriptions.forEach(i=>i()),this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),(s=this.unsubscribeOnScroll)===null||s===void 0||s.call(this)}createDelay(t=10){let s,i;const o=()=>{s&&clearTimeout(s),i&&i()};return this.timeouts.push(o),()=>new Promise((n,r)=>{o(),i=r,s=setTimeout(()=>{s=void 0,i=void 0,n()},t)})}convertColorValues(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";const s=document.createElement("canvas"),i=s.getContext("2d"),o=s.height*(window.devicePixelRatio||1),n=i.createLinearGradient(0,0,0,o),r=1/(t.length-1);return t.forEach((c,v)=>{const x=v*r;n.addColorStop(x,c)}),n}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(t,s,i,o){const n=t[0],r=t[1]||t[0],c=n.length,{width:v,height:x}=i.canvas,h=x/2,d=this.getPixelRatio(),C=s.barWidth?s.barWidth*d:1,j=s.barGap?s.barGap*d:s.barWidth?C/2:0,V=s.barRadius||0,X=v/(C+j)/c,Y=V&&"roundRect"in i?"roundRect":"rect";i.beginPath();let I=0,f=0,g=0;for(let y=0;y<=c;y++){const a=Math.round(y*X);if(a>I){const P=Math.round(f*h*o),G=P+Math.round(g*h*o)||1;let N=h-P;s.barAlign==="top"?N=0:s.barAlign==="bottom"&&(N=x-G),i[Y](I*(C+j),N,C,G,V),I=a,f=0,g=0}const p=Math.abs(n[y]||0),M=Math.abs(r[y]||0);p>f&&(f=p),M>g&&(g=M)}i.fill(),i.closePath()}renderLineWaveform(t,s,i,o){const n=r=>{const c=t[r]||t[0],v=c.length,{height:x}=i.canvas,h=x/2,d=i.canvas.width/v;i.moveTo(0,h);let C=0,j=0;for(let V=0;V<=v;V++){const X=Math.round(V*d);if(X>C){const I=h+(Math.round(j*h*o)||1)*(r===0?-1:1);i.lineTo(C,I),C=X,j=0}const Y=Math.abs(c[V]||0);Y>j&&(j=Y)}i.lineTo(C,h)};i.beginPath(),n(0),n(1),i.fill(),i.closePath()}renderWaveform(t,s,i){if(i.fillStyle=this.convertColorValues(s.waveColor),s.renderFunction)return void s.renderFunction(t,i);let o=s.barHeight||1;if(s.normalize){const n=Array.from(t[0]).reduce((r,c)=>Math.max(r,Math.abs(c)),0);o=n?1/n:1}s.barWidth||s.barGap||s.barAlign?this.renderBarWaveform(t,s,i,o):this.renderLineWaveform(t,s,i,o)}renderSingleCanvas(t,s,i,o,n,r,c){const v=this.getPixelRatio(),x=document.createElement("canvas");x.width=Math.round(i*v),x.height=Math.round(o*v),x.style.width=`${i}px`,x.style.height=`${o}px`,x.style.left=`${Math.round(n)}px`,r.appendChild(x);const h=x.getContext("2d");if(this.renderWaveform(t,s,h),x.width>0&&x.height>0){const d=x.cloneNode(),C=d.getContext("2d");C.drawImage(x,0,0),C.globalCompositeOperation="source-in",C.fillStyle=this.convertColorValues(s.progressColor),C.fillRect(0,0,x.width,x.height),c.appendChild(d)}}renderMultiCanvas(t,s,i,o,n,r){const c=this.getPixelRatio(),{clientWidth:v}=this.scrollContainer,x=i/c;let h=Math.min(ys.MAX_CANVAS_WIDTH,v,x),d={};if(s.barWidth||s.barGap){const Y=s.barWidth||.5,I=Y+(s.barGap||Y/2);h%I!=0&&(h=Math.floor(h/I)*I)}const C=Y=>{if(Y<0||Y>=j||d[Y])return;d[Y]=!0;const I=Y*h,f=Math.min(x-I,h);if(f<=0)return;const g=t.map(y=>{const a=Math.floor(I/x*y.length),p=Math.floor((I+f)/x*y.length);return y.slice(a,p)});this.renderSingleCanvas(g,s,f,o,I,n,r)},j=Math.ceil(x/h);if(!this.isScrollable){for(let Y=0;Y<j;Y++)C(Y);return}const V=this.scrollContainer.scrollLeft/x,X=Math.floor(V*j);C(X-1),C(X),C(X+1),j>1&&(this.unsubscribeOnScroll=this.on("scroll",()=>{const{scrollLeft:Y}=this.scrollContainer,I=Math.floor(Y/x*j);Object.keys(d).length>ys.MAX_NODES&&(n.innerHTML="",r.innerHTML="",d={}),C(I-1),C(I),C(I+1)}))}renderChannel(t,s,i,o){var{overlay:n}=s,r=function(h,d){var C={};for(var j in h)Object.prototype.hasOwnProperty.call(h,j)&&d.indexOf(j)<0&&(C[j]=h[j]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var V=0;for(j=Object.getOwnPropertySymbols(h);V<j.length;V++)d.indexOf(j[V])<0&&Object.prototype.propertyIsEnumerable.call(h,j[V])&&(C[j[V]]=h[j[V]])}return C}(s,["overlay"]);const c=document.createElement("div"),v=this.getHeight(r.height,r.splitChannels);c.style.height=`${v}px`,n&&o>0&&(c.style.marginTop=`-${v}px`),this.canvasWrapper.style.minHeight=`${v}px`,this.canvasWrapper.appendChild(c);const x=c.cloneNode();this.progressWrapper.appendChild(x),this.renderMultiCanvas(t,r,i,v,c,x)}render(t){return wt(this,void 0,void 0,function*(){var s;this.timeouts.forEach(v=>v()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const i=this.getPixelRatio(),o=this.scrollContainer.clientWidth,n=Math.ceil(t.duration*(this.options.minPxPerSec||0));this.isScrollable=n>o;const r=this.options.fillParent&&!this.isScrollable,c=(r?o:n)*i;if(this.wrapper.style.width=r?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let v=0;v<t.numberOfChannels;v++){const x=Object.assign(Object.assign({},this.options),(s=this.options.splitChannels)===null||s===void 0?void 0:s[v]);this.renderChannel([t.getChannelData(v)],x,c,v)}else{const v=[t.getChannelData(0)];t.numberOfChannels>1&&v.push(t.getChannelData(1)),this.renderChannel(v,this.options,c,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){var t;if((t=this.unsubscribeOnScroll)===null||t===void 0||t.call(this),delete this.unsubscribeOnScroll,!this.audioData)return;const{scrollWidth:s}=this.scrollContainer,{right:i}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&s!==this.scrollContainer.scrollWidth){const{right:o}=this.progressWrapper.getBoundingClientRect();let n=o-i;n*=2,n=n<0?Math.floor(n):Math.ceil(n),n/=2,this.scrollContainer.scrollLeft+=n}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,s=!1){const{scrollLeft:i,scrollWidth:o,clientWidth:n}=this.scrollContainer,r=t*o,c=i,v=i+n,x=n/2;if(this.isDragging)r+30>v?this.scrollContainer.scrollLeft+=30:r-30<c&&(this.scrollContainer.scrollLeft-=30);else{(r<c||r>v)&&(this.scrollContainer.scrollLeft=r-(this.options.autoCenter?x:0));const h=r-i-x;s&&this.options.autoCenter&&h>0&&(this.scrollContainer.scrollLeft+=Math.min(h,10))}{const h=this.scrollContainer.scrollLeft,d=h/o,C=(h+n)/o;this.emit("scroll",d,C,h,h+n)}}renderProgress(t,s){if(isNaN(t))return;const i=100*t;this.canvasWrapper.style.clipPath=`polygon(${i}% 0, 100% 0, 100% 100%, ${i}% 100%)`,this.progressWrapper.style.width=`${i}%`,this.cursor.style.left=`${i}%`,this.cursor.style.transform=`translateX(-${Math.round(i)===100?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,s)}exportImage(t,s,i){return wt(this,void 0,void 0,function*(){const o=this.canvasWrapper.querySelectorAll("canvas");if(!o.length)throw new Error("No waveform data");if(i==="dataURL"){const n=Array.from(o).map(r=>r.toDataURL(t,s));return Promise.resolve(n)}return Promise.all(Array.from(o).map(n=>new Promise((r,c)=>{n.toBlob(v=>{v?r(v):c(new Error("Could not export image"))},t,s)})))})}}ys.MAX_CANVAS_WIDTH=8e3,ys.MAX_NODES=10;class xu extends js{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class ya extends js{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return wt(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then(s=>{if(s.status>=400)throw new Error(`Failed to fetch ${t}: ${s.status} (${s.statusText})`);return s.arrayBuffer()}).then(s=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(s)).then(s=>{this.currentSrc===t&&(this.buffer=s,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})}_play(){var t;if(!this.paused)return;this.paused=!1,(t=this.bufferNode)===null||t===void 0||t.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let s=this.playedDuration*this._playbackRate;s>=this.duration&&(s=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,s),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,(t=this.bufferNode)===null||t===void 0||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return wt(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){var s,i;const o=t-this.currentTime;(s=this.bufferNode)===null||s===void 0||s.stop(this.audioContext.currentTime+o),(i=this.bufferNode)===null||i===void 0||i.addEventListener("ended",()=>{this.bufferNode=null,this.pause()},{once:!0})}setSinkId(t){return wt(this,void 0,void 0,function*(){return this.audioContext.setSinkId(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){const s=!this.paused;s&&this._pause(),this.playedDuration=t/this._playbackRate,s&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,s;return(t=this._duration)!==null&&t!==void 0?t:((s=this.buffer)===null||s===void 0?void 0:s.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){const t=[];if(!this.buffer)return t;const s=this.buffer.numberOfChannels;for(let i=0;i<s;i++)t.push(this.buffer.getChannelData(i));return t}}const Lu={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class Fs extends ku{static create(t){return new Fs(t)}constructor(t){const s=t.media||(t.backend==="WebAudio"?new ya:void 0);super({media:s,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},Lu,t),this.timer=new xu;const i=s?void 0:this.getMediaElement();this.renderer=new ys(this.options,i),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const o=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");const{peaks:n,duration:r}=this.options;(o||n&&r)&&this.load(o,n,r).catch(()=>null)})}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){const t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t)}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{const t=this.updateProgress();this.emit("timeupdate",t)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("emptied",()=>{this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",t=>{this.emit("error",t.error)}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(t,s)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,s))}),this.renderer.on("dblclick",(t,s)=>{this.emit("dblclick",t,s)}),this.renderer.on("scroll",(t,s,i,o)=>{const n=this.getDuration();this.emit("scroll",t*n,s*n,i,o)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",t=>{this.emit("dragstart",t)}),this.renderer.on("dragend",t=>{this.emit("dragend",t)}));{let t;this.subscriptions.push(this.renderer.on("drag",s=>{if(!this.options.interact)return;let i;this.renderer.renderProgress(s),clearTimeout(t),this.isPlaying()?i=0:this.options.dragToSeek===!0?i=200:typeof this.options.dragToSeek=="object"&&this.options.dragToSeek!==void 0&&(i=this.options.dragToSeek.debounceTime),t=setTimeout(()=>{this.seekTo(s)},i),this.emit("interaction",s*this.getDuration()),this.emit("drag",s)}))}}initPlugins(){var t;!((t=this.options.plugins)===null||t===void 0)&&t.length&&this.options.plugins.forEach(s=>{this.registerPlugin(s)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(t=>t()),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),t.mediaControls!=null&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){return t._init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",()=>{this.plugins=this.plugins.filter(s=>s!==t)})),t}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){const s=t/this.getDuration();this.renderer.setScrollPercentage(s)}getActivePlugins(){return this.plugins}loadAudio(t,s,i,o){return wt(this,void 0,void 0,function*(){var n;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!s&&!i){const c=this.options.fetchParams||{};window.AbortController&&!c.signal&&(this.abortController=new AbortController,c.signal=(n=this.abortController)===null||n===void 0?void 0:n.signal);const v=x=>this.emit("loading",x);s=yield Ou.fetchBlob(t,v,c)}this.setSrc(t,s);const r=yield new Promise(c=>{const v=o||this.getDuration();v?c(v):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>c(this.getDuration()),{once:!0}))});if(!t&&!s){const c=this.getMediaElement();c instanceof ya&&(c.duration=r)}if(i)this.decodedData=Ea.createBuffer(i,r||0);else if(s){const c=yield s.arrayBuffer();this.decodedData=yield Ea.decode(c,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(t,s,i){return wt(this,void 0,void 0,function*(){try{return yield this.loadAudio(t,void 0,s,i)}catch(o){throw this.emit("error",o),o}})}loadBlob(t,s,i){return wt(this,void 0,void 0,function*(){try{return yield this.loadAudio("",t,s,i)}catch(o){throw this.emit("error",o),o}})}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:s=8e3,precision:i=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const o=Math.min(t,this.decodedData.numberOfChannels),n=[];for(let r=0;r<o;r++){const c=this.decodedData.getChannelData(r),v=[],x=c.length/s;for(let h=0;h<s;h++){const d=c.slice(Math.floor(h*x),Math.ceil((h+1)*x));let C=0;for(let j=0;j<d.length;j++){const V=d[j];Math.abs(V)>Math.abs(C)&&(C=V)}v.push(Math.round(C*i)/i)}n.push(v)}return n}getDuration(){let t=super.getDuration()||0;return t!==0&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){const s=this.getDuration()*t;this.setTime(s)}playPause(){return wt(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return wt(this,arguments,void 0,function*(t="image/png",s=1,i="dataURL"){return this.renderer.exportImage(t,s,i)})}destroy(){var t;this.emit("destroy"),(t=this.abortController)===null||t===void 0||t.abort(),this.plugins.forEach(s=>s.destroy()),this.subscriptions.forEach(s=>s()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}Fs.BasePlugin=class extends js{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}_init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}},Fs.dom=Nu;function In(e,t,s,i){return new(s||(s=Promise))(function(o,n){function r(x){try{v(i.next(x))}catch(h){n(h)}}function c(x){try{v(i.throw(x))}catch(h){n(h)}}function v(x){var h;x.done?o(x.value):(h=x.value,h instanceof s?h:new s(function(d){d(h)})).then(r,c)}v((i=i.apply(e,[])).next())})}class Ei{constructor(){this.listeners={}}on(t,s,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(s),i==null?void 0:i.once){const o=()=>{this.un(t,o),this.un(t,s)};return this.on(t,o),o}return()=>this.un(t,s)}un(t,s){var i;(i=this.listeners[t])===null||i===void 0||i.delete(s)}once(t,s){return this.on(t,s,{once:!0})}unAll(){this.listeners={}}emit(t,...s){this.listeners[t]&&this.listeners[t].forEach(i=>i(...s))}}class Pu extends Ei{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(t=>t())}}class Bu extends Ei{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}const Du=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class Zn extends Pu{constructor(t){var s,i,o,n,r,c;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(s=t.audioBitsPerSecond)!==null&&s!==void 0?s:128e3,scrollingWaveform:(i=t.scrollingWaveform)!==null&&i!==void 0&&i,scrollingWaveformWindow:(o=t.scrollingWaveformWindow)!==null&&o!==void 0?o:5,continuousWaveform:(n=t.continuousWaveform)!==null&&n!==void 0&&n,renderRecordedAudio:(r=t.renderRecordedAudio)===null||r===void 0||r,mediaRecorderTimeslice:(c=t.mediaRecorderTimeslice)!==null&&c!==void 0?c:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.timer=new Bu,this.subscriptions.push(this.timer.on("tick",()=>{const v=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+v,this.emit("record-progress",this.duration)}))}static create(t){return new Zn(t||{})}renderMicStream(t){var s;const i=new AudioContext,o=i.createMediaStreamSource(t),n=i.createAnalyser();o.connect(n),this.options.continuousWaveform&&(n.fftSize=32);const r=n.frequencyBinCount,c=new Float32Array(r);let v=0;this.wavesurfer&&((s=this.originalOptions)!==null&&s!==void 0||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0));const x=setInterval(()=>{var h,d,C,j;if(!this.isWaveformPaused){if(n.getFloatTimeDomainData(c),this.options.scrollingWaveform){const V=Math.floor((this.options.scrollingWaveformWindow||0)*i.sampleRate),X=Math.min(V,this.dataWindow?this.dataWindow.length+r:r),Y=new Float32Array(V);if(this.dataWindow){const I=Math.max(0,V-this.dataWindow.length);Y.set(this.dataWindow.slice(-X+r),I)}Y.set(c,V-r),this.dataWindow=Y}else if(this.options.continuousWaveform){if(!this.dataWindow){const X=this.options.continuousWaveformDuration?Math.round(100*this.options.continuousWaveformDuration):((d=(h=this.wavesurfer)===null||h===void 0?void 0:h.getWidth())!==null&&d!==void 0?d:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(X)}let V=0;for(let X=0;X<r;X++){const Y=Math.abs(c[X]);Y>V&&(V=Y)}if(v+1>this.dataWindow.length){const X=new Float32Array(2*this.dataWindow.length);X.set(this.dataWindow,0),this.dataWindow=X}this.dataWindow[v]=V,v++}else this.dataWindow=c;if(this.wavesurfer){const V=((j=(C=this.dataWindow)===null||C===void 0?void 0:C.length)!==null&&j!==void 0?j:0)/100;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:V).then(()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1e3),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))}).catch(X=>{console.error("Error rendering real-time recording data:",X)})}}},10);return{onDestroy:()=>{clearInterval(x),o==null||o.disconnect(),i==null||i.close()},onEnd:()=>{this.isWaveformPaused=!0,clearInterval(x),this.stopMic()}}}startMic(t){return In(this,void 0,void 0,function*(){let s;try{s=yield navigator.mediaDevices.getUserMedia({audio:!(t!=null&&t.deviceId)||{deviceId:t.deviceId}})}catch(n){throw new Error("Error accessing the microphone: "+n.message)}const{onDestroy:i,onEnd:o}=this.renderMicStream(s);return this.subscriptions.push(this.once("destroy",i)),this.subscriptions.push(this.once("record-end",o)),this.stream=s,s})}stopMic(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null,this.mediaRecorder=null)}startRecording(t){return In(this,void 0,void 0,function*(){const s=this.stream||(yield this.startMic(t));this.dataWindow=null;const i=this.mediaRecorder||new MediaRecorder(s,{mimeType:this.options.mimeType||Du.find(r=>MediaRecorder.isTypeSupported(r)),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=i,this.stopRecording();const o=[];i.ondataavailable=r=>{r.data.size>0&&o.push(r.data),this.emit("record-data-available",r.data)};const n=r=>{var c;const v=new Blob(o,{type:i.mimeType});this.emit(r,v),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),(c=this.wavesurfer)===null||c===void 0||c.load(URL.createObjectURL(v)))};i.onpause=()=>n("record-pause"),i.onstop=()=>n("record-end"),i.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")})}getDuration(){return this.duration}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}isPaused(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="paused"}isActive(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)!=="inactive"}stopRecording(){var t;this.isActive()&&((t=this.mediaRecorder)===null||t===void 0||t.stop(),this.timer.stop())}pauseRecording(){var t,s;this.isRecording()&&(this.isWaveformPaused=!0,(t=this.mediaRecorder)===null||t===void 0||t.requestData(),(s=this.mediaRecorder)===null||s===void 0||s.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,(t=this.mediaRecorder)===null||t===void 0||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return In(this,void 0,void 0,function*(){return navigator.mediaDevices.enumerateDevices().then(t=>t.filter(s=>s.kind==="audioinput"))})}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic()}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}}var Jn={};function Vu(e){return new Int8Array(e)}function Si(e){return new Int16Array(e)}function yi(e){return new Int32Array(e)}function Ii(e){return new Float32Array(e)}function Gu(e){return new Float64Array(e)}function wi(e){if(e.length==1)return Ii(e[0]);var t=e[0];e=e.slice(1);for(var s=[],i=0;i<t;i++)s.push(wi(e));return s}function Ri(e){if(e.length==1)return yi(e[0]);var t=e[0];e=e.slice(1);for(var s=[],i=0;i<t;i++)s.push(Ri(e));return s}function Ci(e){if(e.length==1)return Si(e[0]);var t=e[0];e=e.slice(1);for(var s=[],i=0;i<t;i++)s.push(Ci(e));return s}function Mi(e){if(e.length==1)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var s=[],i=0;i<t;i++)s.push(Mi(e));return s}var Ni={};Ni.fill=function(e,t,s,i){if(arguments.length==2)for(var o=0;o<e.length;o++)e[o]=arguments[1];else for(var o=t;o<s;o++)e[o]=i};var Ys={};Ys.arraycopy=function(e,t,s,i,o){for(var n=t+o;t<n;)s[i++]=e[t++]};Ys.out={};Ys.out.println=function(e){console.log(e)};Ys.out.printf=function(){console.log.apply(console,arguments)};var ln={};ln.SQRT2=1.4142135623730951;ln.FAST_LOG10=function(e){return Math.log10(e)};ln.FAST_LOG10_X=function(e,t){return Math.log10(e)*t};function Zt(e){this.ordinal=e}Zt.short_block_allowed=new Zt(0);Zt.short_block_coupled=new Zt(1);Zt.short_block_dispensed=new Zt(2);Zt.short_block_forced=new Zt(3);var Oi={};Oi.MAX_VALUE=34028235e31;function Dt(e){this.ordinal=e}Dt.vbr_off=new Dt(0);Dt.vbr_mt=new Dt(1);Dt.vbr_rh=new Dt(2);Dt.vbr_abr=new Dt(3);Dt.vbr_mtrh=new Dt(4);Dt.vbr_default=Dt.vbr_mtrh;var Fu=function(e){},_t={System:Ys,VbrMode:Dt,Float:Oi,ShortBlock:Zt,Util:ln,Arrays:Ni,new_array_n:Mi,new_byte:Vu,new_double:Gu,new_float:Ii,new_float_n:wi,new_int:yi,new_int_n:Ri,new_short:Si,new_short_n:Ci,assert:Fu},wn,Ia;function $u(){if(Ia)return wn;Ia=1;var e=_t,t=e.System,s=e.Util,i=e.Arrays,o=e.new_float,n=Rt();function r(){var c=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*s.SQRT2*.5/2384e-9,.017876148*s.SQRT2*.5/2384e-9,.003134727*s.SQRT2*.5/2384e-9,.002457142*s.SQRT2*.5/2384e-9,971317e-9*s.SQRT2*.5/2384e-9,218868e-9*s.SQRT2*.5/2384e-9,101566e-9*s.SQRT2*.5/2384e-9,13828e-9*s.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],v=12,x=36,h=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],d=h[n.SHORT_TYPE],C=h[n.SHORT_TYPE],j=h[n.SHORT_TYPE],V=h[n.SHORT_TYPE],X=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function Y(g,y,a){for(var p=10,M=y+238-14-286,P=-15;P<0;P++){var G,N,F;G=c[p+-10],N=g[M+-224]*G,F=g[y+224]*G,G=c[p+-9],N+=g[M+-160]*G,F+=g[y+160]*G,G=c[p+-8],N+=g[M+-96]*G,F+=g[y+96]*G,G=c[p+-7],N+=g[M+-32]*G,F+=g[y+32]*G,G=c[p+-6],N+=g[M+32]*G,F+=g[y+-32]*G,G=c[p+-5],N+=g[M+96]*G,F+=g[y+-96]*G,G=c[p+-4],N+=g[M+160]*G,F+=g[y+-160]*G,G=c[p+-3],N+=g[M+224]*G,F+=g[y+-224]*G,G=c[p+-2],N+=g[y+-256]*G,F-=g[M+256]*G,G=c[p+-1],N+=g[y+-192]*G,F-=g[M+192]*G,G=c[p+0],N+=g[y+-128]*G,F-=g[M+128]*G,G=c[p+1],N+=g[y+-64]*G,F-=g[M+64]*G,G=c[p+2],N+=g[y+0]*G,F-=g[M+0]*G,G=c[p+3],N+=g[y+64]*G,F-=g[M+-64]*G,G=c[p+4],N+=g[y+128]*G,F-=g[M+-128]*G,G=c[p+5],N+=g[y+192]*G,F-=g[M+-192]*G,N*=c[p+6],G=F-N,a[30+P*2]=F+N,a[31+P*2]=c[p+7]*G,p+=18,y--,M++}{var N,F,pe,k;F=g[y+-16]*c[p+-10],N=g[y+-32]*c[p+-2],F+=(g[y+-48]-g[y+16])*c[p+-9],N+=g[y+-96]*c[p+-1],F+=(g[y+-80]+g[y+48])*c[p+-8],N+=g[y+-160]*c[p+0],F+=(g[y+-112]-g[y+80])*c[p+-7],N+=g[y+-224]*c[p+1],F+=(g[y+-144]+g[y+112])*c[p+-6],N-=g[y+32]*c[p+2],F+=(g[y+-176]-g[y+144])*c[p+-5],N-=g[y+96]*c[p+3],F+=(g[y+-208]+g[y+176])*c[p+-4],N-=g[y+160]*c[p+4],F+=(g[y+-240]-g[y+208])*c[p+-3],N-=g[y+224],pe=N-F,k=N+F,F=a[14],N=a[15]-F,a[31]=k+F,a[30]=pe+N,a[15]=pe-N,a[14]=k-F}{var l;l=a[28]-a[0],a[0]+=a[28],a[28]=l*c[p+-2*18+7],l=a[29]-a[1],a[1]+=a[29],a[29]=l*c[p+-2*18+7],l=a[26]-a[2],a[2]+=a[26],a[26]=l*c[p+-4*18+7],l=a[27]-a[3],a[3]+=a[27],a[27]=l*c[p+-4*18+7],l=a[24]-a[4],a[4]+=a[24],a[24]=l*c[p+-6*18+7],l=a[25]-a[5],a[5]+=a[25],a[25]=l*c[p+-6*18+7],l=a[22]-a[6],a[6]+=a[22],a[22]=l*s.SQRT2,l=a[23]-a[7],a[7]+=a[23],a[23]=l*s.SQRT2-a[7],a[7]-=a[6],a[22]-=a[7],a[23]-=a[22],l=a[6],a[6]=a[31]-l,a[31]=a[31]+l,l=a[7],a[7]=a[30]-l,a[30]=a[30]+l,l=a[22],a[22]=a[15]-l,a[15]=a[15]+l,l=a[23],a[23]=a[14]-l,a[14]=a[14]+l,l=a[20]-a[8],a[8]+=a[20],a[20]=l*c[p+-10*18+7],l=a[21]-a[9],a[9]+=a[21],a[21]=l*c[p+-10*18+7],l=a[18]-a[10],a[10]+=a[18],a[18]=l*c[p+-12*18+7],l=a[19]-a[11],a[11]+=a[19],a[19]=l*c[p+-12*18+7],l=a[16]-a[12],a[12]+=a[16],a[16]=l*c[p+-14*18+7],l=a[17]-a[13],a[13]+=a[17],a[17]=l*c[p+-14*18+7],l=-a[20]+a[24],a[20]+=a[24],a[24]=l*c[p+-12*18+7],l=-a[21]+a[25],a[21]+=a[25],a[25]=l*c[p+-12*18+7],l=a[4]-a[8],a[4]+=a[8],a[8]=l*c[p+-12*18+7],l=a[5]-a[9],a[5]+=a[9],a[9]=l*c[p+-12*18+7],l=a[0]-a[12],a[0]+=a[12],a[12]=l*c[p+-4*18+7],l=a[1]-a[13],a[1]+=a[13],a[13]=l*c[p+-4*18+7],l=a[16]-a[28],a[16]+=a[28],a[28]=l*c[p+-4*18+7],l=-a[17]+a[29],a[17]+=a[29],a[29]=l*c[p+-4*18+7],l=s.SQRT2*(a[2]-a[10]),a[2]+=a[10],a[10]=l,l=s.SQRT2*(a[3]-a[11]),a[3]+=a[11],a[11]=l,l=s.SQRT2*(-a[18]+a[26]),a[18]+=a[26],a[26]=l-a[18],l=s.SQRT2*(-a[19]+a[27]),a[19]+=a[27],a[27]=l-a[19],l=a[2],a[19]-=a[3],a[3]-=l,a[2]=a[31]-l,a[31]+=l,l=a[3],a[11]-=a[19],a[18]-=l,a[3]=a[30]-l,a[30]+=l,l=a[18],a[27]-=a[11],a[19]-=l,a[18]=a[15]-l,a[15]+=l,l=a[19],a[10]-=l,a[19]=a[14]-l,a[14]+=l,l=a[10],a[11]-=l,a[10]=a[23]-l,a[23]+=l,l=a[11],a[26]-=l,a[11]=a[22]-l,a[22]+=l,l=a[26],a[27]-=l,a[26]=a[7]-l,a[7]+=l,l=a[27],a[27]=a[6]-l,a[6]+=l,l=s.SQRT2*(a[0]-a[4]),a[0]+=a[4],a[4]=l,l=s.SQRT2*(a[1]-a[5]),a[1]+=a[5],a[5]=l,l=s.SQRT2*(a[16]-a[20]),a[16]+=a[20],a[20]=l,l=s.SQRT2*(a[17]-a[21]),a[17]+=a[21],a[21]=l,l=-s.SQRT2*(a[8]-a[12]),a[8]+=a[12],a[12]=l-a[8],l=-s.SQRT2*(a[9]-a[13]),a[9]+=a[13],a[13]=l-a[9],l=-s.SQRT2*(a[25]-a[29]),a[25]+=a[29],a[29]=l-a[25],l=-s.SQRT2*(a[24]+a[28]),a[24]-=a[28],a[28]=l-a[24],l=a[24]-a[16],a[24]=l,l=a[20]-l,a[20]=l,l=a[28]-l,a[28]=l,l=a[25]-a[17],a[25]=l,l=a[21]-l,a[21]=l,l=a[29]-l,a[29]=l,l=a[17]-a[1],a[17]=l,l=a[9]-l,a[9]=l,l=a[25]-l,a[25]=l,l=a[5]-l,a[5]=l,l=a[21]-l,a[21]=l,l=a[13]-l,a[13]=l,l=a[29]-l,a[29]=l,l=a[1]-a[0],a[1]=l,l=a[16]-l,a[16]=l,l=a[17]-l,a[17]=l,l=a[8]-l,a[8]=l,l=a[9]-l,a[9]=l,l=a[24]-l,a[24]=l,l=a[25]-l,a[25]=l,l=a[4]-l,a[4]=l,l=a[5]-l,a[5]=l,l=a[20]-l,a[20]=l,l=a[21]-l,a[21]=l,l=a[12]-l,a[12]=l,l=a[13]-l,a[13]=l,l=a[28]-l,a[28]=l,l=a[29]-l,a[29]=l,l=a[0],a[0]+=a[31],a[31]-=l,l=a[1],a[1]+=a[30],a[30]-=l,l=a[16],a[16]+=a[15],a[15]-=l,l=a[17],a[17]+=a[14],a[14]-=l,l=a[8],a[8]+=a[23],a[23]-=l,l=a[9],a[9]+=a[22],a[22]-=l,l=a[24],a[24]+=a[7],a[7]-=l,l=a[25],a[25]+=a[6],a[6]-=l,l=a[4],a[4]+=a[27],a[27]-=l,l=a[5],a[5]+=a[26],a[26]-=l,l=a[20],a[20]+=a[11],a[11]-=l,l=a[21],a[21]+=a[10],a[10]-=l,l=a[12],a[12]+=a[19],a[19]-=l,l=a[13],a[13]+=a[18],a[18]-=l,l=a[28],a[28]+=a[3],a[3]-=l,l=a[29],a[29]+=a[2],a[2]-=l}}function I(g,y){for(var a=0;a<3;a++){var p,M,P,G,N,F;G=g[y+2*3]*h[n.SHORT_TYPE][0]-g[y+5*3],p=g[y+0*3]*h[n.SHORT_TYPE][2]-g[y+3*3],M=G+p,P=G-p,G=g[y+5*3]*h[n.SHORT_TYPE][0]+g[y+2*3],p=g[y+3*3]*h[n.SHORT_TYPE][2]+g[y+0*3],N=G+p,F=-G+p,p=(g[y+1*3]*h[n.SHORT_TYPE][1]-g[y+4*3])*2069978111953089e-26,G=(g[y+4*3]*h[n.SHORT_TYPE][1]+g[y+1*3])*2069978111953089e-26,g[y+3*0]=M*190752519173728e-25+p,g[y+3*5]=-N*190752519173728e-25+G,P=P*.8660254037844387*1907525191737281e-26,N=N*.5*1907525191737281e-26+G,g[y+3*1]=P-N,g[y+3*2]=P+N,M=M*.5*1907525191737281e-26-p,F=F*.8660254037844387*1907525191737281e-26,g[y+3*3]=M+F,g[y+3*4]=M-F,y++}}function f(g,y,a){var p,M;{var P,G,N,F,pe,k,l,w;P=a[17]-a[9],N=a[15]-a[11],F=a[14]-a[12],pe=a[0]+a[8],k=a[1]+a[7],l=a[2]+a[6],w=a[3]+a[5],g[y+17]=pe+l-w-(k-a[4]),M=(pe+l-w)*C[19]+(k-a[4]),p=(P-N-F)*C[18],g[y+5]=p+M,g[y+6]=p-M,G=(a[16]-a[10])*C[18],k=k*C[19]+a[4],p=P*C[12]+G+N*C[13]+F*C[14],M=-pe*C[16]+k-l*C[17]+w*C[15],g[y+1]=p+M,g[y+2]=p-M,p=P*C[13]-G-N*C[14]+F*C[12],M=-pe*C[17]+k-l*C[15]+w*C[16],g[y+9]=p+M,g[y+10]=p-M,p=P*C[14]-G+N*C[12]-F*C[13],M=pe*C[15]-k+l*C[16]-w*C[17],g[y+13]=p+M,g[y+14]=p-M}{var $,z,W,ne,B,b,m,u;$=a[8]-a[0],W=a[6]-a[2],ne=a[5]-a[3],B=a[17]+a[9],b=a[16]+a[10],m=a[15]+a[11],u=a[14]+a[12],g[y+0]=B+m+u+(b+a[13]),p=(B+m+u)*C[19]-(b+a[13]),M=($-W+ne)*C[18],g[y+11]=p+M,g[y+12]=p-M,z=(a[7]-a[1])*C[18],b=a[13]-b*C[19],p=B*C[15]-b+m*C[16]+u*C[17],M=$*C[14]+z+W*C[12]+ne*C[13],g[y+3]=p+M,g[y+4]=p-M,p=-B*C[17]+b-m*C[15]-u*C[16],M=$*C[13]+z-W*C[14]-ne*C[12],g[y+7]=p+M,g[y+8]=p-M,p=-B*C[16]+b-m*C[17]-u*C[15],M=$*C[12]-z+W*C[13]-ne*C[14],g[y+15]=p+M,g[y+16]=p-M}}this.mdct_sub48=function(g,y,a){for(var p=y,M=286,P=0;P<g.channels_out;P++){for(var G=0;G<g.mode_gr;G++){for(var N,F=g.l3_side.tt[G][P],pe=F.xr,k=0,l=g.sb_sample[P][1-G],w=0,$=0;$<18/2;$++)for(Y(p,M,l[w]),Y(p,M+32,l[w+1]),w+=2,M+=64,N=1;N<32;N+=2)l[w-1][N]*=-1;for(N=0;N<32;N++,k+=18){var z=F.block_type,W=g.sb_sample[P][G],ne=g.sb_sample[P][1-G];if(F.mixed_block_flag!=0&&N<2&&(z=0),g.amp_filter[N]<1e-12)i.fill(pe,k+0,k+18,0);else{if(g.amp_filter[N]<1)for(var $=0;$<18;$++)ne[$][X[N]]*=g.amp_filter[N];if(z==n.SHORT_TYPE){for(var $=-v/4;$<0;$++){var B=h[n.SHORT_TYPE][$+3];pe[k+$*3+9]=W[9+$][X[N]]*B-W[8-$][X[N]],pe[k+$*3+18]=W[14-$][X[N]]*B+W[15+$][X[N]],pe[k+$*3+10]=W[15+$][X[N]]*B-W[14-$][X[N]],pe[k+$*3+19]=ne[2-$][X[N]]*B+ne[3+$][X[N]],pe[k+$*3+11]=ne[3+$][X[N]]*B-ne[2-$][X[N]],pe[k+$*3+20]=ne[8-$][X[N]]*B+ne[9+$][X[N]]}I(pe,k)}else{for(var b=o(18),$=-x/4;$<0;$++){var m,u;m=h[z][$+27]*ne[$+9][X[N]]+h[z][$+36]*ne[8-$][X[N]],u=h[z][$+9]*W[$+9][X[N]]-h[z][$+18]*W[8-$][X[N]],b[$+9]=m-u*d[3+$+9],b[$+18]=m*d[3+$+9]+u}f(pe,k,b)}}if(z!=n.SHORT_TYPE&&N!=0)for(var $=7;$>=0;--$){var A,R;A=pe[k+$]*j[20+$]+pe[k+-1-$]*V[28+$],R=pe[k+$]*V[28+$]-pe[k+-1-$]*j[20+$],pe[k+-1-$]=A,pe[k+$]=R}}}if(p=a,M=286,g.mode_gr==1)for(var J=0;J<18;J++)t.arraycopy(g.sb_sample[P][1][J],0,g.sb_sample[P][0][J],0,32)}}}return wn=r,wn}var Rn,wa;function ki(){if(wa)return Rn;wa=1;var e=Rt(),t=_t,s=t.System,i=t.new_float,o=t.new_float_n;function n(){this.l=i(e.SBMAX_l),this.s=o([e.SBMAX_s,3]);var r=this;this.assign=function(c){s.arraycopy(c.l,0,r.l,0,e.SBMAX_l);for(var v=0;v<e.SBMAX_s;v++)for(var x=0;x<3;x++)r.s[v][x]=c.s[v][x]}}return Rn=n,Rn}var Cn,Ra;function Hu(){if(Ra)return Cn;Ra=1;var e=ki();function t(){this.thm=new e,this.en=new e}return Cn=t,Cn}function Xt(e){var t=e;this.ordinal=function(){return t}}Xt.STEREO=new Xt(0);Xt.JOINT_STEREO=new Xt(1);Xt.DUAL_CHANNEL=new Xt(2);Xt.MONO=new Xt(3);Xt.NOT_SET=new Xt(4);var Xs=Xt,Mn,Ca;function Rt(){if(Ca)return Mn;Ca=1;var e=_t,t=e.System,s=e.VbrMode,i=e.new_array_n,o=e.new_float,n=e.new_float_n,r=e.new_int,c=e.assert;v.ENCDELAY=576,v.POSTDELAY=1152,v.MDCTDELAY=48,v.FFTOFFSET=224+v.MDCTDELAY,v.DECDELAY=528,v.SBLIMIT=32,v.CBANDS=64,v.SBPSY_l=21,v.SBPSY_s=12,v.SBMAX_l=22,v.SBMAX_s=13,v.PSFB21=6,v.PSFB12=6,v.BLKSIZE=1024,v.HBLKSIZE=v.BLKSIZE/2+1,v.BLKSIZE_s=256,v.HBLKSIZE_s=v.BLKSIZE_s/2+1,v.NORM_TYPE=0,v.START_TYPE=1,v.SHORT_TYPE=2,v.STOP_TYPE=3,v.MPG_MD_LR_LR=0,v.MPG_MD_LR_I=1,v.MPG_MD_MS_LR=2,v.MPG_MD_MS_I=3,v.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function v(){var x=$u(),h=Hu(),d=Xs,C=v.FFTOFFSET,j=v.MPG_MD_MS_LR,V=null;this.psy=null;var X=null,Y=null,I=null;this.setModules=function(p,M,P,G){V=p,this.psy=M,X=M,Y=G,I=P};var f=new x;function g(p){var M,P;if(p.ATH.useAdjust==0){p.ATH.adjust=1;return}if(P=p.loudness_sq[0][0],M=p.loudness_sq[1][0],p.channels_out==2?(P+=p.loudness_sq[0][1],M+=p.loudness_sq[1][1]):(P+=P,M+=M),p.mode_gr==2&&(P=Math.max(P,M)),P*=.5,P*=p.ATH.aaSensitivityP,P>.03125)p.ATH.adjust>=1?p.ATH.adjust=1:p.ATH.adjust<p.ATH.adjustLimit&&(p.ATH.adjust=p.ATH.adjustLimit),p.ATH.adjustLimit=1;else{var G=31.98*P+625e-6;p.ATH.adjust>=G?(p.ATH.adjust*=G*.075+.925,p.ATH.adjust<G&&(p.ATH.adjust=G)):p.ATH.adjustLimit>=G?p.ATH.adjust=G:p.ATH.adjust<p.ATH.adjustLimit&&(p.ATH.adjust=p.ATH.adjustLimit),p.ATH.adjustLimit=G}}function y(p){var M,P;for(c(0<=p.bitrate_index&&p.bitrate_index<16),c(0<=p.mode_ext&&p.mode_ext<4),p.bitrate_stereoMode_Hist[p.bitrate_index][4]++,p.bitrate_stereoMode_Hist[15][4]++,p.channels_out==2&&(p.bitrate_stereoMode_Hist[p.bitrate_index][p.mode_ext]++,p.bitrate_stereoMode_Hist[15][p.mode_ext]++),M=0;M<p.mode_gr;++M)for(P=0;P<p.channels_out;++P){var G=p.l3_side.tt[M][P].block_type|0;p.l3_side.tt[M][P].mixed_block_flag!=0&&(G=4),p.bitrate_blockType_Hist[p.bitrate_index][G]++,p.bitrate_blockType_Hist[p.bitrate_index][5]++,p.bitrate_blockType_Hist[15][G]++,p.bitrate_blockType_Hist[15][5]++}}function a(p,M){var P=p.internal_flags,G,N;if(P.lame_encode_frame_init==0){var F,pe,k=o(2014),l=o(2014);for(P.lame_encode_frame_init=1,F=0,pe=0;F<286+576*(1+P.mode_gr);++F)F<576*P.mode_gr?(k[F]=0,P.channels_out==2&&(l[F]=0)):(k[F]=M[0][pe],P.channels_out==2&&(l[F]=M[1][pe]),++pe);for(N=0;N<P.mode_gr;N++)for(G=0;G<P.channels_out;G++)P.l3_side.tt[N][G].block_type=v.SHORT_TYPE;f.mdct_sub48(P,k,l),c(576>=v.FFTOFFSET),c(P.mf_size>=v.BLKSIZE+p.framesize-v.FFTOFFSET),c(P.mf_size>=512+p.framesize-32)}}this.lame_encode_mp3_frame=function(p,M,P,G,N,F){var pe,k=i([2,2]);k[0][0]=new h,k[0][1]=new h,k[1][0]=new h,k[1][1]=new h;var l=i([2,2]);l[0][0]=new h,l[0][1]=new h,l[1][0]=new h,l[1][1]=new h;var w,$=[null,null],z=p.internal_flags,W=n([2,4]),ne=[.5,.5],B=[[0,0],[0,0]],b=[[0,0],[0,0]],m,u,A;if($[0]=M,$[1]=P,z.lame_encode_frame_init==0&&a(p,$),z.padding=0,(z.slot_lag-=z.frac_SpF)<0&&(z.slot_lag+=p.out_samplerate,z.padding=1),z.psymodel!=0){var R,J=[null,null],le=0,H=r(2);for(A=0;A<z.mode_gr;A++){for(u=0;u<z.channels_out;u++)J[u]=$[u],le=576+A*576-v.FFTOFFSET;if(p.VBR==s.vbr_mtrh||p.VBR==s.vbr_mt?R=X.L3psycho_anal_vbr(p,J,le,A,k,l,B[A],b[A],W[A],H):R=X.L3psycho_anal_ns(p,J,le,A,k,l,B[A],b[A],W[A],H),R!=0)return-4;for(p.mode==d.JOINT_STEREO&&(ne[A]=W[A][2]+W[A][3],ne[A]>0&&(ne[A]=W[A][3]/ne[A])),u=0;u<z.channels_out;u++){var ee=z.l3_side.tt[A][u];ee.block_type=H[u],ee.mixed_block_flag=0}}}else for(A=0;A<z.mode_gr;A++)for(u=0;u<z.channels_out;u++)z.l3_side.tt[A][u].block_type=v.NORM_TYPE,z.l3_side.tt[A][u].mixed_block_flag=0,b[A][u]=B[A][u]=700;if(g(z),f.mdct_sub48(z,$[0],$[1]),z.mode_ext=v.MPG_MD_LR_LR,p.force_ms)z.mode_ext=v.MPG_MD_MS_LR;else if(p.mode==d.JOINT_STEREO){var me=0,Te=0;for(A=0;A<z.mode_gr;A++)for(u=0;u<z.channels_out;u++)me+=b[A][u],Te+=B[A][u];if(me<=1*Te){var we=z.l3_side.tt[0],Ne=z.l3_side.tt[z.mode_gr-1];we[0].block_type==we[1].block_type&&Ne[0].block_type==Ne[1].block_type&&(z.mode_ext=v.MPG_MD_MS_LR)}}if(z.mode_ext==j?(w=l,m=b):(w=k,m=B),p.analysis&&z.pinfo!=null)for(A=0;A<z.mode_gr;A++)for(u=0;u<z.channels_out;u++)z.pinfo.ms_ratio[A]=z.ms_ratio[A],z.pinfo.ms_ener_ratio[A]=ne[A],z.pinfo.blocktype[A][u]=z.l3_side.tt[A][u].block_type,z.pinfo.pe[A][u]=m[A][u],t.arraycopy(z.l3_side.tt[A][u].xr,0,z.pinfo.xr[A][u],0,576),z.mode_ext==j&&(z.pinfo.ers[A][u]=z.pinfo.ers[A][u+2],t.arraycopy(z.pinfo.energy[A][u+2],0,z.pinfo.energy[A][u],0,z.pinfo.energy[A][u].length));if(p.VBR==s.vbr_off||p.VBR==s.vbr_abr){var Re,Ce;for(Re=0;Re<18;Re++)z.nsPsy.pefirbuf[Re]=z.nsPsy.pefirbuf[Re+1];for(Ce=0,A=0;A<z.mode_gr;A++)for(u=0;u<z.channels_out;u++)Ce+=m[A][u];for(z.nsPsy.pefirbuf[18]=Ce,Ce=z.nsPsy.pefirbuf[9],Re=0;Re<9;Re++)Ce+=(z.nsPsy.pefirbuf[Re]+z.nsPsy.pefirbuf[18-Re])*v.fircoef[Re];for(Ce=670*5*z.mode_gr*z.channels_out/Ce,A=0;A<z.mode_gr;A++)for(u=0;u<z.channels_out;u++)m[A][u]*=Ce}if(z.iteration_loop.iteration_loop(p,m,ne,w),V.format_bitstream(p),pe=V.copy_buffer(z,G,N,F,1),p.bWriteVbrTag&&Y.addVbrFrame(p),p.analysis&&z.pinfo!=null){for(u=0;u<z.channels_out;u++){var Pe;for(Pe=0;Pe<C;Pe++)z.pinfo.pcmdata[u][Pe]=z.pinfo.pcmdata[u][Pe+p.framesize];for(Pe=C;Pe<1600;Pe++)z.pinfo.pcmdata[u][Pe]=$[u][Pe-C]}I.set_frame_pinfo(p,w)}return y(z),pe}}return Mn=v,Mn}var xi=_t,Ma=xi.Util,Na=xi.new_float,bt=Rt();function Uu(){var e=Na(bt.BLKSIZE),t=Na(bt.BLKSIZE_s/2),s=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function i(n,r,c){var v=0,x,h,d;c<<=1;var C=r+c;x=4;do{var j,V,X,Y,I,f,g;g=x>>1,Y=x,I=x<<1,f=I+Y,x=I<<1,h=r,d=h+g;do{var y,a,p,M;a=n[h+0]-n[h+Y],y=n[h+0]+n[h+Y],M=n[h+I]-n[h+f],p=n[h+I]+n[h+f],n[h+I]=y-p,n[h+0]=y+p,n[h+f]=a-M,n[h+Y]=a+M,a=n[d+0]-n[d+Y],y=n[d+0]+n[d+Y],M=Ma.SQRT2*n[d+f],p=Ma.SQRT2*n[d+I],n[d+I]=y-p,n[d+0]=y+p,n[d+f]=a-M,n[d+Y]=a+M,d+=x,h+=x}while(h<C);for(V=s[v+0],j=s[v+1],X=1;X<g;X++){var P,G;P=1-2*j*j,G=2*j*V,h=r+X,d=r+Y-X;do{var N,F,pe,y,a,k,p,l,M,w;F=G*n[h+Y]-P*n[d+Y],N=P*n[h+Y]+G*n[d+Y],a=n[h+0]-N,y=n[h+0]+N,k=n[d+0]-F,pe=n[d+0]+F,F=G*n[h+f]-P*n[d+f],N=P*n[h+f]+G*n[d+f],M=n[h+I]-N,p=n[h+I]+N,w=n[d+I]-F,l=n[d+I]+F,F=j*p-V*w,N=V*p+j*w,n[h+I]=y-N,n[h+0]=y+N,n[d+f]=k-F,n[d+Y]=k+F,F=V*l-j*M,N=j*l+V*M,n[d+I]=pe-N,n[d+0]=pe+N,n[h+f]=a-F,n[h+Y]=a+F,d+=x,h+=x}while(h<C);P=V,V=P*s[v+0]-j*s[v+1],j=P*s[v+1]+j*s[v+0]}v+=2}while(x<c)}var o=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(n,r,c,v,x){for(var h=0;h<3;h++){var d=bt.BLKSIZE_s/2,C=65535&576/3*(h+1),j=bt.BLKSIZE_s/8-1;do{var V,X,Y,I,f,g=o[j<<2]&255;V=t[g]*v[c][x+g+C],f=t[127-g]*v[c][x+g+C+128],X=V-f,V=V+f,Y=t[g+64]*v[c][x+g+C+64],f=t[63-g]*v[c][x+g+C+192],I=Y-f,Y=Y+f,d-=4,r[h][d+0]=V+Y,r[h][d+2]=V-Y,r[h][d+1]=X+I,r[h][d+3]=X-I,V=t[g+1]*v[c][x+g+C+1],f=t[126-g]*v[c][x+g+C+129],X=V-f,V=V+f,Y=t[g+65]*v[c][x+g+C+65],f=t[62-g]*v[c][x+g+C+193],I=Y-f,Y=Y+f,r[h][d+bt.BLKSIZE_s/2+0]=V+Y,r[h][d+bt.BLKSIZE_s/2+2]=V-Y,r[h][d+bt.BLKSIZE_s/2+1]=X+I,r[h][d+bt.BLKSIZE_s/2+3]=X-I}while(--j>=0);i(r[h],d,bt.BLKSIZE_s/2)}},this.fft_long=function(n,r,c,v,x){var h=bt.BLKSIZE/8-1,d=bt.BLKSIZE/2;do{var C,j,V,X,Y,I=o[h]&255;C=e[I]*v[c][x+I],Y=e[I+512]*v[c][x+I+512],j=C-Y,C=C+Y,V=e[I+256]*v[c][x+I+256],Y=e[I+768]*v[c][x+I+768],X=V-Y,V=V+Y,d-=4,r[d+0]=C+V,r[d+2]=C-V,r[d+1]=j+X,r[d+3]=j-X,C=e[I+1]*v[c][x+I+1],Y=e[I+513]*v[c][x+I+513],j=C-Y,C=C+Y,V=e[I+257]*v[c][x+I+257],Y=e[I+769]*v[c][x+I+769],X=V-Y,V=V+Y,r[d+bt.BLKSIZE/2+0]=C+V,r[d+bt.BLKSIZE/2+2]=C-V,r[d+bt.BLKSIZE/2+1]=j+X,r[d+bt.BLKSIZE/2+3]=j-X}while(--h>=0);i(r,d,bt.BLKSIZE/2)},this.init_fft=function(n){for(var r=0;r<bt.BLKSIZE;r++)e[r]=.42-.5*Math.cos(2*Math.PI*(r+.5)/bt.BLKSIZE)+.08*Math.cos(4*Math.PI*(r+.5)/bt.BLKSIZE);for(var r=0;r<bt.BLKSIZE_s/2;r++)t[r]=.5*(1-Math.cos(2*Math.PI*(r+.5)/bt.BLKSIZE_s))}}var Wu=Uu,es=_t,gs=es.VbrMode,Oa=es.Float,bs=es.ShortBlock,Nt=es.Util,ju=es.Arrays,At=es.new_float,Gt=es.new_float_n,rs=es.new_int,ze=es.assert,Yu=Wu,ue=Rt();function Xu(){var e=Xs,t=new Yu,s=2.302585092994046,i=2,o=16,n=2,r=16,c=.34,v=1/(14752*14752)/(ue.BLKSIZE/2),x=.01,h=.8,d=.6,C=.3,j=3.5,V=21,X=.2302585093;function Y(E,S){for(var D=0,U=0;U<ue.BLKSIZE/2;++U)D+=E[U]*S.ATH.eql_w[U];return D*=v,D}function I(E,S,D,U,Q,L,Z,te,K,de,ie){var ce=E.internal_flags;if(K<2)t.fft_long(ce,U[Q],K,de,ie),t.fft_short(ce,L[Z],K,de,ie);else if(K==2){for(var Ee=ue.BLKSIZE-1;Ee>=0;--Ee){var Ge=U[Q+0][Ee],ge=U[Q+1][Ee];U[Q+0][Ee]=(Ge+ge)*Nt.SQRT2*.5,U[Q+1][Ee]=(Ge-ge)*Nt.SQRT2*.5}for(var Ve=2;Ve>=0;--Ve)for(var Ee=ue.BLKSIZE_s-1;Ee>=0;--Ee){var Ge=L[Z+0][Ve][Ee],ge=L[Z+1][Ve][Ee];L[Z+0][Ve][Ee]=(Ge+ge)*Nt.SQRT2*.5,L[Z+1][Ve][Ee]=(Ge-ge)*Nt.SQRT2*.5}}S[0]=U[Q+0][0],S[0]*=S[0];for(var Ee=ue.BLKSIZE/2-1;Ee>=0;--Ee){var re=U[Q+0][ue.BLKSIZE/2-Ee],Me=U[Q+0][ue.BLKSIZE/2+Ee];S[ue.BLKSIZE/2-Ee]=(re*re+Me*Me)*.5}for(var Ve=2;Ve>=0;--Ve){D[Ve][0]=L[Z+0][Ve][0],D[Ve][0]*=D[Ve][0];for(var Ee=ue.BLKSIZE_s/2-1;Ee>=0;--Ee){var re=L[Z+0][Ve][ue.BLKSIZE_s/2-Ee],Me=L[Z+0][Ve][ue.BLKSIZE_s/2+Ee];D[Ve][ue.BLKSIZE_s/2-Ee]=(re*re+Me*Me)*.5}}{for(var qe=0,Ee=11;Ee<ue.HBLKSIZE;Ee++)qe+=S[Ee];ce.tot_ener[K]=qe}if(E.analysis){for(var Ee=0;Ee<ue.HBLKSIZE;Ee++)ce.pinfo.energy[te][K][Ee]=ce.pinfo.energy_save[K][Ee],ce.pinfo.energy_save[K][Ee]=S[Ee];ce.pinfo.pe[te][K]=ce.pe[K]}E.athaa_loudapprox==2&&K<2&&(ce.loudness_sq[te][K]=ce.loudness_sq_save[K],ce.loudness_sq_save[K]=Y(S,ce))}var f=8,g=23,y=15,a,p,M,P=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function G(){a=Math.pow(10,(f+1)/16),p=Math.pow(10,(g+1)/16),M=Math.pow(10,y/10)}var N=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],F=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],pe=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function k(E,S,D,U,Q,L){var Z;if(S>E)if(S<E*p)Z=S/E;else return E+S;else{if(E>=S*p)return E+S;Z=E/S}if(E+=S,U+3<=6){if(Z>=a)return E;var te=0|Nt.FAST_LOG10_X(Z,16);return E*F[te]}var te=0|Nt.FAST_LOG10_X(Z,16);if(S=Q.ATH.cb_l[D]*Q.ATH.adjust,E<M*S){if(E>S){var K,de;return K=1,te<=13&&(K=pe[te]),de=Nt.FAST_LOG10_X(E/S,10/15),E*((N[te]-K)*de+K)}return te>13?E:E*pe[te]}return E*N[te]}var l=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function w(E,S,D){var U;if(E<0&&(E=0),S<0&&(S=0),E<=0)return S;if(S<=0)return E;if(S>E?U=S/E:U=E/S,-2<=D&&D<=2){if(U>=a)return E+S;var Q=0|Nt.FAST_LOG10_X(U,16);return(E+S)*l[Q]}return U<p?E+S:(E<S&&(E=S),E)}function $(E,S){var D=E.internal_flags;if(D.channels_out>1){for(var U=0;U<ue.SBMAX_l;U++){var Q=D.thm[0].l[U],L=D.thm[1].l[U];D.thm[0].l[U]+=L*S,D.thm[1].l[U]+=Q*S}for(var U=0;U<ue.SBMAX_s;U++)for(var Z=0;Z<3;Z++){var Q=D.thm[0].s[U][Z],L=D.thm[1].s[U][Z];D.thm[0].s[U][Z]+=L*S,D.thm[1].s[U][Z]+=Q*S}}}function z(E){for(var S=0;S<ue.SBMAX_l;S++)if(!(E.thm[0].l[S]>1.58*E.thm[1].l[S]||E.thm[1].l[S]>1.58*E.thm[0].l[S])){var D=E.mld_l[S]*E.en[3].l[S],U=Math.max(E.thm[2].l[S],Math.min(E.thm[3].l[S],D));D=E.mld_l[S]*E.en[2].l[S];var Q=Math.max(E.thm[3].l[S],Math.min(E.thm[2].l[S],D));E.thm[2].l[S]=U,E.thm[3].l[S]=Q}for(var S=0;S<ue.SBMAX_s;S++)for(var L=0;L<3;L++)if(!(E.thm[0].s[S][L]>1.58*E.thm[1].s[S][L]||E.thm[1].s[S][L]>1.58*E.thm[0].s[S][L])){var D=E.mld_s[S]*E.en[3].s[S][L],U=Math.max(E.thm[2].s[S][L],Math.min(E.thm[3].s[S][L],D));D=E.mld_s[S]*E.en[2].s[S][L];var Q=Math.max(E.thm[3].s[S][L],Math.min(E.thm[2].s[S][L],D));E.thm[2].s[S][L]=U,E.thm[3].s[S][L]=Q}}function W(E,S,D){var U=S,Q=Math.pow(10,D);S*=2,U*=2;for(var L=0;L<ue.SBMAX_l;L++){var Z,te,K,de;if(de=E.ATH.cb_l[E.bm_l[L]]*Q,Z=Math.min(Math.max(E.thm[0].l[L],de),Math.max(E.thm[1].l[L],de)),te=Math.max(E.thm[2].l[L],de),K=Math.max(E.thm[3].l[L],de),Z*S<te+K){var ie=Z*U/(te+K);te*=ie,K*=ie}E.thm[2].l[L]=Math.min(te,E.thm[2].l[L]),E.thm[3].l[L]=Math.min(K,E.thm[3].l[L])}Q*=ue.BLKSIZE_s/ue.BLKSIZE;for(var L=0;L<ue.SBMAX_s;L++)for(var ce=0;ce<3;ce++){var Z,te,K,de;if(de=E.ATH.cb_s[E.bm_s[L]]*Q,Z=Math.min(Math.max(E.thm[0].s[L][ce],de),Math.max(E.thm[1].s[L][ce],de)),te=Math.max(E.thm[2].s[L][ce],de),K=Math.max(E.thm[3].s[L][ce],de),Z*S<te+K){var ie=Z*S/(te+K);te*=ie,K*=ie}E.thm[2].s[L][ce]=Math.min(E.thm[2].s[L][ce],te),E.thm[3].s[L][ce]=Math.min(E.thm[3].s[L][ce],K)}}function ne(E,S,D,U,Q){var L,Z,te=0,K=0;for(L=Z=0;L<ue.SBMAX_s;++Z,++L){for(var de=E.bo_s[L],ie=E.npart_s,ce=de<ie?de:ie;Z<ce;)ze(S[Z]>=0),ze(D[Z]>=0),te+=S[Z],K+=D[Z],Z++;if(E.en[U].s[L][Q]=te,E.thm[U].s[L][Q]=K,Z>=ie){++L;break}ze(S[Z]>=0),ze(D[Z]>=0);{var Ee=E.PSY.bo_s_weight[L],Ge=1-Ee;te=Ee*S[Z],K=Ee*D[Z],E.en[U].s[L][Q]+=te,E.thm[U].s[L][Q]+=K,te=Ge*S[Z],K=Ge*D[Z]}}for(;L<ue.SBMAX_s;++L)E.en[U].s[L][Q]=0,E.thm[U].s[L][Q]=0}function B(E,S,D,U){var Q,L,Z=0,te=0;for(Q=L=0;Q<ue.SBMAX_l;++L,++Q){for(var K=E.bo_l[Q],de=E.npart_l,ie=K<de?K:de;L<ie;)ze(S[L]>=0),ze(D[L]>=0),Z+=S[L],te+=D[L],L++;if(E.en[U].l[Q]=Z,E.thm[U].l[Q]=te,L>=de){++Q;break}ze(S[L]>=0),ze(D[L]>=0);{var ce=E.PSY.bo_l_weight[Q],Ee=1-ce;Z=ce*S[L],te=ce*D[L],E.en[U].l[Q]+=Z,E.thm[U].l[Q]+=te,Z=Ee*S[L],te=Ee*D[L]}}for(;Q<ue.SBMAX_l;++Q)E.en[U].l[Q]=0,E.thm[U].l[Q]=0}function b(E,S,D,U,Q,L){var Z=E.internal_flags,te,K;for(K=te=0;K<Z.npart_s;++K){for(var de=0,ie=Z.numlines_s[K],ce=0;ce<ie;++ce,++te){var Ee=S[L][te];de+=Ee}D[K]=de}for(ze(K==Z.npart_s),te=K=0;K<Z.npart_s;K++){var Ge=Z.s3ind_s[K][0],ge=Z.s3_ss[te++]*D[Ge];for(++Ge;Ge<=Z.s3ind_s[K][1];)ge+=Z.s3_ss[te]*D[Ge],++te,++Ge;{var Ve=n*Z.nb_s1[Q][K];U[K]=Math.min(ge,Ve)}if(Z.blocktype_old[Q&1]==ue.SHORT_TYPE){var Ve=r*Z.nb_s2[Q][K],re=U[K];U[K]=Math.min(Ve,re)}Z.nb_s2[Q][K]=Z.nb_s1[Q][K],Z.nb_s1[Q][K]=ge,ze(U[K]>=0)}for(;K<=ue.CBANDS;++K)D[K]=0,U[K]=0}function m(E,S,D,U){var Q=E.internal_flags;E.short_blocks==bs.short_block_coupled&&!(S[0]!=0&&S[1]!=0)&&(S[0]=S[1]=0);for(var L=0;L<Q.channels_out;L++)U[L]=ue.NORM_TYPE,E.short_blocks==bs.short_block_dispensed&&(S[L]=1),E.short_blocks==bs.short_block_forced&&(S[L]=0),S[L]!=0?(ze(Q.blocktype_old[L]!=ue.START_TYPE),Q.blocktype_old[L]==ue.SHORT_TYPE&&(U[L]=ue.STOP_TYPE)):(U[L]=ue.SHORT_TYPE,Q.blocktype_old[L]==ue.NORM_TYPE&&(Q.blocktype_old[L]=ue.START_TYPE),Q.blocktype_old[L]==ue.STOP_TYPE&&(Q.blocktype_old[L]=ue.SHORT_TYPE)),D[L]=Q.blocktype_old[L],Q.blocktype_old[L]=U[L]}function u(E,S,D){return D>=1?E:D<=0?S:S>0?Math.pow(E/S,D)*S:0}var A=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function R(E,S){for(var D=309.07,U=0;U<ue.SBMAX_s-1;U++)for(var Q=0;Q<3;Q++){var L=E.thm.s[U][Q];if(L>0){var Z=L*S,te=E.en.s[U][Q];te>Z&&(te>Z*1e10?D+=A[U]*(10*s):D+=A[U]*Nt.FAST_LOG10(te/Z))}}return D}var J=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function le(E,S){for(var D=281.0575,U=0;U<ue.SBMAX_l-1;U++){var Q=E.thm.l[U];if(Q>0){var L=Q*S,Z=E.en.l[U];Z>L&&(Z>L*1e10?D+=J[U]*(10*s):D+=J[U]*Nt.FAST_LOG10(Z/L))}}return D}function H(E,S,D,U,Q){var L,Z;for(L=Z=0;L<E.npart_l;++L){var te=0,K=0,de;for(de=0;de<E.numlines_l[L];++de,++Z){var ie=S[Z];te+=ie,K<ie&&(K=ie)}D[L]=te,U[L]=K,Q[L]=te*E.rnumlines_l[L],ze(E.rnumlines_l[L]>=0),ze(D[L]>=0),ze(U[L]>=0),ze(Q[L]>=0)}}function ee(E,S,D,U){var Q=P.length-1,L=0,Z=D[L]+D[L+1];if(Z>0){var te=S[L];te<S[L+1]&&(te=S[L+1]),ze(E.numlines_l[L]+E.numlines_l[L+1]-1>0),Z=20*(te*2-Z)/(Z*(E.numlines_l[L]+E.numlines_l[L+1]-1));var K=0|Z;K>Q&&(K=Q),U[L]=K}else U[L]=0;for(L=1;L<E.npart_l-1;L++)if(Z=D[L-1]+D[L]+D[L+1],Z>0){var te=S[L-1];te<S[L]&&(te=S[L]),te<S[L+1]&&(te=S[L+1]),ze(E.numlines_l[L-1]+E.numlines_l[L]+E.numlines_l[L+1]-1>0),Z=20*(te*3-Z)/(Z*(E.numlines_l[L-1]+E.numlines_l[L]+E.numlines_l[L+1]-1));var K=0|Z;K>Q&&(K=Q),U[L]=K}else U[L]=0;if(ze(L==E.npart_l-1),Z=D[L-1]+D[L],Z>0){var te=S[L-1];te<S[L]&&(te=S[L]),ze(E.numlines_l[L-1]+E.numlines_l[L]-1>0),Z=20*(te*2-Z)/(Z*(E.numlines_l[L-1]+E.numlines_l[L]-1));var K=0|Z;K>Q&&(K=Q),U[L]=K}else U[L]=0;ze(L==E.npart_l-1)}var me=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(E,S,D,U,Q,L,Z,te,K,de){var ie=E.internal_flags,ce=Gt([2,ue.BLKSIZE]),Ee=Gt([2,3,ue.BLKSIZE_s]),Ge=At(ue.CBANDS+1),ge=At(ue.CBANDS+1),Ve=At(ue.CBANDS+2),re=rs(2),Me=rs(2),qe,be,xe,ve,$e,lt,ye,Xe,Qe=Gt([2,576]),ct,xt=rs(ue.CBANDS+2),gt=rs(ue.CBANDS+2);for(ju.fill(gt,0),qe=ie.channels_out,E.mode==e.JOINT_STEREO&&(qe=4),E.VBR==gs.vbr_off?ct=ie.ResvMax==0?0:ie.ResvSize/ie.ResvMax*.5:E.VBR==gs.vbr_rh||E.VBR==gs.vbr_mtrh||E.VBR==gs.vbr_mt?ct=.6:ct=1,be=0;be<ie.channels_out;be++){var dt=S[be],Ct=D+576-350-V+192;for(ve=0;ve<576;ve++){var Lt,Pt;for(Lt=dt[Ct+ve+10],Pt=0,$e=0;$e<(V-1)/2-1;$e+=2)Lt+=me[$e]*(dt[Ct+ve+$e]+dt[Ct+ve+V-$e]),Pt+=me[$e+1]*(dt[Ct+ve+$e+1]+dt[Ct+ve+V-$e-1]);Qe[be][ve]=Lt+Pt}Q[U][be].en.assign(ie.en[be]),Q[U][be].thm.assign(ie.thm[be]),qe>2&&(L[U][be].en.assign(ie.en[be+2]),L[U][be].thm.assign(ie.thm[be+2]))}for(be=0;be<qe;be++){var Ut,Wt,It=At(12),zt=[0,0,0,0],ms=At(12),hn=1,oa,ra=At(ue.CBANDS),la=At(ue.CBANDS),ut=[0,0,0,0],ca=At(ue.HBLKSIZE),da=Gt([3,ue.HBLKSIZE_s]);for(ze(ie.npart_s<=ue.CBANDS),ze(ie.npart_l<=ue.CBANDS),ve=0;ve<3;ve++)It[ve]=ie.nsPsy.last_en_subshort[be][ve+6],ze(ie.nsPsy.last_en_subshort[be][ve+4]>0),ms[ve]=It[ve]/ie.nsPsy.last_en_subshort[be][ve+4],zt[0]+=It[ve];if(be==2)for(ve=0;ve<576;ve++){var _n,mn;_n=Qe[0][ve],mn=Qe[1][ve],Qe[0][ve]=_n+mn,Qe[1][ve]=_n-mn}{var ua=Qe[be&1],Os=0;for(ve=0;ve<9;ve++){for(var Ki=Os+64,Tt=1;Os<Ki;Os++)Tt<Math.abs(ua[Os])&&(Tt=Math.abs(ua[Os]));ie.nsPsy.last_en_subshort[be][ve]=It[ve+3]=Tt,zt[1+ve/3]+=Tt,Tt>It[ve+3-2]?(ze(It[ve+3-2]>0),Tt=Tt/It[ve+3-2]):It[ve+3-2]>Tt*10?Tt=It[ve+3-2]/(Tt*10):Tt=0,ms[ve+3]=Tt}}if(E.analysis){var pn=ms[0];for(ve=1;ve<12;ve++)pn<ms[ve]&&(pn=ms[ve]);ie.pinfo.ers[U][be]=ie.pinfo.ers_save[be],ie.pinfo.ers_save[be]=pn}for(oa=be==3?ie.nsPsy.attackthre_s:ie.nsPsy.attackthre,ve=0;ve<12;ve++)ut[ve/3]==0&&ms[ve]>oa&&(ut[ve/3]=ve%3+1);for(ve=1;ve<4;ve++){var fn;zt[ve-1]>zt[ve]?(ze(zt[ve]>0),fn=zt[ve-1]/zt[ve]):(ze(zt[ve-1]>0),fn=zt[ve]/zt[ve-1]),fn<1.7&&(ut[ve]=0,ve==1&&(ut[0]=0))}for(ut[0]!=0&&ie.nsPsy.lastAttacks[be]!=0&&(ut[0]=0),(ie.nsPsy.lastAttacks[be]==3||ut[0]+ut[1]+ut[2]+ut[3]!=0)&&(hn=0,ut[1]!=0&&ut[0]!=0&&(ut[1]=0),ut[2]!=0&&ut[1]!=0&&(ut[2]=0),ut[3]!=0&&ut[2]!=0&&(ut[3]=0)),be<2?Me[be]=hn:hn==0&&(Me[0]=Me[1]=0),K[be]=ie.tot_ener[be],Wt=Ee,Ut=ce,I(E,ca,da,Ut,be&1,Wt,be&1,U,be,S,D),H(ie,ca,Ge,ra,la),ee(ie,ra,la,xt),Xe=0;Xe<3;Xe++){var gn,Mt;for(b(E,da,ge,Ve,be,Xe),ne(ie,ge,Ve,be,Xe),ye=0;ye<ue.SBMAX_s;ye++){if(Mt=ie.thm[be].s[ye][Xe],Mt*=h,ut[Xe]>=2||ut[Xe+1]==1){var ks=Xe!=0?Xe-1:2,Tt=u(ie.thm[be].s[ye][ks],Mt,d*ct);Mt=Math.min(Mt,Tt)}if(ut[Xe]==1){var ks=Xe!=0?Xe-1:2,Tt=u(ie.thm[be].s[ye][ks],Mt,C*ct);Mt=Math.min(Mt,Tt)}else if(Xe!=0&&ut[Xe-1]==3||Xe==0&&ie.nsPsy.lastAttacks[be]==3){var ks=Xe!=2?Xe+1:0,Tt=u(ie.thm[be].s[ye][ks],Mt,C*ct);Mt=Math.min(Mt,Tt)}gn=It[Xe*3+3]+It[Xe*3+4]+It[Xe*3+5],It[Xe*3+5]*6<gn&&(Mt*=.5,It[Xe*3+4]*6<gn&&(Mt*=.5)),ie.thm[be].s[ye][Xe]=Mt}}for(ie.nsPsy.lastAttacks[be]=ut[2],lt=0,xe=0;xe<ie.npart_l;xe++){for(var as=ie.s3ind[xe][0],bn=Ge[as]*P[xt[as]],is=ie.s3_ll[lt++]*bn;++as<=ie.s3ind[xe][1];)bn=Ge[as]*P[xt[as]],is=k(is,ie.s3_ll[lt++]*bn,as,as-xe,ie);is*=.158489319246111,ie.blocktype_old[be&1]==ue.SHORT_TYPE?Ve[xe]=is:Ve[xe]=u(Math.min(is,Math.min(i*ie.nb_1[be][xe],o*ie.nb_2[be][xe])),is,ct),ie.nb_2[be][xe]=ie.nb_1[be][xe],ie.nb_1[be][xe]=is}for(;xe<=ue.CBANDS;++xe)Ge[xe]=0,Ve[xe]=0;B(ie,Ge,Ve,be)}if((E.mode==e.STEREO||E.mode==e.JOINT_STEREO)&&E.interChRatio>0&&$(E,E.interChRatio),E.mode==e.JOINT_STEREO){var vn;z(ie),vn=E.msfix,Math.abs(vn)>0&&W(ie,vn,E.ATHlower*ie.ATH.adjust)}for(m(E,Me,de,re),be=0;be<qe;be++){var xs,Ls=0,zs,qs;be>1?(xs=te,Ls=-2,zs=ue.NORM_TYPE,(de[0]==ue.SHORT_TYPE||de[1]==ue.SHORT_TYPE)&&(zs=ue.SHORT_TYPE),qs=L[U][be-2]):(xs=Z,Ls=0,zs=de[be],qs=Q[U][be]),zs==ue.SHORT_TYPE?xs[Ls+be]=R(qs,ie.masking_lower):xs[Ls+be]=le(qs,ie.masking_lower),E.analysis&&(ie.pinfo.pe[U][be]=xs[Ls+be])}return 0};function Te(E,S,D,U,Q,L,Z,te){var K=E.internal_flags;if(U<2)t.fft_long(K,Z[te],U,S,D);else if(U==2)for(var de=ue.BLKSIZE-1;de>=0;--de){var ie=Z[te+0][de],ce=Z[te+1][de];Z[te+0][de]=(ie+ce)*Nt.SQRT2*.5,Z[te+1][de]=(ie-ce)*Nt.SQRT2*.5}L[0]=Z[te+0][0],L[0]*=L[0];for(var de=ue.BLKSIZE/2-1;de>=0;--de){var Ee=Z[te+0][ue.BLKSIZE/2-de],Ge=Z[te+0][ue.BLKSIZE/2+de];L[ue.BLKSIZE/2-de]=(Ee*Ee+Ge*Ge)*.5}{for(var ge=0,de=11;de<ue.HBLKSIZE;de++)ge+=L[de];K.tot_ener[U]=ge}if(E.analysis){for(var de=0;de<ue.HBLKSIZE;de++)K.pinfo.energy[Q][U][de]=K.pinfo.energy_save[U][de],K.pinfo.energy_save[U][de]=L[de];K.pinfo.pe[Q][U]=K.pe[U]}}function we(E,S,D,U,Q,L,Z,te){var K=E.internal_flags;if(Q==0&&U<2&&t.fft_short(K,Z[te],U,S,D),U==2)for(var de=ue.BLKSIZE_s-1;de>=0;--de){var ie=Z[te+0][Q][de],ce=Z[te+1][Q][de];Z[te+0][Q][de]=(ie+ce)*Nt.SQRT2*.5,Z[te+1][Q][de]=(ie-ce)*Nt.SQRT2*.5}L[Q][0]=Z[te+0][Q][0],L[Q][0]*=L[Q][0];for(var de=ue.BLKSIZE_s/2-1;de>=0;--de){var Ee=Z[te+0][Q][ue.BLKSIZE_s/2-de],Ge=Z[te+0][Q][ue.BLKSIZE_s/2+de];L[Q][ue.BLKSIZE_s/2-de]=(Ee*Ee+Ge*Ge)*.5}}function Ne(E,S,D,U){var Q=E.internal_flags;E.athaa_loudapprox==2&&D<2&&(Q.loudness_sq[S][D]=Q.loudness_sq_save[D],Q.loudness_sq_save[D]=Y(U,Q))}var Re=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Ce(E,S,D,U,Q,L,Z,te,K,de){for(var ie=Gt([2,576]),ce=E.internal_flags,Ee=ce.channels_out,Ge=E.mode==e.JOINT_STEREO?4:Ee,ge=0;ge<Ee;ge++){firbuf=S[ge];for(var Ve=D+576-350-V+192,re=0;re<576;re++){var Me,qe;Me=firbuf[Ve+re+10],qe=0;for(var be=0;be<(V-1)/2-1;be+=2)Me+=Re[be]*(firbuf[Ve+re+be]+firbuf[Ve+re+V-be]),qe+=Re[be+1]*(firbuf[Ve+re+be+1]+firbuf[Ve+re+V-be-1]);ie[ge][re]=Me+qe}Q[U][ge].en.assign(ce.en[ge]),Q[U][ge].thm.assign(ce.thm[ge]),Ge>2&&(L[U][ge].en.assign(ce.en[ge+2]),L[U][ge].thm.assign(ce.thm[ge+2]))}for(var ge=0;ge<Ge;ge++){var xe=At(12),ve=At(12),$e=[0,0,0,0],lt=ie[ge&1],ye=0,Xe=ge==3?ce.nsPsy.attackthre_s:ce.nsPsy.attackthre,Qe=1;if(ge==2)for(var re=0,be=576;be>0;++re,--be){var ct=ie[0][re],xt=ie[1][re];ie[0][re]=ct+xt,ie[1][re]=ct-xt}for(var re=0;re<3;re++)ve[re]=ce.nsPsy.last_en_subshort[ge][re+6],ze(ce.nsPsy.last_en_subshort[ge][re+4]>0),xe[re]=ve[re]/ce.nsPsy.last_en_subshort[ge][re+4],$e[0]+=ve[re];for(var re=0;re<9;re++){for(var gt=ye+64,dt=1;ye<gt;ye++)dt<Math.abs(lt[ye])&&(dt=Math.abs(lt[ye]));ce.nsPsy.last_en_subshort[ge][re]=ve[re+3]=dt,$e[1+re/3]+=dt,dt>ve[re+3-2]?(ze(ve[re+3-2]>0),dt=dt/ve[re+3-2]):ve[re+3-2]>dt*10?dt=ve[re+3-2]/(dt*10):dt=0,xe[re+3]=dt}for(var re=0;re<3;++re){var Ct=ve[re*3+3]+ve[re*3+4]+ve[re*3+5],Lt=1;ve[re*3+5]*6<Ct&&(Lt*=.5,ve[re*3+4]*6<Ct&&(Lt*=.5)),te[ge][re]=Lt}if(E.analysis){for(var Pt=xe[0],re=1;re<12;re++)Pt<xe[re]&&(Pt=xe[re]);ce.pinfo.ers[U][ge]=ce.pinfo.ers_save[ge],ce.pinfo.ers_save[ge]=Pt}for(var re=0;re<12;re++)K[ge][re/3]==0&&xe[re]>Xe&&(K[ge][re/3]=re%3+1);for(var re=1;re<4;re++){var Ut=$e[re-1],Wt=$e[re],It=Math.max(Ut,Wt);It<4e4&&Ut<1.7*Wt&&Wt<1.7*Ut&&(re==1&&K[ge][0]<=K[ge][re]&&(K[ge][0]=0),K[ge][re]=0)}K[ge][0]<=ce.nsPsy.lastAttacks[ge]&&(K[ge][0]=0),(ce.nsPsy.lastAttacks[ge]==3||K[ge][0]+K[ge][1]+K[ge][2]+K[ge][3]!=0)&&(Qe=0,K[ge][1]!=0&&K[ge][0]!=0&&(K[ge][1]=0),K[ge][2]!=0&&K[ge][1]!=0&&(K[ge][2]=0),K[ge][3]!=0&&K[ge][2]!=0&&(K[ge][3]=0)),ge<2?de[ge]=Qe:Qe==0&&(de[0]=de[1]=0),Z[ge]=ce.tot_ener[ge]}}function Pe(E,S,D){if(D==0)for(var U=0;U<E.npart_s;U++)E.nb_s2[S][U]=E.nb_s1[S][U],E.nb_s1[S][U]=0}function it(E,S){for(var D=0;D<E.npart_l;D++)E.nb_2[S][D]=E.nb_1[S][D],E.nb_1[S][D]=0}function Vt(E,S,D,U){var Q=P.length-1,L=0,Z=D[L]+D[L+1];if(Z>0){var te=S[L];te<S[L+1]&&(te=S[L+1]),ze(E.numlines_s[L]+E.numlines_s[L+1]-1>0),Z=20*(te*2-Z)/(Z*(E.numlines_s[L]+E.numlines_s[L+1]-1));var K=0|Z;K>Q&&(K=Q),U[L]=K}else U[L]=0;for(L=1;L<E.npart_s-1;L++)if(Z=D[L-1]+D[L]+D[L+1],ze(L+1<E.npart_s),Z>0){var te=S[L-1];te<S[L]&&(te=S[L]),te<S[L+1]&&(te=S[L+1]),ze(E.numlines_s[L-1]+E.numlines_s[L]+E.numlines_s[L+1]-1>0),Z=20*(te*3-Z)/(Z*(E.numlines_s[L-1]+E.numlines_s[L]+E.numlines_s[L+1]-1));var K=0|Z;K>Q&&(K=Q),U[L]=K}else U[L]=0;if(ze(L==E.npart_s-1),Z=D[L-1]+D[L],Z>0){var te=S[L-1];te<S[L]&&(te=S[L]),ze(E.numlines_s[L-1]+E.numlines_s[L]-1>0),Z=20*(te*2-Z)/(Z*(E.numlines_s[L-1]+E.numlines_s[L]-1));var K=0|Z;K>Q&&(K=Q),U[L]=K}else U[L]=0;ze(L==E.npart_s-1)}function _(E,S,D,U,Q,L){var Z=E.internal_flags,te=new float[ue.CBANDS],K=At(ue.CBANDS),de,ie,ce,Ee=new int[ue.CBANDS];for(ce=ie=0;ce<Z.npart_s;++ce){var Ge=0,ge=0,Ve=Z.numlines_s[ce];for(de=0;de<Ve;++de,++ie){var re=S[L][ie];Ge+=re,ge<re&&(ge=re)}D[ce]=Ge,te[ce]=ge,K[ce]=Ge/Ve,ze(K[ce]>=0)}for(ze(ce==Z.npart_s);ce<ue.CBANDS;++ce)te[ce]=0,K[ce]=0;for(Vt(Z,te,K,Ee),ie=ce=0;ce<Z.npart_s;ce++){var Me=Z.s3ind_s[ce][0],qe=Z.s3ind_s[ce][1],be,xe,ve,$e,lt;for(be=Ee[Me],xe=1,$e=Z.s3_ss[ie]*D[Me]*P[Ee[Me]],++ie,++Me;Me<=qe;)be+=Ee[Me],xe+=1,ve=Z.s3_ss[ie]*D[Me]*P[Ee[Me]],$e=w($e,ve,Me-ce),++ie,++Me;be=(1+2*be)/(2*xe),lt=P[be]*.5,$e*=lt,U[ce]=$e,Z.nb_s2[Q][ce]=Z.nb_s1[Q][ce],Z.nb_s1[Q][ce]=$e,ve=te[ce],ve*=Z.minval_s[ce],ve*=lt,U[ce]>ve&&(U[ce]=ve),Z.masking_lower>1&&(U[ce]*=Z.masking_lower),U[ce]>D[ce]&&(U[ce]=D[ce]),Z.masking_lower<1&&(U[ce]*=Z.masking_lower),ze(U[ce]>=0)}for(;ce<ue.CBANDS;++ce)D[ce]=0,U[ce]=0}function T(E,S,D,U,Q){var L=At(ue.CBANDS),Z=At(ue.CBANDS),te=rs(ue.CBANDS+2),K;H(E,S,D,L,Z),ee(E,L,Z,te);var de=0;for(K=0;K<E.npart_l;K++){var ie,ce,Ee,Ge,ge=E.s3ind[K][0],Ve=E.s3ind[K][1],re=0,Me=0;for(re=te[ge],Me+=1,ce=E.s3_ll[de]*D[ge]*P[te[ge]],++de,++ge;ge<=Ve;)re+=te[ge],Me+=1,ie=E.s3_ll[de]*D[ge]*P[te[ge]],Ge=w(ce,ie,ge-K),ce=Ge,++de,++ge;if(re=(1+2*re)/(2*Me),Ee=P[re]*.5,ce*=Ee,E.blocktype_old[Q&1]==ue.SHORT_TYPE){var qe=i*E.nb_1[Q][K];qe>0?U[K]=Math.min(ce,qe):U[K]=Math.min(ce,D[K]*C)}else{var be=o*E.nb_2[Q][K],xe=i*E.nb_1[Q][K],qe;be<=0&&(be=ce),xe<=0&&(xe=ce),E.blocktype_old[Q&1]==ue.NORM_TYPE?qe=Math.min(xe,be):qe=xe,U[K]=Math.min(ce,qe)}E.nb_2[Q][K]=E.nb_1[Q][K],E.nb_1[Q][K]=ce,ie=L[K],ie*=E.minval_l[K],ie*=Ee,U[K]>ie&&(U[K]=ie),E.masking_lower>1&&(U[K]*=E.masking_lower),U[K]>D[K]&&(U[K]=D[K]),E.masking_lower<1&&(U[K]*=E.masking_lower),ze(U[K]>=0)}for(;K<ue.CBANDS;++K)D[K]=0,U[K]=0}function Ie(E,S){var D=E.internal_flags;E.short_blocks==bs.short_block_coupled&&!(S[0]!=0&&S[1]!=0)&&(S[0]=S[1]=0);for(var U=0;U<D.channels_out;U++)E.short_blocks==bs.short_block_dispensed&&(S[U]=1),E.short_blocks==bs.short_block_forced&&(S[U]=0)}function ke(E,S,D){for(var U=E.internal_flags,Q=0;Q<U.channels_out;Q++){var L=ue.NORM_TYPE;S[Q]!=0?(ze(U.blocktype_old[Q]!=ue.START_TYPE),U.blocktype_old[Q]==ue.SHORT_TYPE&&(L=ue.STOP_TYPE)):(L=ue.SHORT_TYPE,U.blocktype_old[Q]==ue.NORM_TYPE&&(U.blocktype_old[Q]=ue.START_TYPE),U.blocktype_old[Q]==ue.STOP_TYPE&&(U.blocktype_old[Q]=ue.SHORT_TYPE)),D[Q]=U.blocktype_old[Q],U.blocktype_old[Q]=L}}function Ue(E,S,D,U,Q,L,Z){for(var te=L*2,K=L>0?Math.pow(10,Q):1,de,ie,ce=0;ce<Z;++ce){var Ee=E[2][ce],Ge=E[3][ce],ge=S[0][ce],Ve=S[1][ce],re=S[2][ce],Me=S[3][ce];if(ge<=1.58*Ve&&Ve<=1.58*ge){var qe=D[ce]*Ge,be=D[ce]*Ee;ie=Math.max(re,Math.min(Me,qe)),de=Math.max(Me,Math.min(re,be))}else ie=re,de=Me;if(L>0){var xe,ve,$e=U[ce]*K;if(xe=Math.min(Math.max(ge,$e),Math.max(Ve,$e)),re=Math.max(ie,$e),Me=Math.max(de,$e),ve=re+Me,ve>0&&xe*te<ve){var lt=xe*te/ve;re*=lt,Me*=lt}ie=Math.min(re,ie),de=Math.min(Me,de)}ie>Ee&&(ie=Ee),de>Ge&&(de=Ge),S[2][ce]=ie,S[3][ce]=de}}this.L3psycho_anal_vbr=function(E,S,D,U,Q,L,Z,te,K,de){var ie=E.internal_flags,ce,Ee,Ge=At(ue.HBLKSIZE),ge=Gt([3,ue.HBLKSIZE_s]),Ve=Gt([2,ue.BLKSIZE]),re=Gt([2,3,ue.BLKSIZE_s]),Me=Gt([4,ue.CBANDS]),qe=Gt([4,ue.CBANDS]),be=Gt([4,3]),xe=.6,ve=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],$e=rs(2),lt=E.mode==e.JOINT_STEREO?4:ie.channels_out;Ce(E,S,D,U,Q,L,K,be,ve,$e),Ie(E,$e);{for(var ye=0;ye<lt;ye++){var Xe=ye&1;ce=Ve,Te(E,S,D,ye,U,Ge,ce,Xe),Ne(E,U,ye,Ge),$e[Xe]!=0?T(ie,Ge,Me[ye],qe[ye],ye):it(ie,ye)}$e[0]+$e[1]==2&&E.mode==e.JOINT_STEREO&&Ue(Me,qe,ie.mld_cb_l,ie.ATH.cb_l,E.ATHlower*ie.ATH.adjust,E.msfix,ie.npart_l);for(var ye=0;ye<lt;ye++){var Xe=ye&1;$e[Xe]!=0&&B(ie,Me[ye],qe[ye],ye)}}{for(var Qe=0;Qe<3;Qe++){for(var ye=0;ye<lt;++ye){var Xe=ye&1;$e[Xe]!=0?Pe(ie,ye,Qe):(Ee=re,we(E,S,D,ye,Qe,ge,Ee,Xe),_(E,ge,Me[ye],qe[ye],ye,Qe))}$e[0]+$e[1]==0&&E.mode==e.JOINT_STEREO&&Ue(Me,qe,ie.mld_cb_s,ie.ATH.cb_s,E.ATHlower*ie.ATH.adjust,E.msfix,ie.npart_s);for(var ye=0;ye<lt;++ye){var Xe=ye&1;$e[Xe]==0&&ne(ie,Me[ye],qe[ye],ye,Qe)}}for(var ye=0;ye<lt;ye++){var Xe=ye&1;if($e[Xe]==0)for(var ct=0;ct<ue.SBMAX_s;ct++){for(var xt=At(3),Qe=0;Qe<3;Qe++){var gt=ie.thm[ye].s[ct][Qe];if(gt*=h,ve[ye][Qe]>=2||ve[ye][Qe+1]==1){var dt=Qe!=0?Qe-1:2,Ct=u(ie.thm[ye].s[ct][dt],gt,d*xe);gt=Math.min(gt,Ct)}else if(ve[ye][Qe]==1){var dt=Qe!=0?Qe-1:2,Ct=u(ie.thm[ye].s[ct][dt],gt,C*xe);gt=Math.min(gt,Ct)}else if(Qe!=0&&ve[ye][Qe-1]==3||Qe==0&&ie.nsPsy.lastAttacks[ye]==3){var dt=Qe!=2?Qe+1:0,Ct=u(ie.thm[ye].s[ct][dt],gt,C*xe);gt=Math.min(gt,Ct)}gt*=be[ye][Qe],xt[Qe]=gt}for(var Qe=0;Qe<3;Qe++)ie.thm[ye].s[ct][Qe]=xt[Qe]}}}for(var ye=0;ye<lt;ye++)ie.nsPsy.lastAttacks[ye]=ve[ye][2];ke(E,$e,de);for(var ye=0;ye<lt;ye++){var Lt,Pt,Ut,Wt;ye>1?(Lt=te,Pt=-2,Ut=ue.NORM_TYPE,(de[0]==ue.SHORT_TYPE||de[1]==ue.SHORT_TYPE)&&(Ut=ue.SHORT_TYPE),Wt=L[U][ye-2]):(Lt=Z,Pt=0,Ut=de[ye],Wt=Q[U][ye]),Ut==ue.SHORT_TYPE?Lt[Pt+ye]=R(Wt,ie.masking_lower):Lt[Pt+ye]=le(Wt,ie.masking_lower),E.analysis&&(ie.pinfo.pe[U][ye]=Lt[Pt+ye])}return 0};function De(E,S){var D=E,U;return D>=0?U=-D*27:U=D*S,U<=-72?0:Math.exp(U*X)}function Be(E){var S=0,D=0;{var U=0,Q,L;for(U=0;De(U,E)>1e-20;U-=1);for(Q=U,L=0;Math.abs(L-Q)>1e-12;)U=(L+Q)/2,De(U,E)>0?L=U:Q=U;S=Q}{var U=0,Q,L;for(U=0;De(U,E)>1e-20;U+=1);for(Q=0,L=U;Math.abs(L-Q)>1e-12;)U=(L+Q)/2,De(U,E)>0?Q=U:L=U;D=L}{var Z=0,te=1e3,K;for(K=0;K<=te;++K){var U=S+K*(D-S)/te,de=De(U,E);Z+=de}{var ie=(te+1)/(Z*(D-S));return ie}}}function Le(E){var S,D,U,Q;return S=E,S>=0?S*=3:S*=1.5,S>=.5&&S<=2.5?(Q=S-.5,D=8*(Q*Q-2*Q)):D=0,S+=.474,U=15.811389+7.5*S-17.5*Math.sqrt(1+S*S),U<=-60?0:(S=Math.exp((D+U)*X),S/=.6609193,S)}function Ye(E){return E<0&&(E=0),E=E*.001,13*Math.atan(.76*E)+3.5*Math.atan(E*E/(7.5*7.5))}function Fe(E,S,D,U,Q,L,Z,te,K,de,ie,ce){var Ee=At(ue.CBANDS+1),Ge=te/(ce>15?2*576:2*192),ge=rs(ue.HBLKSIZE),Ve;te/=K;var re=0,Me=0;for(Ve=0;Ve<ue.CBANDS;Ve++){var qe,be;for(qe=Ye(te*re),Ee[Ve]=te*re,be=re;Ye(te*be)-qe<c&&be<=K/2;be++);for(E[Ve]=be-re,Me=Ve+1;re<be;)ze(re<ue.HBLKSIZE),ge[re++]=Ve;if(re>K/2){re=K/2,++Ve;break}}ze(Ve<ue.CBANDS),Ee[Ve]=te*re;for(var xe=0;xe<ce;xe++){var ve,$e,lt,ye,Xe;lt=de[xe],ye=de[xe+1],ve=0|Math.floor(.5+ie*(lt-.5)),ve<0&&(ve=0),$e=0|Math.floor(.5+ie*(ye-.5)),$e>K/2&&($e=K/2),D[xe]=(ge[ve]+ge[$e])/2,S[xe]=ge[$e];var Qe=Ge*ye;Z[xe]=(Qe-Ee[S[xe]])/(Ee[S[xe]+1]-Ee[S[xe]]),Z[xe]<0?Z[xe]=0:Z[xe]>1&&(Z[xe]=1),Xe=Ye(te*de[xe]*ie),Xe=Math.min(Xe,15.5)/15.5,L[xe]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Xe))-2.5)}re=0;for(var ct=0;ct<Me;ct++){var xt=E[ct],qe,gt;qe=Ye(te*re),gt=Ye(te*(re+xt-1)),U[ct]=.5*(qe+gt),qe=Ye(te*(re-.5)),gt=Ye(te*(re+xt-.5)),Q[ct]=gt-qe,re+=xt}return Me}function Se(E,S,D,U,Q,L){var Z=Gt([ue.CBANDS,ue.CBANDS]),te,K=0;if(L)for(var de=0;de<S;de++)for(te=0;te<S;te++){var ie=Le(D[de]-D[te])*U[te];Z[de][te]=ie*Q[de]}else for(te=0;te<S;te++)for(var ce=15+Math.min(21/D[te],12),Ee=Be(ce),de=0;de<S;de++){var ie=Ee*De(D[de]-D[te],ce)*U[te];Z[de][te]=ie*Q[de]}for(var de=0;de<S;de++){for(te=0;te<S&&!(Z[de][te]>0);te++);for(E[de][0]=te,te=S-1;te>0&&!(Z[de][te]>0);te--);E[de][1]=te,K+=E[de][1]-E[de][0]+1}for(var Ge=At(K),ge=0,de=0;de<S;de++)for(te=E[de][0];te<=E[de][1];te++)Ge[ge++]=Z[de][te];return Ge}function nt(E){var S=Ye(E);return S=Math.min(S,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*S))-2.5)}this.psymodel_init=function(E){var S=E.internal_flags,D,U=!0,Q=13,L=24,Z=0,te=0,K=-8.25,de=-4.5,ie=At(ue.CBANDS),ce=At(ue.CBANDS),Ee=At(ue.CBANDS),Ge=E.out_samplerate;switch(E.experimentalZ){default:case 0:U=!0;break;case 1:U=!(E.VBR==gs.vbr_mtrh||E.VBR==gs.vbr_mt);break;case 2:U=!1;break;case 3:Q=8,Z=-1.75,te=-.0125,K=-8.25,de=-2.25;break}for(S.ms_ener_ratio_old=.25,S.blocktype_old[0]=S.blocktype_old[1]=ue.NORM_TYPE,D=0;D<4;++D){for(var re=0;re<ue.CBANDS;++re)S.nb_1[D][re]=1e20,S.nb_2[D][re]=1e20,S.nb_s1[D][re]=S.nb_s2[D][re]=1;for(var ge=0;ge<ue.SBMAX_l;ge++)S.en[D].l[ge]=1e20,S.thm[D].l[ge]=1e20;for(var re=0;re<3;++re){for(var ge=0;ge<ue.SBMAX_s;ge++)S.en[D].s[ge][re]=1e20,S.thm[D].s[ge][re]=1e20;S.nsPsy.lastAttacks[D]=0}for(var re=0;re<9;re++)S.nsPsy.last_en_subshort[D][re]=10}for(S.loudness_sq_save[0]=S.loudness_sq_save[1]=0,S.npart_l=Fe(S.numlines_l,S.bo_l,S.bm_l,ie,ce,S.mld_l,S.PSY.bo_l_weight,Ge,ue.BLKSIZE,S.scalefac_band.l,ue.BLKSIZE/(2*576),ue.SBMAX_l),ze(S.npart_l<ue.CBANDS),D=0;D<S.npart_l;D++){var Ve=Z;ie[D]>=Q&&(Ve=te*(ie[D]-Q)/(L-Q)+Z*(L-ie[D])/(L-Q)),Ee[D]=Math.pow(10,Ve/10),S.numlines_l[D]>0?S.rnumlines_l[D]=1/S.numlines_l[D]:S.rnumlines_l[D]=0}S.s3_ll=Se(S.s3ind,S.npart_l,ie,ce,Ee,U);var re=0;for(D=0;D<S.npart_l;D++){var Me;Me=Oa.MAX_VALUE;for(var qe=0;qe<S.numlines_l[D];qe++,re++){var be=Ge*re/(1e3*ue.BLKSIZE),xe;xe=this.ATHformula(be*1e3,E)-20,xe=Math.pow(10,.1*xe),xe*=S.numlines_l[D],Me>xe&&(Me=xe)}S.ATH.cb_l[D]=Me,Me=-20+ie[D]*20/10,Me>6&&(Me=100),Me<-15&&(Me=-15),Me-=8,S.minval_l[D]=Math.pow(10,Me/10)*S.numlines_l[D]}for(S.npart_s=Fe(S.numlines_s,S.bo_s,S.bm_s,ie,ce,S.mld_s,S.PSY.bo_s_weight,Ge,ue.BLKSIZE_s,S.scalefac_band.s,ue.BLKSIZE_s/(2*192),ue.SBMAX_s),ze(S.npart_s<ue.CBANDS),re=0,D=0;D<S.npart_s;D++){var Me,Ve=K;ie[D]>=Q&&(Ve=de*(ie[D]-Q)/(L-Q)+K*(L-ie[D])/(L-Q)),Ee[D]=Math.pow(10,Ve/10),Me=Oa.MAX_VALUE;for(var qe=0;qe<S.numlines_s[D];qe++,re++){var be=Ge*re/(1e3*ue.BLKSIZE_s),xe;xe=this.ATHformula(be*1e3,E)-20,xe=Math.pow(10,.1*xe),xe*=S.numlines_s[D],Me>xe&&(Me=xe)}S.ATH.cb_s[D]=Me,Me=-7+ie[D]*7/12,ie[D]>12&&(Me*=1+Math.log(1+Me)*3.1),ie[D]<12&&(Me*=1+Math.log(1-Me)*2.3),Me<-15&&(Me=-15),Me-=8,S.minval_s[D]=Math.pow(10,Me/10)*S.numlines_s[D]}S.s3_ss=Se(S.s3ind_s,S.npart_s,ie,ce,Ee,U),G(),t.init_fft(S),S.decay=Math.exp(-1*s/(x*Ge/192));{var ve;ve=j,E.exp_nspsytune&2&&(ve=1),Math.abs(E.msfix)>0&&(ve=E.msfix),E.msfix=ve;for(var $e=0;$e<S.npart_l;$e++)S.s3ind[$e][1]>S.npart_l-1&&(S.s3ind[$e][1]=S.npart_l-1)}var lt=576*S.mode_gr/Ge;if(S.ATH.decay=Math.pow(10,-12/10*lt),S.ATH.adjust=.01,S.ATH.adjustLimit=1,ze(S.bo_l[ue.SBMAX_l-1]<=S.npart_l),ze(S.bo_s[ue.SBMAX_s-1]<=S.npart_s),E.ATHtype!=-1){var be,ye=E.out_samplerate/ue.BLKSIZE,Xe=0;for(be=0,D=0;D<ue.BLKSIZE/2;++D)be+=ye,S.ATH.eql_w[D]=1/Math.pow(10,this.ATHformula(be,E)/10),Xe+=S.ATH.eql_w[D];for(Xe=1/Xe,D=ue.BLKSIZE/2;--D>=0;)S.ATH.eql_w[D]*=Xe}{for(var $e=re=0;$e<S.npart_s;++$e)for(D=0;D<S.numlines_s[$e];++D)++re;for(var $e=re=0;$e<S.npart_l;++$e)for(D=0;D<S.numlines_l[$e];++D)++re}for(re=0,D=0;D<S.npart_l;D++){var be=Ge*(re+S.numlines_l[D]/2)/(1*ue.BLKSIZE);S.mld_cb_l[D]=nt(be),re+=S.numlines_l[D]}for(;D<ue.CBANDS;++D)S.mld_cb_l[D]=1;for(re=0,D=0;D<S.npart_s;D++){var be=Ge*(re+S.numlines_s[D]/2)/(1*ue.BLKSIZE_s);S.mld_cb_s[D]=nt(be),re+=S.numlines_s[D]}for(;D<ue.CBANDS;++D)S.mld_cb_s[D]=1;return 0};function mt(E,S){E<-.3&&(E=3410),E/=1e3,E=Math.max(.1,E);var D=3.64*Math.pow(E,-.8)-6.8*Math.exp(-.6*Math.pow(E-3.4,2))+6*Math.exp(-.15*Math.pow(E-8.7,2))+(.6+.04*S)*.001*Math.pow(E,4);return D}this.ATHformula=function(E,S){var D;switch(S.ATHtype){case 0:D=mt(E,9);break;case 1:D=mt(E,-1);break;case 2:D=mt(E,0);break;case 3:D=mt(E,1)+6;break;case 4:D=mt(E,S.ATHcurve);break;default:D=mt(E,0);break}return D}}var zu=Xu,qu=Xs;function Ku(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=qu.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var Qu=Ku,Zu=Rt(),Li={};Li.SFBMAX=Zu.SBMAX_s*3;var cn=Li,Pi=_t,Ju=Pi.new_float,ls=Pi.new_int,Nn=cn;function eh(){this.xr=Ju(576),this.l3_enc=ls(576),this.scalefac=ls(Nn.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=ls(3),this.subblock_gain=ls(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=ls(Nn.SFBMAX),this.window=ls(Nn.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=ls(4),this.max_nonzero_coeff=0;var e=this;function t(i){return new Int32Array(i)}function s(i){return new Float32Array(i)}this.assign=function(i){e.xr=s(i.xr),e.l3_enc=t(i.l3_enc),e.scalefac=t(i.scalefac),e.xrpow_max=i.xrpow_max,e.part2_3_length=i.part2_3_length,e.big_values=i.big_values,e.count1=i.count1,e.global_gain=i.global_gain,e.scalefac_compress=i.scalefac_compress,e.block_type=i.block_type,e.mixed_block_flag=i.mixed_block_flag,e.table_select=t(i.table_select),e.subblock_gain=t(i.subblock_gain),e.region0_count=i.region0_count,e.region1_count=i.region1_count,e.preflag=i.preflag,e.scalefac_scale=i.scalefac_scale,e.count1table_select=i.count1table_select,e.part2_length=i.part2_length,e.sfb_lmax=i.sfb_lmax,e.sfb_smin=i.sfb_smin,e.psy_lmax=i.psy_lmax,e.sfbmax=i.sfbmax,e.psymax=i.psymax,e.sfbdivide=i.sfbdivide,e.width=t(i.width),e.window=t(i.window),e.count1bits=i.count1bits,e.sfb_partition_table=i.sfb_partition_table.slice(0),e.slen=t(i.slen),e.max_nonzero_coeff=i.max_nonzero_coeff}}var ea=eh,th=_t,ka=th.new_int,sh=ea;function nh(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[ka(4),ka(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new sh}var ah=nh,Bi=_t,Zs=Bi.System,Js=Bi.new_int,en=Rt();function ih(e,t,s,i){this.l=Js(1+en.SBMAX_l),this.s=Js(1+en.SBMAX_s),this.psfb21=Js(1+en.PSFB21),this.psfb12=Js(1+en.PSFB12);var o=this.l,n=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Zs.arraycopy(this.arrL,0,o,0,Math.min(this.arrL.length,this.l.length)),Zs.arraycopy(this.arrS,0,n,0,Math.min(this.arrS.length,this.s.length)),Zs.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Zs.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Di=ih,ta=_t,On=ta.new_float,oh=ta.new_float_n,rh=ta.new_int,xa=Rt();function lh(){this.last_en_subshort=oh([4,9]),this.lastAttacks=rh(4),this.pefirbuf=On(19),this.longfact=On(xa.SBMAX_l),this.shortfact=On(xa.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var ch=lh;function dh(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var uh=dh,Cs=_t,hh=Cs.new_byte,_h=Cs.new_double,Ft=Cs.new_float,cs=Cs.new_float_n,jt=Cs.new_int,tn=Cs.new_int_n,mh=ah,ph=Di,fh=ch,gh=uh,La=ki(),pt=Rt(),bh=cn;Qt.MFSIZE=3*1152+pt.ENCDELAY-pt.MDCTDELAY;Qt.MAX_HEADER_BUF=256;Qt.MAX_BITS_PER_CHANNEL=4095;Qt.MAX_BITS_PER_GRANULE=7680;Qt.BPC=320;function Qt(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=cs([2,Qt.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new mh,this.ms_ratio=Ft(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=jt(2),this.CurrentStep=jt(2),this.masking_lower=0,this.bv_scf=jt(576),this.pseudohalf=jt(bh.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Qt.BPC+1),this.itime=_h(2),this.sideinfo_len=0,this.sb_sample=cs([2,2,18,pt.SBLIMIT]),this.amp_filter=Ft(32);function t(){this.write_timing=0,this.ptr=0,this.buf=hh(e)}this.header=new Array(Qt.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new ph,this.minval_l=Ft(pt.CBANDS),this.minval_s=Ft(pt.CBANDS),this.nb_1=cs([4,pt.CBANDS]),this.nb_2=cs([4,pt.CBANDS]),this.nb_s1=cs([4,pt.CBANDS]),this.nb_s2=cs([4,pt.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ft(4),this.loudness_sq=cs([2,2]),this.loudness_sq_save=Ft(2),this.mld_l=Ft(pt.SBMAX_l),this.mld_s=Ft(pt.SBMAX_s),this.bm_l=jt(pt.SBMAX_l),this.bo_l=jt(pt.SBMAX_l),this.bm_s=jt(pt.SBMAX_s),this.bo_s=jt(pt.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=tn([pt.CBANDS,2]),this.s3ind_s=tn([pt.CBANDS,2]),this.numlines_s=jt(pt.CBANDS),this.numlines_l=jt(pt.CBANDS),this.rnumlines_l=Ft(pt.CBANDS),this.mld_cb_l=Ft(pt.CBANDS),this.mld_cb_s=Ft(pt.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ft(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=jt(2),this.nsPsy=new fh,this.VBR_seek_table=new gh,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=tn([16,5]),this.bitrate_blockType_Hist=tn([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var s=0;s<this.en.length;s++)this.en[s]=new La;for(var s=0;s<this.thm.length;s++)this.thm[s]=new La;for(var s=0;s<this.header.length;s++)this.header[s]=new t}var dn=Qt,vh=_t,ds=vh.new_float,us=Rt();function Ah(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=ds(us.SBMAX_l),this.s=ds(us.SBMAX_s),this.psfb21=ds(us.PSFB21),this.psfb12=ds(us.PSFB12),this.cb_l=ds(us.CBANDS),this.cb_s=ds(us.CBANDS),this.eql_w=ds(us.BLKSIZE/2)}var Th=Ah,Vi=_t,Ot=Vi.System,Pa=Vi.Arrays;ft.STEPS_per_dB=100;ft.MAX_dB=120;ft.GAIN_NOT_ENOUGH_SAMPLES=-24601;ft.GAIN_ANALYSIS_ERROR=0;ft.GAIN_ANALYSIS_OK=1;ft.INIT_GAIN_ANALYSIS_ERROR=0;ft.INIT_GAIN_ANALYSIS_OK=1;ft.YULE_ORDER=10;ft.MAX_ORDER=ft.YULE_ORDER;ft.MAX_SAMP_FREQ=48e3;ft.RMS_WINDOW_TIME_NUMERATOR=1;ft.RMS_WINDOW_TIME_DENOMINATOR=20;ft.MAX_SAMPLES_PER_WINDOW=ft.MAX_SAMP_FREQ*ft.RMS_WINDOW_TIME_NUMERATOR/ft.RMS_WINDOW_TIME_DENOMINATOR+1;function ft(){var e=64.82,t=.95,s=ft.RMS_WINDOW_TIME_NUMERATOR,i=ft.RMS_WINDOW_TIME_DENOMINATOR,o=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],n=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function r(d,C,j,V,X,Y){for(;X--!=0;)j[V]=1e-10+d[C+0]*Y[0]-j[V-1]*Y[1]+d[C-1]*Y[2]-j[V-2]*Y[3]+d[C-2]*Y[4]-j[V-3]*Y[5]+d[C-3]*Y[6]-j[V-4]*Y[7]+d[C-4]*Y[8]-j[V-5]*Y[9]+d[C-5]*Y[10]-j[V-6]*Y[11]+d[C-6]*Y[12]-j[V-7]*Y[13]+d[C-7]*Y[14]-j[V-8]*Y[15]+d[C-8]*Y[16]-j[V-9]*Y[17]+d[C-9]*Y[18]-j[V-10]*Y[19]+d[C-10]*Y[20],++V,++C}function c(d,C,j,V,X,Y){for(;X--!=0;)j[V]=d[C+0]*Y[0]-j[V-1]*Y[1]+d[C-1]*Y[2]-j[V-2]*Y[3]+d[C-2]*Y[4],++V,++C}function v(d,C){for(var j=0;j<MAX_ORDER;j++)d.linprebuf[j]=d.lstepbuf[j]=d.loutbuf[j]=d.rinprebuf[j]=d.rstepbuf[j]=d.routbuf[j]=0;switch(0|C){case 48e3:d.reqindex=0;break;case 44100:d.reqindex=1;break;case 32e3:d.reqindex=2;break;case 24e3:d.reqindex=3;break;case 22050:d.reqindex=4;break;case 16e3:d.reqindex=5;break;case 12e3:d.reqindex=6;break;case 11025:d.reqindex=7;break;case 8e3:d.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return d.sampleWindow=0|(C*s+i-1)/i,d.lsum=0,d.rsum=0,d.totsamp=0,Pa.ill(d.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(d,C){return v(d,C)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(d.linpre=MAX_ORDER,d.rinpre=MAX_ORDER,d.lstep=MAX_ORDER,d.rstep=MAX_ORDER,d.lout=MAX_ORDER,d.rout=MAX_ORDER,Pa.fill(d.B,0),INIT_GAIN_ANALYSIS_OK)};function x(d){return d*d}this.AnalyzeSamples=function(d,C,j,V,X,Y,I){var f,g,y,a,p,M,P;if(Y==0)return GAIN_ANALYSIS_OK;switch(P=0,p=Y,I){case 1:V=C,X=j;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(Y<MAX_ORDER?(Ot.arraycopy(C,j,d.linprebuf,MAX_ORDER,Y),Ot.arraycopy(V,X,d.rinprebuf,MAX_ORDER,Y)):(Ot.arraycopy(C,j,d.linprebuf,MAX_ORDER,MAX_ORDER),Ot.arraycopy(V,X,d.rinprebuf,MAX_ORDER,MAX_ORDER));p>0;){M=p>d.sampleWindow-d.totsamp?d.sampleWindow-d.totsamp:p,P<MAX_ORDER?(f=d.linpre+P,g=d.linprebuf,y=d.rinpre+P,a=d.rinprebuf,M>MAX_ORDER-P&&(M=MAX_ORDER-P)):(f=j+P,g=C,y=X+P,a=V),r(g,f,d.lstepbuf,d.lstep+d.totsamp,M,o[d.reqindex]),r(a,y,d.rstepbuf,d.rstep+d.totsamp,M,o[d.reqindex]),c(d.lstepbuf,d.lstep+d.totsamp,d.loutbuf,d.lout+d.totsamp,M,n[d.reqindex]),c(d.rstepbuf,d.rstep+d.totsamp,d.routbuf,d.rout+d.totsamp,M,n[d.reqindex]),f=d.lout+d.totsamp,g=d.loutbuf,y=d.rout+d.totsamp,a=d.routbuf;for(var G=M%8;G--!=0;)d.lsum+=x(g[f++]),d.rsum+=x(a[y++]);for(G=M/8;G--!=0;)d.lsum+=x(g[f+0])+x(g[f+1])+x(g[f+2])+x(g[f+3])+x(g[f+4])+x(g[f+5])+x(g[f+6])+x(g[f+7]),f+=8,d.rsum+=x(a[y+0])+x(a[y+1])+x(a[y+2])+x(a[y+3])+x(a[y+4])+x(a[y+5])+x(a[y+6])+x(a[y+7]),y+=8;if(p-=M,P+=M,d.totsamp+=M,d.totsamp==d.sampleWindow){var N=ft.STEPS_per_dB*10*Math.log10((d.lsum+d.rsum)/d.totsamp*.5+1e-37),F=N<=0?0:0|N;F>=d.A.length&&(F=d.A.length-1),d.A[F]++,d.lsum=d.rsum=0,Ot.arraycopy(d.loutbuf,d.totsamp,d.loutbuf,0,MAX_ORDER),Ot.arraycopy(d.routbuf,d.totsamp,d.routbuf,0,MAX_ORDER),Ot.arraycopy(d.lstepbuf,d.totsamp,d.lstepbuf,0,MAX_ORDER),Ot.arraycopy(d.rstepbuf,d.totsamp,d.rstepbuf,0,MAX_ORDER),d.totsamp=0}if(d.totsamp>d.sampleWindow)return GAIN_ANALYSIS_ERROR}return Y<MAX_ORDER?(Ot.arraycopy(d.linprebuf,Y,d.linprebuf,0,MAX_ORDER-Y),Ot.arraycopy(d.rinprebuf,Y,d.rinprebuf,0,MAX_ORDER-Y),Ot.arraycopy(C,j,d.linprebuf,MAX_ORDER-Y,Y),Ot.arraycopy(V,X,d.rinprebuf,MAX_ORDER-Y,Y)):(Ot.arraycopy(C,j+Y-MAX_ORDER,d.linprebuf,0,MAX_ORDER),Ot.arraycopy(V,X+Y-MAX_ORDER,d.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function h(d,C){var j,V=0;for(j=0;j<C;j++)V+=d[j];if(V==0)return GAIN_NOT_ENOUGH_SAMPLES;var X=0|Math.ceil(V*(1-t));for(j=C;j-- >0&&!((X-=d[j])<=0););return e-j/ft.STEPS_per_dB}this.GetTitleGain=function(d){for(var C=h(d.A,d.A.length),j=0;j<d.A.length;j++)d.B[j]+=d.A[j],d.A[j]=0;for(var j=0;j<MAX_ORDER;j++)d.linprebuf[j]=d.lstepbuf[j]=d.loutbuf[j]=d.rinprebuf[j]=d.rstepbuf[j]=d.routbuf[j]=0;return d.totsamp=0,d.lsum=d.rsum=0,C}}var Gi=ft,Fi=_t,vs=Fi.new_float,Ba=Fi.new_int,kt=Gi;function Eh(){this.linprebuf=vs(kt.MAX_ORDER*2),this.linpre=0,this.lstepbuf=vs(kt.MAX_SAMPLES_PER_WINDOW+kt.MAX_ORDER),this.lstep=0,this.loutbuf=vs(kt.MAX_SAMPLES_PER_WINDOW+kt.MAX_ORDER),this.lout=0,this.rinprebuf=vs(kt.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=vs(kt.MAX_SAMPLES_PER_WINDOW+kt.MAX_ORDER),this.rstep=0,this.routbuf=vs(kt.MAX_SAMPLES_PER_WINDOW+kt.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Ba(0|kt.STEPS_per_dB*kt.MAX_dB),this.B=Ba(0|kt.STEPS_per_dB*kt.MAX_dB)}var Sh=Eh;function yh(e){this.bits=e}var $i=yh,sa=_t,Da=sa.new_float,Ih=sa.new_int,Va=sa.assert,wh=$i,Ga=Rt(),Rh=cn,Ch=dn;function Mh(e){var t=e;this.quantize=t,this.iteration_loop=function(s,i,o,n){var r=s.internal_flags,c=Da(Rh.SFBMAX),v=Da(576),x=Ih(2),h=0,d,C=r.l3_side,j=new wh(h);this.quantize.rv.ResvFrameBegin(s,j),h=j.bits;for(var V=0;V<r.mode_gr;V++){d=this.quantize.qupvt.on_pe(s,i,x,h,V,V),r.mode_ext==Ga.MPG_MD_MS_LR&&(this.quantize.ms_convert(r.l3_side,V),this.quantize.qupvt.reduce_side(x,o[V],h,d));for(var X=0;X<r.channels_out;X++){var Y,I,f=C.tt[V][X];f.block_type!=Ga.SHORT_TYPE?(Y=0,I=r.PSY.mask_adjust-Y):(Y=0,I=r.PSY.mask_adjust_short-Y),r.masking_lower=Math.pow(10,I*.1),this.quantize.init_outer_loop(r,f),this.quantize.init_xrpow(r,f,v)&&(this.quantize.qupvt.calc_xmin(s,n[V][X],f,c),this.quantize.outer_loop(s,f,c,v,X,x[X])),this.quantize.iteration_finish_one(r,V,X),Va(f.part2_3_length<=Ch.MAX_BITS_PER_CHANNEL),Va(f.part2_3_length<=x[X])}}this.quantize.rv.ResvFrameEnd(r,h)}}var Nh=Mh;function et(e,t,s,i){this.xlen=e,this.linmax=t,this.table=s,this.hlen=i}var Ae={};Ae.t1HB=[1,1,1,0];Ae.t2HB=[1,2,1,3,1,1,3,2,0];Ae.t3HB=[3,2,1,1,1,1,3,2,0];Ae.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];Ae.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];Ae.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];Ae.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];Ae.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];Ae.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];Ae.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];Ae.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];Ae.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];Ae.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];Ae.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];Ae.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];Ae.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];Ae.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];Ae.t1l=[1,4,3,5];Ae.t2l=[1,4,7,4,5,7,6,7,8];Ae.t3l=[2,3,7,4,4,7,6,7,8];Ae.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];Ae.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];Ae.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];Ae.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];Ae.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];Ae.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];Ae.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];Ae.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];Ae.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];Ae.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];Ae.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];Ae.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];Ae.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];Ae.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];Ae.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];Ae.ht=[new et(0,0,null,null),new et(2,0,Ae.t1HB,Ae.t1l),new et(3,0,Ae.t2HB,Ae.t2l),new et(3,0,Ae.t3HB,Ae.t3l),new et(0,0,null,null),new et(4,0,Ae.t5HB,Ae.t5l),new et(4,0,Ae.t6HB,Ae.t6l),new et(6,0,Ae.t7HB,Ae.t7l),new et(6,0,Ae.t8HB,Ae.t8l),new et(6,0,Ae.t9HB,Ae.t9l),new et(8,0,Ae.t10HB,Ae.t10l),new et(8,0,Ae.t11HB,Ae.t11l),new et(8,0,Ae.t12HB,Ae.t12l),new et(16,0,Ae.t13HB,Ae.t13l),new et(0,0,null,Ae.t16_5l),new et(16,0,Ae.t15HB,Ae.t15l),new et(1,1,Ae.t16HB,Ae.t16l),new et(2,3,Ae.t16HB,Ae.t16l),new et(3,7,Ae.t16HB,Ae.t16l),new et(4,15,Ae.t16HB,Ae.t16l),new et(6,63,Ae.t16HB,Ae.t16l),new et(8,255,Ae.t16HB,Ae.t16l),new et(10,1023,Ae.t16HB,Ae.t16l),new et(13,8191,Ae.t16HB,Ae.t16l),new et(4,15,Ae.t24HB,Ae.t24l),new et(5,31,Ae.t24HB,Ae.t24l),new et(6,63,Ae.t24HB,Ae.t24l),new et(7,127,Ae.t24HB,Ae.t24l),new et(8,255,Ae.t24HB,Ae.t24l),new et(9,511,Ae.t24HB,Ae.t24l),new et(11,2047,Ae.t24HB,Ae.t24l),new et(13,8191,Ae.t24HB,Ae.t24l),new et(0,0,Ae.t32HB,Ae.t32l),new et(0,0,Ae.t33HB,Ae.t33l)];Ae.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];Ae.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];Ae.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];Ae.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];Ae.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];Ae.scfsi_band=[0,6,11,16,21];var na=Ae,kn,Fa;function Hi(){if(Fa)return kn;Fa=1;var e=Di,t=_t,s=t.VbrMode,i=t.Float,o=t.Util,n=t.new_float,r=t.new_int,c=t.assert,v=Rt(),x=$i,h=dn;d.Q_MAX=257,d.Q_MAX2=116,d.LARGE_BITS=1e5,d.IXMAX_VAL=8206;function d(){var C=aa(),j=null,V=null,X=null;this.setModules=function(w,$,z){j=w,V=$,X=z};function Y(w){return c(0<=w+d.Q_MAX2&&w<d.Q_MAX),P[w+d.Q_MAX2]}this.IPOW20=function(w){return c(0<=w&&w<d.Q_MAX),G[w]};var I=2220446049250313e-31,f=d.IXMAX_VAL,g=f+2,y=d.Q_MAX,a=d.Q_MAX2;d.LARGE_BITS;var p=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var M=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=M,this.sfBandIndex=[new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var P=n(y+a+1),G=n(y),N=n(g),F=n(g);this.adj43=F;function pe(w,$){var z=X.ATHformula($,w);return z-=p,z=Math.pow(10,z/10+w.ATHlower),z}function k(w){for(var $=w.internal_flags.ATH.l,z=w.internal_flags.ATH.psfb21,W=w.internal_flags.ATH.s,ne=w.internal_flags.ATH.psfb12,B=w.internal_flags,b=w.out_samplerate,m=0;m<v.SBMAX_l;m++){var u=B.scalefac_band.l[m],A=B.scalefac_band.l[m+1];$[m]=i.MAX_VALUE;for(var R=u;R<A;R++){var J=R*b/1152,le=pe(w,J);$[m]=Math.min($[m],le)}}for(var m=0;m<v.PSFB21;m++){var u=B.scalefac_band.psfb21[m],A=B.scalefac_band.psfb21[m+1];z[m]=i.MAX_VALUE;for(var R=u;R<A;R++){var J=R*b/1152,le=pe(w,J);z[m]=Math.min(z[m],le)}}for(var m=0;m<v.SBMAX_s;m++){var u=B.scalefac_band.s[m],A=B.scalefac_band.s[m+1];W[m]=i.MAX_VALUE;for(var R=u;R<A;R++){var J=R*b/384,le=pe(w,J);W[m]=Math.min(W[m],le)}W[m]*=B.scalefac_band.s[m+1]-B.scalefac_band.s[m]}for(var m=0;m<v.PSFB12;m++){var u=B.scalefac_band.psfb12[m],A=B.scalefac_band.psfb12[m+1];ne[m]=i.MAX_VALUE;for(var R=u;R<A;R++){var J=R*b/384,le=pe(w,J);ne[m]=Math.min(ne[m],le)}ne[m]*=B.scalefac_band.s[13]-B.scalefac_band.s[12]}if(w.noATH){for(var m=0;m<v.SBMAX_l;m++)$[m]=1e-20;for(var m=0;m<v.PSFB21;m++)z[m]=1e-20;for(var m=0;m<v.SBMAX_s;m++)W[m]=1e-20;for(var m=0;m<v.PSFB12;m++)ne[m]=1e-20}B.ATH.floor=10*Math.log10(pe(w,-1))}this.iteration_init=function(w){var $=w.internal_flags,z=$.l3_side,W;if($.iteration_init_init==0){for($.iteration_init_init=1,z.main_data_begin=0,k(w),N[0]=0,W=1;W<g;W++)N[W]=Math.pow(W,4/3);for(W=0;W<g-1;W++)F[W]=W+1-Math.pow(.5*(N[W]+N[W+1]),.75);for(F[W]=.5,W=0;W<y;W++)G[W]=Math.pow(2,(W-210)*-.1875);for(W=0;W<=y+a;W++)P[W]=Math.pow(2,(W-210-a)*.25);j.huffman_init($);{var ne,B,b,m;for(W=w.exp_nspsytune>>2&63,W>=32&&(W-=64),ne=Math.pow(10,W/4/10),W=w.exp_nspsytune>>8&63,W>=32&&(W-=64),B=Math.pow(10,W/4/10),W=w.exp_nspsytune>>14&63,W>=32&&(W-=64),b=Math.pow(10,W/4/10),W=w.exp_nspsytune>>20&63,W>=32&&(W-=64),m=b*Math.pow(10,W/4/10),W=0;W<v.SBMAX_l;W++){var u;W<=6?u=ne:W<=13?u=B:W<=20?u=b:u=m,$.nsPsy.longfact[W]=u}for(W=0;W<v.SBMAX_s;W++){var u;W<=5?u=ne:W<=10?u=B:W<=11?u=b:u=m,$.nsPsy.shortfact[W]=u}}}},this.on_pe=function(w,$,z,W,ne,B){var b=w.internal_flags,m=0,u,A=r(2),R,J=new x(m),le=V.ResvMaxBits(w,W,J,B);m=J.bits;var H=m+le;for(H>h.MAX_BITS_PER_GRANULE&&(H=h.MAX_BITS_PER_GRANULE),u=0,R=0;R<b.channels_out;++R)z[R]=Math.min(h.MAX_BITS_PER_CHANNEL,m/b.channels_out),A[R]=0|z[R]*$[ne][R]/700-z[R],A[R]>W*3/4&&(A[R]=W*3/4),A[R]<0&&(A[R]=0),A[R]+z[R]>h.MAX_BITS_PER_CHANNEL&&(A[R]=Math.max(0,h.MAX_BITS_PER_CHANNEL-z[R])),u+=A[R];if(u>le)for(R=0;R<b.channels_out;++R)A[R]=le*A[R]/u;for(R=0;R<b.channels_out;++R)z[R]+=A[R],le-=A[R];for(u=0,R=0;R<b.channels_out;++R)u+=z[R];if(u>h.MAX_BITS_PER_GRANULE){var ee=0;for(R=0;R<b.channels_out;++R)z[R]*=h.MAX_BITS_PER_GRANULE,z[R]/=u,ee+=z[R]}return H},this.reduce_side=function(w,$,z,W){c(w[0]+w[1]<=h.MAX_BITS_PER_GRANULE);var ne=.33*(.5-$)/.5;ne<0&&(ne=0),ne>.5&&(ne=.5);var B=0|ne*.5*(w[0]+w[1]);B>h.MAX_BITS_PER_CHANNEL-w[0]&&(B=h.MAX_BITS_PER_CHANNEL-w[0]),B<0&&(B=0),w[1]>=125&&(w[1]-B>125?(w[0]<z&&(w[0]+=B),w[1]-=B):(w[0]+=w[1]-125,w[1]=125)),B=w[0]+w[1],B>W&&(w[0]=W*w[0]/B,w[1]=W*w[1]/B),c(w[0]<=h.MAX_BITS_PER_CHANNEL),c(w[1]<=h.MAX_BITS_PER_CHANNEL),c(w[0]+w[1]<=h.MAX_BITS_PER_GRANULE)},this.athAdjust=function(w,$,z){var W=90.30873362,ne=94.82444863,B=o.FAST_LOG10_X($,10),b=w*w,m=0;return B-=z,b>1e-20&&(m=1+o.FAST_LOG10_X(b,10/W)),m<0&&(m=0),B*=m,B+=z+W-ne,Math.pow(10,.1*B)},this.calc_xmin=function(w,$,z,W){var ne=0,B=w.internal_flags,b,m=0,u=0,A=B.ATH,R=z.xr,J=w.VBR==s.vbr_mtrh?1:0,le=B.masking_lower;for((w.VBR==s.vbr_mtrh||w.VBR==s.vbr_mt)&&(le=1),b=0;b<z.psy_lmax;b++){var H,ee,me,Te,we,Ne;w.VBR==s.vbr_rh||w.VBR==s.vbr_mtrh?ee=athAdjust(A.adjust,A.l[b],A.floor):ee=A.adjust*A.l[b],we=z.width[b],me=ee/we,Te=I,Ne=we>>1,H=0;do{var Re,Ce;Re=R[m]*R[m],H+=Re,Te+=Re<me?Re:me,m++,Ce=R[m]*R[m],H+=Ce,Te+=Ce<me?Ce:me,m++}while(--Ne>0);if(H>ee&&u++,b==v.SBPSY_l){var Pe=ee*B.nsPsy.longfact[b];Te<Pe&&(Te=Pe)}if(J!=0&&(ee=Te),!w.ATHonly){var it=$.en.l[b];if(it>0){var Pe;Pe=H*$.thm.l[b]*le/it,J!=0&&(Pe*=B.nsPsy.longfact[b]),ee<Pe&&(ee=Pe)}}J!=0?W[ne++]=ee:W[ne++]=ee*B.nsPsy.longfact[b]}var Vt=575;if(z.block_type!=v.SHORT_TYPE)for(var _=576;_--!=0&&C.EQ(R[_],0);)Vt=_;z.max_nonzero_coeff=Vt;for(var T=z.sfb_smin;b<z.psymax;T++,b+=3){var we,Ie,ke;for(w.VBR==s.vbr_rh||w.VBR==s.vbr_mtrh?ke=athAdjust(A.adjust,A.s[T],A.floor):ke=A.adjust*A.s[T],we=z.width[b],Ie=0;Ie<3;Ie++){var H=0,ee,me,Te,Ne=we>>1;me=ke/we,Te=I;do{var Re,Ce;Re=R[m]*R[m],H+=Re,Te+=Re<me?Re:me,m++,Ce=R[m]*R[m],H+=Ce,Te+=Ce<me?Ce:me,m++}while(--Ne>0);if(H>ke&&u++,T==v.SBPSY_s){var Pe=ke*B.nsPsy.shortfact[T];Te<Pe&&(Te=Pe)}if(J!=0?ee=Te:ee=ke,!w.ATHonly&&!w.ATHshort){var it=$.en.s[T][Ie];if(it>0){var Pe;Pe=H*$.thm.s[T][Ie]*le/it,J!=0&&(Pe*=B.nsPsy.shortfact[T]),ee<Pe&&(ee=Pe)}}J!=0?W[ne++]=ee:W[ne++]=ee*B.nsPsy.shortfact[T]}w.useTemporal&&(W[ne-3]>W[ne-3+1]&&(W[ne-3+1]+=(W[ne-3]-W[ne-3+1])*B.decay),W[ne-3+1]>W[ne-3+2]&&(W[ne-3+2]+=(W[ne-3+1]-W[ne-3+2])*B.decay))}return u};function l(w){this.s=w}this.calc_noise_core=function(w,$,z,W){var ne=0,B=$.s,b=w.l3_enc;if(B>w.count1)for(;z--!=0;){var m;m=w.xr[B],B++,ne+=m*m,m=w.xr[B],B++,ne+=m*m}else if(B>w.big_values){var u=n(2);for(u[0]=0,u[1]=W;z--!=0;){var m;m=Math.abs(w.xr[B])-u[b[B]],B++,ne+=m*m,m=Math.abs(w.xr[B])-u[b[B]],B++,ne+=m*m}}else for(;z--!=0;){var m;m=Math.abs(w.xr[B])-N[b[B]]*W,B++,ne+=m*m,m=Math.abs(w.xr[B])-N[b[B]]*W,B++,ne+=m*m}return $.s=B,ne},this.calc_noise=function(w,$,z,W,ne){var B=0,b=0,m,u,A=0,R=0,J=0,le=-20,H=0,ee=w.scalefac,me=0;for(W.over_SSD=0,m=0;m<w.psymax;m++){var Te=w.global_gain-(ee[me++]+(w.preflag!=0?M[m]:0)<<w.scalefac_scale+1)-w.subblock_gain[w.window[m]]*8,we=0;if(ne!=null&&ne.step[m]==Te)we=ne.noise[m],H+=w.width[m],z[B++]=we/$[b++],we=ne.noise_log[m];else{var Ne=Y(Te);if(u=w.width[m]>>1,H+w.width[m]>w.max_nonzero_coeff){var Re;Re=w.max_nonzero_coeff-H+1,Re>0?u=Re>>1:u=0}var Ce=new l(H);we=this.calc_noise_core(w,Ce,u,Ne),H=Ce.s,ne!=null&&(ne.step[m]=Te,ne.noise[m]=we),we=z[B++]=we/$[b++],we=o.FAST_LOG10(Math.max(we,1e-20)),ne!=null&&(ne.noise_log[m]=we)}if(ne!=null&&(ne.global_gain=w.global_gain),J+=we,we>0){var Pe;Pe=Math.max(0|we*10+.5,1),W.over_SSD+=Pe*Pe,A++,R+=we}le=Math.max(le,we)}return W.over_count=A,W.tot_noise=J,W.over_noise=R,W.max_noise=le,A},this.set_pinfo=function(w,$,z,W,ne){var B=w.internal_flags,b,m,u,A,R,J=$.scalefac_scale==0?.5:1,le=$.scalefac,H=n(L3Side.SFBMAX),ee=n(L3Side.SFBMAX),me=new CalcNoiseResult;calc_xmin(w,z,$,H),calc_noise($,H,ee,me,null);var Te=0;for(m=$.sfb_lmax,$.block_type!=v.SHORT_TYPE&&$.mixed_block_flag==0&&(m=22),b=0;b<m;b++){var we=B.scalefac_band.l[b],Ne=B.scalefac_band.l[b+1],Re=Ne-we;for(A=0;Te<Ne;Te++)A+=$.xr[Te]*$.xr[Te];A/=Re,R=1e15,B.pinfo.en[W][ne][b]=R*A,B.pinfo.xfsf[W][ne][b]=R*H[b]*ee[b]/Re,z.en.l[b]>0&&!w.ATHonly?A=A/z.en.l[b]:A=0,B.pinfo.thr[W][ne][b]=R*Math.max(A*z.thm.l[b],B.ATH.l[b]),B.pinfo.LAMEsfb[W][ne][b]=0,$.preflag!=0&&b>=11&&(B.pinfo.LAMEsfb[W][ne][b]=-J*M[b]),b<v.SBPSY_l&&(c(le[b]>=0),B.pinfo.LAMEsfb[W][ne][b]-=J*le[b])}if($.block_type==v.SHORT_TYPE)for(m=b,b=$.sfb_smin;b<v.SBMAX_s;b++)for(var we=B.scalefac_band.s[b],Ne=B.scalefac_band.s[b+1],Re=Ne-we,Ce=0;Ce<3;Ce++){for(A=0,u=we;u<Ne;u++)A+=$.xr[Te]*$.xr[Te],Te++;A=Math.max(A/Re,1e-20),R=1e15,B.pinfo.en_s[W][ne][3*b+Ce]=R*A,B.pinfo.xfsf_s[W][ne][3*b+Ce]=R*H[m]*ee[m]/Re,z.en.s[b][Ce]>0?A=A/z.en.s[b][Ce]:A=0,(w.ATHonly||w.ATHshort)&&(A=0),B.pinfo.thr_s[W][ne][3*b+Ce]=R*Math.max(A*z.thm.s[b][Ce],B.ATH.s[b]),B.pinfo.LAMEsfb_s[W][ne][3*b+Ce]=-2*$.subblock_gain[Ce],b<v.SBPSY_s&&(B.pinfo.LAMEsfb_s[W][ne][3*b+Ce]-=J*le[m]),m++}B.pinfo.LAMEqss[W][ne]=$.global_gain,B.pinfo.LAMEmainbits[W][ne]=$.part2_3_length+$.part2_length,B.pinfo.LAMEsfbits[W][ne]=$.part2_length,B.pinfo.over[W][ne]=me.over_count,B.pinfo.max_noise[W][ne]=me.max_noise*10,B.pinfo.over_noise[W][ne]=me.over_noise*10,B.pinfo.tot_noise[W][ne]=me.tot_noise*10,B.pinfo.over_SSD[W][ne]=me.over_SSD}}return kn=d,kn}var xn,$a;function Ui(){if($a)return xn;$a=1;var e=_t,t=e.System,s=e.Arrays,i=e.new_int,o=e.assert,n=Rt(),r=na,c=ea,v=Hi();function x(){var h=null;this.qupvt=null,this.setModules=function(B){this.qupvt=B,h=B};function d(B){this.bits=0|B}var C=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function j(B,b,m,u,A,R){var J=.5946/b;for(B=B>>1;B--!=0;)A[R++]=J>m[u++]?0:1,A[R++]=J>m[u++]?0:1}function V(B,b,m,u,A,R){B=B>>1;var J=B%2;for(B=B>>1;B--!=0;){var le,H,ee,me,Te,we,Ne,Re;le=m[u++]*b,H=m[u++]*b,Te=0|le,ee=m[u++]*b,we=0|H,me=m[u++]*b,Ne=0|ee,le+=h.adj43[Te],Re=0|me,H+=h.adj43[we],A[R++]=0|le,ee+=h.adj43[Ne],A[R++]=0|H,me+=h.adj43[Re],A[R++]=0|ee,A[R++]=0|me}if(J!=0){var le,H,Te,we;le=m[u++]*b,H=m[u++]*b,Te=0|le,we=0|H,le+=h.adj43[Te],H+=h.adj43[we],A[R++]=0|le,A[R++]=0|H}}function X(B,b,m,u,A){var R,J,le=0,H,ee=0,me=0,Te=0,we=b,Ne=0,Re=we,Ce=0,Pe=B,it=0;for(H=A!=null&&u.global_gain==A.global_gain,u.block_type==n.SHORT_TYPE?J=38:J=21,R=0;R<=J;R++){var Vt=-1;if((H||u.block_type==n.NORM_TYPE)&&(Vt=u.global_gain-(u.scalefac[R]+(u.preflag!=0?h.pretab[R]:0)<<u.scalefac_scale+1)-u.subblock_gain[u.window[R]]*8),o(u.width[R]>=0),H&&A.step[R]==Vt)ee!=0&&(V(ee,m,Pe,it,Re,Ce),ee=0),me!=0&&(j(me,m,Pe,it,Re,Ce),me=0);else{var _=u.width[R];if(le+u.width[R]>u.max_nonzero_coeff){var T;T=u.max_nonzero_coeff-le+1,s.fill(b,u.max_nonzero_coeff,576,0),_=T,_<0&&(_=0),R=J+1}if(ee==0&&me==0&&(Re=we,Ce=Ne,Pe=B,it=Te),A!=null&&A.sfb_count1>0&&R>=A.sfb_count1&&A.step[R]>0&&Vt>=A.step[R]?(ee!=0&&(V(ee,m,Pe,it,Re,Ce),ee=0,Re=we,Ce=Ne,Pe=B,it=Te),me+=_):(me!=0&&(j(me,m,Pe,it,Re,Ce),me=0,Re=we,Ce=Ne,Pe=B,it=Te),ee+=_),_<=0){me!=0&&(j(me,m,Pe,it,Re,Ce),me=0),ee!=0&&(V(ee,m,Pe,it,Re,Ce),ee=0);break}}R<=J&&(Ne+=u.width[R],Te+=u.width[R],le+=u.width[R])}ee!=0&&(V(ee,m,Pe,it,Re,Ce),ee=0),me!=0&&(j(me,m,Pe,it,Re,Ce),me=0)}function Y(B,b,m){var u=0,A=0;do{var R=B[b++],J=B[b++];u<R&&(u=R),A<J&&(A=J)}while(b<m);return u<A&&(u=A),u}function I(B,b,m,u,A,R){var J=r.ht[u].xlen*65536+r.ht[A].xlen,le=0,H;do{var ee=B[b++],me=B[b++];ee!=0&&(ee>14&&(ee=15,le+=J),ee*=16),me!=0&&(me>14&&(me=15,le+=J),ee+=me),le+=r.largetbl[ee]}while(b<m);return H=le&65535,le>>=16,le>H&&(le=H,u=A),R.bits+=le,u}function f(B,b,m,u){var A=0,R=r.ht[1].hlen;do{var J=B[b+0]*2+B[b+1];b+=2,A+=R[J]}while(b<m);return u.bits+=A,1}function g(B,b,m,u,A){var R=0,J,le=r.ht[u].xlen,H;u==2?H=r.table23:H=r.table56;do{var ee=B[b+0]*le+B[b+1];b+=2,R+=H[ee]}while(b<m);return J=R&65535,R>>=16,R>J&&(R=J,u++),A.bits+=R,u}function y(B,b,m,u,A){var R=0,J=0,le=0,H=r.ht[u].xlen,ee=r.ht[u].hlen,me=r.ht[u+1].hlen,Te=r.ht[u+2].hlen;do{var we=B[b+0]*H+B[b+1];b+=2,R+=ee[we],J+=me[we],le+=Te[we]}while(b<m);var Ne=u;return R>J&&(R=J,Ne++),R>le&&(R=le,Ne=u+2),A.bits+=R,Ne}var a=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function p(B,b,m,u){var A=Y(B,b,m);switch(A){case 0:return A;case 1:return f(B,b,m,u);case 2:case 3:return g(B,b,m,a[A-1],u);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return y(B,b,m,a[A-1],u);default:if(A>v.IXMAX_VAL)return u.bits=v.LARGE_BITS,-1;A-=15;var R;for(R=24;R<32&&!(r.ht[R].linmax>=A);R++);var J;for(J=R-8;J<24&&!(r.ht[J].linmax>=A);J++);return I(B,b,m,J,R,u)}}this.noquant_count_bits=function(B,b,m){var u=b.l3_enc,A=Math.min(576,b.max_nonzero_coeff+2>>1<<1);for(m!=null&&(m.sfb_count1=0);A>1&&!(u[A-1]|u[A-2]);A-=2);b.count1=A;for(var R=0,J=0;A>3;A-=4){var le;if(((u[A-1]|u[A-2]|u[A-3]|u[A-4])&2147483647)>1)break;le=((u[A-4]*2+u[A-3])*2+u[A-2])*2+u[A-1],R+=r.t32l[le],J+=r.t33l[le]}var H=R;if(b.count1table_select=0,R>J&&(H=J,b.count1table_select=1),b.count1bits=H,b.big_values=A,A==0)return H;if(b.block_type==n.SHORT_TYPE)R=3*B.scalefac_band.s[3],R>b.big_values&&(R=b.big_values),J=b.big_values;else if(b.block_type==n.NORM_TYPE){if(R=b.region0_count=B.bv_scf[A-2],J=b.region1_count=B.bv_scf[A-1],o(R+J+2<n.SBPSY_l),J=B.scalefac_band.l[R+J+2],R=B.scalefac_band.l[R+1],J<A){var ee=new d(H);b.table_select[2]=p(u,J,A,ee),H=ee.bits}}else b.region0_count=7,b.region1_count=n.SBMAX_l-1-7-1,R=B.scalefac_band.l[8],J=A,R>J&&(R=J);if(R=Math.min(R,A),J=Math.min(J,A),0<R){var ee=new d(H);b.table_select[0]=p(u,0,R,ee),H=ee.bits}if(R<J){var ee=new d(H);b.table_select[1]=p(u,R,J,ee),H=ee.bits}if(B.use_best_huffman==2&&(b.part2_3_length=H,best_huffman_divide(B,b),H=b.part2_3_length),m!=null&&b.block_type==n.NORM_TYPE){for(var me=0;B.scalefac_band.l[me]<b.big_values;)me++;m.sfb_count1=me}return H},this.count_bits=function(B,b,m,u){var A=m.l3_enc,R=v.IXMAX_VAL/h.IPOW20(m.global_gain);if(m.xrpow_max>R)return v.LARGE_BITS;if(X(b,A,h.IPOW20(m.global_gain),m,u),B.substep_shaping&2)for(var J=0,le=m.global_gain+m.scalefac_scale,H=.634521682242439/h.IPOW20(le),ee=0;ee<m.sfbmax;ee++){var me=m.width[ee];if(B.pseudohalf[ee]==0)J+=me;else{var Te;for(Te=J,J+=me;Te<J;++Te)A[Te]=b[Te]>=H?A[Te]:0}}return this.noquant_count_bits(B,m,u)};function M(B,b,m,u,A,R,J){for(var le=b.big_values,H=0;H<=22;H++)u[H]=v.LARGE_BITS;for(var H=0;H<16;H++){var ee=B.scalefac_band.l[H+1];if(ee>=le)break;var me=0,Te=new d(me),we=p(m,0,ee,Te);me=Te.bits;for(var Ne=0;Ne<8;Ne++){var Re=B.scalefac_band.l[H+Ne+2];if(Re>=le)break;var Ce=me;Te=new d(Ce);var Pe=p(m,ee,Re,Te);Ce=Te.bits,u[H+Ne]>Ce&&(u[H+Ne]=Ce,A[H+Ne]=H,R[H+Ne]=we,J[H+Ne]=Pe)}}}function P(B,b,m,u,A,R,J,le){for(var H=b.big_values,ee=2;ee<n.SBMAX_l+1;ee++){var me=B.scalefac_band.l[ee];if(me>=H)break;var Te=A[ee-2]+b.count1bits;if(m.part2_3_length<=Te)break;var we=new d(Te),Ne=p(u,me,H,we);Te=we.bits,!(m.part2_3_length<=Te)&&(m.assign(b),m.part2_3_length=Te,m.region0_count=R[ee-2],m.region1_count=ee-2-R[ee-2],m.table_select[0]=J[ee-2],m.table_select[1]=le[ee-2],m.table_select[2]=Ne)}}this.best_huffman_divide=function(B,b){var m=new c,u=b.l3_enc,A=i(23),R=i(23),J=i(23),le=i(23);if(!(b.block_type==n.SHORT_TYPE&&B.mode_gr==1)){m.assign(b),b.block_type==n.NORM_TYPE&&(M(B,b,u,A,R,J,le),P(B,m,b,u,A,R,J,le));var H=m.big_values;if(!(H==0||(u[H-2]|u[H-1])>1)&&(H=b.count1+2,!(H>576))){m.assign(b),m.count1=H;for(var ee=0,me=0;H>m.big_values;H-=4){var Te=((u[H-4]*2+u[H-3])*2+u[H-2])*2+u[H-1];ee+=r.t32l[Te],me+=r.t33l[Te]}if(m.big_values=H,m.count1table_select=0,ee>me&&(ee=me,m.count1table_select=1),m.count1bits=ee,m.block_type==n.NORM_TYPE)P(B,m,b,u,A,R,J,le);else{if(m.part2_3_length=ee,ee=B.scalefac_band.l[8],ee>H&&(ee=H),ee>0){var we=new d(m.part2_3_length);m.table_select[0]=p(u,0,ee,we),m.part2_3_length=we.bits}if(H>ee){var we=new d(m.part2_3_length);m.table_select[1]=p(u,ee,H,we),m.part2_3_length=we.bits}b.part2_3_length>m.part2_3_length&&b.assign(m)}}}};var G=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],N=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],F=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],pe=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];x.slen1_tab=F,x.slen2_tab=pe;function k(B,b){for(var m,u=b.tt[1][B],A=b.tt[0][B],R=0;R<r.scfsi_band.length-1;R++){for(m=r.scfsi_band[R];m<r.scfsi_band[R+1]&&!(A.scalefac[m]!=u.scalefac[m]&&u.scalefac[m]>=0);m++);if(m==r.scfsi_band[R+1]){for(m=r.scfsi_band[R];m<r.scfsi_band[R+1];m++)u.scalefac[m]=-1;b.scfsi[B][R]=1}}var J=0,le=0;for(m=0;m<11;m++)u.scalefac[m]!=-1&&(le++,J<u.scalefac[m]&&(J=u.scalefac[m]));for(var H=0,ee=0;m<n.SBPSY_l;m++)u.scalefac[m]!=-1&&(ee++,H<u.scalefac[m]&&(H=u.scalefac[m]));for(var R=0;R<16;R++)if(J<G[R]&&H<N[R]){var me=F[R]*le+pe[R]*ee;u.part2_length>me&&(u.part2_length=me,u.scalefac_compress=R)}}this.best_scalefac_store=function(B,b,m,u){var A=u.tt[b][m],R,J,le,H,ee=0;for(le=0,R=0;R<A.sfbmax;R++){var me=A.width[R];for(le+=me,H=-me;H<0&&A.l3_enc[H+le]==0;H++);H==0&&(A.scalefac[R]=ee=-2)}if(A.scalefac_scale==0&&A.preflag==0){var Te=0;for(R=0;R<A.sfbmax;R++)A.scalefac[R]>0&&(Te|=A.scalefac[R]);if(!(Te&1)&&Te!=0){for(R=0;R<A.sfbmax;R++)A.scalefac[R]>0&&(A.scalefac[R]>>=1);A.scalefac_scale=ee=1}}if(A.preflag==0&&A.block_type!=n.SHORT_TYPE&&B.mode_gr==2){for(R=11;R<n.SBPSY_l&&!(A.scalefac[R]<h.pretab[R]&&A.scalefac[R]!=-2);R++);if(R==n.SBPSY_l){for(R=11;R<n.SBPSY_l;R++)A.scalefac[R]>0&&(A.scalefac[R]-=h.pretab[R]);A.preflag=ee=1}}for(J=0;J<4;J++)u.scfsi[m][J]=0;for(B.mode_gr==2&&b==1&&u.tt[0][m].block_type!=n.SHORT_TYPE&&u.tt[1][m].block_type!=n.SHORT_TYPE&&(k(m,u),ee=0),R=0;R<A.sfbmax;R++)A.scalefac[R]==-2&&(A.scalefac[R]=0);ee!=0&&(B.mode_gr==2?this.scale_bitcount(A):this.scale_bitcount_lsf(B,A))};function l(B,b){for(var m=0;m<b;++m)if(B[m]<0)return!1;return!0}var w=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],$=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],z=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(B){var b,m,u=0,A=0,R,J=B.scalefac;if(o(l(J,B.sfbmax)),B.block_type==n.SHORT_TYPE)R=w,B.mixed_block_flag!=0&&(R=$);else if(R=z,B.preflag==0){for(m=11;m<n.SBPSY_l&&!(J[m]<h.pretab[m]);m++);if(m==n.SBPSY_l)for(B.preflag=1,m=11;m<n.SBPSY_l;m++)J[m]-=h.pretab[m]}for(m=0;m<B.sfbdivide;m++)u<J[m]&&(u=J[m]);for(;m<B.sfbmax;m++)A<J[m]&&(A=J[m]);for(B.part2_length=v.LARGE_BITS,b=0;b<16;b++)u<G[b]&&A<N[b]&&B.part2_length>R[b]&&(B.part2_length=R[b],B.scalefac_compress=b);return B.part2_length==v.LARGE_BITS};var W=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(B,b){var m,u,A,R,J,le,H,ee,me=i(4),Te=b.scalefac;for(b.preflag!=0?m=2:m=0,H=0;H<4;H++)me[H]=0;if(b.block_type==n.SHORT_TYPE){u=1;var we=h.nr_of_sfb_block[m][u];for(ee=0,A=0;A<4;A++)for(R=we[A]/3,H=0;H<R;H++,ee++)for(J=0;J<3;J++)Te[ee*3+J]>me[A]&&(me[A]=Te[ee*3+J])}else{u=0;var we=h.nr_of_sfb_block[m][u];for(ee=0,A=0;A<4;A++)for(R=we[A],H=0;H<R;H++,ee++)Te[ee]>me[A]&&(me[A]=Te[ee])}for(le=!1,A=0;A<4;A++)me[A]>W[m][A]&&(le=!0);if(!le){var Ne,Re,Ce,Pe;for(b.sfb_partition_table=h.nr_of_sfb_block[m][u],A=0;A<4;A++)b.slen[A]=ne[me[A]];switch(Ne=b.slen[0],Re=b.slen[1],Ce=b.slen[2],Pe=b.slen[3],m){case 0:b.scalefac_compress=(Ne*5+Re<<4)+(Ce<<2)+Pe;break;case 1:b.scalefac_compress=400+(Ne*5+Re<<2)+Ce;break;case 2:b.scalefac_compress=500+Ne*3+Re;break;default:t.err.printf(`intensity stereo not implemented yet
`);break}}if(!le)for(o(b.sfb_partition_table!=null),b.part2_length=0,A=0;A<4;A++)b.part2_length+=b.slen[A]*b.sfb_partition_table[A];return le};var ne=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(B){for(var b=2;b<=576;b+=2){for(var m=0,u;B.scalefac_band.l[++m]<b;);for(u=C[m][0];B.scalefac_band.l[u+1]>b;)u--;for(u<0&&(u=C[m][0]),B.bv_scf[b-2]=u,u=C[m][1];B.scalefac_band.l[u+B.bv_scf[b-2]+2]>b;)u--;u<0&&(u=C[m][1]),B.bv_scf[b-1]=u}}}return xn=x,xn}var Ln,Ha;function aa(){if(Ha)return Ln;Ha=1;var e=_t,t=e.System,s=e.Arrays,i=e.new_byte,o=e.new_float_n,n=e.new_int,r=e.assert,c=Ui(),v=na,x=Rt(),h=dn;d.EQ=function(C,j){return Math.abs(C)>Math.abs(j)?Math.abs(C-j)<=Math.abs(C)*1e-6:Math.abs(C-j)<=Math.abs(j)*1e-6},d.NEQ=function(C,j){return!d.EQ(C,j)};function d(){var C=ia(),j=this,V=32773,X=null,Y=null,I=null,f=null;this.setModules=function(b,m,u,A){X=b,Y=m,I=u,f=A};var g=null,y=0,a=0,p=0;this.getframebits=function(b){var m=b.internal_flags,u;m.bitrate_index!=0?u=v.bitrate_table[b.version][m.bitrate_index]:u=b.brate;var A=0|(b.version+1)*72e3*u/b.out_samplerate+m.padding;return 8*A};function M(b){t.arraycopy(b.header[b.w_ptr].buf,0,g,a,b.sideinfo_len),a+=b.sideinfo_len,y+=b.sideinfo_len*8,b.w_ptr=b.w_ptr+1&h.MAX_HEADER_BUF-1}function P(b,m,u){for(;u>0;){var A;p==0&&(p=8,a++,r(a<C.LAME_MAXMP3BUFFER),r(b.header[b.w_ptr].write_timing>=y),b.header[b.w_ptr].write_timing==y&&M(b),g[a]=0),A=Math.min(u,p),u-=A,p-=A,g[a]|=m>>u<<p,y+=A}}function G(b,m,u){for(;u>0;){var A;p==0&&(p=8,a++,r(a<C.LAME_MAXMP3BUFFER),g[a]=0),A=Math.min(u,p),u-=A,p-=A,g[a]|=m>>u<<p,y+=A}}function N(b,m){var u=b.internal_flags,A;if(m>=8&&(P(u,76,8),m-=8),m>=8&&(P(u,65,8),m-=8),m>=8&&(P(u,77,8),m-=8),m>=8&&(P(u,69,8),m-=8),m>=32){var R=I.getLameShortVersion();if(m>=32)for(A=0;A<R.length&&m>=8;++A)m-=8,P(u,R.charAt(A),8)}for(;m>=1;m-=1)P(u,u.ancillary_flag,1),u.ancillary_flag^=b.disable_reservoir?0:1}function F(b,m,u){for(var A=b.header[b.h_ptr].ptr;u>0;){var R=Math.min(u,8-(A&7));u-=R,b.header[b.h_ptr].buf[A>>3]|=m>>u<<8-(A&7)-R,A+=R}b.header[b.h_ptr].ptr=A}function pe(b,m){b<<=8;for(var u=0;u<8;u++)b<<=1,m<<=1,(m^b)&65536&&(m^=V);return m}this.CRC_writeheader=function(b,m){var u=65535;u=pe(m[2]&255,u),u=pe(m[3]&255,u);for(var A=6;A<b.sideinfo_len;A++)u=pe(m[A]&255,u);m[4]=byte(u>>8),m[5]=byte(u&255)};function k(b,m){var u=b.internal_flags,A,R,J;if(A=u.l3_side,u.header[u.h_ptr].ptr=0,s.fill(u.header[u.h_ptr].buf,0,u.sideinfo_len,0),b.out_samplerate<16e3?F(u,4094,12):F(u,4095,12),F(u,b.version,1),F(u,1,2),F(u,b.error_protection?0:1,1),F(u,u.bitrate_index,4),F(u,u.samplerate_index,2),F(u,u.padding,1),F(u,b.extension,1),F(u,b.mode.ordinal(),2),F(u,u.mode_ext,2),F(u,b.copyright,1),F(u,b.original,1),F(u,b.emphasis,2),b.error_protection&&F(u,0,16),b.version==1){for(r(A.main_data_begin>=0),F(u,A.main_data_begin,9),u.channels_out==2?F(u,A.private_bits,3):F(u,A.private_bits,5),J=0;J<u.channels_out;J++){var le;for(le=0;le<4;le++)F(u,A.scfsi[J][le],1)}for(R=0;R<2;R++)for(J=0;J<u.channels_out;J++){var H=A.tt[R][J];F(u,H.part2_3_length+H.part2_length,12),F(u,H.big_values/2,9),F(u,H.global_gain,8),F(u,H.scalefac_compress,4),H.block_type!=x.NORM_TYPE?(F(u,1,1),F(u,H.block_type,2),F(u,H.mixed_block_flag,1),H.table_select[0]==14&&(H.table_select[0]=16),F(u,H.table_select[0],5),H.table_select[1]==14&&(H.table_select[1]=16),F(u,H.table_select[1],5),F(u,H.subblock_gain[0],3),F(u,H.subblock_gain[1],3),F(u,H.subblock_gain[2],3)):(F(u,0,1),H.table_select[0]==14&&(H.table_select[0]=16),F(u,H.table_select[0],5),H.table_select[1]==14&&(H.table_select[1]=16),F(u,H.table_select[1],5),H.table_select[2]==14&&(H.table_select[2]=16),F(u,H.table_select[2],5),r(0<=H.region0_count&&H.region0_count<16),r(0<=H.region1_count&&H.region1_count<8),F(u,H.region0_count,4),F(u,H.region1_count,3)),F(u,H.preflag,1),F(u,H.scalefac_scale,1),F(u,H.count1table_select,1)}}else for(r(A.main_data_begin>=0),F(u,A.main_data_begin,8),F(u,A.private_bits,u.channels_out),R=0,J=0;J<u.channels_out;J++){var H=A.tt[R][J];F(u,H.part2_3_length+H.part2_length,12),F(u,H.big_values/2,9),F(u,H.global_gain,8),F(u,H.scalefac_compress,9),H.block_type!=x.NORM_TYPE?(F(u,1,1),F(u,H.block_type,2),F(u,H.mixed_block_flag,1),H.table_select[0]==14&&(H.table_select[0]=16),F(u,H.table_select[0],5),H.table_select[1]==14&&(H.table_select[1]=16),F(u,H.table_select[1],5),F(u,H.subblock_gain[0],3),F(u,H.subblock_gain[1],3),F(u,H.subblock_gain[2],3)):(F(u,0,1),H.table_select[0]==14&&(H.table_select[0]=16),F(u,H.table_select[0],5),H.table_select[1]==14&&(H.table_select[1]=16),F(u,H.table_select[1],5),H.table_select[2]==14&&(H.table_select[2]=16),F(u,H.table_select[2],5),r(0<=H.region0_count&&H.region0_count<16),r(0<=H.region1_count&&H.region1_count<8),F(u,H.region0_count,4),F(u,H.region1_count,3)),F(u,H.scalefac_scale,1),F(u,H.count1table_select,1)}b.error_protection&&CRC_writeheader(u,u.header[u.h_ptr].buf);{var ee=u.h_ptr;r(u.header[ee].ptr==u.sideinfo_len*8),u.h_ptr=ee+1&h.MAX_HEADER_BUF-1,u.header[u.h_ptr].write_timing=u.header[ee].write_timing+m,u.h_ptr==u.w_ptr&&t.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function l(b,m){var u=v.ht[m.count1table_select+32],A,R=0,J=m.big_values,le=m.big_values;for(r(m.count1table_select<2),A=(m.count1-m.big_values)/4;A>0;--A){var H=0,ee=0,me;me=m.l3_enc[J+0],me!=0&&(ee+=8,m.xr[le+0]<0&&H++),me=m.l3_enc[J+1],me!=0&&(ee+=4,H*=2,m.xr[le+1]<0&&H++),me=m.l3_enc[J+2],me!=0&&(ee+=2,H*=2,m.xr[le+2]<0&&H++),me=m.l3_enc[J+3],me!=0&&(ee++,H*=2,m.xr[le+3]<0&&H++),J+=4,le+=4,P(b,H+u.table[ee],u.hlen[ee]),R+=u.hlen[ee]}return R}function w(b,m,u,A,R){var J=v.ht[m],le=0;if(m==0)return le;for(var H=u;H<A;H+=2){var ee=0,me=0,Te=J.xlen,we=J.xlen,Ne=0,Re=R.l3_enc[H],Ce=R.l3_enc[H+1];if(Re!=0&&(R.xr[H]<0&&Ne++,ee--),m>15){if(Re>14){var Pe=Re-15;r(Pe<=J.linmax),Ne|=Pe<<1,me=Te,Re=15}if(Ce>14){var it=Ce-15;r(it<=J.linmax),Ne<<=Te,Ne|=it,me+=Te,Ce=15}we=16}Ce!=0&&(Ne<<=1,R.xr[H+1]<0&&Ne++,ee--),Re=Re*we+Ce,me-=ee,ee+=J.hlen[Re],P(b,J.table[Re],ee),P(b,Ne,me),le+=ee+me}return le}function $(b,m){var u=3*b.scalefac_band.s[3];u>m.big_values&&(u=m.big_values);var A=w(b,m.table_select[0],0,u,m);return A+=w(b,m.table_select[1],u,m.big_values,m),A}function z(b,m){var u,A,R,J;u=m.big_values;var le=m.region0_count+1;return r(le<b.scalefac_band.l.length),R=b.scalefac_band.l[le],le+=m.region1_count+1,r(le<b.scalefac_band.l.length),J=b.scalefac_band.l[le],R>u&&(R=u),J>u&&(J=u),A=w(b,m.table_select[0],0,R,m),A+=w(b,m.table_select[1],R,J,m),A+=w(b,m.table_select[2],J,u,m),A}function W(b){var m,u,A,R,J=0,le=b.internal_flags,H=le.l3_side;if(b.version==1)for(m=0;m<2;m++)for(u=0;u<le.channels_out;u++){var ee=H.tt[m][u],me=c.slen1_tab[ee.scalefac_compress],Te=c.slen2_tab[ee.scalefac_compress];for(R=0,A=0;A<ee.sfbdivide;A++)ee.scalefac[A]!=-1&&(P(le,ee.scalefac[A],me),R+=me);for(;A<ee.sfbmax;A++)ee.scalefac[A]!=-1&&(P(le,ee.scalefac[A],Te),R+=Te);r(R==ee.part2_length),ee.block_type==x.SHORT_TYPE?R+=$(le,ee):R+=z(le,ee),R+=l(le,ee),r(R==ee.part2_3_length+ee.part2_length),J+=R}else for(m=0,u=0;u<le.channels_out;u++){var ee=H.tt[m][u],we,Ne,Re=0;if(r(ee.sfb_partition_table!=null),R=0,A=0,Ne=0,ee.block_type==x.SHORT_TYPE){for(;Ne<4;Ne++){var Ce=ee.sfb_partition_table[Ne]/3,Pe=ee.slen[Ne];for(we=0;we<Ce;we++,A++)P(le,Math.max(ee.scalefac[A*3+0],0),Pe),P(le,Math.max(ee.scalefac[A*3+1],0),Pe),P(le,Math.max(ee.scalefac[A*3+2],0),Pe),Re+=3*Pe}R+=$(le,ee)}else{for(;Ne<4;Ne++){var Ce=ee.sfb_partition_table[Ne],Pe=ee.slen[Ne];for(we=0;we<Ce;we++,A++)P(le,Math.max(ee.scalefac[A],0),Pe),Re+=Pe}R+=z(le,ee)}R+=l(le,ee),r(R==ee.part2_3_length),r(Re==ee.part2_length),J+=Re+R}return J}function ne(){this.total=0}function B(b,m){var u=b.internal_flags,A,R,J,le,H;return H=u.w_ptr,le=u.h_ptr-1,le==-1&&(le=h.MAX_HEADER_BUF-1),A=u.header[le].write_timing-y,m.total=A,A>=0&&(R=1+le-H,le<H&&(R=1+le-H+h.MAX_HEADER_BUF),A-=R*8*u.sideinfo_len),J=j.getframebits(b),A+=J,m.total+=J,m.total%8!=0?m.total=1+m.total/8:m.total=m.total/8,m.total+=a+1,A<0&&t.err.println(`strange error flushing buffer ... 
`),A}this.flush_bitstream=function(b){var m=b.internal_flags,u,A,R=m.h_ptr-1;if(R==-1&&(R=h.MAX_HEADER_BUF-1),u=m.l3_side,!((A=B(b,new ne))<0)){if(N(b,A),r(m.header[R].write_timing+this.getframebits(b)==y),m.ResvSize=0,u.main_data_begin=0,m.findReplayGain){var J=X.GetTitleGain(m.rgdata);r(NEQ(J,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),m.RadioGain=Math.floor(J*10+.5)|0}m.findPeakSample&&(m.noclipGainChange=Math.ceil(Math.log10(m.PeakSample/32767)*20*10)|0,m.noclipGainChange>0&&(EQ(b.scale,1)||EQ(b.scale,0))?m.noclipScale=Math.floor(32767/m.PeakSample*100)/100:m.noclipScale=-1)}},this.add_dummy_byte=function(b,m,u){for(var A=b.internal_flags,R;u-- >0;)for(G(A,m,8),R=0;R<h.MAX_HEADER_BUF;++R)A.header[R].write_timing+=8},this.format_bitstream=function(b){var m=b.internal_flags,u;u=m.l3_side;var A=this.getframebits(b);N(b,u.resvDrain_pre),k(b,A);var R=8*m.sideinfo_len;if(R+=W(b),N(b,u.resvDrain_post),R+=u.resvDrain_post,u.main_data_begin+=(A-R)/8,B(b,new ne)!=m.ResvSize&&t.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),u.main_data_begin*8!=m.ResvSize&&(t.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*u.main_data_begin,m.ResvSize,u.resvDrain_post,u.resvDrain_pre,8*m.sideinfo_len,R-u.resvDrain_post-8*m.sideinfo_len,R,R%8,A),t.err.println("This is a fatal error.  It has several possible causes:"),t.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),t.err.println(" 9%%  Your system is overclocked"),t.err.println(" 1%%  bug in LAME encoding library"),m.ResvSize=u.main_data_begin*8),y>1e9){var J;for(J=0;J<h.MAX_HEADER_BUF;++J)m.header[J].write_timing-=y;y=0}return 0},this.copy_buffer=function(b,m,u,A,R){var J=a+1;if(J<=0)return 0;if(A!=0&&J>A)return-1;if(t.arraycopy(g,0,m,u,J),a=-1,p=0,R!=0){var le=n(1);if(le[0]=b.nMusicCRC,f.updateMusicCRC(le,m,u,J),b.nMusicCRC=le[0],J>0&&(b.VBR_seek_table.nBytesWritten+=J),b.decode_on_the_fly){for(var H=o([2,1152]),ee=J,me=-1,Te;me!=0;)if(me=Y.hip_decode1_unclipped(b.hip,m,u,ee,H[0],H[1]),ee=0,me==-1&&(me=0),me>0){if(b.findPeakSample){for(Te=0;Te<me;Te++)H[0][Te]>b.PeakSample?b.PeakSample=H[0][Te]:-H[0][Te]>b.PeakSample&&(b.PeakSample=-H[0][Te]);if(b.channels_out>1)for(Te=0;Te<me;Te++)H[1][Te]>b.PeakSample?b.PeakSample=H[1][Te]:-H[1][Te]>b.PeakSample&&(b.PeakSample=-H[1][Te])}if(b.findReplayGain&&X.AnalyzeSamples(b.rgdata,H[0],0,H[1],0,me,b.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return J},this.init_bit_stream_w=function(b){g=i(C.LAME_MAXMP3BUFFER),b.h_ptr=b.w_ptr=0,b.header[b.h_ptr].write_timing=0,a=-1,p=0,y=0}}return Ln=d,Ln}var Pn,Ua;function ia(){if(Ua)return Pn;Ua=1;var e=_t,t=e.System,s=e.VbrMode,i=e.ShortBlock,o=e.new_float,n=e.new_int_n,r=e.new_short_n,c=e.assert,v=zu,x=Qu,h=dn,d=Th,C=Sh,j=Nh,V=aa(),X=na,Y=Rt();function I(){var f=Xs,g=this,y=128*1024;I.V9=410,I.V8=420,I.V7=430,I.V6=440,I.V5=450,I.V4=460,I.V3=470,I.V2=480,I.V1=490,I.V0=500,I.R3MIX=1e3,I.STANDARD=1001,I.EXTREME=1002,I.INSANE=1003,I.STANDARD_FAST=1004,I.EXTREME_FAST=1005,I.MEDIUM=1006,I.MEDIUM_FAST=1007;var a=16384+y;I.LAME_MAXMP3BUFFER=a;var p,M,P,G,N,F=new v,pe,k,l;this.enc=new Y,this.setModules=function(_,T,Ie,ke,Ue,De,Be,Le,Ye){p=_,M=T,P=Ie,G=ke,N=Ue,pe=De,k=Le,l=Ye,this.enc.setModules(M,F,G,pe)};function w(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=o(Y.SBMAX_l),this.bo_s_weight=o(Y.SBMAX_s)}function $(){this.lowerlimit=0}function z(_,T){this.lowpass=T}var W=4294479419;function ne(_){var T;return _.class_id=W,T=_.internal_flags=new h,_.mode=f.NOT_SET,_.original=1,_.in_samplerate=44100,_.num_channels=2,_.num_samples=-1,_.bWriteVbrTag=!0,_.quality=-1,_.short_blocks=null,T.subblock_gain=-1,_.lowpassfreq=0,_.highpassfreq=0,_.lowpasswidth=-1,_.highpasswidth=-1,_.VBR=s.vbr_off,_.VBR_q=4,_.ATHcurve=-1,_.VBR_mean_bitrate_kbps=128,_.VBR_min_bitrate_kbps=0,_.VBR_max_bitrate_kbps=0,_.VBR_hard_min=0,T.VBR_min_bitrate=1,T.VBR_max_bitrate=13,_.quant_comp=-1,_.quant_comp_short=-1,_.msfix=-1,T.resample_ratio=1,T.OldValue[0]=180,T.OldValue[1]=180,T.CurrentStep[0]=4,T.CurrentStep[1]=4,T.masking_lower=1,T.nsPsy.attackthre=-1,T.nsPsy.attackthre_s=-1,_.scale=-1,_.athaa_type=-1,_.ATHtype=-1,_.athaa_loudapprox=-1,_.athaa_sensitivity=0,_.useTemporal=null,_.interChRatio=-1,T.mf_samples_to_encode=Y.ENCDELAY+Y.POSTDELAY,_.encoder_padding=0,T.mf_size=Y.ENCDELAY-Y.MDCTDELAY,_.findReplayGain=!1,_.decode_on_the_fly=!1,T.decode_on_the_fly=!1,T.findReplayGain=!1,T.findPeakSample=!1,T.RadioGain=0,T.AudiophileGain=0,T.noclipGainChange=0,T.noclipScale=-1,_.preset=0,_.write_id3tag_automatic=!0,0}this.lame_init=function(){var _=new x;return ne(_),_.lame_allocated_gfp=1,_};function B(_){return _>1?0:_<=0?1:Math.cos(Math.PI/2*_)}this.nearestBitrateFullIndex=function(_){var T=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],Ie=0,ke=0,Ue=0,De=0;De=T[16],Ue=16,ke=T[16],Ie=16;for(var Be=0;Be<16;Be++)if(Math.max(_,T[Be+1])!=_){De=T[Be+1],Ue=Be+1,ke=T[Be],Ie=Be;break}return De-_>_-ke?Ie:Ue};function b(_,T){var Ie=44100;return T>=48e3?Ie=48e3:T>=44100?Ie=44100:T>=32e3?Ie=32e3:T>=24e3?Ie=24e3:T>=22050?Ie=22050:T>=16e3?Ie=16e3:T>=12e3?Ie=12e3:T>=11025?Ie=11025:T>=8e3&&(Ie=8e3),_==-1?Ie:(_<=15960&&(Ie=44100),_<=15250&&(Ie=32e3),_<=11220&&(Ie=24e3),_<=9970&&(Ie=22050),_<=7230&&(Ie=16e3),_<=5420&&(Ie=12e3),_<=4510&&(Ie=11025),_<=3970&&(Ie=8e3),T<Ie?T>44100?48e3:T>32e3?44100:T>24e3?32e3:T>22050?24e3:T>16e3?22050:T>12e3?16e3:T>11025?12e3:T>8e3?11025:8e3:Ie)}function m(_,T){switch(_){case 44100:return T.version=1,0;case 48e3:return T.version=1,1;case 32e3:return T.version=1,2;case 22050:return T.version=0,0;case 24e3:return T.version=0,1;case 16e3:return T.version=0,2;case 11025:return T.version=0,0;case 12e3:return T.version=0,1;case 8e3:return T.version=0,2;default:return T.version=0,-1}}function u(_,T,Ie){Ie<16e3&&(T=2);for(var ke=X.bitrate_table[T][1],Ue=2;Ue<=14;Ue++)X.bitrate_table[T][Ue]>0&&Math.abs(X.bitrate_table[T][Ue]-_)<Math.abs(ke-_)&&(ke=X.bitrate_table[T][Ue]);return ke}function A(_,T,Ie){Ie<16e3&&(T=2);for(var ke=0;ke<=14;ke++)if(X.bitrate_table[T][ke]>0&&X.bitrate_table[T][ke]==_)return ke;return-1}function R(_,T){var Ie=[new z(8,2e3),new z(16,3700),new z(24,3900),new z(32,5500),new z(40,7e3),new z(48,7500),new z(56,1e4),new z(64,11e3),new z(80,13500),new z(96,15100),new z(112,15600),new z(128,17e3),new z(160,17500),new z(192,18600),new z(224,19400),new z(256,19700),new z(320,20500)],ke=g.nearestBitrateFullIndex(T);_.lowerlimit=Ie[ke].lowpass}function J(_){var T=_.internal_flags,Ie=32,ke=-1;if(T.lowpass1>0){for(var Ue=999,De=0;De<=31;De++){var Be=De/31;Be>=T.lowpass2&&(Ie=Math.min(Ie,De)),T.lowpass1<Be&&Be<T.lowpass2&&(Ue=Math.min(Ue,De))}Ue==999?T.lowpass1=(Ie-.75)/31:T.lowpass1=(Ue-.75)/31,T.lowpass2=Ie/31}if(T.highpass2>0&&T.highpass2<.9*(.75/31)&&(T.highpass1=0,T.highpass2=0,t.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),T.highpass2>0){for(var Le=-1,De=0;De<=31;De++){var Be=De/31;Be<=T.highpass1&&(ke=Math.max(ke,De)),T.highpass1<Be&&Be<T.highpass2&&(Le=Math.max(Le,De))}T.highpass1=ke/31,Le==-1?T.highpass2=(ke+.75)/31:T.highpass2=(Le+.75)/31}for(var De=0;De<32;De++){var Ye,Fe,Be=De/31;T.highpass2>T.highpass1?Ye=B((T.highpass2-Be)/(T.highpass2-T.highpass1+1e-20)):Ye=1,T.lowpass2>T.lowpass1?Fe=B((Be-T.lowpass1)/(T.lowpass2-T.lowpass1+1e-20)):Fe=1,T.amp_filter[De]=Ye*Fe}}function le(_){var T=_.internal_flags;switch(_.quality){default:case 9:T.psymodel=0,T.noise_shaping=0,T.noise_shaping_amp=0,T.noise_shaping_stop=0,T.use_best_huffman=0,T.full_outer_loop=0;break;case 8:_.quality=7;case 7:T.psymodel=1,T.noise_shaping=0,T.noise_shaping_amp=0,T.noise_shaping_stop=0,T.use_best_huffman=0,T.full_outer_loop=0;break;case 6:T.psymodel=1,T.noise_shaping==0&&(T.noise_shaping=1),T.noise_shaping_amp=0,T.noise_shaping_stop=0,T.subblock_gain==-1&&(T.subblock_gain=1),T.use_best_huffman=0,T.full_outer_loop=0;break;case 5:T.psymodel=1,T.noise_shaping==0&&(T.noise_shaping=1),T.noise_shaping_amp=0,T.noise_shaping_stop=0,T.subblock_gain==-1&&(T.subblock_gain=1),T.use_best_huffman=0,T.full_outer_loop=0;break;case 4:T.psymodel=1,T.noise_shaping==0&&(T.noise_shaping=1),T.noise_shaping_amp=0,T.noise_shaping_stop=0,T.subblock_gain==-1&&(T.subblock_gain=1),T.use_best_huffman=1,T.full_outer_loop=0;break;case 3:T.psymodel=1,T.noise_shaping==0&&(T.noise_shaping=1),T.noise_shaping_amp=1,T.noise_shaping_stop=1,T.subblock_gain==-1&&(T.subblock_gain=1),T.use_best_huffman=1,T.full_outer_loop=0;break;case 2:T.psymodel=1,T.noise_shaping==0&&(T.noise_shaping=1),T.substep_shaping==0&&(T.substep_shaping=2),T.noise_shaping_amp=1,T.noise_shaping_stop=1,T.subblock_gain==-1&&(T.subblock_gain=1),T.use_best_huffman=1,T.full_outer_loop=0;break;case 1:T.psymodel=1,T.noise_shaping==0&&(T.noise_shaping=1),T.substep_shaping==0&&(T.substep_shaping=2),T.noise_shaping_amp=2,T.noise_shaping_stop=1,T.subblock_gain==-1&&(T.subblock_gain=1),T.use_best_huffman=1,T.full_outer_loop=0;break;case 0:T.psymodel=1,T.noise_shaping==0&&(T.noise_shaping=1),T.substep_shaping==0&&(T.substep_shaping=2),T.noise_shaping_amp=2,T.noise_shaping_stop=1,T.subblock_gain==-1&&(T.subblock_gain=1),T.use_best_huffman=1,T.full_outer_loop=0;break}}function H(_){var T=_.internal_flags;_.frameNum=0,_.write_id3tag_automatic&&k.id3tag_write_v2(_),T.bitrate_stereoMode_Hist=n([16,5]),T.bitrate_blockType_Hist=n([16,6]),T.PeakSample=0,_.bWriteVbrTag&&pe.InitVbrTag(_)}this.lame_init_params=function(_){var T=_.internal_flags;if(T.Class_ID=0,T.ATH==null&&(T.ATH=new d),T.PSY==null&&(T.PSY=new w),T.rgdata==null&&(T.rgdata=new C),T.channels_in=_.num_channels,T.channels_in==1&&(_.mode=f.MONO),T.channels_out=_.mode==f.MONO?1:2,T.mode_ext=Y.MPG_MD_MS_LR,_.mode==f.MONO&&(_.force_ms=!1),_.VBR==s.vbr_off&&_.VBR_mean_bitrate_kbps!=128&&_.brate==0&&(_.brate=_.VBR_mean_bitrate_kbps),_.VBR==s.vbr_off||_.VBR==s.vbr_mtrh||_.VBR==s.vbr_mt||(_.free_format=!1),_.VBR==s.vbr_off&&_.brate==0&&V.EQ(_.compression_ratio,0)&&(_.compression_ratio=11.025),_.VBR==s.vbr_off&&_.compression_ratio>0&&(_.out_samplerate==0&&(_.out_samplerate=map2MP3Frequency(int(.97*_.in_samplerate))),_.brate=0|_.out_samplerate*16*T.channels_out/(1e3*_.compression_ratio),T.samplerate_index=m(_.out_samplerate,_),_.free_format||(_.brate=u(_.brate,_.version,_.out_samplerate))),_.out_samplerate!=0&&(_.out_samplerate<16e3?(_.VBR_mean_bitrate_kbps=Math.max(_.VBR_mean_bitrate_kbps,8),_.VBR_mean_bitrate_kbps=Math.min(_.VBR_mean_bitrate_kbps,64)):_.out_samplerate<32e3?(_.VBR_mean_bitrate_kbps=Math.max(_.VBR_mean_bitrate_kbps,8),_.VBR_mean_bitrate_kbps=Math.min(_.VBR_mean_bitrate_kbps,160)):(_.VBR_mean_bitrate_kbps=Math.max(_.VBR_mean_bitrate_kbps,32),_.VBR_mean_bitrate_kbps=Math.min(_.VBR_mean_bitrate_kbps,320))),_.lowpassfreq==0){var Ie=16e3;switch(_.VBR){case s.vbr_off:{var ke=new $;R(ke,_.brate),Ie=ke.lowerlimit;break}case s.vbr_abr:{var ke=new $;R(ke,_.VBR_mean_bitrate_kbps),Ie=ke.lowerlimit;break}case s.vbr_rh:{var Ue=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=_.VBR_q&&_.VBR_q<=9){var De=Ue[_.VBR_q],Be=Ue[_.VBR_q+1],Le=_.VBR_q_frac;Ie=linear_int(De,Be,Le)}else Ie=19500;break}default:{var Ue=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=_.VBR_q&&_.VBR_q<=9){var De=Ue[_.VBR_q],Be=Ue[_.VBR_q+1],Le=_.VBR_q_frac;Ie=linear_int(De,Be,Le)}else Ie=19500}}_.mode==f.MONO&&(_.VBR==s.vbr_off||_.VBR==s.vbr_abr)&&(Ie*=1.5),_.lowpassfreq=Ie|0}if(_.out_samplerate==0&&(2*_.lowpassfreq>_.in_samplerate&&(_.lowpassfreq=_.in_samplerate/2),_.out_samplerate=b(_.lowpassfreq|0,_.in_samplerate)),_.lowpassfreq=Math.min(20500,_.lowpassfreq),_.lowpassfreq=Math.min(_.out_samplerate/2,_.lowpassfreq),_.VBR==s.vbr_off&&(_.compression_ratio=_.out_samplerate*16*T.channels_out/(1e3*_.brate)),_.VBR==s.vbr_abr&&(_.compression_ratio=_.out_samplerate*16*T.channels_out/(1e3*_.VBR_mean_bitrate_kbps)),_.bWriteVbrTag||(_.findReplayGain=!1,_.decode_on_the_fly=!1,T.findPeakSample=!1),T.findReplayGain=_.findReplayGain,T.decode_on_the_fly=_.decode_on_the_fly,T.decode_on_the_fly&&(T.findPeakSample=!0),T.findReplayGain&&p.InitGainAnalysis(T.rgdata,_.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return _.internal_flags=null,-6;switch(T.decode_on_the_fly&&!_.decode_only&&(T.hip!=null&&l.hip_decode_exit(T.hip),T.hip=l.hip_decode_init()),T.mode_gr=_.out_samplerate<=24e3?1:2,_.framesize=576*T.mode_gr,_.encoder_delay=Y.ENCDELAY,T.resample_ratio=_.in_samplerate/_.out_samplerate,_.VBR){case s.vbr_mt:case s.vbr_rh:case s.vbr_mtrh:{var Ye=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];_.compression_ratio=Ye[_.VBR_q]}break;case s.vbr_abr:_.compression_ratio=_.out_samplerate*16*T.channels_out/(1e3*_.VBR_mean_bitrate_kbps);break;default:_.compression_ratio=_.out_samplerate*16*T.channels_out/(1e3*_.brate);break}if(_.mode==f.NOT_SET&&(_.mode=f.JOINT_STEREO),_.highpassfreq>0?(T.highpass1=2*_.highpassfreq,_.highpasswidth>=0?T.highpass2=2*(_.highpassfreq+_.highpasswidth):T.highpass2=1*2*_.highpassfreq,T.highpass1/=_.out_samplerate,T.highpass2/=_.out_samplerate):(T.highpass1=0,T.highpass2=0),_.lowpassfreq>0?(T.lowpass2=2*_.lowpassfreq,_.lowpasswidth>=0?(T.lowpass1=2*(_.lowpassfreq-_.lowpasswidth),T.lowpass1<0&&(T.lowpass1=0)):T.lowpass1=1*2*_.lowpassfreq,T.lowpass1/=_.out_samplerate,T.lowpass2/=_.out_samplerate):(T.lowpass1=0,T.lowpass2=0),J(_),T.samplerate_index=m(_.out_samplerate,_),T.samplerate_index<0)return _.internal_flags=null,-1;if(_.VBR==s.vbr_off){if(_.free_format)T.bitrate_index=0;else if(_.brate=u(_.brate,_.version,_.out_samplerate),T.bitrate_index=A(_.brate,_.version,_.out_samplerate),T.bitrate_index<=0)return _.internal_flags=null,-1}else T.bitrate_index=1;_.analysis&&(_.bWriteVbrTag=!1),T.pinfo!=null&&(_.bWriteVbrTag=!1),M.init_bit_stream_w(T);for(var Fe=T.samplerate_index+3*_.version+6*(_.out_samplerate<16e3?1:0),Se=0;Se<Y.SBMAX_l+1;Se++)T.scalefac_band.l[Se]=G.sfBandIndex[Fe].l[Se];for(var Se=0;Se<Y.PSFB21+1;Se++){var nt=(T.scalefac_band.l[22]-T.scalefac_band.l[21])/Y.PSFB21,mt=T.scalefac_band.l[21]+Se*nt;T.scalefac_band.psfb21[Se]=mt}T.scalefac_band.psfb21[Y.PSFB21]=576;for(var Se=0;Se<Y.SBMAX_s+1;Se++)T.scalefac_band.s[Se]=G.sfBandIndex[Fe].s[Se];for(var Se=0;Se<Y.PSFB12+1;Se++){var nt=(T.scalefac_band.s[13]-T.scalefac_band.s[12])/Y.PSFB12,mt=T.scalefac_band.s[12]+Se*nt;T.scalefac_band.psfb12[Se]=mt}T.scalefac_band.psfb12[Y.PSFB12]=192,_.version==1?T.sideinfo_len=T.channels_out==1?21:36:T.sideinfo_len=T.channels_out==1?13:21,_.error_protection&&(T.sideinfo_len+=2),H(_),T.Class_ID=W;{var E;for(E=0;E<19;E++)T.nsPsy.pefirbuf[E]=700*T.mode_gr*T.channels_out;_.ATHtype==-1&&(_.ATHtype=4)}switch(c(_.VBR_q<=9),c(_.VBR_q>=0),_.VBR){case s.vbr_mt:_.VBR=s.vbr_mtrh;case s.vbr_mtrh:{_.useTemporal==null&&(_.useTemporal=!1),P.apply_preset(_,500-_.VBR_q*10,0),_.quality<0&&(_.quality=LAME_DEFAULT_QUALITY),_.quality<5&&(_.quality=0),_.quality>5&&(_.quality=5),T.PSY.mask_adjust=_.maskingadjust,T.PSY.mask_adjust_short=_.maskingadjust_short,_.experimentalY?T.sfb21_extra=!1:T.sfb21_extra=_.out_samplerate>44e3,T.iteration_loop=new VBRNewIterationLoop(N);break}case s.vbr_rh:{P.apply_preset(_,500-_.VBR_q*10,0),T.PSY.mask_adjust=_.maskingadjust,T.PSY.mask_adjust_short=_.maskingadjust_short,_.experimentalY?T.sfb21_extra=!1:T.sfb21_extra=_.out_samplerate>44e3,_.quality>6&&(_.quality=6),_.quality<0&&(_.quality=LAME_DEFAULT_QUALITY),T.iteration_loop=new VBROldIterationLoop(N);break}default:{var S;T.sfb21_extra=!1,_.quality<0&&(_.quality=LAME_DEFAULT_QUALITY),S=_.VBR,S==s.vbr_off&&(_.VBR_mean_bitrate_kbps=_.brate),P.apply_preset(_,_.VBR_mean_bitrate_kbps,0),_.VBR=S,T.PSY.mask_adjust=_.maskingadjust,T.PSY.mask_adjust_short=_.maskingadjust_short,S==s.vbr_off?T.iteration_loop=new j(N):T.iteration_loop=new ABRIterationLoop(N);break}}if(c(_.scale>=0),_.VBR!=s.vbr_off){if(T.VBR_min_bitrate=1,T.VBR_max_bitrate=14,_.out_samplerate<16e3&&(T.VBR_max_bitrate=8),_.VBR_min_bitrate_kbps!=0&&(_.VBR_min_bitrate_kbps=u(_.VBR_min_bitrate_kbps,_.version,_.out_samplerate),T.VBR_min_bitrate=A(_.VBR_min_bitrate_kbps,_.version,_.out_samplerate),T.VBR_min_bitrate<0)||_.VBR_max_bitrate_kbps!=0&&(_.VBR_max_bitrate_kbps=u(_.VBR_max_bitrate_kbps,_.version,_.out_samplerate),T.VBR_max_bitrate=A(_.VBR_max_bitrate_kbps,_.version,_.out_samplerate),T.VBR_max_bitrate<0))return-1;_.VBR_min_bitrate_kbps=X.bitrate_table[_.version][T.VBR_min_bitrate],_.VBR_max_bitrate_kbps=X.bitrate_table[_.version][T.VBR_max_bitrate],_.VBR_mean_bitrate_kbps=Math.min(X.bitrate_table[_.version][T.VBR_max_bitrate],_.VBR_mean_bitrate_kbps),_.VBR_mean_bitrate_kbps=Math.max(X.bitrate_table[_.version][T.VBR_min_bitrate],_.VBR_mean_bitrate_kbps)}return _.tune&&(T.PSY.mask_adjust+=_.tune_value_a,T.PSY.mask_adjust_short+=_.tune_value_a),le(_),c(_.scale>=0),_.athaa_type<0?T.ATH.useAdjust=3:T.ATH.useAdjust=_.athaa_type,T.ATH.aaSensitivityP=Math.pow(10,_.athaa_sensitivity/-10),_.short_blocks==null&&(_.short_blocks=i.short_block_allowed),_.short_blocks==i.short_block_allowed&&(_.mode==f.JOINT_STEREO||_.mode==f.STEREO)&&(_.short_blocks=i.short_block_coupled),_.quant_comp<0&&(_.quant_comp=1),_.quant_comp_short<0&&(_.quant_comp_short=0),_.msfix<0&&(_.msfix=0),_.exp_nspsytune=_.exp_nspsytune|1,_.internal_flags.nsPsy.attackthre<0&&(_.internal_flags.nsPsy.attackthre=v.NSATTACKTHRE),_.internal_flags.nsPsy.attackthre_s<0&&(_.internal_flags.nsPsy.attackthre_s=v.NSATTACKTHRE_S),c(_.scale>=0),_.scale<0&&(_.scale=1),_.ATHtype<0&&(_.ATHtype=4),_.ATHcurve<0&&(_.ATHcurve=4),_.athaa_loudapprox<0&&(_.athaa_loudapprox=2),_.interChRatio<0&&(_.interChRatio=0),_.useTemporal==null&&(_.useTemporal=!0),T.slot_lag=T.frac_SpF=0,_.VBR==s.vbr_off&&(T.slot_lag=T.frac_SpF=(_.version+1)*72e3*_.brate%_.out_samplerate|0),G.iteration_init(_),F.psymodel_init(_),c(_.scale>=0),0};function ee(_,T){(_.in_buffer_0==null||_.in_buffer_nsamples<T)&&(_.in_buffer_0=o(T),_.in_buffer_1=o(T),_.in_buffer_nsamples=T)}this.lame_encode_flush=function(_,T,Ie,ke){var Ue=_.internal_flags,De=r([2,1152]),Be=0,Le,Ye,Fe,Se,nt=Ue.mf_samples_to_encode-Y.POSTDELAY,mt=me(_);if(Ue.mf_samples_to_encode<1)return 0;for(Le=0,_.in_samplerate!=_.out_samplerate&&(nt+=16*_.out_samplerate/_.in_samplerate),Fe=_.framesize-nt%_.framesize,Fe<576&&(Fe+=_.framesize),_.encoder_padding=Fe,Se=(nt+Fe)/_.framesize;Se>0&&Be>=0;){var E=mt-Ue.mf_size,S=_.frameNum;E*=_.in_samplerate,E/=_.out_samplerate,E>1152&&(E=1152),E<1&&(E=1),Ye=ke-Le,ke==0&&(Ye=0),Be=this.lame_encode_buffer(_,De[0],De[1],E,T,Ie,Ye),Ie+=Be,Le+=Be,Se-=S!=_.frameNum?1:0}if(Ue.mf_samples_to_encode=0,Be<0||(Ye=ke-Le,ke==0&&(Ye=0),M.flush_bitstream(_),Be=M.copy_buffer(Ue,T,Ie,Ye,1),Be<0))return Be;if(Ie+=Be,Le+=Be,Ye=ke-Le,ke==0&&(Ye=0),_.write_id3tag_automatic){if(k.id3tag_write_v1(_),Be=M.copy_buffer(Ue,T,Ie,Ye,0),Be<0)return Be;Le+=Be}return Le},this.lame_encode_buffer=function(_,T,Ie,ke,Ue,De,Be){var Le=_.internal_flags,Ye=[null,null];if(Le.Class_ID!=W)return-3;if(ke==0)return 0;ee(Le,ke),Ye[0]=Le.in_buffer_0,Ye[1]=Le.in_buffer_1;for(var Fe=0;Fe<ke;Fe++)Ye[0][Fe]=T[Fe],Le.channels_in>1&&(Ye[1][Fe]=Ie[Fe]);return Te(_,Ye[0],Ye[1],ke,Ue,De,Be)};function me(_){var T=Y.BLKSIZE+_.framesize-Y.FFTOFFSET;return T=Math.max(T,512+_.framesize-32),T}function Te(_,T,Ie,ke,Ue,De,Be){var Le=_.internal_flags,Ye=0,Fe,Se,nt,mt,E,S=[null,null],D=[null,null];if(Le.Class_ID!=W)return-3;if(ke==0)return 0;if(E=M.copy_buffer(Le,Ue,De,Be,0),E<0)return E;if(De+=E,Ye+=E,D[0]=T,D[1]=Ie,V.NEQ(_.scale,0)&&V.NEQ(_.scale,1))for(Se=0;Se<ke;++Se)D[0][Se]*=_.scale,Le.channels_out==2&&(D[1][Se]*=_.scale);if(V.NEQ(_.scale_left,0)&&V.NEQ(_.scale_left,1))for(Se=0;Se<ke;++Se)D[0][Se]*=_.scale_left;if(V.NEQ(_.scale_right,0)&&V.NEQ(_.scale_right,1))for(Se=0;Se<ke;++Se)D[1][Se]*=_.scale_right;if(_.num_channels==2&&Le.channels_out==1)for(Se=0;Se<ke;++Se)D[0][Se]=.5*(D[0][Se]+D[1][Se]),D[1][Se]=0;mt=me(_),S[0]=Le.mfbuf[0],S[1]=Le.mfbuf[1];for(var U=0;ke>0;){var Q=[null,null],L=0,Z=0;Q[0]=D[0],Q[1]=D[1];var te=new Ne;if(Vt(_,S,Q,U,ke,te),L=te.n_in,Z=te.n_out,Le.findReplayGain&&!Le.decode_on_the_fly&&p.AnalyzeSamples(Le.rgdata,S[0],Le.mf_size,S[1],Le.mf_size,Z,Le.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(ke-=L,U+=L,Le.channels_out==2,Le.mf_size+=Z,c(Le.mf_size<=h.MFSIZE),Le.mf_samples_to_encode<1&&(Le.mf_samples_to_encode=Y.ENCDELAY+Y.POSTDELAY),Le.mf_samples_to_encode+=Z,Le.mf_size>=mt){var K=Be-Ye;if(Be==0&&(K=0),Fe=we(_,S[0],S[1],Ue,De,K),Fe<0)return Fe;for(De+=Fe,Ye+=Fe,Le.mf_size-=_.framesize,Le.mf_samples_to_encode-=_.framesize,nt=0;nt<Le.channels_out;nt++)for(Se=0;Se<Le.mf_size;Se++)S[nt][Se]=S[nt][Se+_.framesize]}}return Ye}function we(_,T,Ie,ke,Ue,De){var Be=g.enc.lame_encode_mp3_frame(_,T,Ie,ke,Ue,De);return _.frameNum++,Be}function Ne(){this.n_in=0,this.n_out=0}function Re(){this.num_used=0}function Ce(_,T){return T!=0?Ce(T,_%T):_}function Pe(_,T,Ie){var ke=Math.PI*T;_/=Ie,_<0&&(_=0),_>1&&(_=1);var Ue=_-.5,De=.42-.5*Math.cos(2*_*Math.PI)+.08*Math.cos(4*_*Math.PI);return Math.abs(Ue)<1e-9?ke/Math.PI:De*Math.sin(Ie*ke*Ue)/(Math.PI*Ie*Ue)}function it(_,T,Ie,ke,Ue,De,Be,Le,Ye){var Fe=_.internal_flags,Se,nt=0,mt,E=_.out_samplerate/Ce(_.out_samplerate,_.in_samplerate);E>h.BPC&&(E=h.BPC);var S=Math.abs(Fe.resample_ratio-Math.floor(.5+Fe.resample_ratio))<1e-4?1:0,D=1/Fe.resample_ratio;D>1&&(D=1);var U=31;U%2==0&&--U,U+=S;var Q=U+1;if(Fe.fill_buffer_resample_init==0){for(Fe.inbuf_old[0]=o(Q),Fe.inbuf_old[1]=o(Q),Se=0;Se<=2*E;++Se)Fe.blackfilt[Se]=o(Q);for(Fe.itime[0]=0,Fe.itime[1]=0,nt=0;nt<=2*E;nt++){var L=0,Z=(nt-E)/(2*E);for(Se=0;Se<=U;Se++)L+=Fe.blackfilt[nt][Se]=Pe(Se-Z,D,U);for(Se=0;Se<=U;Se++)Fe.blackfilt[nt][Se]/=L}Fe.fill_buffer_resample_init=1}var te=Fe.inbuf_old[Ye];for(mt=0;mt<ke;mt++){var K,de;if(K=mt*Fe.resample_ratio,nt=0|Math.floor(K-Fe.itime[Ye]),U+nt-U/2>=Be)break;var Z=K-Fe.itime[Ye]-(nt+.5*(U%2));de=0|Math.floor(Z*2*E+E+.5);var ie=0;for(Se=0;Se<=U;++Se){var ce=0|Se+nt-U/2,Ee;Ee=ce<0?te[Q+ce]:Ue[De+ce],ie+=Ee*Fe.blackfilt[de][Se]}T[Ie+mt]=ie}if(Le.num_used=Math.min(Be,U+nt-U/2),Fe.itime[Ye]+=Le.num_used-mt*Fe.resample_ratio,Le.num_used>=Q)for(Se=0;Se<Q;Se++)te[Se]=Ue[De+Le.num_used+Se-Q];else{var Ge=Q-Le.num_used;for(Se=0;Se<Ge;++Se)te[Se]=te[Se+Le.num_used];for(nt=0;Se<Q;++Se,++nt)te[Se]=Ue[De+nt];c(nt==Le.num_used)}return mt}function Vt(_,T,Ie,ke,Ue,De){var Be=_.internal_flags;if(Be.resample_ratio<.9999||Be.resample_ratio>1.0001)for(var Le=0;Le<Be.channels_out;Le++){var Ye=new Re;De.n_out=it(_,T[Le],Be.mf_size,_.framesize,Ie[Le],ke,Ue,Ye,Le),De.n_in=Ye.num_used}else{De.n_out=Math.min(_.framesize,Ue),De.n_in=De.n_out;for(var Fe=0;Fe<De.n_out;++Fe)T[0][Be.mf_size+Fe]=Ie[0][ke+Fe],Be.channels_out==2&&(T[1][Be.mf_size+Fe]=Ie[1][ke+Fe])}}}return Pn=I,Pn}var Oh=_t,qt=Oh.VbrMode;function kh(){var e=ia();function t(h,d,C,j,V,X,Y,I,f,g,y,a,p,M,P){this.vbr_q=h,this.quant_comp=d,this.quant_comp_s=C,this.expY=j,this.st_lrm=V,this.st_s=X,this.masking_adj=Y,this.masking_adj_short=I,this.ath_lower=f,this.ath_curve=g,this.ath_sensitivity=y,this.interch=a,this.safejoint=p,this.sfb21mod=M,this.msfix=P}function s(h,d,C,j,V,X,Y,I,f,g,y,a,p,M){this.quant_comp=d,this.quant_comp_s=C,this.safejoint=j,this.nsmsfix=V,this.st_lrm=X,this.st_s=Y,this.nsbass=I,this.scale=f,this.masking_adj=g,this.ath_lower=y,this.ath_curve=a,this.interch=p,this.sfscale=M}var i;this.setModules=function(h){i=h};var o=[new t(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new t(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new t(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new t(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new t(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new t(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new t(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new t(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new t(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new t(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new t(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],n=[new t(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new t(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new t(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new t(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new t(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new t(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new t(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new t(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new t(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new t(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new t(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function r(h,d,C){var j=h.VBR==qt.vbr_rh?o:n,V=h.VBR_q_frac,X=j[d],Y=j[d+1],I=X;X.st_lrm=X.st_lrm+V*(Y.st_lrm-X.st_lrm),X.st_s=X.st_s+V*(Y.st_s-X.st_s),X.masking_adj=X.masking_adj+V*(Y.masking_adj-X.masking_adj),X.masking_adj_short=X.masking_adj_short+V*(Y.masking_adj_short-X.masking_adj_short),X.ath_lower=X.ath_lower+V*(Y.ath_lower-X.ath_lower),X.ath_curve=X.ath_curve+V*(Y.ath_curve-X.ath_curve),X.ath_sensitivity=X.ath_sensitivity+V*(Y.ath_sensitivity-X.ath_sensitivity),X.interch=X.interch+V*(Y.interch-X.interch),X.msfix=X.msfix+V*(Y.msfix-X.msfix),x(h,I.vbr_q),C!=0?h.quant_comp=I.quant_comp:Math.abs(h.quant_comp- -1)>0||(h.quant_comp=I.quant_comp),C!=0?h.quant_comp_short=I.quant_comp_s:Math.abs(h.quant_comp_short- -1)>0||(h.quant_comp_short=I.quant_comp_s),I.expY!=0&&(h.experimentalY=I.expY!=0),C!=0?h.internal_flags.nsPsy.attackthre=I.st_lrm:Math.abs(h.internal_flags.nsPsy.attackthre- -1)>0||(h.internal_flags.nsPsy.attackthre=I.st_lrm),C!=0?h.internal_flags.nsPsy.attackthre_s=I.st_s:Math.abs(h.internal_flags.nsPsy.attackthre_s- -1)>0||(h.internal_flags.nsPsy.attackthre_s=I.st_s),C!=0?h.maskingadjust=I.masking_adj:Math.abs(h.maskingadjust-0)>0||(h.maskingadjust=I.masking_adj),C!=0?h.maskingadjust_short=I.masking_adj_short:Math.abs(h.maskingadjust_short-0)>0||(h.maskingadjust_short=I.masking_adj_short),C!=0?h.ATHlower=-I.ath_lower/10:Math.abs(-h.ATHlower*10-0)>0||(h.ATHlower=-I.ath_lower/10),C!=0?h.ATHcurve=I.ath_curve:Math.abs(h.ATHcurve- -1)>0||(h.ATHcurve=I.ath_curve),C!=0?h.athaa_sensitivity=I.ath_sensitivity:Math.abs(h.athaa_sensitivity- -1)>0||(h.athaa_sensitivity=I.ath_sensitivity),I.interch>0&&(C!=0?h.interChRatio=I.interch:Math.abs(h.interChRatio- -1)>0||(h.interChRatio=I.interch)),I.safejoint>0&&(h.exp_nspsytune=h.exp_nspsytune|I.safejoint),I.sfb21mod>0&&(h.exp_nspsytune=h.exp_nspsytune|I.sfb21mod<<20),C!=0?h.msfix=I.msfix:Math.abs(h.msfix- -1)>0||(h.msfix=I.msfix),C==0&&(h.VBR_q=d,h.VBR_q_frac=V)}var c=[new s(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new s(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new s(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new s(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new s(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new s(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new s(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new s(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new s(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new s(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new s(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new s(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new s(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new s(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new s(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new s(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new s(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function v(h,d,C){var j=d,V=i.nearestBitrateFullIndex(d);if(h.VBR=qt.vbr_abr,h.VBR_mean_bitrate_kbps=j,h.VBR_mean_bitrate_kbps=Math.min(h.VBR_mean_bitrate_kbps,320),h.VBR_mean_bitrate_kbps=Math.max(h.VBR_mean_bitrate_kbps,8),h.brate=h.VBR_mean_bitrate_kbps,h.VBR_mean_bitrate_kbps>320&&(h.disable_reservoir=!0),c[V].safejoint>0&&(h.exp_nspsytune=h.exp_nspsytune|2),c[V].sfscale>0&&(h.internal_flags.noise_shaping=2),Math.abs(c[V].nsbass)>0){var X=int(c[V].nsbass*4);X<0&&(X+=64),h.exp_nspsytune=h.exp_nspsytune|X<<2}return C!=0?h.quant_comp=c[V].quant_comp:Math.abs(h.quant_comp- -1)>0||(h.quant_comp=c[V].quant_comp),C!=0?h.quant_comp_short=c[V].quant_comp_s:Math.abs(h.quant_comp_short- -1)>0||(h.quant_comp_short=c[V].quant_comp_s),C!=0?h.msfix=c[V].nsmsfix:Math.abs(h.msfix- -1)>0||(h.msfix=c[V].nsmsfix),C!=0?h.internal_flags.nsPsy.attackthre=c[V].st_lrm:Math.abs(h.internal_flags.nsPsy.attackthre- -1)>0||(h.internal_flags.nsPsy.attackthre=c[V].st_lrm),C!=0?h.internal_flags.nsPsy.attackthre_s=c[V].st_s:Math.abs(h.internal_flags.nsPsy.attackthre_s- -1)>0||(h.internal_flags.nsPsy.attackthre_s=c[V].st_s),C!=0?h.scale=c[V].scale:Math.abs(h.scale- -1)>0||(h.scale=c[V].scale),C!=0?h.maskingadjust=c[V].masking_adj:Math.abs(h.maskingadjust-0)>0||(h.maskingadjust=c[V].masking_adj),c[V].masking_adj>0?C!=0?h.maskingadjust_short=c[V].masking_adj*.9:Math.abs(h.maskingadjust_short-0)>0||(h.maskingadjust_short=c[V].masking_adj*.9):C!=0?h.maskingadjust_short=c[V].masking_adj*1.1:Math.abs(h.maskingadjust_short-0)>0||(h.maskingadjust_short=c[V].masking_adj*1.1),C!=0?h.ATHlower=-c[V].ath_lower/10:Math.abs(-h.ATHlower*10-0)>0||(h.ATHlower=-c[V].ath_lower/10),C!=0?h.ATHcurve=c[V].ath_curve:Math.abs(h.ATHcurve- -1)>0||(h.ATHcurve=c[V].ath_curve),C!=0?h.interChRatio=c[V].interch:Math.abs(h.interChRatio- -1)>0||(h.interChRatio=c[V].interch),d}this.apply_preset=function(h,d,C){switch(d){case e.R3MIX:{d=e.V3,h.VBR=qt.vbr_mtrh;break}case e.MEDIUM:{d=e.V4,h.VBR=qt.vbr_rh;break}case e.MEDIUM_FAST:{d=e.V4,h.VBR=qt.vbr_mtrh;break}case e.STANDARD:{d=e.V2,h.VBR=qt.vbr_rh;break}case e.STANDARD_FAST:{d=e.V2,h.VBR=qt.vbr_mtrh;break}case e.EXTREME:{d=e.V0,h.VBR=qt.vbr_rh;break}case e.EXTREME_FAST:{d=e.V0,h.VBR=qt.vbr_mtrh;break}case e.INSANE:return d=320,h.preset=d,v(h,d,C),h.VBR=qt.vbr_off,d}switch(h.preset=d,d){case e.V9:return r(h,9,C),d;case e.V8:return r(h,8,C),d;case e.V7:return r(h,7,C),d;case e.V6:return r(h,6,C),d;case e.V5:return r(h,5,C),d;case e.V4:return r(h,4,C),d;case e.V3:return r(h,3,C),d;case e.V2:return r(h,2,C),d;case e.V1:return r(h,1,C),d;case e.V0:return r(h,0,C),d}return 8<=d&&d<=320?v(h,d,C):(h.preset=0,d)};function x(h,d){var C=0;return 0>d&&(C=-1,d=0),9<d&&(C=-1,d=9),h.VBR_q=d,h.VBR_q_frac=0,C}}var xh=kh;function Lh(){this.setModules=function(e,t){}}var Ph=Lh;function Bh(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Dh=Bh,Wi=_t,Wa=Wi.new_float,Vh=Wi.new_int;function Gh(){this.global_gain=0,this.sfb_count1=0,this.step=Vh(39),this.noise=Wa(39),this.noise_log=Wa(39)}var Fh=Gh,Ms=_t,ss=Ms.System,ja=Ms.VbrMode,Bn=Ms.Util,As=Ms.Arrays,Bs=Ms.new_float,Ds=Ms.assert,$h=Ph,Dn=Dh,Hh=Fh,tt=Rt(),Ya=ea,Xa=cn;function Uh(){var e;this.rv=null;var t;this.qupvt=null;var s,i=new $h,o;this.setModules=function(I,f,g,y){e=I,t=f,this.rv=f,s=g,this.qupvt=g,o=y,i.setModules(s,o)},this.ms_convert=function(I,f){for(var g=0;g<576;++g){var y=I.tt[f][0].xr[g],a=I.tt[f][1].xr[g];I.tt[f][0].xr[g]=(y+a)*(Bn.SQRT2*.5),I.tt[f][1].xr[g]=(y-a)*(Bn.SQRT2*.5)}};function n(I,f,g,y){y=0;for(var a=0;a<=g;++a){var p=Math.abs(I.xr[a]);y+=p,f[a]=Math.sqrt(p*Math.sqrt(p)),f[a]>I.xrpow_max&&(I.xrpow_max=f[a])}return y}this.init_xrpow=function(I,f,g){var y=0,a=0|f.max_nonzero_coeff;if(f.xrpow_max=0,As.fill(g,a,576,0),y=n(f,g,a,y),y>1e-20){var p=0;I.substep_shaping&2&&(p=1);for(var M=0;M<f.psymax;M++)I.pseudohalf[M]=p;return!0}return As.fill(f.l3_enc,0,576,0),!1};function r(I,f){var g=I.ATH,y=f.xr;if(f.block_type!=tt.SHORT_TYPE)for(var a=!1,p=tt.PSFB21-1;p>=0&&!a;p--){var M=I.scalefac_band.psfb21[p],P=I.scalefac_band.psfb21[p+1],G=s.athAdjust(g.adjust,g.psfb21[p],g.floor);I.nsPsy.longfact[21]>1e-12&&(G*=I.nsPsy.longfact[21]);for(var N=P-1;N>=M;N--)if(Math.abs(y[N])<G)y[N]=0;else{a=!0;break}}else for(var F=0;F<3;F++)for(var a=!1,p=tt.PSFB12-1;p>=0&&!a;p--){var M=I.scalefac_band.s[12]*3+(I.scalefac_band.s[13]-I.scalefac_band.s[12])*F+(I.scalefac_band.psfb12[p]-I.scalefac_band.psfb12[0]),P=M+(I.scalefac_band.psfb12[p+1]-I.scalefac_band.psfb12[p]),pe=s.athAdjust(g.adjust,g.psfb12[p],g.floor);I.nsPsy.shortfact[12]>1e-12&&(pe*=I.nsPsy.shortfact[12]);for(var N=P-1;N>=M;N--)if(Math.abs(y[N])<pe)y[N]=0;else{a=!0;break}}}this.init_outer_loop=function(I,f){f.part2_3_length=0,f.big_values=0,f.count1=0,f.global_gain=210,f.scalefac_compress=0,f.table_select[0]=0,f.table_select[1]=0,f.table_select[2]=0,f.subblock_gain[0]=0,f.subblock_gain[1]=0,f.subblock_gain[2]=0,f.subblock_gain[3]=0,f.region0_count=0,f.region1_count=0,f.preflag=0,f.scalefac_scale=0,f.count1table_select=0,f.part2_length=0,f.sfb_lmax=tt.SBPSY_l,f.sfb_smin=tt.SBPSY_s,f.psy_lmax=I.sfb21_extra?tt.SBMAX_l:tt.SBPSY_l,f.psymax=f.psy_lmax,f.sfbmax=f.sfb_lmax,f.sfbdivide=11;for(var g=0;g<tt.SBMAX_l;g++)f.width[g]=I.scalefac_band.l[g+1]-I.scalefac_band.l[g],f.window[g]=3;if(f.block_type==tt.SHORT_TYPE){var y=Bs(576);f.sfb_smin=0,f.sfb_lmax=0,f.mixed_block_flag!=0&&(f.sfb_smin=3,f.sfb_lmax=I.mode_gr*2+4),f.psymax=f.sfb_lmax+3*((I.sfb21_extra?tt.SBMAX_s:tt.SBPSY_s)-f.sfb_smin),f.sfbmax=f.sfb_lmax+3*(tt.SBPSY_s-f.sfb_smin),f.sfbdivide=f.sfbmax-18,f.psy_lmax=f.sfb_lmax;var a=I.scalefac_band.l[f.sfb_lmax];ss.arraycopy(f.xr,0,y,0,576);for(var g=f.sfb_smin;g<tt.SBMAX_s;g++)for(var p=I.scalefac_band.s[g],M=I.scalefac_band.s[g+1],P=0;P<3;P++)for(var G=p;G<M;G++)f.xr[a++]=y[3*G+P];for(var N=f.sfb_lmax,g=f.sfb_smin;g<tt.SBMAX_s;g++)f.width[N]=f.width[N+1]=f.width[N+2]=I.scalefac_band.s[g+1]-I.scalefac_band.s[g],f.window[N]=0,f.window[N+1]=1,f.window[N+2]=2,N+=3}f.count1bits=0,f.sfb_partition_table=s.nr_of_sfb_block[0][0],f.slen[0]=0,f.slen[1]=0,f.slen[2]=0,f.slen[3]=0,f.max_nonzero_coeff=575,As.fill(f.scalefac,0),r(I,f)};function c(I){this.ordinal=I}c.BINSEARCH_NONE=new c(0),c.BINSEARCH_UP=new c(1),c.BINSEARCH_DOWN=new c(2);function v(I,f,g,y,a){var p,M=I.CurrentStep[y],P=!1,G=I.OldValue[y],N=c.BINSEARCH_NONE;for(f.global_gain=G,g-=f.part2_length;;){var F;if(p=o.count_bits(I,a,f,null),M==1||p==g)break;p>g?(N==c.BINSEARCH_DOWN&&(P=!0),P&&(M/=2),N=c.BINSEARCH_UP,F=M):(N==c.BINSEARCH_UP&&(P=!0),P&&(M/=2),N=c.BINSEARCH_DOWN,F=-M),f.global_gain+=F,f.global_gain<0&&(f.global_gain=0,P=!0),f.global_gain>255&&(f.global_gain=255,P=!0)}for(Ds(f.global_gain>=0),Ds(f.global_gain<256);p>g&&f.global_gain<255;)f.global_gain++,p=o.count_bits(I,a,f,null);return I.CurrentStep[y]=G-f.global_gain>=4?4:2,I.OldValue[y]=f.global_gain,f.part2_3_length=p,p}this.trancate_smallspectrums=function(I,f,g,y){var a=Bs(Xa.SFBMAX);if(!(!(I.substep_shaping&4)&&f.block_type==tt.SHORT_TYPE||I.substep_shaping&128)){s.calc_noise(f,g,a,new Dn,null);for(var M=0;M<576;M++){var p=0;f.l3_enc[M]!=0&&(p=Math.abs(f.xr[M])),y[M]=p}var M=0,P=8;f.block_type==tt.SHORT_TYPE&&(P=6);do{var G,N,F,pe,k=f.width[P];if(M+=k,!(a[P]>=1)&&(As.sort(y,M-k,k),!BitStream.EQ(y[M-1],0))){G=(1-a[P])*g[P],N=0,pe=0;do{var l;for(F=1;pe+F<k&&!BitStream.NEQ(y[pe+M-k],y[pe+M+F-k]);F++);if(l=y[pe+M-k]*y[pe+M-k]*F,G<l){pe!=0&&(N=y[pe+M-k-1]);break}G-=l,pe+=F}while(pe<k);if(!BitStream.EQ(N,0))do Math.abs(f.xr[M-k])<=N&&(f.l3_enc[M-k]=0);while(--k>0)}}while(++P<f.psymax);f.part2_3_length=o.noquant_count_bits(I,f,null)}};function x(I){for(var f=0;f<I.sfbmax;f++)if(I.scalefac[f]+I.subblock_gain[I.window[f]]==0)return!1;return!0}function h(I){return Bn.FAST_LOG10(.368+.632*I*I*I)}function d(I,f){for(var g=1e-37,y=0;y<f.psymax;y++)g+=h(I[y]);return Math.max(1e-20,g)}function C(I,f,g,y,a){var p;switch(I){default:case 9:{f.over_count>0?(p=g.over_SSD<=f.over_SSD,g.over_SSD==f.over_SSD&&(p=g.bits<f.bits)):p=g.max_noise<0&&g.max_noise*10+g.bits<=f.max_noise*10+f.bits;break}case 0:p=g.over_count<f.over_count||g.over_count==f.over_count&&g.over_noise<f.over_noise||g.over_count==f.over_count&&BitStream.EQ(g.over_noise,f.over_noise)&&g.tot_noise<f.tot_noise;break;case 8:g.max_noise=d(a,y);case 1:p=g.max_noise<f.max_noise;break;case 2:p=g.tot_noise<f.tot_noise;break;case 3:p=g.tot_noise<f.tot_noise&&g.max_noise<f.max_noise;break;case 4:p=g.max_noise<=0&&f.max_noise>.2||g.max_noise<=0&&f.max_noise<0&&f.max_noise>g.max_noise-.2&&g.tot_noise<f.tot_noise||g.max_noise<=0&&f.max_noise>0&&f.max_noise>g.max_noise-.2&&g.tot_noise<f.tot_noise+f.over_noise||g.max_noise>0&&f.max_noise>-.05&&f.max_noise>g.max_noise-.1&&g.tot_noise+g.over_noise<f.tot_noise+f.over_noise||g.max_noise>0&&f.max_noise>-.1&&f.max_noise>g.max_noise-.15&&g.tot_noise+g.over_noise+g.over_noise<f.tot_noise+f.over_noise+f.over_noise;break;case 5:p=g.over_noise<f.over_noise||BitStream.EQ(g.over_noise,f.over_noise)&&g.tot_noise<f.tot_noise;break;case 6:p=g.over_noise<f.over_noise||BitStream.EQ(g.over_noise,f.over_noise)&&(g.max_noise<f.max_noise||BitStream.EQ(g.max_noise,f.max_noise)&&g.tot_noise<=f.tot_noise);break;case 7:p=g.over_count<f.over_count||g.over_noise<f.over_noise;break}return f.over_count==0&&(p=p&&g.bits<f.bits),p}function j(I,f,g,y,a){var p=I.internal_flags,M;f.scalefac_scale==0?M=1.2968395546510096:M=1.6817928305074292;for(var P=0,G=0;G<f.sfbmax;G++)P<g[G]&&(P=g[G]);var N=p.noise_shaping_amp;switch(N==3&&(a?N=2:N=1),N){case 2:break;case 1:P>1?P=Math.pow(P,.5):P*=.95;break;case 0:default:P>1?P=1:P*=.95;break}for(var F=0,G=0;G<f.sfbmax;G++){var pe=f.width[G],k;if(F+=pe,!(g[G]<P)){if(p.substep_shaping&2&&(p.pseudohalf[G]=p.pseudohalf[G]==0?1:0,p.pseudohalf[G]==0&&p.noise_shaping_amp==2))return;for(f.scalefac[G]++,k=-pe;k<0;k++)y[F+k]*=M,y[F+k]>f.xrpow_max&&(f.xrpow_max=y[F+k]);if(p.noise_shaping_amp==2)return}}}function V(I,f){for(var g=1.2968395546510096,y=0,a=0;a<I.sfbmax;a++){var p=I.width[a],M=I.scalefac[a];if(I.preflag!=0&&(M+=s.pretab[a]),y+=p,M&1){M++;for(var P=-p;P<0;P++)f[y+P]*=g,f[y+P]>I.xrpow_max&&(I.xrpow_max=f[y+P])}I.scalefac[a]=M>>1}I.preflag=0,I.scalefac_scale=1}function X(I,f,g){var y,a=f.scalefac;for(y=0;y<f.sfb_lmax;y++)if(a[y]>=16)return!0;for(var p=0;p<3;p++){var M=0,P=0;for(y=f.sfb_lmax+p;y<f.sfbdivide;y+=3)M<a[y]&&(M=a[y]);for(;y<f.sfbmax;y+=3)P<a[y]&&(P=a[y]);if(!(M<16&&P<8)){if(f.subblock_gain[p]>=7)return!0;f.subblock_gain[p]++;var G=I.scalefac_band.l[f.sfb_lmax];for(y=f.sfb_lmax+p;y<f.sfbmax;y+=3){var N,F=f.width[y],pe=a[y];if(pe=pe-(4>>f.scalefac_scale),pe>=0){a[y]=pe,G+=F*3;continue}a[y]=0;{var k=210+(pe<<f.scalefac_scale+1);N=s.IPOW20(k)}G+=F*(p+1);for(var l=-F;l<0;l++)g[G+l]*=N,g[G+l]>f.xrpow_max&&(f.xrpow_max=g[G+l]);G+=F*(3-p-1)}{var N=s.IPOW20(202);G+=f.width[y]*(p+1);for(var l=-f.width[y];l<0;l++)g[G+l]*=N,g[G+l]>f.xrpow_max&&(f.xrpow_max=g[G+l])}}}return!1}function Y(I,f,g,y,a){var p=I.internal_flags;j(I,f,g,y,a);var M=x(f);return M?!1:(p.mode_gr==2?M=o.scale_bitcount(f):M=o.scale_bitcount_lsf(p,f),M?(p.noise_shaping>1&&(As.fill(p.pseudohalf,0),f.scalefac_scale==0?(V(f,y),M=!1):f.block_type==tt.SHORT_TYPE&&p.subblock_gain>0&&(M=X(p,f,y)||x(f))),M||(p.mode_gr==2?M=o.scale_bitcount(f):M=o.scale_bitcount_lsf(p,f)),!M):!0)}this.outer_loop=function(I,f,g,y,a,p){var M=I.internal_flags,P=new Ya,G=Bs(576),N=Bs(Xa.SFBMAX),F=new Dn,pe,k=new Hh,l=9999999,w=!1,$=!1,z=0;if(v(M,f,p,a,y),M.noise_shaping==0)return 100;s.calc_noise(f,g,N,F,k),F.bits=f.part2_3_length,P.assign(f);var W=0;for(ss.arraycopy(y,0,G,0,576);!w;){do{var ne=new Dn,B,b=255;if(M.substep_shaping&2?B=20:B=3,M.sfb21_extra&&(N[P.sfbmax]>1||P.block_type==tt.SHORT_TYPE&&(N[P.sfbmax+1]>1||N[P.sfbmax+2]>1))||!Y(I,P,N,y,$))break;P.scalefac_scale!=0&&(b=254);var m=p-P.part2_length;if(m<=0)break;for(;(P.part2_3_length=o.count_bits(M,y,P,k))>m&&P.global_gain<=b;)P.global_gain++;if(P.global_gain>b)break;if(F.over_count==0){for(;(P.part2_3_length=o.count_bits(M,y,P,k))>l&&P.global_gain<=b;)P.global_gain++;if(P.global_gain>b)break}if(s.calc_noise(P,g,N,ne,k),ne.bits=P.part2_3_length,f.block_type!=tt.SHORT_TYPE?pe=I.quant_comp:pe=I.quant_comp_short,pe=C(pe,F,ne,P,N)?1:0,pe!=0)l=f.part2_3_length,F=ne,f.assign(P),W=0,ss.arraycopy(y,0,G,0,576);else if(M.full_outer_loop==0&&(++W>B&&F.over_count==0||M.noise_shaping_amp==3&&$&&W>30||M.noise_shaping_amp==3&&$&&P.global_gain-z>15))break}while(P.global_gain+P.scalefac_scale<255);M.noise_shaping_amp==3?$?w=!0:(P.assign(f),ss.arraycopy(G,0,y,0,576),W=0,z=P.global_gain,$=!0):w=!0}return Ds(f.global_gain+f.scalefac_scale<=255),I.VBR==ja.vbr_rh||I.VBR==ja.vbr_mtrh?ss.arraycopy(G,0,y,0,576):M.substep_shaping&1&&trancate_smallspectrums(M,f,g,y),F.over_count},this.iteration_finish_one=function(I,f,g){var y=I.l3_side,a=y.tt[f][g];o.best_scalefac_store(I,f,g,y),I.use_best_huffman==1&&o.best_huffman_divide(I,a),t.ResvAdjust(I,a)},this.VBR_encode_granule=function(I,f,g,y,a,p,M){var P=I.internal_flags,G=new Ya,N=Bs(576),F=M,pe=M+1,k=(M+p)/2,l,w,$=0,z=P.sfb21_extra;Ds(F<=LameInternalFlags.MAX_BITS_PER_CHANNEL),As.fill(G.l3_enc,0);do k>F-42?P.sfb21_extra=!1:P.sfb21_extra=z,w=outer_loop(I,f,g,y,a,k),w<=0?($=1,pe=f.part2_3_length,G.assign(f),ss.arraycopy(y,0,N,0,576),M=pe-32,l=M-p,k=(M+p)/2):(p=k+32,l=M-p,k=(M+p)/2,$!=0&&($=2,f.assign(G),ss.arraycopy(N,0,y,0,576)));while(l>12);P.sfb21_extra=z,$==2&&ss.arraycopy(G.l3_enc,0,f.l3_enc,0,576),Ds(f.part2_3_length<=F)},this.get_framebits=function(I,f){var g=I.internal_flags;g.bitrate_index=g.VBR_min_bitrate;var y=e.getframebits(I);g.bitrate_index=1,y=e.getframebits(I);for(var a=1;a<=g.VBR_max_bitrate;a++){g.bitrate_index=a;var p=new MeanBits(y);f[a]=t.ResvFrameBegin(I,p),y=p.bits}},this.VBR_old_prepare=function(I,f,g,y,a,p,M,P,G){var N=I.internal_flags,F,pe=0,k=1,l=0;N.bitrate_index=N.VBR_max_bitrate;var w=t.ResvFrameBegin(I,new MeanBits(0))/N.mode_gr;get_framebits(I,p);for(var $=0;$<N.mode_gr;$++){var z=s.on_pe(I,f,P[$],w,$,0);N.mode_ext==tt.MPG_MD_MS_LR&&(ms_convert(N.l3_side,$),s.reduce_side(P[$],g[$],w,z));for(var W=0;W<N.channels_out;++W){var ne=N.l3_side.tt[$][W];ne.block_type!=tt.SHORT_TYPE?(pe=1.28/(1+Math.exp(3.5-f[$][W]/300))-.05,F=N.PSY.mask_adjust-pe):(pe=2.56/(1+Math.exp(3.5-f[$][W]/300))-.14,F=N.PSY.mask_adjust_short-pe),N.masking_lower=Math.pow(10,F*.1),init_outer_loop(N,ne),G[$][W]=s.calc_xmin(I,y[$][W],ne,a[$][W]),G[$][W]!=0&&(k=0),M[$][W]=126,l+=P[$][W]}}for(var $=0;$<N.mode_gr;$++)for(var W=0;W<N.channels_out;W++)l>p[N.VBR_max_bitrate]&&(P[$][W]*=p[N.VBR_max_bitrate],P[$][W]/=l),M[$][W]>P[$][W]&&(M[$][W]=P[$][W]);return k},this.bitpressure_strategy=function(I,f,g,y){for(var a=0;a<I.mode_gr;a++)for(var p=0;p<I.channels_out;p++){for(var M=I.l3_side.tt[a][p],P=f[a][p],G=0,N=0;N<M.psy_lmax;N++)P[G++]*=1+.029*N*N/tt.SBMAX_l/tt.SBMAX_l;if(M.block_type==tt.SHORT_TYPE)for(var N=M.sfb_smin;N<tt.SBMAX_s;N++)P[G++]*=1+.029*N*N/tt.SBMAX_s/tt.SBMAX_s,P[G++]*=1+.029*N*N/tt.SBMAX_s/tt.SBMAX_s,P[G++]*=1+.029*N*N/tt.SBMAX_s/tt.SBMAX_s;y[a][p]=0|Math.max(g[a][p],.9*y[a][p])}},this.VBR_new_prepare=function(I,f,g,y,a,p){var M=I.internal_flags,P=1,G=0,N=0,F;if(I.free_format){M.bitrate_index=0;var pe=new MeanBits(G);F=t.ResvFrameBegin(I,pe),G=pe.bits,a[0]=F}else{M.bitrate_index=M.VBR_max_bitrate;var pe=new MeanBits(G);t.ResvFrameBegin(I,pe),G=pe.bits,get_framebits(I,a),F=a[M.VBR_max_bitrate]}for(var k=0;k<M.mode_gr;k++){s.on_pe(I,f,p[k],G,k,0),M.mode_ext==tt.MPG_MD_MS_LR&&ms_convert(M.l3_side,k);for(var l=0;l<M.channels_out;++l){var w=M.l3_side.tt[k][l];M.masking_lower=Math.pow(10,M.PSY.mask_adjust*.1),init_outer_loop(M,w),s.calc_xmin(I,g[k][l],w,y[k][l])!=0&&(P=0),N+=p[k][l]}}for(var k=0;k<M.mode_gr;k++)for(var l=0;l<M.channels_out;l++)N>F&&(p[k][l]*=F,p[k][l]/=N);return P},this.calc_target_bits=function(I,f,g,y,a,p){var M=I.internal_flags,P=M.l3_side,G,N,F,pe,k=0;M.bitrate_index=M.VBR_max_bitrate;var l=new MeanBits(k);for(p[0]=t.ResvFrameBegin(I,l),k=l.bits,M.bitrate_index=1,k=e.getframebits(I)-M.sideinfo_len*8,a[0]=k/(M.mode_gr*M.channels_out),k=I.VBR_mean_bitrate_kbps*I.framesize*1e3,M.substep_shaping&1&&(k*=1.09),k/=I.out_samplerate,k-=M.sideinfo_len*8,k/=M.mode_gr*M.channels_out,G=.93+.07*(11-I.compression_ratio)/(11-5.5),G<.9&&(G=.9),G>1&&(G=1),N=0;N<M.mode_gr;N++){var w=0;for(F=0;F<M.channels_out;F++){if(y[N][F]=int(G*k),f[N][F]>700){var $=int((f[N][F]-700)/1.4),z=P.tt[N][F];y[N][F]=int(G*k),z.block_type==tt.SHORT_TYPE&&$<k/2&&($=k/2),$>k*3/2?$=k*3/2:$<0&&($=0),y[N][F]+=$}y[N][F]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(y[N][F]=LameInternalFlags.MAX_BITS_PER_CHANNEL),w+=y[N][F]}if(w>LameInternalFlags.MAX_BITS_PER_GRANULE)for(F=0;F<M.channels_out;++F)y[N][F]*=LameInternalFlags.MAX_BITS_PER_GRANULE,y[N][F]/=w}if(M.mode_ext==tt.MPG_MD_MS_LR)for(N=0;N<M.mode_gr;N++)s.reduce_side(y[N],g[N],k*M.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(pe=0,N=0;N<M.mode_gr;N++)for(F=0;F<M.channels_out;F++)y[N][F]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(y[N][F]=LameInternalFlags.MAX_BITS_PER_CHANNEL),pe+=y[N][F];if(pe>p[0])for(N=0;N<M.mode_gr;N++)for(F=0;F<M.channels_out;F++)y[N][F]*=p[0],y[N][F]/=pe}}var Wh=Uh,jh=_t,za=jh.assert;function Yh(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,s){var i=t.internal_flags,o,n=i.l3_side,r=e.getframebits(t);s.bits=(r-i.sideinfo_len*8)/i.mode_gr;var c=8*256*i.mode_gr-8;t.brate>320?o=8*int(t.brate*1e3/(t.out_samplerate/1152)/8+.5):(o=8*1440,t.strict_ISO&&(o=8*int(32e4/(t.out_samplerate/1152)/8+.5))),i.ResvMax=o-r,i.ResvMax>c&&(i.ResvMax=c),(i.ResvMax<0||t.disable_reservoir)&&(i.ResvMax=0);var v=s.bits*i.mode_gr+Math.min(i.ResvSize,i.ResvMax);return v>o&&(v=o),za(i.ResvMax%8==0),za(i.ResvMax>=0),n.resvDrain_pre=0,i.pinfo!=null&&(i.pinfo.mean_bits=s.bits/2,i.pinfo.resvsize=i.ResvSize),v},this.ResvMaxBits=function(t,s,i,o){var n=t.internal_flags,r,c=n.ResvSize,v=n.ResvMax;o!=0&&(c+=s),n.substep_shaping&1&&(v*=.9),i.bits=s,c*10>v*9?(r=c-v*9/10,i.bits+=r,n.substep_shaping|=128):(r=0,n.substep_shaping&=127,!t.disable_reservoir&&!(n.substep_shaping&1)&&(i.bits-=.1*s));var x=c<n.ResvMax*6/10?c:n.ResvMax*6/10;return x-=r,x<0&&(x=0),x},this.ResvAdjust=function(t,s){t.ResvSize-=s.part2_3_length+s.part2_length},this.ResvFrameEnd=function(t,s){var i,o=t.l3_side;t.ResvSize+=s*t.mode_gr;var n=0;o.resvDrain_post=0,o.resvDrain_pre=0,(i=t.ResvSize%8)!=0&&(n+=i),i=t.ResvSize-n-t.ResvMax,i>0&&(n+=i);{var r=Math.min(o.main_data_begin*8,n)/8;o.resvDrain_pre+=8*r,n-=8*r,t.ResvSize-=8*r,o.main_data_begin-=r}o.resvDrain_post+=n,t.ResvSize-=n}}var Xh=Yh;function zh(){var e="http://www.mp3dev.org/",t=3,s=98,i=4,o=0,n=93;this.getLameVersion=function(){return t+"."+s+"."+i},this.getLameShortVersion=function(){return t+"."+s+"."+i},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+s+"r"},this.getPsyVersion=function(){return o+"."+n},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var qh=zh,Ns=_t,Kh=Ns.System,Vn=Ns.VbrMode,qa=Ns.ShortBlock,Qh=Ns.Arrays,sn=Ns.new_byte,Zh=Ns.assert;$s.NUMTOCENTRIES=100;$s.MAXFRAMESIZE=2880;function $s(){var e,t,s;this.setModules=function(k,l,w){e=k,t=l,s=w};var i=1,o=2,n=4,r=8,c=$s.NUMTOCENTRIES,v=$s.MAXFRAMESIZE,x=c+4+4+4+4+4,h=x+9+1+1+8+1+1+3+1+1+2+4+2+2,d=128,C=64,j=32,V=null,X="Xing",Y="Info",I=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function f(k,l){if(k.nVbrNumFrames++,k.sum+=l,k.seen++,!(k.seen<k.want)&&(k.pos<k.size&&(k.bag[k.pos]=k.sum,k.pos++,k.seen=0),k.pos==k.size)){for(var w=1;w<k.size;w+=2)k.bag[w/2]=k.bag[w];k.want*=2,k.pos/=2}}function g(k,l){if(!(k.pos<=0))for(var w=1;w<c;++w){var $=w/c,z,W,ne=0|Math.floor($*k.pos);ne>k.pos-1&&(ne=k.pos-1),z=k.bag[ne],W=k.sum;var B=0|256*z/W;B>255&&(B=255),l[w]=255&B}}this.addVbrFrame=function(k){var l=k.internal_flags,w=Tables.bitrate_table[k.version][l.bitrate_index];Zh(l.VBR_seek_table.bag!=null),f(l.VBR_seek_table,w)};function y(k,l){var w=k[l+0]&255;return w<<=8,w|=k[l+1]&255,w<<=8,w|=k[l+2]&255,w<<=8,w|=k[l+3]&255,w}function a(k,l,w){k[l+0]=255&(w>>24&255),k[l+1]=255&(w>>16&255),k[l+2]=255&(w>>8&255),k[l+3]=255&(w&255)}function p(k,l,w){k[l+0]=255&(w>>8&255),k[l+1]=255&(w&255)}function M(k,l){return new String(k,l,X.length(),V).equals(X)||new String(k,l,Y.length(),V).equals(Y)}function P(k,l,w){return 255&(k<<l|w&~(-1<<l))}function G(k,l){var w=k.internal_flags;l[0]=P(l[0],8,255),l[1]=P(l[1],3,7),l[1]=P(l[1],1,k.out_samplerate<16e3?0:1),l[1]=P(l[1],1,k.version),l[1]=P(l[1],2,1),l[1]=P(l[1],1,k.error_protection?0:1),l[2]=P(l[2],4,w.bitrate_index),l[2]=P(l[2],2,w.samplerate_index),l[2]=P(l[2],1,0),l[2]=P(l[2],1,k.extension),l[3]=P(l[3],2,k.mode.ordinal()),l[3]=P(l[3],2,w.mode_ext),l[3]=P(l[3],1,k.copyright),l[3]=P(l[3],1,k.original),l[3]=P(l[3],2,k.emphasis),l[0]=255;var $=255&(l[1]&241),z;k.version==1?z=d:k.out_samplerate<16e3?z=j:z=C,k.VBR==Vn.vbr_off&&(z=k.brate);var W;k.free_format?W=0:W=255&16*e.BitrateIndex(z,k.version,k.out_samplerate),k.version==1?(l[1]=255&($|10),$=255&(l[2]&13),l[2]=255&(W|$)):(l[1]=255&($|2),$=255&(l[2]&13),l[2]=255&(W|$))}this.getVbrTag=function(k){var l=new VBRTagData,w=0;l.flags=0;var $=k[w+1]>>3&1,z=k[w+2]>>2&3,W=k[w+3]>>6&3,ne=k[w+2]>>4&15;if(ne=Tables.bitrate_table[$][ne],k[w+1]>>4==14?l.samprate=Tables.samplerate_table[2][z]:l.samprate=Tables.samplerate_table[$][z],$!=0?W!=3?w+=36:w+=21:W!=3?w+=21:w+=13,!M(k,w))return null;w+=4,l.hId=$;var B=l.flags=y(k,w);if(w+=4,B&i&&(l.frames=y(k,w),w+=4),B&o&&(l.bytes=y(k,w),w+=4),B&n){if(l.toc!=null)for(var b=0;b<c;b++)l.toc[b]=k[w+b];w+=c}l.vbrScale=-1,B&r&&(l.vbrScale=y(k,w),w+=4),l.headersize=($+1)*72e3*ne/l.samprate,w+=21;var m=k[w+0]<<4;m+=k[w+1]>>4;var u=(k[w+1]&15)<<8;return u+=k[w+2]&255,(m<0||m>3e3)&&(m=-1),(u<0||u>3e3)&&(u=-1),l.encDelay=m,l.encPadding=u,l},this.InitVbrTag=function(k){var l=k.internal_flags,w;k.version==1?w=d:k.out_samplerate<16e3?w=j:w=C,k.VBR==Vn.vbr_off&&(w=k.brate);var $=(k.version+1)*72e3*w/k.out_samplerate,z=l.sideinfo_len+h;if(l.VBR_seek_table.TotalFrameSize=$,$<z||$>v){k.bWriteVbrTag=!1;return}l.VBR_seek_table.nVbrNumFrames=0,l.VBR_seek_table.nBytesWritten=0,l.VBR_seek_table.sum=0,l.VBR_seek_table.seen=0,l.VBR_seek_table.want=1,l.VBR_seek_table.pos=0,l.VBR_seek_table.bag==null&&(l.VBR_seek_table.bag=new int[400],l.VBR_seek_table.size=400);var W=sn(v);G(k,W);for(var ne=l.VBR_seek_table.TotalFrameSize,B=0;B<ne;++B)t.add_dummy_byte(k,W[B]&255,1)};function N(k,l){var w=l^k;return l=l>>8^I[w&255],l}this.updateMusicCRC=function(k,l,w,$){for(var z=0;z<$;++z)k[0]=N(l[w+z],k[0])};function F(k,l,w,$,z){var W=k.internal_flags,ne=0,B=k.encoder_delay,b=k.encoder_padding,m=100-10*k.VBR_q-k.quality,u=s.getLameVeryShortVersion(),A,R=0,J,le=[1,5,3,2,4,0,3],H=0|(k.lowpassfreq/100+.5>255?255:k.lowpassfreq/100+.5),ee=0,me=0,Te=0,we=k.internal_flags.noise_shaping,Ne=0,Re=0,Ce=0,Pe=0,it=0,Vt=(k.exp_nspsytune&1)!=0,_=(k.exp_nspsytune&2)!=0,T=!1,Ie=!1,ke=k.internal_flags.nogap_total,Ue=k.internal_flags.nogap_current,De=k.ATHtype,Be=0,Le;switch(k.VBR){case vbr_abr:Le=k.VBR_mean_bitrate_kbps;break;case vbr_off:Le=k.brate;break;default:Le=k.VBR_min_bitrate_kbps}switch(k.VBR.ordinal()<le.length?A=le[k.VBR.ordinal()]:A=0,J=16*R+A,W.findReplayGain&&(W.RadioGain>510&&(W.RadioGain=510),W.RadioGain<-510&&(W.RadioGain=-510),me=8192,me|=3072,W.RadioGain>=0?me|=W.RadioGain:(me|=512,me|=-W.RadioGain)),W.findPeakSample&&(ee=Math.abs(0|W.PeakSample/32767*Math.pow(2,23)+.5)),ke!=-1&&(Ue>0&&(Ie=!0),Ue<ke-1&&(T=!0)),Be=De+((Vt?1:0)<<4)+((_?1:0)<<5)+((T?1:0)<<6)+((Ie?1:0)<<7),m<0&&(m=0),k.mode){case MONO:Ne=0;break;case STEREO:Ne=1;break;case DUAL_CHANNEL:Ne=2;break;case JOINT_STEREO:k.force_ms?Ne=4:Ne=3;break;case NOT_SET:default:Ne=7;break}k.in_samplerate<=32e3?Ce=0:k.in_samplerate==48e3?Ce=2:k.in_samplerate>48e3?Ce=3:Ce=1,(k.short_blocks==qa.short_block_forced||k.short_blocks==qa.short_block_dispensed||k.lowpassfreq==-1&&k.highpassfreq==-1||k.scale_left<k.scale_right||k.scale_left>k.scale_right||k.disable_reservoir&&k.brate<320||k.noATH||k.ATHonly||De==0||k.in_samplerate<=32e3)&&(Re=1),Pe=we+(Ne<<2)+(Re<<5)+(Ce<<6),it=W.nMusicCRC,a(w,$+ne,m),ne+=4;for(var Ye=0;Ye<9;Ye++)w[$+ne+Ye]=255&u.charAt(Ye);ne+=9,w[$+ne]=255&J,ne++,w[$+ne]=255&H,ne++,a(w,$+ne,ee),ne+=4,p(w,$+ne,me),ne+=2,p(w,$+ne,Te),ne+=2,w[$+ne]=255&Be,ne++,Le>=255?w[$+ne]=255:w[$+ne]=255&Le,ne++,w[$+ne]=255&B>>4,w[$+ne+1]=255&(B<<4)+(b>>8),w[$+ne+2]=255&b,ne+=3,w[$+ne]=255&Pe,ne++,w[$+ne++]=0,p(w,$+ne,k.preset),ne+=2,a(w,$+ne,l),ne+=4,p(w,$+ne,it),ne+=2;for(var Fe=0;Fe<ne;Fe++)z=N(w[$+Fe],z);return p(w,$+ne,z),ne+=2,ne}function pe(k){k.seek(0);var l=sn(10);k.readFully(l);var w;return new String(l,"ISO-8859-1").startsWith("ID3")?w=0:w=((l[6]&127)<<21|(l[7]&127)<<14|(l[8]&127)<<7|l[9]&127)+l.length,w}this.getLameTagFrame=function(k,l){var w=k.internal_flags;if(!k.bWriteVbrTag||w.Class_ID!=Lame.LAME_ID||w.VBR_seek_table.pos<=0)return 0;if(l.length<w.VBR_seek_table.TotalFrameSize)return w.VBR_seek_table.TotalFrameSize;Qh.fill(l,0,w.VBR_seek_table.TotalFrameSize,0),G(k,l);var $=sn(c);if(k.free_format)for(var z=1;z<c;++z)$[z]=255&255*z/100;else g(w.VBR_seek_table,$);var W=w.sideinfo_len;k.error_protection&&(W-=2),k.VBR==Vn.vbr_off?(l[W++]=255&Y.charAt(0),l[W++]=255&Y.charAt(1),l[W++]=255&Y.charAt(2),l[W++]=255&Y.charAt(3)):(l[W++]=255&X.charAt(0),l[W++]=255&X.charAt(1),l[W++]=255&X.charAt(2),l[W++]=255&X.charAt(3)),a(l,W,i+o+n+r),W+=4,a(l,W,w.VBR_seek_table.nVbrNumFrames),W+=4;var ne=w.VBR_seek_table.nBytesWritten+w.VBR_seek_table.TotalFrameSize;a(l,W,0|ne),W+=4,Kh.arraycopy($,0,l,W,$.length),W+=$.length,k.error_protection&&t.CRC_writeheader(w,l);for(var B=0,z=0;z<W;z++)B=N(l[z],B);return W+=F(k,ne,l,W,B),w.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(k,l){var w=k.internal_flags;if(w.VBR_seek_table.pos<=0||(l.seek(l.length()),l.length()==0))return-1;var $=pe(l);l.seek($);var z=sn(v),W=getLameTagFrame(k,z);return W>z.length?-1:(W<1||l.write(z,0,W),0)}}var Jh=$s,ji=_t,Ka=ji.new_byte,e0=ji.assert,t0=ia(),s0=xh,n0=Gi,a0=Hi(),i0=Wh,o0=Ui(),r0=Xh,l0=Xs,c0=aa();Rt();var d0=qh,u0=Jh;function h0(){this.setModules=function(e,t){}}function _0(){this.setModules=function(e,t,s){}}function m0(){}function p0(){this.setModules=function(e,t){}}function f0(e,t,s){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,s=128);var i=new t0,o=new h0,n=new n0,r=new c0,c=new s0,v=new a0,x=new i0,h=new u0,d=new d0,C=new p0,j=new r0,V=new o0,X=new _0,Y=new m0;i.setModules(n,r,c,v,x,h,d,C,Y),r.setModules(n,Y,d,h),C.setModules(r,d),c.setModules(i),x.setModules(r,j,v,V),v.setModules(V,j,i.enc.psy),j.setModules(r),V.setModules(v),h.setModules(i,r,d),o.setModules(X,Y),X.setModules(d,C,c);var I=i.lame_init();I.num_channels=e,I.in_samplerate=t,I.brate=s,I.mode=l0.STEREO,I.quality=3,I.bWriteVbrTag=!1,I.disable_reservoir=!0,I.write_id3tag_automatic=!1,i.lame_init_params(I);var f=1152,g=0|1.25*f+7200,y=Ka(g);this.encodeBuffer=function(a,p){e==1&&(p=a),e0(a.length==p.length),a.length>f&&(f=a.length,g=0|1.25*f+7200,y=Ka(g));var M=i.lame_encode_buffer(I,a,p,a.length,y,0,g);return new Int8Array(y.subarray(0,M))},this.flush=function(){var a=i.lame_encode_flush(I,y,0,g);return new Int8Array(y.subarray(0,a))}}function Yt(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function un(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}Yt.RIFF=un("RIFF");Yt.WAVE=un("WAVE");Yt.fmt_=un("fmt ");Yt.data=un("data");Yt.readHeader=function(e){var t=new Yt,s=e.getUint32(0,!1);if(Yt.RIFF==s&&(e.getUint32(4,!0),Yt.WAVE==e.getUint32(8,!1)&&Yt.fmt_==e.getUint32(12,!1))){var i=e.getUint32(16,!0),o=20;switch(i){case 16:case 18:t.channels=e.getUint16(o+2,!0),t.sampleRate=e.getUint32(o+4,!0);break;default:throw"extended fmt chunk not implemented"}o+=i;for(var n=Yt.data,r=0;n!=s&&(s=e.getUint32(o,!1),r=e.getUint32(o+4,!0),n!=s);)o+=r+8;return t.dataLen=r,t.dataOffset=o+8,t}};Jn.Mp3Encoder=f0;Jn.WavHeader=Yt;const nn=(e,t,s)=>{for(let i=0;i<s.length;i++)e.setUint8(t+i,s.charCodeAt(i))},g0=async(e,t,s)=>{const i=e.length*t*2,o=new ArrayBuffer(44+i),n=new DataView(o);nn(n,0,"RIFF"),n.setUint32(4,36+i,!0),nn(n,8,"WAVE"),nn(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,t,!0),n.setUint32(24,s,!0),n.setUint32(28,s*t*2,!0),n.setUint16(32,t*2,!0),n.setUint16(34,16,!0),nn(n,36,"data"),n.setUint32(40,i,!0);const r=44;for(let c=0;c<e.length;c++)for(let v=0;v<t;v++){const x=Math.max(-1,Math.min(1,e.getChannelData(v)[c]));n.setInt16(r+(c*t+v)*2,x*32767,!0)}return new Blob([o],{type:"audio/wav"})},Yi=async e=>{const t=new(window.AudioContext||window.webkitAudioContext),s=await e.arrayBuffer();return await t.decodeAudioData(s)},b0=async e=>{const t=await Yi(e);return g0(t,t.numberOfChannels,t.sampleRate)},v0=(e,t,s,i=128)=>{const o=[],n=new Jn.Mp3Encoder(e,t,i),r=1152;for(let v=0;v<s.length;v+=r){const x=Math.min(v+r,s.length),h=s.subarray(v,x),d=n.encodeBuffer(h);d.length>0&&o.push(new Int8Array(d))}const c=n.flush();return c.length>0&&o.push(new Int8Array(c)),new Blob(o,{type:"audio/mp3"})},A0=async(e,t=128)=>{try{const s=await Yi(e),i=new Int16Array(s.length*s.numberOfChannels);let o=0;for(let n=0;n<s.length;n+=1)for(let r=0;r<s.numberOfChannels;r+=1){const c=Math.max(-1,Math.min(1,s.getChannelData(r)[n]));i[o]=c<0?c*32768:c*32767,o+=1}return v0(s.numberOfChannels,s.sampleRate,i,t)}catch{throw new Error("Conversion to MP3 failed.")}},T0=async(e,t,s=128)=>{let i;if(t==="audio/wav")i=await b0(e);else if(t==="audio/mp3")i=await A0(e,s);else throw new Error("Unsupported output format");return i},E0={__name:"AudioRecorder",props:{audioRecordFormat:{type:String,required:!0}},emits:["recorderProgressChanged","finishRecord","pause","play"],setup(e,{expose:t,emit:s}){const i=e,o=s,n=Ze(null),r=Ze(null),c=Ze(null),v=Ze(!1),x=Ze(!1),h=Ze(!1),d=Y=>{const I=Gr({start:0,end:Y});return oi(new Date(0,0,0,0,I.minutes,I.seconds),"mm:ss")},C=()=>{r.value=Fs.create({container:n.value,waveColor:"#1F93FF",progressColor:"#6E6F73",height:100,barWidth:2,barGap:1,barRadius:2,plugins:[Zn.create({scrollingWaveform:!0,renderRecordedAudio:!1})]}),r.value.on("pause",()=>o("pause")),r.value.on("play",()=>o("play")),c.value=r.value.plugins[0],r.value.on("finish",()=>{x.value=!1}),c.value.on("record-end",async Y=>{const I=URL.createObjectURL(Y),f=await T0(Y,i.audioRecordFormat),g=`${_o()}.mp3`,y=new File([f],g,{type:i.audioRecordFormat});r.value.load(I),o("finishRecord",{name:y.name,type:y.type,size:y.size,file:y}),h.value=!0,v.value=!1}),c.value.on("record-progress",Y=>{o("recorderProgressChanged",d(Y))})},j=()=>{v.value&&(c.value.stopRecording(),v.value=!1)},V=()=>{c.value.startRecording(),v.value=!0},X=()=>{h.value&&(r.value.playPause(),x.value=!x.value)};return ws(()=>{C(),V()}),io(()=>{r.value&&r.value.destroy()}),t({playPause:X,stopRecording:j,record:c}),(Y,I)=>(O(),se("div",{ref_key:"waveformContainer",ref:n,class:"w-full p-1"},null,512))}},S0={components:{TemplatesPicker:xo,TemplateParser:Lo},props:{show:{type:Boolean,default:!1},inboxId:{type:Number,default:void 0}},emits:["onSend","cancel","update:show"],data(){return{selectedWaTemplate:null}},computed:{localShow:{get(){return this.show},set(e){this.$emit("update:show",e)}},modalHeaderContent(){return this.selectedWaTemplate?this.$t("WHATSAPP_TEMPLATES.MODAL.TEMPLATE_SELECTED_SUBTITLE",{templateName:this.selectedWaTemplate.name}):this.$t("WHATSAPP_TEMPLATES.MODAL.SUBTITLE")}},methods:{pickTemplate(e){this.selectedWaTemplate=e},onResetTemplate(){this.selectedWaTemplate=null},onSendMessage(e){this.$emit("onSend",e)},onClose(){this.$emit("cancel")}}},y0={class:"row modal-content"};function I0(e,t,s,i,o,n){const r=ae("woot-modal-header"),c=ae("TemplatesPicker"),v=ae("TemplateParser"),x=ae("woot-modal");return O(),_e(x,{show:n.localShow,"onUpdate:show":t[0]||(t[0]=h=>n.localShow=h),"on-close":n.onClose,size:"modal-big"},{default:Oe(()=>[oe(r,{"header-title":e.$t("WHATSAPP_TEMPLATES.MODAL.TITLE"),"header-content":n.modalHeaderContent},null,8,["header-title","header-content"]),q("div",y0,[o.selectedWaTemplate?(O(),_e(v,{key:1,template:o.selectedWaTemplate,onResetTemplate:n.onResetTemplate,onSendMessage:n.onSendMessage},null,8,["template","onResetTemplate","onSendMessage"])):(O(),_e(c,{key:0,"inbox-id":s.inboxId,onOnSelect:n.pickTemplate},null,8,["inbox-id","onOnSelect"]))])]),_:1},8,["show","on-close"])}const w0=je(S0,[["render",I0],["__scopeId","data-v-aadd6c10"]]),R0=oo(()=>eo(()=>import("./EmojiInput-CQAMhbBI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),C0={components:{ArticleSearchPopover:Mu,AttachmentPreview:Po,AudioRecorder:E0,Banner:di,CannedResponse:Eo,EmojiInput:R0,MessageSignatureMissingAlert:Bo,ReplyBottomPanel:qd,ReplyEmailHead:Do,ReplyToMessage:td,ReplyTopPanel:ld,ResizableTextArea:pr,WhatsappTemplates:w0,WootMessageEditor:So},mixins:[Rs,Vo,ur],emits:["update:popoutReplyBox","togglePopout"],setup(){const{uiSettings:e,updateUISettings:t,isEditorHotKeyEnabled:s,fetchSignatureFlagFromUISettings:i}=Hs(),o=ro();return{uiSettings:e,popoutReplyBox:o,updateUISettings:t,isEditorHotKeyEnabled:s,fetchSignatureFlagFromUISettings:i}},data(){return{message:"",inReplyTo:{},isFocused:!1,showEmojiPicker:!1,attachedFiles:[],isRecordingAudio:!1,recordingAudioState:"",recordingAudioDurationText:"",isUploading:!1,replyType:Ht.REPLY,mentionSearchKey:"",hasSlashCommand:!1,bccEmails:"",ccEmails:"",toEmails:"",doAutoSaveDraft:()=>{},showWhatsAppTemplatesModal:!1,updateEditorSelectionWith:"",undefinedVariableMessage:"",showMentions:!1,showUserMentions:!1,showCannedMenu:!1,showVariablesMenu:!1,newConversationModalActive:!1,showArticleSearchPopover:!1,hasRecordedAudio:!1}},computed:{...yt({isRTL:"accounts/isRTL",currentChat:"getSelectedChat",messageSignature:"getMessageSignature",currentUser:"getCurrentUser",lastEmail:"getLastEmailInSelectedChat",globalConfig:"globalConfig/get"}),currentContact(){return this.$store.getters["contacts/getContact"](this.currentChat.meta.sender.id)},shouldShowReplyToMessage(){var e;return((e=this.inReplyTo)==null?void 0:e.id)&&!this.isPrivate&&this.inboxHasFeature(Un.REPLY_TO)&&!this.is360DialogWhatsAppChannel},showRichContentEditor(){if(this.isOnPrivateNote||this.isRichEditorEnabled)return!0;if(this.isAPIInbox){const{display_rich_content_editor:e=!1}=this.uiSettings;return e}return!1},assignedAgent:{get(){return this.currentChat.meta.assignee},set(e){const t=e?e.id:0;this.$store.dispatch("setCurrentChatAssignee",e),this.$store.dispatch("assignAgent",{conversationId:this.currentChat.id,agentId:t}).then(()=>{Je(this.$t("CONVERSATION.CHANGE_AGENT"))})}},showSelfAssignBanner(){return this.message!==""&&!this.isOnPrivateNote&&(!this.assignedAgent||this.assignedAgent.id!==this.currentUser.id)},hasWhatsappTemplates(){return!!this.$store.getters["inboxes/getWhatsAppTemplates"](this.inboxId).length},isPrivate(){return this.currentChat.can_reply||this.isAWhatsAppChannel?this.isOnPrivateNote:!0},inboxId(){return this.currentChat.inbox_id},inbox(){return this.$store.getters["inboxes/getInbox"](this.inboxId)},messagePlaceHolder(){return this.isPrivate?this.$t("CONVERSATION.FOOTER.PRIVATE_MSG_INPUT"):this.$t("CONVERSATION.FOOTER.MSG_INPUT")},isMessageLengthReachingThreshold(){return this.message.length>this.maxLength-50},charactersRemaining(){return this.maxLength-this.message.length},isReplyButtonDisabled(){return this.isATwitterInbox?!0:this.hasAttachments||this.hasRecordedAudio?!1:this.isMessageEmpty||this.message.length===0||this.message.length>this.maxLength},sender(){return{name:this.currentUser.name,thumbnail:this.currentUser.avatar_url}},conversationType(){const{additional_attributes:e}=this.currentChat;return(e?e.type:"")||""},maxLength(){return this.isPrivate?fs.GENERAL:this.isAFacebookInbox?fs.FACEBOOK:this.isAWhatsAppChannel?fs.TWILIO_WHATSAPP:this.isASmsInbox?fs.TWILIO_SMS:this.isAnEmailChannel?fs.EMAIL:fs.GENERAL},showFileUpload(){return this.isAWebWidgetInbox||this.isAFacebookInbox||this.isAWhatsAppChannel||this.isAPIInbox||this.isAnEmailChannel||this.isASmsInbox||this.isATelegramChannel||this.isALineChannel},replyButtonLabel(){let e=this.$t("CONVERSATION.REPLYBOX.SEND");this.isPrivate&&(e=this.$t("CONVERSATION.REPLYBOX.CREATE"));const t=this.isEditorHotKeyEnabled("cmd_enter")?"(⌘ + ↵)":"(↵)";return`${e} ${t}`},replyBoxClass(){return{"is-private":this.isPrivate,"is-focused":this.isFocused||this.hasAttachments}},hasAttachments(){return this.attachedFiles.length},isRichEditorEnabled(){return this.isAWebWidgetInbox||this.isAnEmailChannel},showAudioRecorder(){return!this.isOnPrivateNote&&this.showFileUpload},showAudioRecorderEditor(){return this.showAudioRecorder&&this.isRecordingAudio},isOnPrivateNote(){return this.replyType===Ht.NOTE},isOnExpandedLayout(){const{LAYOUT_TYPES:{CONDENSED:e}}=$t,{conversation_display_type:t=e}=this.uiSettings;return t!==e},emojiDialogClassOnExpandedLayoutAndRTLView(){return this.isOnExpandedLayout||this.popoutReplyBox?"emoji-dialog--expanded":this.isRTL?"emoji-dialog--rtl":""},isMessageEmpty(){return this.message?!this.message.trim().replace(/\n/g,"").length:!0},showReplyHead(){return!this.isOnPrivateNote&&this.isAnEmailChannel},enableMultipleFileUpload(){return this.isAnEmailChannel||this.isAWebWidgetInbox||this.isAPIInbox||this.isAWhatsAppChannel},isSignatureEnabledForInbox(){return!this.isPrivate&&this.sendWithSignature},isSignatureAvailable(){return!!this.signatureToApply},sendWithSignature(){return this.fetchSignatureFlagFromUISettings(this.channelType)},editorMessageKey(){const{editor_message_key:e}=this.uiSettings;return e},commandPlusEnterToSendEnabled(){return this.editorMessageKey==="cmd_enter"},enterToSendEnabled(){return this.editorMessageKey==="enter"},conversationId(){return this.currentChat.id},conversationIdByRoute(){return this.conversationId},editorStateId(){return`draft-${this.conversationIdByRoute}-${this.replyType}`},audioRecordFormat(){return this.isAWhatsAppChannel||this.isATelegramChannel?An.MP3:this.isAPIInbox?An.MP3:An.WAV},messageVariables(){return Ar({conversation:this.currentChat,contact:this.currentContact})},signatureToApply(){return this.showRichContentEditor?this.messageSignature:Sn(this.messageSignature)},connectedPortalSlug(){const{help_center:e={}}=this.inbox,{slug:t=""}=e;return t}},watch:{currentChat(e){const{can_reply:t}=e;this.setCCAndToEmailsFromLastChat(),!this.isOnPrivateNote&&(t||this.isAWhatsAppChannel?this.replyType=Ht.REPLY:this.replyType=Ht.NOTE,this.fetchAndSetReplyTo())},conversationIdByRoute(e,t){e!==t&&(this.setToDraft(t,this.replyType),this.getFromDraft())},message(e){const t=yn(e,this.signatureToApply),s=t.startsWith("/");this.hasSlashCommand=s&&!this.showRichContentEditor,this.showMentions=this.hasSlashCommand,this.mentionSearchKey=this.hasSlashCommand?t.substring(1):"",this.doAutoSaveDraft()},replyType(e,t){this.setToDraft(this.conversationIdByRoute,t),this.getFromDraft()}},mounted(){this.getFromDraft(),document.addEventListener("paste",this.onPaste),document.addEventListener("keydown",this.handleKeyEvents),this.setCCAndToEmailsFromLastChat(),this.doAutoSaveDraft=bi(()=>{this.saveDraft(this.conversationIdByRoute,this.replyType)},500,!0),this.fetchAndSetReplyTo(),ht.on(St.TOGGLE_REPLY_TO_MESSAGE,this.fetchAndSetReplyTo),ht.on(St.NEW_CONVERSATION_MODAL,this.onNewConversationModalActive)},unmounted(){document.removeEventListener("paste",this.onPaste),document.removeEventListener("keydown",this.handleKeyEvents),ht.off(St.TOGGLE_REPLY_TO_MESSAGE,this.fetchAndSetReplyTo),ht.off(St.NEW_CONVERSATION_MODAL,this.onNewConversationModalActive)},methods:{handleInsert(e){const{url:t,title:s}=e;if(this.isRichEditorEnabled){const n=s.split(`
`).filter(r=>r.trim()!=="").join(" ");ht.emit(St.INSERT_INTO_RICH_EDITOR,`[${n}](${t})`)}else this.addIntoEditor(`${this.$t("CONVERSATION.REPLYBOX.INSERT_READ_MORE")} ${t}`);Kt(hs.INSERT_ARTICLE_LINK)},toggleRichContentEditor(){this.updateUISettings({display_rich_content_editor:!this.showRichContentEditor});const e=Sn(this.messageSignature);if(!this.showRichContentEditor&&this.messageSignature){let t=yn(this.message,this.messageSignature);t=Sn(t),t=Ks(t,e),this.message=t}else this.message=fr(this.message,e,this.messageSignature)},saveDraft(e,t){if(this.message||this.message===""){const s=`draft-${e}-${t}`,i=Tr(this.message||"");this.$store.dispatch("draftMessages/set",{key:s,message:i})}},setToDraft(e,t){this.saveDraft(e,t),this.message=""},getFromDraft(){if(this.conversationIdByRoute){const e=`draft-${this.conversationIdByRoute}-${this.replyType}`,t=this.$store.getters["draftMessages/get"](e)||"";this.message=this.toggleSignatureForDraft(t)}},toggleSignatureForDraft(e){return this.isPrivate?e:this.sendWithSignature?Ks(e,this.signatureToApply):yn(e,this.signatureToApply)},removeFromDraft(){if(this.conversationIdByRoute){const e=`draft-${this.conversationIdByRoute}-${this.replyType}`;this.$store.dispatch("draftMessages/delete",{key:e})}},getKeyboardEvents(){return{Escape:{action:()=>{this.hideEmojiPicker(),this.hideMentions()},allowOnFocusedInput:!0},"$mod+KeyK":{action:e=>{e.preventDefault(),document.querySelector("ninja-keys").open()},allowOnFocusedInput:!0},Enter:{action:e=>{this.isAValidEvent("enter")&&(this.onSendReply(),e.preventDefault())},allowOnFocusedInput:!0},"$mod+Enter":{action:()=>{this.isAValidEvent("cmd_enter")&&this.onSendReply()},allowOnFocusedInput:!0}}},isAValidEvent(e){return!this.showUserMentions&&!this.showMentions&&!this.showCannedMenu&&!this.showVariablesMenu&&this.isFocused&&this.isEditorHotKeyEnabled(e)},onPaste(e){const t=e.clipboardData.files;!this.showRichContentEditor&&t.length!==0&&this.$refs.messageInput.$el.blur(),!(!t.length||!t[0])&&t.forEach(s=>{const{name:i,type:o,size:n}=s;this.onFileUpload({name:i,type:o,size:n,file:s})})},toggleUserMention(e){this.showUserMentions=e},toggleCannedMenu(e){this.showCannedMenu=e},toggleVariablesMenu(e){this.showVariablesMenu=e},openWhatsappTemplateModal(){this.showWhatsAppTemplatesModal=!0},hideWhatsappTemplatesModal(){this.showWhatsAppTemplatesModal=!1},onClickSelfAssign(){const{account_id:e,availability_status:t,available_name:s,email:i,id:o,name:n,role:r,avatar_url:c}=this.currentUser,v={account_id:e,availability_status:t,available_name:s,email:i,id:o,name:n,role:r,thumbnail:c};this.assignedAgent=v},confirmOnSendReply(){if(!this.isReplyButtonDisabled&&!this.showMentions){if((this.isATwilioWhatsAppChannel||this.isAWhatsAppCloudChannel||this.is360DialogWhatsAppChannel)&&!this.isPrivate)this.sendMessageAsMultipleMessages(this.message);else{const t=this.getMessagePayload(this.message);this.sendMessage(t)}this.isPrivate||this.clearEmailField(),this.clearMessage(),this.hideEmojiPicker(),this.$emit("update:popoutReplyBox",!1)}},sendMessageAsMultipleMessages(e){this.getMessagePayloadForWhatsapp(e).forEach(s=>{this.sendMessage(s)})},sendMessageAnalyticsData(e){var t;return e?Kt(hs.SENT_PRIVATE_NOTE):Kt(hs.SENT_MESSAGE,{channelType:this.channelType,signatureEnabled:this.sendWithSignature,hasReplyTo:!!((t=this.inReplyTo)!=null&&t.id)})},async onSendReply(){const e=Er({message:this.message,variables:this.messageVariables});if(e.length>0){const t=e.length>1?e.length:1;this.undefinedVariableMessage=this.$t("CONVERSATION.REPLYBOX.UNDEFINED_VARIABLES.MESSAGE",{undefinedVariablesCount:t,undefinedVariables:e.join(", ")}),await this.$refs.confirmDialog.showConfirmation()&&this.confirmOnSendReply()}else this.confirmOnSendReply()},async sendMessage(e){var t,s;try{await this.$store.dispatch("createPendingMessageAndSend",e),ht.emit(St.SCROLL_TO_MESSAGE),ht.emit(St.MESSAGE_SENT),this.removeFromDraft(),this.sendMessageAnalyticsData(e.private)}catch(i){const o=((s=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:s.error)||this.$t("CONVERSATION.MESSAGE_ERROR");Je(o)}},async onSendWhatsAppReply(e){this.sendMessage({conversationId:this.currentChat.id,...e}),this.hideWhatsappTemplatesModal()},replaceText(e){this.sendWithSignature&&!this.private&&(e=Ks(e,this.signatureToApply));const t=Sr({message:e,variables:this.messageVariables});setTimeout(()=>{Kt(hs.INSERTED_A_CANNED_RESPONSE),this.message=t},100)},setReplyMode(e=Ht.REPLY){const{can_reply:t}=this.currentChat;if(this.$store.dispatch("draftMessages/setReplyEditorMode",{mode:e}),(t||this.isAWhatsAppChannel)&&(this.replyType=e),this.showRichContentEditor){this.isRecordingAudio&&this.toggleAudioRecorder();return}this.$nextTick(()=>this.$refs.messageInput.focus())},clearEditorSelection(){this.updateEditorSelectionWith=""},insertIntoTextEditor(e,t,s){const{message:i}=this,o=i.slice(0,t)+e+i.slice(s,i.length);this.message=o},addIntoEditor(e){if(this.showRichContentEditor&&(this.updateEditorSelectionWith=e,this.onFocus()),!this.showRichContentEditor){const{selectionStart:t,selectionEnd:s}=this.$refs.messageInput.$el;this.insertIntoTextEditor(e,t,s)}},clearMessage(){this.message="",this.sendWithSignature&&!this.isPrivate&&(this.message=Ks(this.message,this.signatureToApply)),this.attachedFiles=[],this.isRecordingAudio=!1,this.resetReplyToMessage(),this.resetAudioRecorderInput()},clearEmailField(){this.ccEmails="",this.bccEmails="",this.toEmails=""},toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker},toggleAudioRecorder(){this.isRecordingAudio=!this.isRecordingAudio,this.isRecorderAudioStopped=!this.isRecordingAudio,this.isRecordingAudio||this.resetAudioRecorderInput()},toggleAudioRecorderPlayPause(){this.isRecordingAudio&&(this.isRecorderAudioStopped?this.isRecorderAudioStopped&&this.$refs.audioRecorderInput.playPause():(this.isRecorderAudioStopped=!0,this.$refs.audioRecorderInput.stopRecording()))},hideEmojiPicker(){this.showEmojiPicker&&this.toggleEmojiPicker()},hideMentions(){this.showMentions=!1},onTypingOn(){this.toggleTyping("on")},onTypingOff(){this.toggleTyping("off")},onBlur(){this.isFocused=!1,this.saveDraft(this.conversationIdByRoute,this.replyType)},onFocus(){this.isFocused=!0},onRecordProgressChanged(e){this.recordingAudioDurationText=e},onFinishRecorder(e){this.recordingAudioState="stopped",this.hasRecordedAudio=!0;const t={...e,isRecordedAudio:!0};return e&&this.onFileUpload(t)},toggleTyping(e){const t=this.currentChat.id,s=this.isPrivate;t&&this.$store.dispatch("conversationTypingStatus/toggleTyping",{status:e,conversationId:t,isPrivate:s})},attachFile({blob:e,file:t}){const s=new FileReader;s.readAsDataURL(t.file),s.onloadend=()=>{this.attachedFiles.push({currentChatId:this.currentChat.id,resource:e||t,isPrivate:this.isPrivate,thumb:s.result,blobSignedId:e?e.signed_id:void 0,isRecordedAudio:(t==null?void 0:t.isRecordedAudio)||!1})}},removeAttachment(e){this.attachedFiles=e},setReplyToInPayload(e){var t;return(t=this.inReplyTo)!=null&&t.id?{...e,contentAttributes:{...e.contentAttributes,in_reply_to:this.inReplyTo.id}}:e},getMessagePayloadForWhatsapp(e){const t=[];if(this.attachedFiles&&this.attachedFiles.length){let s=e;this.attachedFiles.forEach(i=>{const o=this.globalConfig.directUploadsEnabled?i.blobSignedId:i.resource.file;let n={conversationId:this.currentChat.id,files:[o],private:!1,message:s,sender:this.sender};n=this.setReplyToInPayload(n),t.push(n),s=""})}else{let s={conversationId:this.currentChat.id,message:e,private:!1,sender:this.sender};s=this.setReplyToInPayload(s),t.push(s)}return t},getMessagePayload(e){let t={conversationId:this.currentChat.id,message:e,private:this.isPrivate,sender:this.sender};return t=this.setReplyToInPayload(t),this.attachedFiles&&this.attachedFiles.length&&(t.files=[],this.attachedFiles.forEach(s=>{this.globalConfig.directUploadsEnabled?t.files.push(s.blobSignedId):t.files.push(s.resource.file)})),this.ccEmails&&!this.isOnPrivateNote&&(t.ccEmails=this.ccEmails),this.bccEmails&&!this.isOnPrivateNote&&(t.bccEmails=this.bccEmails),this.toEmails&&!this.isOnPrivateNote&&(t.toEmails=this.toEmails),t},setCcEmails(e){this.bccEmails=e.bccEmails,this.ccEmails=e.ccEmails},setCCAndToEmailsFromLastChat(){var n,r,c;if(!this.lastEmail)return;const{content_attributes:{email:e={}}}=this.lastEmail,t=((c=(r=(n=this.currentChat)==null?void 0:n.meta)==null?void 0:r.sender)==null?void 0:c.email)||"";let s=e.cc?[...e.cc]:[],i=[];s.includes(t)&&(s=s.filter(v=>v!==t)),e.from.includes(t)||(i.push(...e.from),s.push(t));let o=(e.bcc||[]).filter(v=>v!==t);o=[...new Set(o)],s=[...new Set(s)],i=[...new Set(i)],this.ccEmails=s.join(", "),this.bccEmails=o.join(", "),this.toEmails=i.join(", ")},fetchAndSetReplyTo(){var s,i;const e=Ss.MESSAGE_REPLY_TO,t=Es.getFromJsonStore(e,this.conversationId);this.inReplyTo=(i=(s=this.currentChat)==null?void 0:s.messages)==null?void 0:i.find(o=>o.id===t)},resetReplyToMessage(){const e=Ss.MESSAGE_REPLY_TO;Es.deleteFromJsonStore(e,this.conversationId),ht.emit(St.TOGGLE_REPLY_TO_MESSAGE)},onNewConversationModalActive(e){this.newConversationModalActive=e},onSearchPopoverClose(){this.showArticleSearchPopover=!1},toggleInsertArticle(){this.showArticleSearchPopover=!this.showArticleSearchPopover},resetAudioRecorderInput(){this.recordingAudioDurationText="00:00",this.isRecordingAudio=!1,this.recordingAudioState="",this.hasRecordedAudio=!1,this.attachedFiles=this.attachedFiles.filter(e=>!(e!=null&&e.isRecordedAudio))}}},M0={class:"reply-box__top"};function N0(e,t,s,i,o,n){const r=ae("Banner"),c=ae("ReplyTopPanel"),v=ae("ArticleSearchPopover"),x=ae("ReplyToMessage"),h=ae("CannedResponse"),d=ae("EmojiInput"),C=ae("ReplyEmailHead"),j=ae("AudioRecorder"),V=ae("ResizableTextArea"),X=ae("WootMessageEditor"),Y=ae("AttachmentPreview"),I=ae("MessageSignatureMissingAlert"),f=ae("ReplyBottomPanel"),g=ae("WhatsappTemplates"),y=ae("woot-confirm-modal"),a=rt("on-clickaway");return O(),se("div",{class:st(["reply-box",n.replyBoxClass])},[n.showSelfAssignBanner?(O(),_e(r,{key:0,"action-button-variant":"clear","color-scheme":"secondary",class:"banner--self-assign","banner-message":e.$t("CONVERSATION.NOT_ASSIGNED_TO_YOU"),"has-action-button":"","action-button-label":e.$t("CONVERSATION.ASSIGN_TO_ME"),onPrimaryAction:n.onClickSelfAssign},null,8,["banner-message","action-button-label","onPrimaryAction"])):he("",!0),oe(c,{mode:o.replyType,"is-message-length-reaching-threshold":n.isMessageLengthReachingThreshold,"characters-remaining":n.charactersRemaining,"popout-reply-box":i.popoutReplyBox,onSetReplyMode:n.setReplyMode,onTogglePopout:t[0]||(t[0]=p=>e.$emit("togglePopout"))},null,8,["mode","is-message-length-reaching-threshold","characters-remaining","popout-reply-box","onSetReplyMode"]),o.showArticleSearchPopover&&n.connectedPortalSlug?(O(),_e(v,{key:1,"selected-portal-slug":n.connectedPortalSlug,onInsert:n.handleInsert,onClose:n.onSearchPopoverClose},null,8,["selected-portal-slug","onInsert","onClose"])):he("",!0),q("div",M0,[n.shouldShowReplyToMessage?(O(),_e(x,{key:0,message:o.inReplyTo,onDismiss:n.resetReplyToMessage},null,8,["message","onDismiss"])):he("",!0),o.showMentions&&o.hasSlashCommand?He((O(),_e(h,{key:1,class:"normal-editor__canned-box","search-key":o.mentionSearchKey,onReplace:n.replaceText},null,8,["search-key","onReplace"])),[[a,n.hideMentions]]):he("",!0),o.showEmojiPicker?He((O(),_e(d,{key:2,class:st(n.emojiDialogClassOnExpandedLayoutAndRTLView),"on-click":n.addIntoEditor},null,8,["class","on-click"])),[[a,n.hideEmojiPicker]]):he("",!0),n.showReplyHead?(O(),_e(C,{key:3,"cc-emails":o.ccEmails,"onUpdate:ccEmails":t[1]||(t[1]=p=>o.ccEmails=p),"bcc-emails":o.bccEmails,"onUpdate:bccEmails":t[2]||(t[2]=p=>o.bccEmails=p),"to-emails":o.toEmails,"onUpdate:toEmails":t[3]||(t[3]=p=>o.toEmails=p)},null,8,["cc-emails","bcc-emails","to-emails"])):he("",!0),n.showAudioRecorderEditor?(O(),_e(j,{key:4,ref:"audioRecorderInput","audio-record-format":n.audioRecordFormat,onRecorderProgressChanged:n.onRecordProgressChanged,onFinishRecord:n.onFinishRecorder,onPlay:t[4]||(t[4]=p=>o.recordingAudioState="playing"),onPause:t[5]||(t[5]=p=>o.recordingAudioState="paused")},null,8,["audio-record-format","onRecorderProgressChanged","onFinishRecord"])):n.showRichContentEditor?(O(),_e(X,{key:6,modelValue:o.message,"onUpdate:modelValue":t[7]||(t[7]=p=>o.message=p),"editor-id":n.editorStateId,class:"input","is-private":n.isOnPrivateNote,placeholder:n.messagePlaceHolder,"update-selection-with":o.updateEditorSelectionWith,"min-height":4,"enable-variables":"",variables:n.messageVariables,signature:n.signatureToApply,"allow-signature":"","channel-type":e.channelType,onTypingOff:n.onTypingOff,onTypingOn:n.onTypingOn,onFocus:n.onFocus,onBlur:n.onBlur,onToggleUserMention:n.toggleUserMention,onToggleCannedMenu:n.toggleCannedMenu,onToggleVariablesMenu:n.toggleVariablesMenu,onClearSelection:n.clearEditorSelection},null,8,["modelValue","editor-id","is-private","placeholder","update-selection-with","variables","signature","channel-type","onTypingOff","onTypingOn","onFocus","onBlur","onToggleUserMention","onToggleCannedMenu","onToggleVariablesMenu","onClearSelection"])):(O(),_e(V,{key:5,ref:"messageInput",modelValue:o.message,"onUpdate:modelValue":t[6]||(t[6]=p=>o.message=p),class:"input",placeholder:n.messagePlaceHolder,"min-height":4,signature:n.signatureToApply,"allow-signature":"","send-with-signature":n.sendWithSignature,onTypingOff:n.onTypingOff,onTypingOn:n.onTypingOn,onFocus:n.onFocus,onBlur:n.onBlur},null,8,["modelValue","placeholder","signature","send-with-signature","onTypingOff","onTypingOn","onFocus","onBlur"]))]),n.hasAttachments&&!n.showAudioRecorderEditor?(O(),se("div",{key:2,class:"attachment-preview-box",onPaste:t[8]||(t[8]=(...p)=>n.onPaste&&n.onPaste(...p))},[oe(Y,{class:"flex-col mt-4",attachments:o.attachedFiles,onRemoveAttachment:n.removeAttachment},null,8,["attachments","onRemoveAttachment"])],32)):he("",!0),n.isSignatureEnabledForInbox&&!n.isSignatureAvailable?(O(),_e(I,{key:3})):he("",!0),oe(f,{"conversation-id":n.conversationId,"enable-multiple-file-upload":n.enableMultipleFileUpload,"has-whatsapp-templates":n.hasWhatsappTemplates,inbox:n.inbox,"is-on-private-note":n.isOnPrivateNote,"is-recording-audio":o.isRecordingAudio,"is-send-disabled":n.isReplyButtonDisabled,mode:o.replyType,"on-file-upload":e.onFileUpload,"on-send":n.onSendReply,"recording-audio-duration-text":o.recordingAudioDurationText,"recording-audio-state":o.recordingAudioState,"send-button-text":n.replyButtonLabel,"show-audio-recorder":n.showAudioRecorder,"show-editor-toggle":e.isAPIInbox&&!n.isOnPrivateNote,"show-emoji-picker":o.showEmojiPicker,"show-file-upload":n.showFileUpload,"toggle-audio-recorder-play-pause":n.toggleAudioRecorderPlayPause,"toggle-audio-recorder":n.toggleAudioRecorder,"toggle-emoji-picker":n.toggleEmojiPicker,message:o.message,"portal-slug":n.connectedPortalSlug,"new-conversation-modal-active":o.newConversationModalActive,onSelectWhatsappTemplate:n.openWhatsappTemplateModal,onToggleEditor:n.toggleRichContentEditor,onReplaceText:n.replaceText,onToggleInsertArticle:n.toggleInsertArticle},null,8,["conversation-id","enable-multiple-file-upload","has-whatsapp-templates","inbox","is-on-private-note","is-recording-audio","is-send-disabled","mode","on-file-upload","on-send","recording-audio-duration-text","recording-audio-state","send-button-text","show-audio-recorder","show-editor-toggle","show-emoji-picker","show-file-upload","toggle-audio-recorder-play-pause","toggle-audio-recorder","toggle-emoji-picker","message","portal-slug","new-conversation-modal-active","onSelectWhatsappTemplate","onToggleEditor","onReplaceText","onToggleInsertArticle"]),oe(g,{"inbox-id":n.inbox.id,show:o.showWhatsAppTemplatesModal,onClose:n.hideWhatsappTemplatesModal,onOnSend:n.onSendWhatsAppReply,onCancel:n.hideWhatsappTemplatesModal},null,8,["inbox-id","show","onClose","onOnSend","onCancel"]),oe(y,{ref:"confirmDialog",title:e.$t("CONVERSATION.REPLYBOX.UNDEFINED_VARIABLES.TITLE"),description:o.undefinedVariableMessage},null,8,["title","description"])],2)}const O0=je(C0,[["render",N0],["__scopeId","data-v-3ec20a79"]]),k0={mixins:[Rs],props:{sender:{type:Object,default:()=>({})},createdAt:{type:Number,default:0},storySender:{type:String,default:""},externalError:{type:String,default:""},storyId:{type:String,default:""},isEmail:{type:Boolean,default:!0},isPrivate:{type:Boolean,default:!0},isATweet:{type:Boolean,default:!0},messageType:{type:Number,default:1},messageStatus:{type:String,default:""},sourceId:{type:String,default:""},inboxId:{type:[String,Number],default:0}},computed:{inbox(){return this.$store.getters["inboxes/getInbox"](this.inboxId)},isIncoming(){return Bt.INCOMING===this.messageType},isOutgoing(){return Bt.OUTGOING===this.messageType},isTemplate(){return Bt.TEMPLATE===this.messageType},isDelivered(){return Vs.DELIVERED===this.messageStatus},isRead(){return Vs.READ===this.messageStatus},isSent(){return Vs.SENT===this.messageStatus},readableTime(){return gi(this.createdAt,"LLL d, h:mm a")},screenName(){const{additional_attributes:e={}}=this.sender||{};return(e==null?void 0:e.screen_name)||""},linkToTweet(){if(!this.sourceId||!this.inbox.name)return"";const{screenName:e,sourceId:t}=this;return`https://twitter.com/${e||this.inbox.name}/status/${t}`},linkToStory(){if(!this.storyId||!this.storySender)return"";const{storySender:e,storyId:t}=this;return`https://www.instagram.com/stories/direct/${e}_${t}`},showStatusIndicators(){return!!((this.isOutgoing||this.isTemplate)&&!this.isPrivate)},showSentIndicator(){return this.showStatusIndicators?this.isAnEmailChannel?!!this.sourceId:this.isAWhatsAppChannel||this.isATwilioChannel||this.isAFacebookInbox||this.isASmsInbox||this.isATelegramChannel?this.sourceId&&this.isSent:!!this.isALineChannel:!1},showDeliveredIndicator(){return this.showStatusIndicators?this.isAWhatsAppChannel||this.isATwilioChannel||this.isASmsInbox||this.isAFacebookInbox?this.sourceId&&this.isDelivered:this.isAWebWidgetInbox||this.isAPIInbox?this.isSent:this.isALineChannel?this.isDelivered:!1:!1},showReadIndicator(){return this.showStatusIndicators?this.isAWhatsAppChannel||this.isATwilioChannel||this.isAFacebookInbox?this.sourceId&&this.isRead:this.isAWebWidgetInbox||this.isAPIInbox?this.isRead:!1:!1}}},x0={class:"message-text--metadata"},L0={key:0,class:"read-indicator-wrap"},P0={key:1,class:"read-indicator-wrap"},B0={key:2,class:"read-indicator-wrap"},D0={key:3,class:"read-indicator-wrap"},V0=["href"];function G0(e,t,s,i,o,n){const r=ae("fluent-icon"),c=rt("tooltip");return O(),se("div",x0,[q("span",{class:st(["time",{"has-status-icon":n.showSentIndicator||n.showDeliveredIndicator||n.showReadIndicator}])},fe(n.readableTime),3),s.externalError?(O(),se("span",L0,[He(oe(r,{icon:"error-circle",class:"action--icon",size:"14"},null,512),[[c,s.externalError,void 0,{"top-start":!0}]])])):he("",!0),n.showReadIndicator?(O(),se("span",P0,[He(oe(r,{icon:"checkmark-double",class:"action--icon read-tick read-indicator",size:"14"},null,512),[[c,e.$t("CHAT_LIST.MESSAGE_READ"),void 0,{"top-start":!0}]])])):n.showDeliveredIndicator?(O(),se("span",B0,[He(oe(r,{icon:"checkmark-double",class:"action--icon read-tick",size:"14"},null,512),[[c,e.$t("CHAT_LIST.DELIVERED"),void 0,{"top-start":!0}]])])):n.showSentIndicator?(O(),se("span",D0,[He(oe(r,{icon:"checkmark",class:"action--icon read-tick",size:"14"},null,512),[[c,e.$t("CHAT_LIST.SENT"),void 0,{"top-start":!0}]])])):he("",!0),s.isEmail?He((O(),_e(r,{key:4,icon:"mail",class:"action--icon",size:"16"},null,512)),[[c,e.$t("CHAT_LIST.RECEIVED_VIA_EMAIL"),void 0,{"top-start":!0}]]):he("",!0),s.isPrivate?He((O(),_e(r,{key:5,icon:"lock-closed",class:"action--icon lock--icon--private",size:"16",onMouseenter:t[0]||(t[0]=v=>e.isHovered=!0),onMouseleave:t[1]||(t[1]=v=>e.isHovered=!1)},null,512)),[[c,e.$t("CONVERSATION.VISIBLE_TO_AGENTS"),void 0,{"top-start":!0}]]):he("",!0),s.isATweet&&(n.isOutgoing||n.isIncoming)&&n.linkToTweet?(O(),se("a",{key:6,href:n.linkToTweet,target:"_blank",rel:"noopener noreferrer nofollow"},[He(oe(r,{icon:"open",class:"cursor-pointer action--icon",size:"16"},null,512),[[c,e.$t("CHAT_LIST.VIEW_TWEET_IN_TWITTER"),void 0,{"top-start":!0}]])],8,V0)):he("",!0)])}const F0=je(k0,[["render",G0],["__scopeId","data-v-705d330b"]]),$0={props:{name:{type:String,default:""},phoneNumber:{type:String,default:""}},computed:{formattedPhoneNumber(){return this.phoneNumber.replace(/\s|-|[A-Za-z]/g,"")},rawPhoneNumber(){return this.phoneNumber.replace(/\D/g,"")}},methods:{async addContact(){try{let e=await this.filterContactByNumber(this.rawPhoneNumber);e||(e=await this.$store.dispatch("contacts/create",this.getContactObject()),Je(this.$t("CONTACT_FORM.SUCCESS_MESSAGE"))),this.openContactNewTab(e.id)}catch(e){e instanceof yo?e.data.includes("phone_number")&&Je(this.$t("CONTACT_FORM.FORM.PHONE_NUMBER.DUPLICATE")):e instanceof Io?Je(e.data):Je(this.$t("CONTACT_FORM.ERROR_MESSAGE"))}},getContactObject(){return{name:this.name,phone_number:`+${this.rawPhoneNumber}`}},async filterContactByNumber(e){const s={payload:[{attribute_key:"phone_number",filter_operator:"equal_to",values:[e],attribute_model:"standard",custom_attribute_type:""}]};return(await this.$store.dispatch("contacts/filter",{queryPayload:s,resetState:!1})).shift()},openContactNewTab(e){const s=`/app/accounts/${window.location.pathname.split("/")[3]}/contacts/${e}`;window.open(s,"_blank")}}},H0={class:"contact--group"},U0={class:"meta"},W0={class:"overflow-hidden whitespace-nowrap text-ellipsis margin-bottom-0"},j0={key:0,class:"link-wrap"};function Y0(e,t,s,i,o,n){const r=ae("fluent-icon"),c=ae("woot-button");return O(),se("div",H0,[oe(r,{icon:"call",class:"file--icon",size:"18"}),q("div",U0,[q("p",W0,fe(s.phoneNumber),1)]),n.formattedPhoneNumber?(O(),se("div",j0,[oe(c,{variant:"clear",size:"small",onClick:ot(n.addContact,["prevent"])},{default:Oe(()=>[Ke(fe(e.$t("CONVERSATION.SAVE_CONTACT")),1)]),_:1},8,["onClick"])])):he("",!0)])}const X0=je($0,[["render",Y0],["__scopeId","data-v-cf9772ae"]]),z0={props:{url:{type:String,required:!0}},computed:{fileName(){return this.url?this.url.substring(this.url.lastIndexOf("/")+1)||this.$t("CONVERSATION.UNKNOWN_FILE_TYPE"):this.$t("CONVERSATION.UNKNOWN_FILE_TYPE")}},methods:{openLink(){const e=window.open(this.url,"_blank","noopener");e&&e.focus()}}},q0={class:"file message-text__wrap"},K0={class:"icon-wrap"},Q0={class:"meta"},Z0={class:"attachment-name text-slate-700 dark:text-slate-400"},J0=["href"];function e_(e,t,s,i,o,n){const r=ae("fluent-icon");return O(),se("div",q0,[q("div",K0,[oe(r,{icon:"document",class:"file--icon",size:"32"})]),q("div",Q0,[q("h5",Z0,fe(decodeURI(n.fileName)),1),q("a",{class:"download clear link button small",rel:"noreferrer noopener nofollow",target:"_blank",href:s.url},fe(e.$t("CONVERSATION.DOWNLOAD")),9,J0)])])}const t_=je(z0,[["render",e_],["__scopeId","data-v-9e2ca52f"]]),s_={key:0,class:"items-center flex justify-start min-w-[15rem]"},n_={class:"flex flex-col items-start justify-center ml-2 rtl:ml-0 rtl:mr-2"},a_={class:"text-base inline-block leading-[1.4] m-0 p-0 capitalize"},i_={class:"overflow-hidden text-slate-800 dark:text-slate-100 whitespace-nowrap text-ellipsis"},o_={class:"p-0 m-0 overflow-hidden text-xs text-slate-400 dark:text-slate-200 whitespace-nowrap text-ellipsis"},r_={class:"flex items-center justify-start w-auto min-w-0 p-1 text-sm font-semibold text-slate-700 dark:text-slate-100"},l_={class:"overflow-hidden text-slate-700 dark:text-slate-100 whitespace-nowrap text-ellipsis"},c_={class:"items-center flex gap-2 justify-end min-w-[8rem] sm:min-w-[15rem]"},d_={class:"flex items-center justify-center w-full h-full"},u_={class:"flex justify-center min-w-[6.25rem] w-[6.25rem]"},h_={class:"flex flex-col items-center justify-center w-full h-full"},__=["src"],m_=["src"],p_=["src"],f_={class:"flex justify-center min-w-[6.25rem] w-[6.25rem]"},g_={class:"z-10 flex items-center justify-center w-full h-16 px-6 py-2"},b_={class:"items-center rounded-sm flex font-semibold justify-center min-w-[5rem] p-1 bg-slate-25 dark:bg-slate-800 text-slate-600 dark:text-slate-200 text-sm"},v_={class:"count"},Gn=2,Qa=1,Xi={__name:"GalleryView",props:_a({attachment:{type:Object,required:!0},allAttachments:{type:Array,required:!0}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:_a(["close"],["update:show"]),setup(e,{emit:t}){const s=e,i=t,o=lo(e,"show"),n=rn(),r={IMAGE:"image",VIDEO:"video",IG_REEL:"ig_reel",AUDIO:"audio"},c=Ze(1),v=Ze({}),x=Ze(""),h=Ze(s.allAttachments.findIndex(l=>l.message_id===s.attachment.message_id)||0),d=Ze(0),C=We(()=>n.getCurrentUser.value),j=We(()=>s.allAttachments.length>1),V=We(()=>{const{created_at:l}=v.value;return l&&gi(l,"LLL d yyyy, h:mm a")||""}),X=We(()=>x.value===r.IMAGE),Y=We(()=>x.value===r.VIDEO||x.value===r.IG_REEL),I=We(()=>x.value===r.AUDIO),f=We(()=>{var B,b,m;const{name:l,available_name:w,avatar_url:$,thumbnail:z,id:W}=((B=v.value)==null?void 0:B.sender)||((b=s.attachment)==null?void 0:b.sender)||{};return{name:((m=C.value)==null?void 0:m.id)===W?"You":l||w||"",avatar:z||$||""}}),g=We(()=>{const{data_url:l}=v.value;if(!l)return"";const w=l==null?void 0:l.split("/").pop();return decodeURIComponent(w||"")}),y=We(()=>({transform:`rotate(${d.value}deg) scale(${c.value})`,cursor:c.value<Gn?"zoom-in":"zoom-out"})),a=()=>{i("close")},p=l=>{const{file_type:w}=l;Object.values(r).includes(w)&&(v.value=l,x.value=w)},M=(l,w)=>{l&&(h.value=w,p(l),d.value=0,c.value=1)},P=()=>{const{file_type:l,data_url:w}=v.value;if(!Object.values(r).includes(l))return;const $=document.createElement("a");$.href=w,$.download=`attachment.${l}`,$.click()},G=l=>{if(!X.value)return;const w=l==="clockwise"?90:-90;Math.abs(d.value)===360?d.value=w:d.value+=w},N=l=>{if(!X.value)return;const w=c.value+l;if(w>Gn){c.value=Gn;return}if(w<Qa){c.value=Qa;return}c.value=w},F=()=>{N(.1)},pe=l=>{if(!X.value)return;const w=l.deltaY>0?-.1:.1;N(w)};return Jt({Escape:{action:()=>{a()}},ArrowLeft:{action:()=>{M(s.allAttachments[h.value-1],h.value-1)}},ArrowRight:{action:()=>{M(s.allAttachments[h.value+1],h.value+1)}}}),ws(()=>{p(s.attachment)}),(l,w)=>{const $=ae("woot-button"),z=ae("woot-modal"),W=rt("dompurify-html"),ne=rt("on-clickaway");return O(),_e(z,{show:o.value,"onUpdate:show":w[9]||(w[9]=B=>o.value=B),"full-width":"","show-close-button":!1,"on-close":a},{default:Oe(()=>[He((O(),se("div",{class:"bg-white dark:bg-slate-900 flex flex-col h-[inherit] w-[inherit] overflow-hidden",onClick:a},[q("div",{class:"z-10 flex items-center justify-between w-full h-16 px-6 py-2 bg-white dark:bg-slate-900",onClick:w[4]||(w[4]=ot(()=>{},["stop"]))},[f.value?(O(),se("div",s_,[f.value.avatar?(O(),_e(qn,{key:0,username:f.value.name,src:f.value.avatar},null,8,["username","src"])):he("",!0),q("div",n_,[q("h3",a_,[q("span",i_,fe(f.value.name),1)]),q("span",o_,fe(V.value),1)])])):he("",!0),q("div",r_,[He(q("span",l_,null,512),[[W,g.value]])]),q("div",c_,[X.value?(O(),_e($,{key:0,size:"large","color-scheme":"secondary",variant:"clear",icon:"zoom-in",onClick:w[0]||(w[0]=B=>N(.1))})):he("",!0),X.value?(O(),_e($,{key:1,size:"large","color-scheme":"secondary",variant:"clear",icon:"zoom-out",onClick:w[1]||(w[1]=B=>N(-.1))})):he("",!0),X.value?(O(),_e($,{key:2,size:"large","color-scheme":"secondary",variant:"clear",icon:"arrow-rotate-counter-clockwise",onClick:w[2]||(w[2]=B=>G("counter-clockwise"))})):he("",!0),X.value?(O(),_e($,{key:3,size:"large","color-scheme":"secondary",variant:"clear",icon:"arrow-rotate-clockwise",onClick:w[3]||(w[3]=B=>G("clockwise"))})):he("",!0),oe($,{size:"large","color-scheme":"secondary",variant:"clear",icon:"arrow-download",onClick:P}),oe($,{size:"large","color-scheme":"secondary",variant:"clear",icon:"dismiss",onClick:a})])]),q("div",d_,[q("div",u_,[j.value?(O(),_e($,{key:0,class:"z-10",size:"large",variant:"smooth","color-scheme":"primary",icon:"chevron-left",disabled:h.value===0,onClick:w[5]||(w[5]=ot(B=>M(e.allAttachments[h.value-1],h.value-1),["stop"]))},null,8,["disabled"])):he("",!0)]),q("div",h_,[q("div",null,[X.value?(O(),se("img",{key:v.value.message_id,src:v.value.data_url,class:"mx-auto my-0 duration-150 ease-in-out transform modal-image skip-context-menu",style:Yn(y.value),onClick:ot(F,["stop"]),onWheel:ot(pe,["stop"])},null,44,__)):he("",!0),Y.value?(O(),se("video",{key:v.value.message_id,src:v.value.data_url,controls:"",playsInline:"",class:"mx-auto my-0 modal-video skip-context-menu",onClick:w[6]||(w[6]=ot(()=>{},["stop"]))},null,8,m_)):he("",!0),I.value?(O(),se("audio",{key:v.value.message_id,controls:"",class:"skip-context-menu",onClick:w[7]||(w[7]=ot(()=>{},["stop"]))},[q("source",{src:`${v.value.data_url}?t=${Date.now()}`},null,8,p_)])):he("",!0)])]),q("div",f_,[j.value?(O(),_e($,{key:0,class:"z-10",size:"large",variant:"smooth","color-scheme":"primary",disabled:h.value===e.allAttachments.length-1,icon:"chevron-right",onClick:w[8]||(w[8]=ot(B=>M(e.allAttachments[h.value+1],h.value+1),["stop"]))},null,8,["disabled"])):he("",!0)])]),q("div",g_,[q("div",b_,[q("span",v_,fe(`${h.value+1} / ${e.allAttachments.length}`),1)])])])),[[ne,a]])]),_:1},8,["show"])}}},an={IMAGE:"image",VIDEO:"video",AUDIO:"audio",IG_REEL:"ig_reel"},A_={components:{GalleryView:Xi},props:{attachment:{type:Object,required:!0}},emits:["error"],data(){return{show:!1,isImageError:!1}},computed:{...yt({currentChatAttachments:"getSelectedChatAttachments"}),isImage(){return this.attachment.file_type===an.IMAGE},isVideo(){return this.attachment.file_type===an.VIDEO||this.attachment.file_type===an.IG_REEL},isAudio(){return this.attachment.file_type===an.AUDIO},timeStampURL(){return nr(this.dataUrl)},attachmentTypeClasses(){return{image:this.isImage,video:this.isVideo}},filteredCurrentChatAttachments(){return this.currentChatAttachments.filter(t=>["image","video","audio"].includes(t.file_type))},dataUrl(){return this.attachment.data_url},imageWidth(){return this.attachment.width?`${this.attachment.width}px`:"auto"},imageHeight(){return this.attachment.height?`${this.attachment.height}px`:"auto"}},watch:{attachment(){this.isImageError=!1}},methods:{onClose(){this.show=!1},onClick(e){if(jo(e)){window.open(this.attachment.data_url,"_blank");return}this.show=!0},onImgError(){this.isImageError=!0,this.$emit("error")}}},T_=["src","width","height"],E_=["src"],S_={key:2,controls:"",class:"skip-context-menu mb-0.5"},y_=["src"];function I_(e,t,s,i,o,n){const r=ae("GalleryView");return O(),se("div",{class:st(["message-text__wrap",n.attachmentTypeClasses])},[n.isImage&&!o.isImageError?(O(),se("img",{key:0,class:"bg-woot-200 dark:bg-woot-900",src:n.dataUrl,width:n.imageWidth,height:n.imageHeight,onClick:t[0]||(t[0]=(...c)=>n.onClick&&n.onClick(...c)),onError:t[1]||(t[1]=(...c)=>n.onImgError&&n.onImgError(...c))},null,40,T_)):he("",!0),n.isVideo?(O(),se("video",{key:1,src:n.dataUrl,muted:"",playsInline:"",onError:t[2]||(t[2]=(...c)=>n.onImgError&&n.onImgError(...c)),onClick:t[3]||(t[3]=(...c)=>n.onClick&&n.onClick(...c))},null,40,E_)):n.isAudio?(O(),se("audio",S_,[q("source",{src:n.timeStampURL},null,8,y_)])):he("",!0),o.show?(O(),_e(r,{key:3,show:o.show,"onUpdate:show":t[4]||(t[4]=c=>o.show=c),attachment:s.attachment,"all-attachments":n.filteredCurrentChatAttachments,onError:n.onImgError,onClose:n.onClose},null,8,["show","attachment","all-attachments","onError","onClose"])):he("",!0)],2)}const w_=je(A_,[["render",I_]]),R_={props:{messageId:{type:Number,required:!0},meetingData:{type:Object,default:()=>({})}},data(){return{isLoading:!1,dyteAuthToken:"",isSDKMounted:!1}},computed:{meetingLink(){return Cr(this.meetingData.room_name,this.dyteAuthToken)}},methods:{async joinTheCall(){this.isLoading=!0;try{const{data:{authResponse:{authToken:e}={}}={}}=await Ai.addParticipantToMeeting(this.messageId);this.dyteAuthToken=e}catch{Je(this.$t("INTEGRATION_SETTINGS.DYTE.JOIN_ERROR"))}finally{this.isLoading=!1}},leaveTheRoom(){this.dyteAuthToken=""}}},C_={key:0,class:"video-call--container"},M_=["src"];function N_(e,t,s,i,o,n){const r=ae("woot-button");return O(),se("div",null,[oe(r,{size:"small",variant:"smooth","color-scheme":"secondary",icon:"video-add",class:"join-call-button","is-loading":o.isLoading,onClick:n.joinTheCall},{default:Oe(()=>[Ke(fe(e.$t("INTEGRATION_SETTINGS.DYTE.CLICK_HERE_TO_JOIN")),1)]),_:1},8,["is-loading","onClick"]),o.dyteAuthToken?(O(),se("div",C_,[q("iframe",{src:n.meetingLink,allow:"camera;microphone;fullscreen;display-capture;picture-in-picture;clipboard-write;"},null,8,M_),oe(r,{size:"small",variant:"smooth","color-scheme":"secondary",class:"join-call-button",onClick:n.leaveTheRoom},{default:Oe(()=>[Ke(fe(e.$t("INTEGRATION_SETTINGS.DYTE.LEAVE_THE_ROOM")),1)]),_:1},8,["onClick"])])):he("",!0)])}const O_=je(R_,[["render",N_]]),k_={components:{DyteVideoCall:O_},mixins:[Rs],props:{messageId:{type:[String,Number],default:0},contentAttributes:{type:Object,default:()=>({})},inboxId:{type:[String,Number],default:0}},computed:{showDyteIntegration(){return(this.isAPIInbox||this.isAWebWidgetInbox)&&this.contentAttributes.type==="dyte"},inbox(){return this.$store.getters["inboxes/getInbox"](this.inboxId)}}};function x_(e,t,s,i,o,n){const r=ae("DyteVideoCall");return n.showDyteIntegration?(O(),_e(r,{key:0,"message-id":s.messageId,"meeting-data":s.contentAttributes.data},null,8,["message-id","meeting-data"])):he("",!0)}const L_=je(k_,[["render",x_]]),P_={class:"flex flex-row items-center justify-start gap-1 w-full py-1 px-0 cursor-pointer overflow-hidden"},B_={class:"flex flex-col items-start flex-1 min-w-0"},D_=["title"],V_={class:"flex items-center"},G_=["href"],F_={__name:"Location",props:{latitude:{type:Number,default:void 0},longitude:{type:Number,default:void 0},name:{type:String,default:""}},setup(e){const t=e,s=We(()=>`https://maps.google.com/?q=${t.latitude},${t.longitude}`);return(i,o)=>{const n=ae("fluent-icon");return O(),se("div",P_,[oe(n,{icon:"location",class:"text-slate-600 dark:text-slate-200 leading-none my-0 flex items-center flex-shrink-0",size:"32"}),q("div",B_,[q("h5",{class:"text-sm text-slate-800 dark:text-slate-100 truncate m-0 w-full",title:e.name},fe(e.name),9,D_),q("div",V_,[q("a",{class:"text-woot-600 dark:text-woot-600 text-xs underline",rel:"noreferrer noopener nofollow",target:"_blank",href:s.value},fe(i.$t("COMPONENTS.LOCATION_BUBBLE.SEE_ON_MAP")),9,G_)])])])}}},$_={props:{emailAttributes:{type:Object,default:()=>({})},isIncoming:{type:Boolean,default:!0},cc:{type:Array,default:()=>[]},bcc:{type:Array,default:()=>[]}},computed:{fromMail(){return(this.emailAttributes.from||[]).join(", ")},toMails(){return(this.emailAttributes.to||[]).join(", ")},ccMails(){return(this.emailAttributes.cc||this.cc||[]).join(", ")},bccMails(){return(this.emailAttributes.bcc||this.bcc||[]).join(", ")},subject(){return this.emailAttributes.subject||""},showHead(){return this.toMails||this.ccMails||this.bccMails||this.fromMail}}},H_={key:0,class:"meta-wrap"},U_={class:"message__content--type"},W_={key:1,class:"meta-wrap"},j_={class:"message__content--type"},Y_={key:2,class:"meta-wrap"},X_={class:"message__content--type"},z_={key:3,class:"meta-wrap"},q_={class:"message__content--type"},K_={key:4,class:"meta-wrap"},Q_={class:"message__content--type"};function Z_(e,t,s,i,o,n){return n.showHead?(O(),se("div",{key:0,class:st(["message__mail-head",{"is-incoming":s.isIncoming}])},[n.fromMail?(O(),se("div",H_,[q("span",U_,fe(e.$t("EMAIL_HEADER.FROM"))+":",1),q("span",null,fe(n.fromMail),1)])):he("",!0),n.toMails?(O(),se("div",W_,[q("span",j_,fe(e.$t("EMAIL_HEADER.TO"))+":",1),q("span",null,fe(n.toMails),1)])):he("",!0),n.ccMails?(O(),se("div",Y_,[q("span",X_,fe(e.$t("EMAIL_HEADER.CC"))+":",1),q("span",null,fe(n.ccMails),1)])):he("",!0),n.bccMails?(O(),se("div",z_,[q("span",q_,fe(e.$t("EMAIL_HEADER.BCC"))+":",1),q("span",null,fe(n.bccMails),1)])):he("",!0),n.subject?(O(),se("div",K_,[q("span",Q_,fe(e.$t("EMAIL_HEADER.SUBJECT"))+": ",1),q("span",null,fe(n.subject),1)])):he("",!0)],2)):he("",!0)}const J_=je($_,[["render",Z_],["__scopeId","data-v-51e2a9d6"]]),e2={name:"ReplyTo",components:{MessagePreview:_i},props:{message:{type:Object,required:!0},messageType:{type:Number,required:!0},parentHasAttachments:{type:Boolean,required:!0}},data(){return{MESSAGE_TYPE:Bt}},methods:{scrollToMessage(){ht.emit(St.SCROLL_TO_MESSAGE,{messageId:this.message.id})}}};function t2(e,t,s,i,o,n){const r=ae("MessagePreview");return O(),se("div",{class:st(["px-2 py-1.5 rounded-sm min-w-[10rem] mb-2",{"bg-slate-50 dark:bg-slate-600 dark:text-slate-50":s.messageType===o.MESSAGE_TYPE.INCOMING,"bg-woot-600 text-woot-50":s.messageType===o.MESSAGE_TYPE.OUTGOING,"-mx-2":!s.parentHasAttachments}]),onClick:t[0]||(t[0]=(...c)=>n.scrollToMessage&&n.scrollToMessage(...c))},[oe(r,{class:"cursor-pointer",message:s.message,"show-message-type":!1,"default-empty-message":e.$t("CONVERSATION.REPLY_MESSAGE_NOT_FOUND")},null,8,["message","default-empty-message"])],2)}const s2=je(e2,[["render",t2]]),Za={a:["class","href","id","style","target"],address:["class","id","style"],b:["class","id","style"],blockquote:["class","id","style"],br:["class","id","style"],caption:["class","id","style"],cite:["class","id","style"],code:["class","id","style"],col:["align","bgcolor","char","charoff","class","id","style","valign","width"],colgroup:["align","bgcolor","char","charoff","class","id","style","valign","width"],center:["class","id","style"],dd:["class","id","style"],div:["align","class","dir","id","style"],dt:["class","id","style"],em:["class","id","style"],font:["class","color","face","id","size","style"],h1:["align","class","dir","id","style"],h2:["align","class","dir","id","style"],h3:["align","class","dir","id","style"],h4:["align","class","dir","id","style"],h5:["align","class","dir","id","style"],h6:["align","class","dir","id","style"],hr:["align","size","width"],i:["class","id","style"],img:["align","alt","border","class","height","hspace","id","src","style","usemap","vspace","width"],label:["class","id","style"],legend:["class","id","style"],li:["class","dir","id","style","type"],ol:["class","dir","id","style","type","start","reversed"],p:["align","class","dir","id","style"],pre:["class","id","style"],span:["class","id","style"],strong:["class","id","style"],style:[],sub:["class","id","style"],sup:["class","id","style"],table:["align","bgcolor","border","cellpadding","cellspacing","class","dir","frame","id","rules","style","width"],tbody:["class","id","style"],td:["abbr","align","bgcolor","class","colspan","dir","height","id","lang","rowspan","scope","style","valign","width"],tfoot:["align","bgcolor","char","charoff","class","id","style","valign"],th:["abbr","align","bgcolor","class","colspan","dir","height","id","lang","rowspan","scope","style","valign","width"],thead:["align","bgcolol","char","charoff","class","id","style","valign"],tr:["align","bgcolor","char","charoff","class","dir","id","style","valign"],u:["class","id","style"],ul:["class","dir","id","style"]},n2=["script","iframe","textarea","title","noscript","noembed","svg"],a2=["azimuth","background","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-position-x","background-position-y","background-repeat","background-repeat-x","background-repeat-y","background-size","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","box-sizing","break-after","break-before","break-inside","caption-side","clear","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","direction","display","elevation","empty-cells","float","font","font-family","font-feature-settings","font-kerning","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-weight","height","image-orientation","image-resolution","ime-mode","isolation","layout-flow","layout-grid","layout-grid-char","layout-grid-char-spacing","layout-grid-line","layout-grid-mode","layout-grid-type","letter-spacing","line-break","line-height","list-style","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marker-offset","max-height","max-width","min-height","min-width","mix-blend-mode","object-fit","object-position","opacity","outline","outline-color","outline-style","outline-width","overflow","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","pitch","pitch-range","quotes","richness","speak","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","table-layout","text-align","text-align-last","text-autospace","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-style","text-indent","text-justify","text-kashida-space","text-orientation","text-overflow","text-transform","text-underline-position","unicode-bidi","vertical-align","voice-family","white-space","width","word-break","word-spacing","word-wrap","writing-mode","zoom"];function i2(e,t){return t?e.split(",").map(s=>s.trim()).map(s=>{const i=s.replace(/\./g,"."+t+"_").replace(/#/g,"#"+t+"_");return i.toLowerCase().startsWith("body")?"#"+t+" "+i.substring(4):"#"+t+" "+i}).join(","):e}function o2(e,t,s){return e.trim().replace(/expression\((.*?)\)/g,"").replace(/url\(["']?(.*?)["']?\)/g,(i,o)=>s?`url("${encodeURI(s(decodeURI(o)))}")`:t.includes(o.toLowerCase().split(":")[0])?i:"")}function zi(e,t,s,i){if(!e)return;const o=[];for(let n=0;n<e.length;n++){const r=e[n];o.push(r)}for(const n of o)if(a2.includes(n)){const r=e.getPropertyValue(n);e.setProperty(n,o2(r,t,i),s?e.getPropertyPriority(n):void 0)}else e.removeProperty(n)}function Ja(e,t,s,i,o){e.selectorText=i2(e.selectorText,t),zi(e.style,s,i,o)}const ei=["http","https","mailto"];function r2(e,{dropAllHtmlTags:t=!1,rewriteExternalLinks:s,rewriteExternalResources:i,id:o="msg_"+String.fromCharCode(...new Array(24).fill(void 0).map(()=>Math.random()*25%25+65)),allowedSchemas:n=ei,preserveCssPriority:r=!0,noWrapper:c=!1}){var v,x,h,d,C;c&&(o="");const j=new DOMParser().parseFromString(e,"text/html");n=Array.isArray(n)?n.map(g=>g.toLowerCase()):ei;const V=j.createNodeIterator(j.documentElement,NodeFilter.SHOW_COMMENT);let X;for(;X=V.nextNode();)(v=X.parentNode)==null||v.removeChild(X);const Y=[...n2];t&&Y.push("style"),j.querySelectorAll(Y.join(", ")).forEach(g=>g.remove()),j.querySelectorAll("head > style").forEach(g=>{j.body.appendChild(g)});const I=[],f=j.createNodeIterator(j.body,NodeFilter.SHOW_ELEMENT,{acceptNode:()=>NodeFilter.FILTER_ACCEPT});for(;X=f.nextNode();){const g=X,y=g.tagName.toLowerCase();if(!(y==="body"||y==="html")){if(t){if(X.textContent){const a=j.createTextNode(X.textContent);(x=X.parentNode)==null||x.replaceChild(a,X)}else(h=X.parentNode)==null||h.removeChild(X);continue}if(y in Za){const a=Za[y];for(const p of g.getAttributeNames())if(!a.includes(p))g.removeAttribute(p);else if(p==="class"&&!c)g.setAttribute(p,((d=g.getAttribute(p))==null?void 0:d.split(" ").map(M=>o+"_"+M).join(" "))??"");else if(p==="id"&&!c)g.setAttribute(p,o+"_"+(g.getAttribute(p)??""));else if(p==="href"||p==="src"){const M=g.getAttribute(p)??"";p==="href"&&s?g.setAttribute(p,s(M)):p==="src"&&i?g.setAttribute(p,i(M)):n.includes(M.toLowerCase().split(":")[0])||g.removeAttribute(p)}zi(g.style,n,r,i),y==="a"&&(g.setAttribute("rel","noopener noreferrer"),g.setAttribute("target","_blank"))}else g.insertAdjacentHTML("afterend",g.innerHTML),I.push(g)}}for(const g of I)try{try{(C=g.parentNode)==null||C.removeChild(g)}catch{g.outerHTML=""}}catch{try{g.remove()}catch{}}if(j.querySelectorAll("body style").forEach(g=>{const y=g,a=y.sheet,p=[];if(!a.cssRules){y.textContent="";return}for(let M=0;M<a.cssRules.length;M++){const P=a.cssRules[M];if("selectorText"in P)Ja(P,o,n,r,i),p.push(P);else if("cssRules"in P&&"media"in P){const G=P,N=[];for(let F=0;F<G.cssRules.length;F++){const pe=G.cssRules[F];pe.type===pe.STYLE_RULE&&(Ja(pe,o,n,r,i),N.push(pe))}for(;G.cssRules.length>0;)G.deleteRule(0);for(const F of N)G.insertRule(F.cssText,G.cssRules.length);p.push(G)}}y.textContent=p.map(M=>M.cssText).join(`
`)}),c)return j.body.innerHTML;{const g=j.createElement("div");return g.id=o,g.innerHTML=j.body.innerHTML,g.outerHTML}}function l2(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function c2(e,t,s){let i=e??"";return(i==null?void 0:i.length)===0&&t&&(i=l2(t).split(`
`).map(o=>"<p>"+o+"</p>").join(`
`)),r2(i,s??{})}const d2=["innerHTML"],u2=["title"],h2=co({__name:"Letter",props:{className:{},html:{},text:{},useIframe:{type:Boolean},iframeTitle:{},rewriteExternalLinks:{},rewriteExternalResources:{},allowedSchemas:{},preserveCssPriority:{type:Boolean}},setup(e){const t=e,{className:s,html:i,text:o,useIframe:n,iframeTitle:r,rewriteExternalLinks:c,rewriteExternalResources:v,allowedSchemas:x,preserveCssPriority:h}=ai(t),d=c2(i,o,{rewriteExternalResources:v,rewriteExternalLinks:c,allowedSchemas:x,preserveCssPriority:h}),C="data:text/html;charset=utf-8,"+encodeURIComponent(d);return(j,V)=>at(n)?at(n)?(O(),se("div",{key:1,class:st([at(s)])},[q("iframe",{src:C,title:at(r)},null,8,u2)],2)):he("",!0):(O(),se("div",{key:0,class:st([at(s)]),innerHTML:at(d)},null,10,d2))}}),_2={components:{Letter:h2,GalleryView:Xi},props:{message:{type:String,default:""},isEmail:{type:Boolean,default:!0},displayQuotedButton:{type:Boolean,default:!1}},data(){return{showQuotedContent:!1,showGalleryViewer:!1,attachment:{},availableAttachments:[]}},computed:{isQuotedContentPresent(){return this.isEmail?this.showQuotedContent:this.message.includes("<blockquote")},showQuoteToggle(){return this.isEmail?this.displayQuotedButton:!1}},methods:{toggleQuotedContent(){this.showQuotedContent=!this.showQuotedContent},handleClickOnContent(e){const t=e.target.tagName==="IMG",s=e.target.closest("A");t&&!s&&this.openImagePreview(e.target.src)},openImagePreview(e){this.showGalleryViewer=!0,this.attachment={file_type:"image",data_url:e,message_id:Math.floor(Math.random()*100)},this.availableAttachments=[{...this.attachment}]},onClose(){this.showGalleryViewer=!1,this.resetAttachmentData()},resetAttachmentData(){this.attachment={},this.availableAttachments=[]}}},m2={key:0,class:"text-content"},p2={key:0,class:"flex items-center gap-0.5"},f2={key:1,class:"flex items-center gap-0.5"};function g2(e,t,s,i,o,n){const r=ae("Letter"),c=ae("fluent-icon"),v=ae("GalleryView"),x=rt("dompurify-html");return O(),se("div",{class:st(["message-text__wrap",{"show--quoted":n.isQuotedContentPresent,"hide--quoted":!n.isQuotedContentPresent}])},[s.isEmail?(O(),se("div",{key:1,onClick:t[0]||(t[0]=(...h)=>n.handleClickOnContent&&n.handleClickOnContent(...h))},[oe(r,{class:"text-content bg-white dark:bg-white text-slate-900 dark:text-slate-900 p-2 rounded-[4px]",html:s.message},null,8,["html"])])):He((O(),se("div",m2,null,512)),[[x,s.message]]),n.showQuoteToggle?(O(),se("button",{key:2,class:"py-1 text-xs cursor-pointer text-slate-300 dark:text-slate-300",onClick:t[1]||(t[1]=(...h)=>n.toggleQuotedContent&&n.toggleQuotedContent(...h))},[o.showQuotedContent?(O(),se("span",p2,[oe(c,{icon:"chevron-up",size:"16"}),Ke(" "+fe(e.$t("CHAT_LIST.HIDE_QUOTED_TEXT")),1)])):(O(),se("span",f2,[oe(c,{icon:"chevron-down",size:"16"}),Ke(" "+fe(e.$t("CHAT_LIST.SHOW_QUOTED_TEXT")),1)]))])):he("",!0),o.showGalleryViewer?(O(),_e(v,{key:3,show:o.showGalleryViewer,"onUpdate:show":t[2]||(t[2]=h=>o.showGalleryViewer=h),attachment:o.attachment,"all-attachments":o.availableAttachments,onError:n.onClose,onClose:n.onClose},null,8,["show","attachment","all-attachments","onError","onClose"])):he("",!0)],2)}const b2=je(_2,[["render",g2]]),v2={props:{contentAttributes:{type:Object,default:()=>({})},content:{type:String,default:""}},emits:["close"],computed:{translationsAvailable(){return!!Object.keys(this.translations).length},translations(){return this.contentAttributes.translations||{}}},methods:{onClose(){this.$emit("close")}}},A2={class:"content"},T2={class:"mb-0"},E2={key:0},S2={key:1};function y2(e,t,s,i,o,n){const r=ae("woot-modal"),c=rt("dompurify-html");return O(),_e(r,{"modal-type":"right-aligned",class:"text-left",show:"","on-close":n.onClose},{default:Oe(()=>[q("div",A2,[q("p",null,[q("b",null,fe(e.$t("TRANSLATE_MODAL.ORIGINAL_CONTENT")),1)]),He(q("p",T2,null,512),[[c,s.content]]),t[1]||(t[1]=q("br",null,null,-1)),t[2]||(t[2]=q("hr",null,null,-1)),n.translationsAvailable?(O(),se("div",E2,[q("p",null,[q("b",null,fe(e.$t("TRANSLATE_MODAL.TRANSLATED_CONTENT")),1)]),(O(!0),se(vt,null,Et(n.translations,(v,x)=>(O(),se("div",{key:x},[q("p",null,[q("strong",null,fe(x)+":",1)]),He(q("p",null,null,512),[[c,v]]),t[0]||(t[0]=q("br",null,null,-1))]))),128))])):(O(),se("p",S2,fe(e.$t("TRANSLATE_MODAL.NO_TRANSLATIONS_AVAILABLE")),1))])]),_:1},8,["on-close"])}const I2=je(v2,[["render",y2]]),w2={components:{AddCannedModal:Or,TranslateModal:I2,MenuItem:Go,ContextMenu:Nr},props:{message:{type:Object,required:!0},isOpen:{type:Boolean,default:!1},enabledOptions:{type:Object,default:()=>({})},contextMenuPosition:{type:Object,default:()=>({})}},emits:["open","close","replyTo"],setup(){const{getPlainText:e}=Qn();return{getPlainText:e}},data(){return{isCannedResponseModalOpen:!1,showTranslateModal:!1,showDeleteModal:!1}},computed:{...yt({getAccount:"accounts/getAccount",currentAccountId:"getCurrentAccountId"}),plainTextContent(){return this.getPlainText(this.messageContent)},conversationId(){return this.message.conversation_id},messageId(){return this.message.id},messageContent(){return this.message.content},contentAttributes(){return this.message.content_attributes}},methods:{async copyLinkToMessage(){const e=window.chatwootConfig.hostURL+ar(ir({id:this.conversationId,accountId:this.currentAccountId}));await Hn(`${e}?messageId=${this.messageId}`),Je(this.$t("CONVERSATION.CONTEXT_MENU.LINK_COPIED")),this.handleClose()},async handleCopy(){await Hn(this.plainTextContent),Je(this.$t("CONTACT_PANEL.COPY_SUCCESSFUL")),this.handleClose()},showCannedResponseModal(){Kt(ui.ADDED_TO_CANNED_RESPONSE),this.isCannedResponseModalOpen=!0},hideCannedResponseModal(){this.isCannedResponseModalOpen=!1,this.handleClose()},handleOpen(e){this.$emit("open",e)},handleClose(e){this.$emit("close",e)},handleTranslate(){const{locale:e}=this.getAccount(this.currentAccountId);this.$store.dispatch("translateMessage",{conversationId:this.conversationId,messageId:this.messageId,targetLanguage:e||"en"}),Kt(hs.TRANSLATE_A_MESSAGE),this.handleClose(),this.showTranslateModal=!0},handleReplyTo(){this.$emit("replyTo",this.message),this.handleClose()},onCloseTranslateModal(){this.showTranslateModal=!1},openDeleteModal(){this.handleClose(),this.showDeleteModal=!0},async confirmDeletion(){try{await this.$store.dispatch("deleteMessage",{conversationId:this.conversationId,messageId:this.messageId}),Je(this.$t("CONVERSATION.SUCCESS_DELETE_MESSAGE")),this.handleClose()}catch{Je(this.$t("CONVERSATION.FAIL_DELETE_MESSSAGE"))}},closeDeleteModal(){this.showDeleteModal=!1}}},R2={class:"context-menu"},C2={class:"menu-container"},M2={key:4};function N2(e,t,s,i,o,n){const r=ae("AddCannedModal"),c=ae("woot-modal"),v=ae("TranslateModal"),x=ae("woot-delete-modal"),h=ae("woot-button"),d=ae("MenuItem"),C=ae("ContextMenu");return O(),se("div",R2,[o.isCannedResponseModalOpen&&s.enabledOptions.cannedResponse?(O(),_e(c,{key:0,show:o.isCannedResponseModalOpen,"onUpdate:show":t[0]||(t[0]=j=>o.isCannedResponseModalOpen=j),"on-close":n.hideCannedResponseModal},{default:Oe(()=>[oe(r,{"response-content":n.plainTextContent,"on-close":n.hideCannedResponseModal},null,8,["response-content","on-close"])]),_:1},8,["show","on-close"])):he("",!0),o.showTranslateModal?(O(),_e(v,{key:1,content:n.messageContent,"content-attributes":n.contentAttributes,onClose:n.onCloseTranslateModal},null,8,["content","content-attributes","onClose"])):he("",!0),o.showDeleteModal?(O(),_e(x,{key:2,show:o.showDeleteModal,"onUpdate:show":t[1]||(t[1]=j=>o.showDeleteModal=j),class:"context-menu--delete-modal","on-close":n.closeDeleteModal,"on-confirm":n.confirmDeletion,title:e.$t("CONVERSATION.CONTEXT_MENU.DELETE_CONFIRMATION.TITLE"),message:e.$t("CONVERSATION.CONTEXT_MENU.DELETE_CONFIRMATION.MESSAGE"),"confirm-text":e.$t("CONVERSATION.CONTEXT_MENU.DELETE_CONFIRMATION.DELETE"),"reject-text":e.$t("CONVERSATION.CONTEXT_MENU.DELETE_CONFIRMATION.CANCEL")},null,8,["show","on-close","on-confirm","title","message","confirm-text","reject-text"])):he("",!0),oe(h,{icon:"more-vertical","color-scheme":"secondary",variant:"clear",size:"small",onClick:n.handleOpen},null,8,["onClick"]),s.isOpen&&!o.isCannedResponseModalOpen?(O(),_e(C,{key:3,x:s.contextMenuPosition.x,y:s.contextMenuPosition.y,onClose:n.handleClose},{default:Oe(()=>[q("div",C2,[s.enabledOptions.replyTo?(O(),_e(d,{key:0,option:{icon:"arrow-reply",label:e.$t("CONVERSATION.CONTEXT_MENU.REPLY_TO")},variant:"icon",onClick:ot(n.handleReplyTo,["stop"])},null,8,["option","onClick"])):he("",!0),s.enabledOptions.copy?(O(),_e(d,{key:1,option:{icon:"clipboard",label:e.$t("CONVERSATION.CONTEXT_MENU.COPY")},variant:"icon",onClick:ot(n.handleCopy,["stop"])},null,8,["option","onClick"])):he("",!0),s.enabledOptions.copy?(O(),_e(d,{key:2,option:{icon:"translate",label:e.$t("CONVERSATION.CONTEXT_MENU.TRANSLATE")},variant:"icon",onClick:ot(n.handleTranslate,["stop"])},null,8,["option","onClick"])):he("",!0),t[2]||(t[2]=q("hr",null,null,-1)),oe(d,{option:{icon:"link",label:e.$t("CONVERSATION.CONTEXT_MENU.COPY_PERMALINK")},variant:"icon",onClick:ot(n.copyLinkToMessage,["stop"])},null,8,["option","onClick"]),s.enabledOptions.cannedResponse?(O(),_e(d,{key:3,option:{icon:"comment-add",label:e.$t("CONVERSATION.CONTEXT_MENU.CREATE_A_CANNED_RESPONSE")},variant:"icon",onClick:ot(n.showCannedResponseModal,["stop"])},null,8,["option","onClick"])):he("",!0),s.enabledOptions.delete?(O(),se("hr",M2)):he("",!0),s.enabledOptions.delete?(O(),_e(d,{key:5,option:{icon:"delete",label:e.$t("CONVERSATION.CONTEXT_MENU.DELETE")},variant:"icon",onClick:ot(n.openDeleteModal,["stop"])},null,8,["option","onClick"])):he("",!0)])]),_:1},8,["x","y","onClose"])):he("",!0)])}const O2=je(w2,[["render",N2],["__scopeId","data-v-b2d80122"]]),k2={components:{},props:{url:{type:String,required:!0}},emits:["error"],data(){return{show:!1}},methods:{onClose(){this.show=!1},onClick(){this.show=!0}}},x2={class:"image message-text__wrap"},L2=["src"],P2=["src"];function B2(e,t,s,i,o,n){const r=ae("woot-modal");return O(),se("div",x2,[q("img",{src:s.url,onClick:t[0]||(t[0]=(...c)=>n.onClick&&n.onClick(...c)),onError:t[1]||(t[1]=c=>e.$emit("error"))},null,40,L2),oe(r,{show:o.show,"onUpdate:show":t[2]||(t[2]=c=>o.show=c),"full-width":"","on-close":n.onClose},{default:Oe(()=>[q("img",{src:s.url,class:"modal-image skip-context-menu"},null,8,P2)]),_:1},8,["show","on-close"])])}const D2=je(k2,[["render",B2]]),V2={props:{url:{type:String,required:!0}},emits:["error"],data(){return{show:!1}},mounted(){this.$refs.videoElement.onerror=()=>{this.$emit("error")}},methods:{onClose(){this.show=!1},onClick(){this.show=!0}}},G2={class:"video message-text__wrap"},F2=["src"],$2=["src"];function H2(e,t,s,i,o,n){const r=ae("woot-modal");return O(),se("div",G2,[q("video",{ref:"videoElement",src:s.url,muted:"",playsInline:"",onClick:t[0]||(t[0]=(...c)=>n.onClick&&n.onClick(...c))},null,8,F2),oe(r,{show:o.show,"onUpdate:show":t[1]||(t[1]=c=>o.show=c),"on-close":n.onClose},{default:Oe(()=>[q("video",{src:s.url,controls:"",playsInline:"",class:"modal-video skip-context-menu mx-auto"},null,8,$2)]),_:1},8,["show","on-close"])])}const U2=je(V2,[["render",H2]]),W2={},j2={class:"flex items-center justify-center px-8 h-28 w-full bg-slate-100 text-slate-700 dark:bg-slate-500 dark:text-slate-75"},Y2={class:"mb-0 text-slate-700 dark:text-slate-75"};function X2(e,t,s,i,o,n){const r=ae("fluent-icon");return O(),se("div",j2,[oe(r,{icon:"document-error",size:"32"}),q("p",Y2,fe(e.$t("COMPONENTS.FILE_BUBBLE.INSTAGRAM_STORY_UNAVAILABLE")),1)])}const z2=je(W2,[["render",X2]]),q2={components:{BubbleImage:D2,BubbleVideo:U2,InstagramStoryErrorPlaceHolder:z2},props:{storyUrl:{type:String,default:""}},emits:["error"],data(){return{hasImgStoryError:!1,hasVideoStoryError:!1}},methods:{onImageLoadError(){this.hasImgStoryError=!0,this.emitError()},onVideoLoadError(){this.hasVideoStoryError=!0,this.emitError()},emitError(){this.$emit("error")}}};function K2(e,t,s,i,o,n){const r=ae("BubbleImage"),c=ae("BubbleVideo"),v=ae("InstagramStoryErrorPlaceHolder");return o.hasImgStoryError?o.hasVideoStoryError?(O(),_e(v,{key:2})):(O(),_e(c,{key:1,url:s.storyUrl,onError:n.onVideoLoadError},null,8,["url","onError"])):(O(),_e(r,{key:0,url:s.storyUrl,onError:n.onImageLoadError},null,8,["url","onError"]))}const qi=je(q2,[["render",K2]]),Q2={components:{InstagramStory:qi},props:{storyUrl:{type:String,default:""}},data(){return{hasImgStoryError:!1,hasVideoStoryError:!1}},methods:{onImageLoadError(){this.hasImgStoryError=!0},onVideoLoadError(){this.hasVideoStoryError=!0}}},Z2={class:"my-0 px-2 pb-0 pt-0 border-l-4 border-solid border-slate-75 dark:border-slate-600 text-slate-600 dark:text-slate-200"};function J2(e,t,s,i,o,n){const r=ae("InstagramStory");return O(),se("blockquote",Z2,[q("span",null,fe(e.$t("CONVERSATION.REPLIED_TO_STORY")),1),oe(r,{"story-url":s.storyUrl,class:"mt-3 rounded-md"},null,8,["story-url"])])}const em=je(Q2,[["render",J2]]),tm={INCOMING_EMAIL:"incoming_email"},sm=e=>{const{submitted_values:t=[]}=e,[s]=t;return s&&s.title?`<strong>${s.title}</strong>`:""},nm=e=>{const{submitted_email:t=""}=e;return t?`<strong>${t}</strong>`:""},am=(e,{noResponseText:t})=>{const{items:s,submitted_values:i=[]}=e;if(i.length){const o=i.reduce((r,c)=>(r[c.name]=c.value,r),{});let n="";return s.forEach(r=>{n+=`<div>${r.label}</div>`;const c=o[r.name]||t;n+=`<strong>${c}</strong><br/><br/>`}),n}return""},im=(e,{ratingTitle:t,feedbackTitle:s})=>{const{submitted_values:{csat_survey_response:i={}}={}}=e,{rating:o,feedback_message:n}=i||{};let r="";if(o){const[c={}]=to.filter(v=>v.value===o);r+=`<div><strong>${t}</strong></div>`,r+=`<p>${c.emoji}</p>`}return n&&(r+=`<div><strong>${s}</strong></div>`,r+=`<p>${n}</p>`),r},om=(e,t,{noResponseText:s="No response",csat:{ratingTitle:i="Rating",feedbackTitle:o="Feedback"}={}}={})=>{const r={input_select:sm,input_email:nm,form:am,input_csat:im}[e];return r&&typeof r=="function"?r(t,{noResponseText:s,ratingTitle:i,feedbackTitle:o}):""},rm={components:{BubbleActions:F0,BubbleContact:X0,BubbleFile:t_,BubbleImageAudioVideo:w_,BubbleIntegration:L_,BubbleLocation:F_,BubbleMailHead:J_,BubbleReplyTo:s2,BubbleText:b2,ContextMenu:O2,InstagramStory:qi,InstagramStoryReply:em,Spinner:zn},props:{data:{type:Object,required:!0},isATweet:{type:Boolean,default:!1},isAFacebookInbox:{type:Boolean,default:!1},isInstagram:{type:Boolean,default:!1},isAWhatsAppChannel:{type:Boolean,default:!1},isAnEmailInbox:{type:Boolean,default:!1},inboxSupportsReplyTo:{type:Object,default:()=>({})},inReplyTo:{type:Object,default:()=>({})}},setup(){const{formatMessage:e}=Qn();return{formatMessage:e}},data(){return{showContextMenu:!1,hasMediaLoadError:!1,contextMenuPosition:{},showBackgroundHighlight:!1}},computed:{attachments(){var e;return(e=this.data)==null?void 0:e.attachments.map(t=>({...t,sender:this.data.sender||{},created_at:this.data.created_at||""}))},hasOneDayPassed(){var e;return kr(new Date,(e=this.data)==null?void 0:e.created_at)>=1},shouldRenderMessage(){return this.hasAttachments||this.data.content||this.isEmailContentType||this.isUnsupported||this.isAnIntegrationMessage},emailMessageContent(){const{html_content:{full:e}={},text_content:{full:t}={}}=this.contentAttributes.email||{};return e||(t?t.replace(/\n/g,"<br>"):"")},displayQuotedButton(){return this.emailMessageContent.includes("<blockquote")?!0:(this.isIncoming,!1)},message(){if(this.emailMessageContent&&this.isIncoming)return this.emailMessageContent;const e=om(this.contentType,this.contentAttributes,{noResponseText:this.$t("CONVERSATION.NO_RESPONSE"),csat:{ratingTitle:this.$t("CONVERSATION.RATING_TITLE"),feedbackTitle:this.$t("CONVERSATION.FEEDBACK_TITLE")}});return this.contentType==="input_csat"?this.$t("CONVERSATION.CSAT_REPLY_MESSAGE")+e:this.formatMessage(this.data.content,this.isATweet,this.data.private)+e},inReplyToMessageId(){var e;return(e=this.data.content_attributes)==null?void 0:e.in_reply_to},isAnInstagramStory(){return this.contentAttributes.image_type==="story_mention"},contextMenuEnabledOptions(){return{copy:this.hasText,delete:this.hasText||this.hasAttachments,cannedResponse:this.isOutgoing&&this.hasText,replyTo:!this.data.private&&this.inboxSupportsReplyTo.outgoing}},contentAttributes(){return this.data.content_attributes||{}},externalError(){return this.contentAttributes.external_error||""},sender(){return this.data.sender||{}},status(){return this.data.status},storySender(){return this.contentAttributes.story_sender||null},storyId(){return this.contentAttributes.story_id||null},storyUrl(){return this.contentAttributes.story_url||null},contentType(){const{data:{content_type:e}}=this;return e},twitterProfileLink(){const e=this.sender.additional_attributes||{},{screen_name:t}=e;return`https://twitter.com/${t}`},alignBubble(){const{message_type:e}=this.data,t=e===Bt.ACTIVITY,s=e===Bt.INCOMING,i=e===Bt.OUTGOING||e===Bt.TEMPLATE;return{center:t,left:s,right:i,"has-context-menu":this.showContextMenu,"has-tweet-menu":this.isATweet,"has-bg":this.showBackgroundHighlight}},createdAt(){return this.contentAttributes.external_created_at||this.data.created_at},isBubble(){return[0,1,3].includes(this.data.message_type)},isIncoming(){return this.data.message_type===Bt.INCOMING},isOutgoing(){return this.data.message_type===Bt.OUTGOING},isTemplate(){return this.data.message_type===Bt.TEMPLATE},isAnIntegrationMessage(){return this.contentType==="integrations"},emailHeadAttributes(){return{email:this.contentAttributes.email,cc:this.contentAttributes.cc_emails,bcc:this.contentAttributes.bcc_emails}},hasAttachments(){return!!(this.data.attachments&&this.data.attachments.length>0)},isMessageDeleted(){return this.contentAttributes.deleted},hasText(){return!!this.data.content},tooltipForSender(){const e=this.senderNameForAvatar,{message_type:t}=this.data;return t===Bt.OUTGOING||t===Bt.TEMPLATE?{content:`${this.$t("CONVERSATION.SENT_BY")} ${e}`}:!1},errorMessageTooltip(){return this.isFailed?this.externalError||this.$t("CONVERSATION.SEND_FAILED"):""},wrapClass(){return{wrap:this.isBubble,"activity-wrap":!this.isBubble,"is-pending":this.isPending,"is-failed":this.isFailed,"is-email":this.isEmailContentType}},bubbleClass(){return{bubble:this.isBubble,"is-private":this.data.private,"is-unsupported":this.isUnsupported,"is-image":this.hasMediaAttachment("image"),"is-video":this.hasMediaAttachment("video"),"is-text":this.hasText,"is-from-bot":this.isSentByBot,"is-failed":this.isFailed,"is-email":this.isEmailContentType}},isUnsupported(){return this.contentAttributes.is_unsupported??!1},isPending(){return this.data.status===Vs.PROGRESS},isFailed(){return this.data.status===Vs.FAILED},isSentByBot(){return this.isPending||this.isFailed?!1:!this.sender.type||this.sender.type==="agent_bot"},shouldShowContextMenu(){return!(this.isFailed||this.isPending||this.isUnsupported)},showAvatar(){return this.isOutgoing||this.isTemplate?!0:this.isATweet&&this.isIncoming&&this.sender},senderNameForAvatar(){if(this.isOutgoing||this.isTemplate){const{name:e=this.$t("CONVERSATION.BOT")}=this.sender||{};return e}return""},isEmailContentType(){return this.contentType===tm.INCOMING_EMAIL}},watch:{data(){this.hasMediaLoadError=!1}},mounted(){this.hasMediaLoadError=!1,ht.on(St.ON_MESSAGE_LIST_SCROLL,this.closeContextMenu),this.setupHighlightTimer()},unmounted(){ht.off(St.ON_MESSAGE_LIST_SCROLL,this.closeContextMenu),clearTimeout(this.higlightTimeout)},methods:{isAttachmentImageVideoAudio(e){return["image","audio","video","story_mention","ig_reel"].includes(e)},hasMediaAttachment(e){return this.hasAttachments&&this.data.attachments.length>0?this.compareMessageFileType(this.data,e):!1},compareMessageFileType(e,t){try{const{attachments:s=[{}]}=e,{file_type:i}=s[0];return i===t&&!this.hasMediaLoadError}catch(s){return xr("attachment-parsing-error",{messageData:e,type:t,hasMediaLoadError:this.hasMediaLoadError}),Lr(s),!1}},handleContextMenuClick(){this.showContextMenu=!this.showContextMenu},async retrySendMessage(){await this.$store.dispatch("sendMessageWithData",this.data)},onMediaLoadError(){this.hasMediaLoadError=!0},openContextMenu(e){var s,i;(s=e.target)!=null&&s.classList.contains("skip-context-menu")||((i=e.target)==null?void 0:i.tagName.toLowerCase())==="a"||getSelection().toString()||(e.preventDefault(),e.type==="contextmenu"&&Kt(ui.OPEN_MESSAGE_CONTEXT_MENU),this.contextMenuPosition={x:e.pageX||e.clientX,y:e.pageY||e.clientY},this.showContextMenu=!0)},closeContextMenu(){this.showContextMenu=!1,this.contextMenuPosition={x:null,y:null}},handleReplyTo(){const e=Ss.MESSAGE_REPLY_TO,{conversation_id:t,id:s}=this.data;Es.updateJsonStore(e,t,s),ht.emit(St.TOGGLE_REPLY_TO_MESSAGE,this.data)},setupHighlightTimer(){if(Number(this.$route.query.messageId)!==Number(this.data.id))return;this.showBackgroundHighlight=!0;const e=1e3;this.higlightTimeout=setTimeout(()=>{this.showBackgroundHighlight=!1},e)}}},lm=["id"],cm={key:0,class:"message-failed--alert"},dm={key:2},um={key:4,class:"chat-bubble has-attachment agent"},hm={key:5},_m={key:2,class:"sender--info"},mm=["href"],pm={key:0,class:"invisible context-menu-wrap group-hover:visible"};function fm(e,t,s,i,o,n){const r=ae("woot-button"),c=ae("BubbleMailHead"),v=ae("InstagramStoryReply"),x=ae("BubbleReplyTo"),h=ae("BubbleText"),d=ae("BubbleIntegration"),C=ae("InstagramStory"),j=ae("BubbleImageAudioVideo"),V=ae("BubbleLocation"),X=ae("BubbleContact"),Y=ae("BubbleFile"),I=ae("BubbleActions"),f=ae("Spinner"),g=ae("woot-thumbnail"),y=ae("ContextMenu"),a=rt("tooltip");return n.shouldRenderMessage?(O(),se("li",{key:0,id:`message${s.data.id}`,class:st(["group",[n.alignBubble]])},[q("div",{class:st(n.wrapClass)},[n.isFailed&&!n.hasOneDayPassed&&!s.isAnEmailInbox?(O(),se("div",cm,[He(oe(r,{size:"tiny","color-scheme":"alert",variant:"clear",icon:"arrow-clockwise",onClick:n.retrySendMessage},null,8,["onClick"]),[[a,e.$t("CONVERSATION.TRY_AGAIN"),void 0,{"top-end":!0}]])])):he("",!0),q("div",{class:st(n.bubbleClass),onContextmenu:t[0]||(t[0]=p=>n.openContextMenu(p))},[oe(c,{"email-attributes":n.contentAttributes.email,cc:n.emailHeadAttributes.cc,bcc:n.emailHeadAttributes.bcc,"is-incoming":n.isIncoming},null,8,["email-attributes","cc","bcc","is-incoming"]),n.storyUrl?(O(),_e(v,{key:0,"story-url":n.storyUrl},null,8,["story-url"])):he("",!0),n.inReplyToMessageId&&s.inboxSupportsReplyTo.incoming?(O(),_e(x,{key:1,message:s.inReplyTo,"message-type":s.data.message_type,"parent-has-attachments":n.hasAttachments},null,8,["message","message-type","parent-has-attachments"])):he("",!0),n.isUnsupported?(O(),se("div",dm,[s.isAFacebookInbox&&s.isInstagram?(O(),se(vt,{key:0},[Ke(fe(e.$t("CONVERSATION.UNSUPPORTED_MESSAGE_INSTAGRAM")),1)],64)):s.isAFacebookInbox?(O(),se(vt,{key:1},[Ke(fe(e.$t("CONVERSATION.UNSUPPORTED_MESSAGE_FACEBOOK")),1)],64)):(O(),se(vt,{key:2},[Ke(fe(e.$t("CONVERSATION.UNSUPPORTED_MESSAGE")),1)],64))])):s.data.content?(O(),_e(h,{key:3,message:n.message,"is-email":n.isEmailContentType,"display-quoted-button":n.displayQuotedButton},null,8,["message","is-email","display-quoted-button"])):he("",!0),oe(d,{"message-id":s.data.id,"content-attributes":n.contentAttributes,"inbox-id":s.data.inbox_id},null,8,["message-id","content-attributes","inbox-id"]),n.isPending&&n.hasAttachments?(O(),se("span",um,fe(e.$t("CONVERSATION.UPLOADING_ATTACHMENTS")),1)):he("",!0),!n.isPending&&n.hasAttachments?(O(),se("div",hm,[(O(!0),se(vt,null,Et(n.attachments,p=>(O(),se("div",{key:p.id},[n.isAnInstagramStory?(O(),_e(C,{key:0,"story-url":p.data_url,onError:n.onMediaLoadError},null,8,["story-url","onError"])):n.isAttachmentImageVideoAudio(p.file_type)?(O(),_e(j,{key:1,attachment:p,onError:n.onMediaLoadError},null,8,["attachment","onError"])):p.file_type==="location"?(O(),_e(V,{key:2,latitude:p.coordinates_lat,longitude:p.coordinates_long,name:p.fallback_title},null,8,["latitude","longitude","name"])):p.file_type==="contact"?(O(),_e(X,{key:3,name:s.data.content,"phone-number":p.fallback_title},null,8,["name","phone-number"])):(O(),_e(Y,{key:4,url:p.data_url},null,8,["url"]))]))),128))])):he("",!0),oe(I,{id:s.data.id,sender:s.data.sender,"story-sender":n.storySender,"external-error":n.errorMessageTooltip,"story-id":`${n.storyId}`,"is-a-tweet":s.isATweet,"is-a-whatsapp-channel":s.isAWhatsAppChannel,"is-email":n.isEmailContentType,"is-private":s.data.private,"message-type":s.data.message_type,"message-status":n.status,"source-id":s.data.source_id,"inbox-id":s.data.inbox_id,"created-at":n.createdAt},null,8,["id","sender","story-sender","external-error","story-id","is-a-tweet","is-a-whatsapp-channel","is-email","is-private","message-type","message-status","source-id","inbox-id","created-at"])],34),n.isPending?(O(),_e(f,{key:1,size:"tiny"})):he("",!0),n.showAvatar?He((O(),se("div",_m,[oe(g,{src:n.sender.thumbnail,username:n.senderNameForAvatar,size:"16px"},null,8,["src","username"]),s.isATweet&&n.isIncoming?(O(),se("a",{key:0,class:"sender--available-name",href:n.twitterProfileLink,target:"_blank",rel:"noopener noreferrer nofollow"},fe(n.sender.name),9,mm)):he("",!0)])),[[a,n.tooltipForSender,void 0,{left:!0}]]):he("",!0)],2),n.shouldShowContextMenu?(O(),se("div",pm,[n.isBubble&&!n.isMessageDeleted?(O(),_e(y,{key:0,"context-menu-position":o.contextMenuPosition,"is-open":o.showContextMenu,"enabled-options":n.contextMenuEnabledOptions,message:s.data,onOpen:n.openContextMenu,onClose:n.closeContextMenu,onReplyTo:n.handleReplyTo},null,8,["context-menu-position","is-open","enabled-options","message","onOpen","onClose","onReplyTo"])):he("",!0)])):he("",!0)],10,lm)):he("",!0)}const gm=je(rm,[["render",fm]]),bm={name:"LabelSuggestion",components:{Avatar:Yo,WootButton:gr},props:{suggestedLabels:{type:Array,required:!0},chatLabels:{type:Array,required:!1,default:()=>[]}},setup(){const{isAIIntegrationEnabled:e}=Us();return{isAIIntegrationEnabled:e}},data(){return{isDismissed:!1,isHovered:!1,selectedLabels:[]}},computed:{...yt({allLabels:"labels/getLabels",currentAccountId:"getCurrentAccountId",currentChat:"getSelectedChat"}),conversationId(){var e;return(e=this.currentChat)==null?void 0:e.id},labelTooltip(){return this.preparedLabels.length>1?this.$t("LABEL_MGMT.SUGGESTIONS.TOOLTIP.MULTIPLE_SUGGESTION"):this.$t("LABEL_MGMT.SUGGESTIONS.TOOLTIP.SINGLE_SUGGESTION")},addButtonText(){return this.selectedLabels.length===1?this.$t("LABEL_MGMT.SUGGESTIONS.ADD_SELECTED_LABEL"):this.selectedLabels.length>1?this.$t("LABEL_MGMT.SUGGESTIONS.ADD_SELECTED_LABELS"):this.$t("LABEL_MGMT.SUGGESTIONS.ADD_ALL_LABELS")},preparedLabels(){return this.allLabels.filter(e=>this.suggestedLabels.includes(e.title))},shouldShowSuggestions(){return this.isDismissed||!this.isAIIntegrationEnabled?!1:this.preparedLabels.length&&this.chatLabels.length===0}},watch:{conversationId:{immediate:!0,handler(){this.selectedLabels=[],this.isDismissed=this.isConversationDismissed()}}},methods:{pushOrAddLabel(e){if(this.preparedLabels.length===1){this.addAllLabels();return}this.selectedLabels.includes(e)?this.selectedLabels=this.selectedLabels.filter(t=>t!==e):this.selectedLabels.push(e)},dismissSuggestions(){Es.setFlag(Ss.DISMISSED_LABEL_SUGGESTIONS,this.currentAccountId,this.conversationId),this.isDismissed=!0,this.trackLabelEvent($n.DISMISS_LABEL_SUGGESTION)},isConversationDismissed(){return Es.getFlag(Ss.DISMISSED_LABEL_SUGGESTIONS,this.currentAccountId,this.conversationId)},addAllLabels(){let e=this.selectedLabels;e.length||(e=this.preparedLabels.map(t=>t.title)),this.$store.dispatch("conversationLabels/update",{conversationId:this.conversationId,labels:e}),this.trackLabelEvent($n.APPLY_LABEL_SUGGESTION)},trackLabelEvent(e){const t={conversationId:this.conversationId,account:this.currentAccountId,suggestions:this.suggestedLabels,labelsApplied:this.selectedLabels.length?this.selectedLabels:this.suggestedLabels};Kt(e,t)}}},vm={class:"wrap"},Am={class:"label-suggestion--container"},Tm={class:"label-suggestion--title"},Em={class:"label-suggestion--options"},Sm=["onClick"],ym={key:0},Im={class:"sender--info has-tooltip","data-original-title":"null"};function wm(e,t,s,i,o,n){const r=ae("woot-label"),c=ae("WootButton"),v=ae("fluent-icon"),x=ae("Avatar"),h=ae("woot-thumbnail"),d=rt("tooltip");return n.shouldShowSuggestions?(O(),se("li",{key:0,class:"label-suggestion right",onMouseover:t[0]||(t[0]=C=>o.isHovered=!0),onMouseleave:t[1]||(t[1]=C=>o.isHovered=!1)},[q("div",vm,[q("div",Am,[q("h6",Tm,fe(e.$t("LABEL_MGMT.SUGGESTIONS.SUGGESTED_LABELS")),1),q("div",Em,[(O(!0),se(vt,null,Et(n.preparedLabels,C=>He((O(),se("button",{key:C.title,class:"label-suggestion--option !px-0",onClick:j=>n.pushOrAddLabel(C.title)},[oe(r,uo({variant:"dashed",ref_for:!0},C,{"bg-color":o.selectedLabels.includes(C.title)?"var(--w-100)":""}),null,16,["bg-color"])],8,Sm)),[[d,{content:o.selectedLabels.includes(C.title)?e.$t("LABEL_MGMT.SUGGESTIONS.TOOLTIP.DESELECT"):n.labelTooltip,delay:{show:600,hide:0},hideOnClick:!0},void 0,{top:!0}]])),128)),n.preparedLabels.length===1?He((O(),_e(c,{key:0,variant:"smooth","color-scheme":o.isHovered?"alert":"primary",class:"label--add",icon:"dismiss",size:"tiny",onClick:n.dismissSuggestions},null,8,["color-scheme","onClick"])),[[d,{content:e.$t("LABEL_MGMT.SUGGESTIONS.TOOLTIP.DISMISS"),delay:{show:600,hide:0},hideOnClick:!0},void 0,{top:!0}]]):he("",!0)]),n.preparedLabels.length>1?(O(),se("div",ym,[oe(c,{variant:o.selectedLabels.length===0?"smooth":"",class:"label--add",icon:"add",size:"tiny",onClick:n.addAllLabels},{default:Oe(()=>[Ke(fe(n.addButtonText),1)]),_:1},8,["variant","onClick"]),He(oe(c,{"color-scheme":o.isHovered?"alert":"primary",variant:"smooth",class:"label--add",icon:"dismiss",size:"tiny",onClick:n.dismissSuggestions},null,8,["color-scheme","onClick"]),[[d,{content:e.$t("LABEL_MGMT.SUGGESTIONS.TOOLTIP.DISMISS"),delay:{show:600,hide:0},hideOnClick:!0},void 0,{top:!0}]])])):he("",!0)]),q("div",Im,[He((O(),_e(h,{size:"16px"},{default:Oe(()=>[oe(x,{class:"user-thumbnail thumbnail-rounded"},{default:Oe(()=>[oe(v,{class:"chatwoot-ai-icon",icon:"chatwoot-ai"})]),_:1})]),_:1})),[[d,{content:e.$t("LABEL_MGMT.SUGGESTIONS.POWERED_BY"),delay:{show:600,hide:0},hideOnClick:!0},void 0,{top:!0}]])])])],32)):he("",!0)}const Rm=je(bm,[["render",wm],["__scopeId","data-v-c33dbef4"]]),Cm=(e,t)=>e+t.scrollHeight,Mm=(e,t,s)=>{let i=[...s].reduce(Cm,0);return e-i-t/2},ti={FACEBOOK:"https://developers.facebook.com/docs/messenger-platform/policy/policy-overview/",TWILIO_WHATSAPP:"https://www.twilio.com/docs/whatsapp/tutorial/send-whatsapp-notification-messages-templates#sending-non-template-messages-within-a-24-hour-session"},Nm={components:{Message:gm,ReplyBox:O0,Banner:di,ConversationLabelSuggestion:Rm},mixins:[Rs],props:{isContactPanelOpen:{type:Boolean,default:!1},isInboxView:{type:Boolean,default:!1}},emits:["contactPanelToggle"],setup(){const e=Ze(!1),{isEnterprise:t}=wo(),s=()=>{e.value=!1},i=()=>{e.value=!e.value};Jt({Escape:{action:s}});const{isAIIntegrationEnabled:n,isLabelSuggestionFeatureEnabled:r,fetchIntegrationsIfRequired:c,fetchLabelSuggestions:v}=Us();return{isEnterprise:t,isPopOutReplyBox:e,closePopOutReplyBox:s,showPopOutReplyBox:i,isAIIntegrationEnabled:n,isLabelSuggestionFeatureEnabled:r,fetchIntegrationsIfRequired:c,fetchLabelSuggestions:v}},data(){return{isLoadingPrevious:!0,heightBeforeLoad:null,conversationPanel:null,hasUserScrolled:!1,isProgrammaticScroll:!1,messageSentSinceOpened:!1,labelSuggestions:[]}},computed:{...yt({currentChat:"getSelectedChat",listLoadingStatus:"getAllMessagesLoaded",currentAccountId:"getCurrentAccountId"}),isOpen(){var e;return((e=this.currentChat)==null?void 0:e.status)===$t.STATUS_TYPE.OPEN},shouldShowLabelSuggestions(){return this.isOpen&&this.isEnterprise&&this.isAIIntegrationEnabled&&!this.messageSentSinceOpened},inboxId(){return this.currentChat.inbox_id},inbox(){return this.$store.getters["inboxes/getInbox"](this.inboxId)},typingUsersList(){return this.$store.getters["conversationTypingStatus/getUserList"](this.currentChat.id)},isAnyoneTyping(){return this.typingUsersList.length!==0},typingUserNames(){const e=this.typingUsersList;return this.isAnyoneTyping?Ro(e):""},getMessages(){const e=this.currentChat.messages||[];return this.isAWhatsAppChannel?Fo(e):e},readMessages(){return $o(this.getMessages,this.currentChat.agent_last_seen_at)},unReadMessages(){return Ho(this.getMessages,this.currentChat.agent_last_seen_at)},shouldShowSpinner(){return this.currentChat&&this.currentChat.dataFetched===void 0||!this.listLoadingStatus&&this.isLoadingPrevious},conversationType(){const{additional_attributes:e}=this.currentChat;return(e?e.type:"")||""},isATweet(){return this.conversationType==="tweet"},isRightOrLeftIcon(){return this.isContactPanelOpen?"arrow-chevron-right":"arrow-chevron-left"},getLastSeenAt(){const{contact_last_seen_at:e}=this.currentChat;return e},replyWindowBannerMessage(){if(this.isAWhatsAppChannel)return this.$t("CONVERSATION.TWILIO_WHATSAPP_CAN_REPLY");if(this.isAPIInbox){const{additional_attributes:e={}}=this.inbox;if(e){const{agent_reply_time_window_message:t}=e;return t}return""}return this.$t("CONVERSATION.CANNOT_REPLY")},replyWindowLink(){return this.isAWhatsAppChannel?ti.FACEBOOK:this.isAPIInbox?"":ti.TWILIO_WHATSAPP},replyWindowLinkText(){return this.isAWhatsAppChannel?this.$t("CONVERSATION.24_HOURS_WINDOW"):this.isAPIInbox?"":this.$t("CONVERSATION.TWILIO_WHATSAPP_24_HOURS_WINDOW")},unreadMessageCount(){return this.currentChat.unread_count||0},isInstagramDM(){return this.conversationType==="instagram_direct_message"},inboxSupportsReplyTo(){const e=this.inboxHasFeature(Un.REPLY_TO),t=this.inboxHasFeature(Un.REPLY_TO_OUTGOING)&&!this.is360DialogWhatsAppChannel;return{incoming:e,outgoing:t}}},watch:{currentChat(e,t){e.id!==t.id&&(this.fetchAllAttachmentsFromCurrentChat(),this.fetchSuggestions(),this.messageSentSinceOpened=!1)}},created(){ht.on(St.SCROLL_TO_MESSAGE,this.onScrollToMessage),ht.on(St.FETCH_LABEL_SUGGESTIONS,this.fetchSuggestions),ht.on(St.MESSAGE_SENT,()=>{this.messageSentSinceOpened=!0})},mounted(){this.addScrollListener(),this.fetchAllAttachmentsFromCurrentChat(),this.fetchSuggestions()},unmounted(){this.removeBusListeners(),this.removeScrollListener()},methods:{async fetchSuggestions(){this.labelSuggestions=[],!this.isLabelSuggestionDismissed()&&this.isEnterprise&&(await this.fetchIntegrationsIfRequired(),this.isLabelSuggestionFeatureEnabled&&(this.labelSuggestions=await this.fetchLabelSuggestions({conversationId:this.currentChat.id}),this.$nextTick(()=>{const{messageId:e}=this.$route.query;!e&&!this.hasUserScrolled&&this.scrollToBottom()})))},isLabelSuggestionDismissed(){return Es.getFlag(Ss.DISMISSED_LABEL_SUGGESTIONS,this.currentAccountId,this.currentChat.id)},fetchAllAttachmentsFromCurrentChat(){this.$store.dispatch("fetchAllAttachments",this.currentChat.id)},removeBusListeners(){ht.off(St.SCROLL_TO_MESSAGE,this.onScrollToMessage)},onScrollToMessage({messageId:e=""}={}){this.$nextTick(()=>{const t=document.getElementById("message"+e);t?(this.isProgrammaticScroll=!0,t.scrollIntoView({behavior:"smooth"}),this.fetchPreviousMessages()):this.scrollToBottom()}),this.makeMessagesRead()},addScrollListener(){this.conversationPanel=this.$el.querySelector(".conversation-panel"),this.setScrollParams(),this.conversationPanel.addEventListener("scroll",this.handleScroll),this.$nextTick(()=>this.scrollToBottom()),this.isLoadingPrevious=!1},removeScrollListener(){this.conversationPanel.removeEventListener("scroll",this.handleScroll)},scrollToBottom(){this.isProgrammaticScroll=!0;let e=[],t=this.conversationPanel.querySelector(".label-suggestion");this.unreadMessageCount>0?e=this.conversationPanel.querySelectorAll(".message--unread"):t?e=[t]:e=Array.from(this.conversationPanel.querySelectorAll(".message--read")).slice(-1),this.conversationPanel.scrollTop=Mm(this.conversationPanel.scrollHeight,this.$el.scrollHeight,e)},onToggleContactPanel(){this.$emit("contactPanelToggle")},setScrollParams(){this.heightBeforeLoad=this.conversationPanel.scrollHeight,this.scrollTopBeforeLoad=this.conversationPanel.scrollTop},async fetchPreviousMessages(e=0){this.setScrollParams();const t=this.currentChat.dataFetched===!0&&!this.listLoadingStatus&&!this.isLoadingPrevious;if(e<100&&!this.isLoadingPrevious&&t){this.isLoadingPrevious=!0;try{await this.$store.dispatch("fetchPreviousMessages",{conversationId:this.currentChat.id,before:this.currentChat.messages[0].id});const s=this.conversationPanel.scrollHeight-this.heightBeforeLoad;this.conversationPanel.scrollTop=this.scrollTopBeforeLoad+s,this.setScrollParams()}catch{}finally{this.isLoadingPrevious=!1}}},handleScroll(e){this.isProgrammaticScroll?(this.isProgrammaticScroll=!1,this.hasUserScrolled=!1):this.hasUserScrolled=!0,ht.emit(St.ON_MESSAGE_LIST_SCROLL),this.fetchPreviousMessages(e.target.scrollTop)},makeMessagesRead(){this.$store.dispatch("markMessagesRead",{id:this.currentChat.id})},getInReplyToMessage(e){var s,i;if(!e)return{};const t=(s=e.content_attributes)==null?void 0:s.in_reply_to;return t?(i=this.currentChat)==null?void 0:i.messages.find(o=>o.id===t):{}}}},Om={class:"flex flex-col justify-between flex-grow h-full min-w-0 m-0"},km={class:"flex justify-end"},xm={class:"conversation-panel"},Lm={class:"min-h-[4rem]"},Pm={key:0,class:"spinner message"},Bm={class:"unread--toast"},Dm={key:0,class:"absolute flex items-center w-full h-0 -top-7"},Vm={class:"flex py-2 pr-4 pl-5 shadow-md rounded-full bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 text-xs font-semibold my-2.5 mx-auto"};function Gm(e,t,s,i,o,n){const r=ae("Banner"),c=ae("woot-button"),v=ae("Message"),x=ae("ConversationLabelSuggestion"),h=ae("ReplyBox");return O(),se("div",Om,[e.currentChat.can_reply?he("",!0):(O(),_e(r,{key:0,"color-scheme":"alert","banner-message":n.replyWindowBannerMessage,"href-link":n.replyWindowLink,"href-link-text":n.replyWindowLinkText},null,8,["banner-message","href-link","href-link-text"])),q("div",km,[oe(c,{variant:"smooth",size:"tiny","color-scheme":"secondary",class:st(["box-border fixed z-10 bg-white border border-r-0 border-solid rounded-bl-calc rtl:rotate-180 rounded-tl-calc dark:bg-slate-700 border-slate-50 dark:border-slate-600",s.isInboxView?"top-52 md:top-40":"top-[9.5rem] md:top-[6.25rem]"]),icon:n.isRightOrLeftIcon,onClick:n.onToggleContactPanel},null,8,["class","icon","onClick"])]),q("ul",xm,[oe(jn,{name:"slide-up"},{default:Oe(()=>[q("li",Lm,[n.shouldShowSpinner?(O(),se("span",Pm)):he("",!0)])]),_:1}),(O(!0),se(vt,null,Et(n.readMessages,d=>(O(),_e(v,{key:d.id,class:"message--read ph-no-capture","data-clarity-mask":"True",data:d,"is-a-tweet":n.isATweet,"is-a-whatsapp-channel":e.isAWhatsAppChannel,"is-web-widget-inbox":e.isAWebWidgetInbox,"is-a-facebook-inbox":e.isAFacebookInbox,"is-an-email-inbox":e.isAnEmailChannel,"is-instagram":n.isInstagramDM,"inbox-supports-reply-to":n.inboxSupportsReplyTo,"in-reply-to":n.getInReplyToMessage(d)},null,8,["data","is-a-tweet","is-a-whatsapp-channel","is-web-widget-inbox","is-a-facebook-inbox","is-an-email-inbox","is-instagram","inbox-supports-reply-to","in-reply-to"]))),128)),He(q("li",Bm,[q("span",null,fe(n.unreadMessageCount>9?"9+":n.unreadMessageCount)+" "+fe(n.unreadMessageCount>1?e.$t("CONVERSATION.UNREAD_MESSAGES"):e.$t("CONVERSATION.UNREAD_MESSAGE")),1)],512),[[Gs,n.unreadMessageCount!=0]]),(O(!0),se(vt,null,Et(n.unReadMessages,d=>(O(),_e(v,{key:d.id,class:"message--unread ph-no-capture","data-clarity-mask":"True",data:d,"is-a-tweet":n.isATweet,"is-a-whatsapp-channel":e.isAWhatsAppChannel,"is-web-widget-inbox":e.isAWebWidgetInbox,"is-a-facebook-inbox":e.isAFacebookInbox,"is-instagram-dm":n.isInstagramDM,"inbox-supports-reply-to":n.inboxSupportsReplyTo,"in-reply-to":n.getInReplyToMessage(d)},null,8,["data","is-a-tweet","is-a-whatsapp-channel","is-web-widget-inbox","is-a-facebook-inbox","is-instagram-dm","inbox-supports-reply-to","in-reply-to"]))),128)),n.shouldShowLabelSuggestions?(O(),_e(x,{key:0,"suggested-labels":o.labelSuggestions,"chat-labels":e.currentChat.labels,"conversation-id":e.currentChat.id},null,8,["suggested-labels","chat-labels","conversation-id"])):he("",!0)]),q("div",{class:st(["conversation-footer",{"modal-mask":i.isPopOutReplyBox}])},[n.isAnyoneTyping?(O(),se("div",Dm,[q("div",Vm,[Ke(fe(n.typingUserNames)+" ",1),t[1]||(t[1]=q("img",{class:"w-6 ltr:ml-2 rtl:mr-2",src:Mr,alt:"Someone is typing"},null,-1))])])):he("",!0),oe(h,{"popout-reply-box":i.isPopOutReplyBox,"onUpdate:popoutReplyBox":t[0]||(t[0]=d=>i.isPopOutReplyBox=d),"conversation-id":e.currentChat.id,onTogglePopout:i.showPopOutReplyBox},null,8,["popout-reply-box","conversation-id","onTogglePopout"])],2)])}const Fm=je(Nm,[["render",Gm],["__scopeId","data-v-d4406f91"]]),$m={components:{ContactPanel:Zl,ConversationHeader:f1,DashboardAppFrame:T1,EmptyState:K1,MessagesView:Fm},props:{inboxId:{type:[Number,String],default:"",required:!1},isInboxView:{type:Boolean,default:!1},isContactPanelOpen:{type:Boolean,default:!0},isOnExpandedLayout:{type:Boolean,default:!0}},emits:["contactPanelToggle"],data(){return{activeIndex:0}},computed:{...yt({currentChat:"getSelectedChat",dashboardApps:"dashboardApps/getRecords"}),dashboardAppTabs(){return[{key:"messages",index:0,name:this.$t("CONVERSATION.DASHBOARD_APP_TAB_MESSAGES")},...this.dashboardApps.map((e,t)=>({key:`dashboard-${e.id}`,index:t+1,name:e.title}))]},showContactPanel(){return this.isContactPanelOpen&&this.currentChat.id}},watch:{"currentChat.inbox_id"(e){e&&this.$store.dispatch("inboxAssignableAgents/fetch",[e])},"currentChat.id"(){this.fetchLabels(),this.activeIndex=0}},mounted(){this.fetchLabels(),this.$store.dispatch("dashboardApps/get")},methods:{fetchLabels(){this.currentChat.id&&this.$store.dispatch("conversationLabels/get",this.currentChat.id)},onToggleContactPanel(){this.$emit("contactPanelToggle")},onDashboardAppTabChange(e){this.activeIndex=e}}},Hm={class:"flex h-full min-h-0 m-0 bg-slate-25 dark:bg-slate-800"},Um={class:"conversation-sidebar-wrap basis-full sm:basis-[17.5rem] md:basis-[18.75rem] lg:basis-[19.375rem] xl:basis-[20.625rem] 2xl:basis-[25rem] rtl:border-r border-slate-50 dark:border-slate-700 h-auto overflow-auto z-10 flex-shrink-0 flex-grow-0"};function Wm(e,t,s,i,o,n){const r=ae("ConversationHeader"),c=ae("woot-tabs-item"),v=ae("woot-tabs"),x=ae("MessagesView"),h=ae("EmptyState"),d=ae("ContactPanel"),C=ae("DashboardAppFrame");return O(),se("div",{class:st(["conversation-details-wrap bg-slate-25 dark:bg-slate-800",{"with-border-right":!s.isOnExpandedLayout}])},[e.currentChat.id?(O(),_e(r,{key:0,chat:e.currentChat,"is-inbox-view":s.isInboxView,"is-contact-panel-open":s.isContactPanelOpen,"show-back-button":s.isOnExpandedLayout&&!s.isInboxView,onContactPanelToggle:n.onToggleContactPanel},null,8,["chat","is-inbox-view","is-contact-panel-open","show-back-button","onContactPanelToggle"])):he("",!0),e.dashboardApps.length&&e.currentChat.id?(O(),_e(v,{key:1,index:o.activeIndex,class:"-mt-px bg-white dashboard-app--tabs dark:bg-slate-900",onChange:n.onDashboardAppTabChange},{default:Oe(()=>[(O(!0),se(vt,null,Et(n.dashboardAppTabs,j=>(O(),_e(c,{key:j.key,index:j.index,name:j.name,"show-badge":!1},null,8,["index","name"]))),128))]),_:1},8,["index","onChange"])):he("",!0),He(q("div",Hm,[e.currentChat.id?(O(),_e(x,{key:0,"inbox-id":s.inboxId,"is-inbox-view":s.isInboxView,"is-contact-panel-open":s.isContactPanelOpen,onContactPanelToggle:n.onToggleContactPanel},null,8,["inbox-id","is-inbox-view","is-contact-panel-open","onContactPanelToggle"])):he("",!0),!e.currentChat.id&&!s.isInboxView?(O(),_e(h,{key:1,"is-on-expanded-layout":s.isOnExpandedLayout},null,8,["is-on-expanded-layout"])):he("",!0),He(q("div",Um,[n.showContactPanel?(O(),_e(d,{key:0,"conversation-id":e.currentChat.id,"inbox-id":e.currentChat.inbox_id,"on-toggle":n.onToggleContactPanel},null,8,["conversation-id","inbox-id","on-toggle"])):he("",!0)],512),[[Gs,n.showContactPanel]])],512),[[Gs,!o.activeIndex]]),(O(!0),se(vt,null,Et(e.dashboardApps,(j,V)=>He((O(),_e(C,{key:e.currentChat.id+"-"+j.id,"is-visible":o.activeIndex-1===V,config:e.dashboardApps[V].content,position:V,"current-chat":e.currentChat},null,8,["is-visible","config","position","current-chat"])),[[Gs,o.activeIndex-1===V]])),128))],2)}const Np=je($m,[["render",Wm],["__scopeId","data-v-76e27e0a"]]);export{Np as C};
