import{c as y,R as k,W as K,S as q,u as f,H,o as u,n as O,a as N,k as D,p as s,e as _,L,q as w,g as W,_ as T,l as E,m as x,t as h,V as P,r as V,w as J}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as X,a as Q}from"./vue-router-CNCrM2WK.js";import{u as B}from"./globalConfig-DaGjiImb.js";import{u as U,c as Z}from"./mutationHelpers-3VTcoJiD.js";import{D as ee}from"./vuedraggable.umd-rGNd3eNJ.js";import{P as te,A as ae,g as oe}from"./actionQueryGenerator-D3n9-Avr.js";import{g as se,M as re}from"./macroHelper-BAX1mbBw.js";import{u as ie,r as $}from"./index-C2DForDf.js";import{b as le}from"./validations-BcBAK3o6.js";import{u as C}from"./index-BaHWIRRA.js";import"./index-BP-sUqpX.js";import"./index-DaWXXnfb.js";import"./_commonjsHelpers-BosuxZz1.js";import"./timeHelper-BT38nsET.js";import"./Spinner-B-aSVz3z.js";import"./Thumbnail-DLjRBBx8.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./exports-CsC-x4VI.js";import"./dashboard-CGLIihvy.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./DashboardIcon-CPXNa31t.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./index-Y4OjWrJ-.js";import"./Icon-Dtj3LCzD.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";const F=()=>{const e=U(),a=y(()=>e["labels/getLabels"].value),r=y(()=>e["teams/getTeams"].value),p=y(()=>e["agents/getAgents"].value);return{getMacroDropdownValues:t=>{switch(t){case"assign_team":case"send_email_to_team":return r.value;case"assign_agent":return[{id:"self",name:"Self"},...p.value];case"add_label":case"remove_label":return a.value.map(l=>({id:l.title,name:l.title}));case"change_priority":return te;default:return[]}}}},ne={class:"relative flex items-center w-full min-w-0 basis-full"},ce={__name:"MacroNode",props:k({singleNode:{type:Boolean,default:!1},errorKey:{type:String,default:""},fileName:{type:String,default:""}},{modelValue:{type:Object,required:!0},modelModifiers:{}}),emits:k(["resetAction","deleteNode"],["update:modelValue"]),setup(e){const a=e,{t:r}=B(),p=K("macroActionTypes"),{getMacroDropdownValues:c}=F(),t=q(e,"modelValue"),l=y(()=>a.errorKey?r(`MACROS.ERRORS.${a.errorKey}`):""),i=y(()=>t.value.action_name==="send_email_to_team"||t.value.action_name==="send_message"?!1:!!p.find(o=>o.key===t.value.action_name).inputType),m=()=>c(t.value.action_name);return(d,o)=>{const v=f("woot-button"),M=H("tooltip");return u(),O("div",ne,[e.singleNode?D("",!0):(u(),N(v,{key:0,size:"small",variant:"clear","color-scheme":"secondary",icon:"navigation",class:"absolute cursor-move -left-8 macros__node-drag-handle"})),s("div",{class:w(["flex-grow p-2 mr-2 rounded-md shadow-sm",e.errorKey?"bg-red-50 animate-shake dark:bg-red-800":"bg-white dark:bg-slate-700"])},[_(ae,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=R=>t.value=R),"action-types":L(p),"dropdown-values":m(),"show-action-input":i.value,"show-remove-button":!1,"is-macro":"","error-message":l.value,"initial-file-name":e.fileName,onResetAction:o[1]||(o[1]=R=>d.$emit("resetAction"))},null,8,["modelValue","action-types","dropdown-values","show-action-input","error-message","initial-file-name"])],2),e.singleNode?D("",!0):W((u(),N(v,{key:1,icon:"delete",size:"small",variant:"smooth","color-scheme":"alert",onClick:o[2]||(o[2]=R=>d.$emit("deleteNode"))},null,512)),[[M,d.$t("MACROS.EDITOR.DELETE_BTN_TOOLTIP")]])])}}},me={components:{Draggable:ee,MacroNode:ce},props:{errors:{type:Object,default:()=>({})},modelValue:{type:Array,default:()=>[]},files:{type:Array,default:()=>[]}},emits:["update:modelValue","resetAction","deleteNode","addNewNode"],computed:{actionData:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},methods:{fileName(){return se(...arguments)}}},de={class:"macros__nodes"},ue={class:"macro__node"},pe={class:"macro__node"},_e={class:"macro__node"};function fe(e,a,r,p,c,t){const l=f("woot-label"),i=f("MacroNode"),m=f("Draggable"),d=f("woot-button");return u(),O("div",de,[s("div",ue,[s("div",null,[_(l,{title:e.$t("MACROS.EDITOR.START_FLOW"),"color-scheme":"primary"},null,8,["title"])])]),_(m,{list:t.actionData,animation:"200","item-key":"id","ghost-class":"ghost",tag:"div",class:"macros__nodes-draggable",handle:".macros__node-drag-handle"},{item:E(({index:o})=>[(u(),O("div",{key:o,class:"macro__node"},[_(i,{modelValue:t.actionData[o],"onUpdate:modelValue":v=>t.actionData[o]=v,class:"macros__node-action",type:"add",index:o,"error-key":r.errors[`action_${o}`],"file-name":t.fileName(t.actionData[o].action_params[0],t.actionData[o].action_name,r.files),"single-node":t.actionData.length===1,onResetAction:v=>e.$emit("resetAction",o),onDeleteNode:v=>e.$emit("deleteNode",o)},null,8,["modelValue","onUpdate:modelValue","index","error-key","file-name","single-node","onResetAction","onDeleteNode"])]))]),_:1},8,["list"]),s("div",pe,[s("div",null,[_(d,{title:e.$t("MACROS.EDITOR.ADD_BTN_TOOLTIP"),class:"macros__action-button","color-scheme":"success",variant:"smooth",icon:"add-circle",onClick:a[0]||(a[0]=o=>e.$emit("addNewNode"))},{default:E(()=>[x(h(e.$t("MACROS.EDITOR.ADD_BTN_TOOLTIP")),1)]),_:1},8,["title"])])]),s("div",_e,[s("div",null,[_(l,{title:e.$t("MACROS.EDITOR.END_FLOW"),"color-scheme":"primary"},null,8,["title"])])])])}const ge=T(me,[["render",fe],["__scopeId","data-v-fe1e790d"]]),ve={inject:["v$"],props:{macroName:{type:String,default:""},macroVisibility:{type:String,default:"global"}},emits:["update:name","update:visibility","submit"],methods:{isActive(e){return this.macroVisibility===e?"bg-woot-25 dark:bg-slate-900 border-woot-200 dark:border-woot-700":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-600"},onUpdateName(e){this.$emit("update:name",e)},onUpdateVisibility(e){this.$emit("update:visibility",e)}}},he={class:"p-3 bg-white dark:bg-slate-900 h-[calc(100vh-3.5rem)] flex flex-col border-l border-slate-50 dark:border-slate-800/50"},be={class:"mt-2"},Ae={class:"block m-0 text-sm font-medium leading-[1.8] text-slate-700 dark:text-slate-100"},ye={class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},Oe={class:"block m-0 text-sm font-medium leading-[1.8] text-slate-700 dark:text-slate-100"},Ne={class:"text-xs text-slate-500 dark:text-slate-200"},De={class:"block m-0 text-sm font-medium leading-[1.8] text-slate-700 dark:text-slate-100"},Re={class:"text-xs text-slate-500 dark:text-slate-200"},Ie={class:"mt-2 flex items-start p-2 bg-slate-50 dark:bg-slate-700 rounded-md"},we={class:"ml-2 rtl:ml-0 rtl:mr-2 mb-0 text-slate-600 dark:text-slate-200"},Me={class:"mt-auto w-full"};function Se(e,a,r,p,c,t){const l=f("woot-input"),i=f("fluent-icon"),m=f("woot-button");return u(),O("div",he,[s("div",null,[_(l,{"model-value":r.macroName,label:e.$t("MACROS.ADD.FORM.NAME.LABEL"),placeholder:e.$t("MACROS.ADD.FORM.NAME.PLACEHOLDER"),error:t.v$.macro.name.$error?e.$t("MACROS.ADD.FORM.NAME.ERROR"):null,class:w({error:t.v$.macro.name.$error}),"onUpdate:modelValue":t.onUpdateName},null,8,["model-value","label","placeholder","error","class","onUpdate:modelValue"])]),s("div",be,[s("p",Ae,h(e.$t("MACROS.EDITOR.VISIBILITY.LABEL")),1),s("div",ye,[s("button",{class:w(["p-2 relative rounded-md border border-solid text-left cursor-default",t.isActive("global")]),onClick:a[0]||(a[0]=d=>t.onUpdateVisibility("global"))},[r.macroVisibility==="global"?(u(),N(i,{key:0,icon:"checkmark-circle",type:"solid",class:"absolute text-woot-500 dark:text-woot-500 top-2 right-2"})):D("",!0),s("p",Oe,h(e.$t("MACROS.EDITOR.VISIBILITY.GLOBAL.LABEL")),1),s("p",Ne,h(e.$t("MACROS.EDITOR.VISIBILITY.GLOBAL.DESCRIPTION")),1)],2),s("button",{class:w(["p-2 relative rounded-md border border-solid text-left cursor-default",t.isActive("personal")]),onClick:a[1]||(a[1]=d=>t.onUpdateVisibility("personal"))},[r.macroVisibility==="personal"?(u(),N(i,{key:0,icon:"checkmark-circle",type:"solid",class:"absolute text-woot-500 dark:text-woot-500 top-2 right-2"})):D("",!0),s("p",De,h(e.$t("MACROS.EDITOR.VISIBILITY.PERSONAL.LABEL")),1),s("p",Re,h(e.$t("MACROS.EDITOR.VISIBILITY.PERSONAL.DESCRIPTION")),1)],2)]),s("div",Ie,[_(i,{icon:"info",size:"20",class:"flex-shrink"}),s("p",we,h(e.$t("MACROS.ORDER_INFO")),1)])]),s("div",Me,[_(m,{size:"expanded","color-scheme":"success",class:"w-full",onClick:a[2]||(a[2]=d=>e.$emit("submit"))},{default:E(()=>[x(h(e.$t("MACROS.HEADER_BTN_TXT_SAVE")),1)]),_:1})])])}const Ee=T(ve,[["render",Se],["__scopeId","data-v-36d17196"]]),Te={components:{MacroNodes:ge,MacroProperties:Ee},props:{macroData:{type:Object,default:()=>({})}},emits:["submit"],setup(){const e=ie();return P("v$",e),{v$:e}},data(){return{macro:this.macroData,errors:{}}},computed:{files(){return this.macro&&this.macro.files?this.macro.files:[]}},watch:{$route:{handler(){this.resetValidation()},immediate:!0},macroData:{handler(){this.macro=this.macroData},immediate:!0}},validations:{macro:{name:{required:$},visibility:{required:$}}},methods:{removeObjectProperty(e,a){return Object.fromEntries(Object.entries(e).filter(([r])=>r!==a))},updateName(e){this.macro.name=e},updateVisibility(e){this.macro.visibility=e},appendNode(){this.macro.actions.push({action_name:"assign_team",action_params:[]})},deleteNode(e){this.errors=this.removeObjectProperty(this.errors,`action_${e}`),this.macro.actions.splice(e,1)},submit(){this.errors=le(this.macro.actions),Object.keys(this.errors).length===0&&(this.v$.$touch(),!this.v$.$invalid&&this.$emit("submit",this.macro))},resetNode(e){this.errors=this.removeObjectProperty(this.errors,`action_${e}`),this.macro.actions[e].action_params=[]},resetValidation(){var e,a;this.errors={},(a=(e=this.v$)==null?void 0:e.$reset)==null||a.call(e)}}},ke={class:"flex flex-col w-full h-auto md:flex-row md:h-full"},Ve={class:"flex-1 w-full h-full max-h-full px-12 py-4 overflow-y-auto md:w-auto macro-gradient-radial dark:macro-dark-gradient-radial macro-gradient-radial-size"},$e={class:"w-full md:w-1/3"};function Ce(e,a,r,p,c,t){const l=f("MacroNodes"),i=f("MacroProperties");return u(),O("div",ke,[s("div",Ve,[_(l,{modelValue:c.macro.actions,"onUpdate:modelValue":a[0]||(a[0]=m=>c.macro.actions=m),files:t.files,errors:c.errors,onAddNewNode:t.appendNode,onDeleteNode:t.deleteNode,onResetAction:t.resetNode},null,8,["modelValue","files","errors","onAddNewNode","onDeleteNode","onResetAction"])]),s("div",$e,[_(i,{"macro-name":c.macro.name,"macro-visibility":c.macro.visibility,"onUpdate:name":t.updateName,"onUpdate:visibility":t.updateVisibility,onSubmit:t.submit},null,8,["macro-name","macro-visibility","onUpdate:name","onUpdate:visibility","onSubmit"])])])}const Le=T(Te,[["render",Ce],["__scopeId","data-v-65779f82"]]),xe={class:"flex flex-col flex-1 h-full overflow-auto"},ft={__name:"MacroEditor",setup(e){const a=Z(),r=U(),p=X(),c=Q(),{t}=B(),{getMacroDropdownValues:l}=F(),i=V(null),m=V("CREATE"),d=re;P("macroActionTypes",d);const o=y(()=>r["macros/getUIFlags"].value),v=y(()=>p.params.macroId),M=()=>{a.dispatch("agents/get"),a.dispatch("teams/get"),a.dispatch("labels/get")},R=b=>{const A=b.actions.map(n=>{let g=[];if(n.action_params.length){const S=d.find(I=>I.key===n.action_name).inputType;S==="multi_select"||S==="search_select"?g=l(n.action_name).filter(I=>[...n.action_params].includes(I.id)):S==="team_message"?g={team_ids:l(n.action_name).filter(I=>[...n.action_params[0].team_ids].includes(I.id)),message:n.action_params[0].message}:g=[...n.action_params]}return{...n,action_params:g}});return{...b,actions:A}},j=async()=>{await a.dispatch("macros/getSingleMacro",v.value);const b=a.getters["macros/getMacro"](v.value);i.value=R(b)},z=()=>{m.value="EDIT",j()},Y=()=>{m.value="CREATE",i.value={name:"",actions:[{action_name:"assign_team",action_params:[]}],visibility:"global"}};J(()=>p,()=>{M(),p.params.macroId?z():Y()},{immediate:!0,deep:!0});const G=async b=>{try{const A=m.value==="EDIT"?"macros/update":"macros/create",n=m.value==="EDIT"?t("MACROS.EDIT.API.SUCCESS_MESSAGE"):t("MACROS.ADD.API.SUCCESS_MESSAGE");let g=JSON.parse(JSON.stringify(b));g.actions=oe(g.actions),await a.dispatch(A,g),C(n),c.push({name:"macros_wrapper"})}catch{C(t("MACROS.ERROR"))}};return(b,A)=>{const n=f("woot-loading-state");return u(),O("div",xe,[o.value.isFetchingItem?(u(),N(n,{key:0,message:L(t)("MACROS.EDITOR.LOADING")},null,8,["message"])):D("",!0),i.value&&!o.value.isFetchingItem?(u(),N(Le,{key:1,"macro-data":i.value,"onUpdate:macroData":A[0]||(A[0]=g=>i.value=g),onSubmit:G},null,8,["macro-data"])):D("",!0)])}}};export{ft as default};
