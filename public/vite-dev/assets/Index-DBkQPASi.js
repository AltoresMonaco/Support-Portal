import{r as T,a6 as le,c as E,w as ie,P as ee,u as P,o as p,n as O,e as v,p as o,q as D,L as m,m as W,t as S,g as x,U as Y,F,i as H,a1 as re,f as J,H as de,a as Q,l as w}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as B}from"./index-BaHWIRRA.js";import{_ as ce}from"./SettingsLayout-CbuFko1M.js";import{_ as ue}from"./BaseSettingsHeader-CxIYpdLq.js";import{c as te,v as M}from"./mutationHelpers-3VTcoJiD.js";import{u as G}from"./globalConfig-DaGjiImb.js";import{r as K,m as Z,u as me}from"./index-C2DForDf.js";import{M as N,H as pe,I as _e,J as Ee}from"./DashboardIcon-CPXNa31t.js";import{af as ve}from"./dashboard-CGLIihvy.js";import{g as Oe}from"./settingsHelper-B3R9d9Ag.js";import{a as Se}from"./vue-router-CNCrM2WK.js";import{_ as Re}from"./BasePaywallModal-Db3lqLyd.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./BackButton-YZy1EtJv.js";import"./index-BP-sUqpX.js";import"./index-DaWXXnfb.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./exports-CsC-x4VI.js";import"./Icon-Dtj3LCzD.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./timeHelper-BT38nsET.js";import"./Spinner-B-aSVz3z.js";import"./Thumbnail-DLjRBBx8.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";const Ce={class:"flex flex-col h-auto overflow-auto"},Te={class:"w-full"},fe=["placeholder"],Le={class:"w-full"},ge=["placeholder"],Me={class:"w-full"},he={class:"flex flex-col gap-2.5 mb-4 mt-2"},Ae=["id","value"],Ie=["for"],$e={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"},we={__name:"CustomRoleModal",props:{mode:{type:String,default:"add",validator:f=>["add","edit"].includes(f)},selectedRole:{type:Object,default:()=>({})}},emits:["close"],setup(f,{emit:L}){const s=f,_=L,R=te(),{t:l}=G(),u=T(""),d=T(""),e=T([]),i=T(null),C=le({showLoading:!1,message:""}),h=E(()=>({name:{required:K,minLength:Z(2)},description:{required:K},selectedPermissions:{required:K,minLength:Z(1)}})),c=me(h,{name:u,description:d,selectedPermissions:e}),A=()=>{u.value="",d.value="",e.value=[],c.value.$reset()},j=()=>{u.value=s.selectedRole.name||"",d.value=s.selectedRole.description||"",e.value=s.selectedRole.permissions||[]};ie(e,(t,a)=>{const U=t.includes(N)&&!a.includes(N),n=a.includes(N)&&!t.includes(N);U?e.value=[...new Set([...e.value,pe,_e])]:n&&(e.value=e.value.filter(b=>b!==N))},{deep:!0}),ee(()=>{var t;s.mode==="edit"&&j(),(t=i.value)==null||t.focus()});const y=t=>s.mode==="edit"?`CUSTOM_ROLE.EDIT.${t}`:`CUSTOM_ROLE.ADD.${t}`,I=E(()=>l(y("TITLE"))),V=E(()=>l(y("DESC"))),X=E(()=>l(y("SUBMIT"))),k=async()=>{if(c.value.$touch(),!c.value.$invalid){C.showLoading=!0;try{const t={name:u.value,description:d.value,permissions:e.value};s.mode==="edit"?(await R.dispatch("customRole/updateCustomRole",{id:s.selectedRole.id,...t}),B(l("CUSTOM_ROLE.EDIT.API.SUCCESS_MESSAGE"))):(await R.dispatch("customRole/createCustomRole",t),B(l("CUSTOM_ROLE.ADD.API.SUCCESS_MESSAGE"))),A(),_("close")}catch(t){const a=(t==null?void 0:t.message)||l("CUSTOM_ROLE.FORM.API.ERROR_MESSAGE");B(a)}finally{C.showLoading=!1}}},q=E(()=>c.value.$invalid||C.showLoading);return(t,a)=>{const U=P("woot-modal-header");return p(),O("div",Ce,[v(U,{"header-title":I.value,"header-content":V.value},null,8,["header-title","header-content"]),o("form",{class:"flex flex-col w-full",onSubmit:J(k,["prevent"])},[o("div",Te,[o("label",{class:D({"text-red-500":m(c).name.$error})},[W(S(t.$t("CUSTOM_ROLE.FORM.NAME.LABEL"))+" ",1),x(o("input",{ref_key:"nameInput",ref:i,"onUpdate:modelValue":a[0]||(a[0]=n=>u.value=n),type:"text",class:D({"!border-red-500":m(c).name.$error}),placeholder:t.$t("CUSTOM_ROLE.FORM.NAME.PLACEHOLDER"),onBlur:a[1]||(a[1]=(...n)=>m(c).name.$touch&&m(c).name.$touch(...n))},null,42,fe),[[Y,u.value,void 0,{trim:!0}]])],2)]),o("div",Le,[o("label",{class:D({"text-red-500":m(c).description.$error})},[W(S(t.$t("CUSTOM_ROLE.FORM.DESCRIPTION.LABEL"))+" ",1),x(o("textarea",{"onUpdate:modelValue":a[2]||(a[2]=n=>d.value=n),rows:3,class:D({error:m(c).description.$error}),placeholder:t.$t("CUSTOM_ROLE.FORM.DESCRIPTION.PLACEHOLDER"),onBlur:a[3]||(a[3]=(...n)=>m(c).description.$touch&&m(c).description.$touch(...n))},null,42,ge),[[Y,d.value]])],2)]),o("div",Me,[o("label",{class:D({"text-red-500":m(c).selectedPermissions.$error})},S(t.$t("CUSTOM_ROLE.FORM.PERMISSIONS.LABEL")),3),o("div",he,[(p(!0),O(F,null,H(m(Ee),n=>(p(),O("div",{key:n,class:"flex items-center"},[x(o("input",{id:n,"onUpdate:modelValue":a[4]||(a[4]=b=>e.value=b),type:"checkbox",value:n,name:"permissions",class:"ltr:mr-2 rtl:ml-2"},null,8,Ae),[[re,e.value]]),o("label",{for:n,class:"text-sm font-normal"},S(t.$t(`CUSTOM_ROLE.PERMISSIONS.${n.toUpperCase()}`)),9,Ie)]))),128))])]),o("div",$e,[v(ve,{disabled:q.value,"button-text":X.value,loading:C.showLoading},null,8,["disabled","button-text","loading"]),o("button",{class:"button clear",onClick:a[5]||(a[5]=J(n=>_("close"),["prevent"]))},S(t.$t("CUSTOM_ROLE.FORM.CANCEL_BUTTON_TEXT")),1)])],32)])}}},ye={class:"divide-y divide-slate-50 dark:divide-slate-800 text-slate-700 dark:text-slate-300"},Ue=["title"],be={class:"py-4 pr-4 whitespace-normal align-baseline md:break-words"},De={class:"py-4 pr-4 whitespace-normal align-baseline md:break-words"},Ne={class:"flex justify-end gap-1 py-4"},oe={__name:"CustomRoleTableBody",props:{roles:{type:Array,required:!0},loading:{type:Object,default:()=>({})}},emits:["edit","delete"],setup(f,{emit:L}){const s=L,{t:_}=G(),R=l=>l.permissions.map(u=>_(Oe("CUSTOM_ROLE.PERMISSIONS",u))).join(", ");return(l,u)=>{const d=P("woot-button"),e=de("tooltip");return p(),O("tbody",ye,[(p(!0),O(F,null,H(f.roles,(i,C)=>(p(),O("tr",{key:C},[o("td",{class:"max-w-xs py-4 pr-4 font-medium truncate align-baseline",title:i.name},S(i.name),9,Ue),o("td",be,S(i.description),1),o("td",De,S(R(i)),1),o("td",Ne,[x(v(d,{variant:"smooth",size:"tiny","color-scheme":"secondary","class-names":"grey-btn",icon:"edit",onClick:h=>s("edit",i)},null,8,["onClick"]),[[e,l.$t("CUSTOM_ROLE.EDIT.BUTTON_TEXT"),void 0,{top:!0}]]),x(v(d,{variant:"smooth","color-scheme":"alert",size:"tiny",icon:"dismiss-circle","class-names":"grey-btn","is-loading":f.loading[i.id],onClick:h=>s("delete",i)},null,8,["is-loading","onClick"]),[[e,l.$t("CUSTOM_ROLE.DELETE.BUTTON_TEXT"),void 0,{top:!0}]])])]))),128))])}}},Pe={class:"w-full min-h-[12rem] relative"},xe={class:"w-full space-y-3 text-sm"},ke={class:"opacity-30 dark:opacity-30"},Be={class:"mb-0"},Fe={class:"absolute inset-0 flex flex-col items-center justify-center w-full h-full bg-gradient-to-t from-white dark:from-slate-900 to-transparent"},He={__name:"CustomRolePaywall",setup(f){const L=[{name:"All Permissions",description:"All permissions",permissions:["conversation_manage","conversation_participating_manage","conversation_unassigned_manage","contact_manage","report_manage","knowledge_base_manage"]},{name:"Conversation Permissions",description:"Conversation permissions",permissions:["conversation_manage","conversation_participating_manage","conversation_unassigned_manage"]},{name:"Contact Permissions",description:"Contact permissions",permissions:["contact_manage"]},{name:"Report Permissions",description:"Report permissions",permissions:["report_manage"]}],s=Se(),_=M("globalConfig/isOnChatwootCloud"),R=M("getCurrentUser"),l=M("getCurrentAccountId"),u=E(()=>R.value.type==="SuperAdmin"),d=E(()=>_.value?"PAYWALL":"ENTERPRISE_PAYWALL"),e=()=>{s.push({name:"billing_settings_index",params:{accountId:l.value}})},{t:i}=G(),C=E(()=>[i("CUSTOM_ROLE.LIST.TABLE_HEADER.NAME"),i("CUSTOM_ROLE.LIST.TABLE_HEADER.DESCRIPTION"),i("CUSTOM_ROLE.LIST.TABLE_HEADER.PERMISSIONS"),i("CUSTOM_ROLE.LIST.TABLE_HEADER.ACTIONS")]);return(h,c)=>(p(),O("div",Pe,[o("div",xe,[o("thead",ke,[(p(!0),O(F,null,H(C.value,A=>(p(),O("th",{key:A,class:"py-4 pr-4 font-semibold text-left text-slate-700 dark:text-slate-300"},[o("span",Be,S(A),1)]))),128))]),v(oe,{class:"opacity-25 dark:opacity-20",roles:L,loading:{}})]),o("div",Fe,[v(Re,{"feature-prefix":"CUSTOM_ROLE","i18n-key":d.value,"is-on-chatwoot-cloud":m(_),"is-super-admin":u.value,onUpgrade:e},null,8,["i18n-key","is-on-chatwoot-cloud","is-super-admin"])])]))}},Ge={key:1,class:"min-w-full overflow-x-auto divide-y divide-slate-75 dark:divide-slate-700"},je={class:"mb-0"},ft={__name:"Index",setup(f){const L=te(),{t:s}=G(),_=T(!1),R=T("add"),l=T(null),u=T({}),d=T(!1),e=T({}),i=M("customRole/getCustomRoles"),C=M("customRole/getUIFlags"),h=E(()=>`${s("CUSTOM_ROLE.DELETE.CONFIRM.YES")} ${e.value.name}`),c=E(()=>`${s("CUSTOM_ROLE.DELETE.CONFIRM.NO")} ${e.value.name}`),A=E(()=>` ${e.value.name} ? `),j=M("accounts/isFeatureEnabledonAccount"),y=M("getCurrentAccountId"),I=E(()=>!j.value(y.value,"custom_roles")),V=async()=>{try{await L.dispatch("customRole/getCustomRole")}catch{}};ee(()=>{V()});const X=E(()=>[s("CUSTOM_ROLE.LIST.TABLE_HEADER.NAME"),s("CUSTOM_ROLE.LIST.TABLE_HEADER.DESCRIPTION"),s("CUSTOM_ROLE.LIST.TABLE_HEADER.PERMISSIONS"),s("CUSTOM_ROLE.LIST.TABLE_HEADER.ACTIONS")]),k=r=>{u.value[e.value.id]=!1,e.value={},B(r)},q=()=>{I.value||(R.value="add",l.value=null,_.value=!0)},t=r=>{R.value="edit",l.value=r,_.value=!0},a=()=>{l.value=null,_.value=!1},U=r=>{d.value=!0,e.value=r},n=()=>{d.value=!1},b=async r=>{try{await L.dispatch("customRole/deleteCustomRole",r),k(s("CUSTOM_ROLE.DELETE.API.SUCCESS_MESSAGE"))}catch(g){const z=(g==null?void 0:g.message)||s("CUSTOM_ROLE.DELETE.API.ERROR_MESSAGE");k(z)}},se=()=>{u[e.value.id]=!0,n(),b(e.value.id)};return(r,g)=>{const z=P("woot-button"),ae=P("woot-modal"),ne=P("woot-delete-modal");return p(),Q(ce,{"is-loading":m(C).fetchingList,"loading-message":r.$t("CUSTOM_ROLE.LOADING"),"no-records-found":!m(i).length&&!I.value,"no-records-message":r.$t("CUSTOM_ROLE.LIST.404")},{header:w(()=>[v(ue,{title:r.$t("CUSTOM_ROLE.HEADER"),description:r.$t("CUSTOM_ROLE.DESCRIPTION"),"link-text":r.$t("CUSTOM_ROLE.LEARN_MORE"),"feature-name":"canned_responses"},{actions:w(()=>[v(z,{class:"rounded-md button nice",icon:"add-circle",disabled:I.value,onClick:q},{default:w(()=>[W(S(r.$t("CUSTOM_ROLE.HEADER_BTN_TXT")),1)]),_:1},8,["disabled"])]),_:1},8,["title","description","link-text"])]),body:w(()=>[I.value?(p(),Q(He,{key:0})):(p(),O("table",Ge,[o("thead",null,[(p(!0),O(F,null,H(X.value,$=>(p(),O("th",{key:$,class:"py-4 pr-4 font-semibold text-left text-slate-700 dark:text-slate-300"},[o("span",je,S($),1)]))),128))]),v(oe,{roles:m(i),loading:u.value,onEdit:t,onDelete:U},null,8,["roles","loading"])]))]),default:w(()=>[v(ae,{show:_.value,"onUpdate:show":g[0]||(g[0]=$=>_.value=$),"on-close":a},{default:w(()=>[v(we,{mode:R.value,"selected-role":l.value,onClose:a},null,8,["mode","selected-role"])]),_:1},8,["show"]),v(ne,{show:d.value,"onUpdate:show":g[1]||(g[1]=$=>d.value=$),"on-close":n,"on-confirm":se,title:r.$t("CUSTOM_ROLE.DELETE.CONFIRM.TITLE"),message:r.$t("CUSTOM_ROLE.DELETE.CONFIRM.MESSAGE"),"message-value":A.value,"confirm-text":h.value,"reject-text":c.value},null,8,["show","title","message","message-value","confirm-text","reject-text"])]),_:1},8,["is-loading","loading-message","no-records-found","no-records-message"])}}};export{ft as default};
