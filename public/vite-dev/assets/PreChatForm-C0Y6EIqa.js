import{C as Ce}from"./Button-BlM3GDIn.js";import{S as ge}from"./Spinner-B-aSVz3z.js";import{m as _e,e as K}from"./globalConfig-DaGjiImb.js";import{g as Ee}from"./utils.esm-CA3tRshB.js";import{u as X,r as Y,c as J,i as Z,d as xe}from"./widget-CI6WQx7h.js";import{g as Re}from"./Validators-eX6_8wdj.js";import{u as ke}from"./useMessageFormatter-CoQTTzFX.js";import{F as Ae,z as ye}from"./mutationHelpers-3VTcoJiD.js";import{_ as M,r as E,$ as z,c as m,w as we,H as ee,o as d,n as h,p as _,q as v,t as x,a as w,e as N,L as y,k as R,g as D,j as O,U as Ie,F as te,i as ae,z as G,l as W,u as F,C as Fe,m as Pe}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{g as Se,a as Oe,c as De}from"./helper-DcGaBm2u.js";import{F as Q}from"./Index-CtF_0wrY.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./sharedFrameEvents-CcDS0bVP.js";import"./index-BP-sUqpX.js";import"./index-DaWXXnfb.js";import"./axios-CCb-kr4I.js";import"./constants-lVAyZKq6.js";import"./MessageTypeHelper-CjbF8VpS.js";import"./DateHelper-D7GM2F2-.js";import"./vue-router-CNCrM2WK.js";import"./index-CbMJaKeB.js";import"./index-BGZqnxRy.js";import"./businessHour-BNp1n6b4.js";import"./Branding-CyqV4wcK.js";import"./globalConfigMixin-BNbqaRx5.js";import"./module-CGzIBJZi.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Icon-Dtj3LCzD.js";import"./index-BO4rcqbh.js";const Me={class:"relative mt-2 phone-input--wrap"},Ne={key:0,class:"mb-0 text-xl"},Te=["value","placeholder"],Le=["placeholder"],$e=["onClick"],He={key:0,class:"mr-2 text-xl"},Ve={class:"text-sm leading-5 truncate"},Ue={class:"ml-2 text-xs"},Be={key:0},je={__name:"PhoneInput",props:{context:{type:Object,default:()=>({})}},setup(e){const t=E(e.context.value||""),{getThemeClass:o}=X(),a=E(-1),n=E(!1),s=E(""),u=E(Se()),b=E(Oe()),f=E(""),C=z("dropdownRef"),i=z("searchbarRef"),k=m(()=>{var r,l;return((l=(r=e.context)==null?void 0:r.attrs)==null?void 0:l.placeholder)||""}),se=m(()=>e.context.hasErrorInPhoneInput),re=m(()=>u.value?"Clear selection":"Select Country"),P=m(()=>[{name:re.value,dial_code:"",emoji:"",id:""},...De]),oe=m(()=>o("bg-slate-100 text-slate-700","dark:bg-slate-700 dark:text-slate-50")),T=m(()=>o("bg-white text-slate-700","dark:bg-slate-700 dark:text-slate-50")),ne=m(()=>o("text-slate-700 hover:bg-slate-50","dark:text-slate-50 dark:hover:bg-slate-600")),le=m(()=>`active ${o("bg-slate-100","dark:bg-slate-800")}`),ie=m(()=>`focus ${o("bg-slate-50","dark:bg-slate-600")}`),S=m(()=>o("bg-white text-slate-700","dark:bg-slate-600 dark:text-slate-50")),L=m(()=>`${o("border-black-200","dark:border-black-500")}`),ue=m(()=>se.value?`border-red-200 hover:border-red-300 focus:border-red-300 ${S.value}`:`hover:border-black-300 focus:border-black-300 ${S.value} ${L.value}`),A=m(()=>P.value.filter(r=>{const{name:l,dial_code:p,id:c}=r,g=s.value.toLowerCase();return l.toLowerCase().includes(g)||p.toLowerCase().includes(g)||c.toLowerCase().includes(g)})),$=m(()=>P.value.find(r=>r.id===u.value));we(A,r=>{r.length<a.value+1&&(a.value=0)});function H(r){const l=y(r);t.value=`${l}${f.value}`,e.context.node.input(t.value)}function ce(r){const l=y(r);if(!l)return;const p=P.value.find(c=>l.startsWith(c.dial_code));p&&(u.value=p.id,b.value=p.dial_code,f.value=l.replace(p.dial_code,""))}function de(r){f.value=r.target.value,ce(f),H(b)}function I(r){var l;return n.value?Array.from((l=C.value)==null?void 0:l.querySelectorAll(`div.country-dropdown div.country-dropdown--item.${r}`)):[]}function V(r){if(r.length>0){const p=C.value,c=p.clientHeight,g=I[0].offsetTop,q=I[0].offsetHeight,be=g-c/2+q/2;p.scrollTo({top:be,behavior:"auto"})}}function me(){G(()=>{V(I("focus"))})}function U(r){if(!n.value)return;const l=A.value.length-1;r==="up"?a.value=a.value<=0?l:a.value-1:r==="down"&&(a.value=a.value>=l?0:a.value+1),me()}function pe(){U("up")}function he(){U("down")}function B(){a.value=-1,n.value=!1}function j(r){u.value=r.id,s.value="",b.value=r.dial_code?r.dial_code:"",H(r.dial_code),B()}function fe(){n.value=!n.value,a.value=-1,n.value&&G(()=>{i.value.focus(),V(I("active"))})}function ve(){!n.value||a.value===-1||j(A.value[a.value])}return(r,l)=>{const p=ee("on-clickaway");return d(),h("div",Me,[_("div",{class:v(["flex items-center justify-start w-full border border-solid rounded outline-none phone-input",ue.value])},[_("div",{class:v(["flex items-center justify-between h-full px-2 py-2 cursor-pointer country-emoji--wrap",oe.value]),onClick:fe},[$.value.emoji?(d(),h("h5",Ne,x($.value.emoji),1)):(d(),w(Q,{key:1,icon:"globe",class:"fluent-icon",size:"20"})),N(Q,{icon:"chevron-down",class:"fluent-icon",size:"12"})],2),b.value?(d(),h("span",{key:0,class:v(["py-2 pl-2 pr-0 text-base",y(o)("text-slate-700","dark:text-slate-50")])},x(b.value),3)):R("",!0),_("input",{value:f.value,type:"phoneInput",class:v(["w-full h-full py-2 pl-2 pr-3 leading-tight border-0 rounded-r outline-none",S.value]),name:"phoneNumber",placeholder:k.value,onInput:de,onBlur:l[0]||(l[0]=(...c)=>e.context.blurHandler&&e.context.blurHandler(...c))},null,42,Te)],2),n.value?D((d(),h("div",{key:0,ref_key:"dropdownRef",ref:C,class:v([T.value,"absolute z-10 h-48 px-0 pt-0 pb-1 pl-1 pr-1 overflow-y-auto rounded shadow-lg country-dropdown top-12"]),onKeydown:[O(pe,["up"]),O(he,["down"]),O(ve,["enter"])]},[_("div",{class:v(["sticky top-0",T.value])},[D(_("input",{ref_key:"searchbarRef",ref:i,"onUpdate:modelValue":l[1]||(l[1]=c=>s.value=c),type:"text",placeholder:r.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DROPDOWN_SEARCH"),class:v(["w-full h-8 px-3 py-2 mt-1 mb-1 text-sm border border-solid rounded outline-none dropdown-search",[y(o)("bg-slate-50","dark:bg-slate-600"),L.value]])},null,10,Le),[[Ie,s.value]])],2),(d(!0),h(te,null,ae(A.value,(c,g)=>(d(),h("div",{key:g,class:v(["flex items-center h-8 px-2 py-2 rounded cursor-pointer country-dropdown--item",[ne.value,c.id===u.value?le.value:"",g===a.value?ie.value:""]]),onClick:q=>j(c)},[c.emoji?(d(),h("span",He,x(c.emoji),1)):R("",!0),_("span",Ve,x(c.name),1),_("span",Ue,x(c.dial_code),1)],10,$e))),128)),A.value.length===0?(d(),h("div",Be,[_("span",{class:v(["flex justify-center mt-4 text-sm text-center",y(o)("text-slate-700","dark:text-slate-50")])},x(r.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DROPDOWN_EMPTY")),3)])):R("",!0)],34)),[[p,B]]):R("",!0)])}}},qe=M(je,[["__scopeId","data-v-5e8fefc7"]]),Ke={components:{CustomButton:Ce,Spinner:ge,FormKit:Ae},mixins:[Y,J],props:{options:{type:Object,default:()=>{}}},emits:["submitPreChat"],setup(){const e=ye(qe,{props:["hasErrorInPhoneInput"]}),{formatMessage:t}=ke(),{getThemeClass:o}=X();return{formatMessage:t,phoneInput:e,getThemeClass:o}},data(){return{locale:this.$root.$i18n.locale,hasErrorInPhoneInput:!1,message:"",formValues:{},labels:{emailAddress:"EMAIL_ADDRESS",fullName:"FULL_NAME",phoneNumber:"PHONE_NUMBER"}}},computed:{..._e({widgetColor:"appConfig/getWidgetColor",isCreating:"conversation/getIsCreating",activeCampaign:"campaign/getActiveCampaign",currentUser:"contacts/getCurrentUser"}),textColor(){return Ee(this.widgetColor)},hasActiveCampaign(){return!Z(this.activeCampaign)},shouldShowHeaderMessage(){return this.hasActiveCampaign||this.preChatFormEnabled},headerMessage(){return this.preChatFormEnabled?this.options.preChatMessage:this.hasActiveCampaign?this.$t("PRE_CHAT_FORM.CAMPAIGN_HEADER"):""},preChatFields(){return this.preChatFormEnabled?this.options.preChatFields:[]},filteredPreChatFields(){const e=this.currentUser.has_email,t=this.currentUser.has_phone_number,a=!!(!!this.currentUser.identifier||e||t);return this.preChatFields.filter(n=>!(e&&n.name==="emailAddress"||t&&n.name==="phoneNumber"||a&&n.name==="fullName"))},enabledPreChatFields(){return this.filteredPreChatFields.filter(e=>e.enabled).map(e=>({...e,type:e.name==="phoneNumber"?this.phoneInput:this.findFieldType(e.type)}))},conversationCustomAttributes(){let e={};return this.enabledPreChatFields.forEach(t=>{t.field_type==="conversation_attribute"&&(e={...e,[t.name]:this.getValue(t)})}),e},contactCustomAttributes(){let e={};return this.enabledPreChatFields.forEach(t=>{t.field_type==="contact_attribute"&&(e={...e,[t.name]:this.getValue(t)})}),e},inputStyles(){return"mt-1 border rounded w-full py-2 px-3 text-slate-700 outline-none"},isInputDarkOrLightMode(){return`${this.getThemeClass("bg-white","dark:bg-slate-600")} ${this.getThemeClass("text-slate-700","dark:text-slate-50")}`},inputBorderColor(){return`${this.getThemeClass("border-black-200","dark:border-black-500")}`}},methods:{labelClass(e){const{hasErrors:t}=e;return t?`text-xs font-medium ${this.getThemeClass("text-red-400","dark:text-red-400")}`:`text-xs font-medium ${this.getThemeClass("text-black-800","dark:text-slate-50")}`},inputClass(e){const{state:t,family:o,type:a}=e.context,n=t.invalid;return o==="box"&&a==="checkbox"?"":(a==="phoneInput"&&(this.hasErrorInPhoneInput=n),n?`${this.inputStyles} border-red-200 hover:border-red-300 focus:border-red-300 ${this.isInputDarkOrLightMode}`:`${this.inputStyles} hover:border-black-300 focus:border-black-300 ${this.isInputDarkOrLightMode} ${this.inputBorderColor}`)},isContactFieldRequired(e){return this.preChatFields.find(t=>t.name===e).required},getLabel({label:e}){return e},getPlaceHolder({placeholder:e}){return e},getValue({name:e,type:t}){return t==="select"?this.enabledPreChatFields.find(o=>o.name===e).values[this.formValues[e]]:this.formValues[e]||null},getValidation({type:e,name:t,field_type:o,regex_pattern:a}){let n=a?Re(a):null;const s={emailAddress:"email",phoneNumber:["startsWithPlus","isValidPhoneNumber"],url:"url",date:"date",text:null,select:null,number:null,checkbox:!1,contact_attribute:n?[["matches",n]]:null,conversation_attribute:n?[["matches",n]]:null},u=Object.keys(s),f=this.isContactFieldRequired(t)?["required"]:["optional"];if(u.includes(t)||u.includes(e)||u.includes(o)){const C=s[e]||s[t]||s[o];return(C?f.concat(C):f).join("|")}return""},findFieldType(e){return e==="link"?"url":e==="list"?"select":e},getOptions(e){if(e.type==="select"){let t={};return e.values.forEach((o,a)=>{t={...t,[a]:o}}),t}return{}},onSubmit(){const{emailAddress:e,fullName:t,phoneNumber:o,message:a}=this.formValues;this.$emit("submitPreChat",{fullName:t,phoneNumber:o,emailAddress:e,message:a,activeCampaignId:this.activeCampaign.id,conversationCustomAttributes:this.conversationCustomAttributes,contactCustomAttributes:this.contactCustomAttributes})}}};function ze(e,t,o,a,n,s){const u=F("FormKit"),b=F("Spinner"),f=F("CustomButton"),C=ee("dompurify-html");return d(),w(u,{modelValue:n.formValues,"onUpdate:modelValue":t[0]||(t[0]=i=>n.formValues=i),type:"form","form-class":"flex flex-col flex-1 w-full p-6 overflow-y-auto","incomplete-message":!1,"submit-attrs":{inputClass:"hidden",wrapperClass:"hidden"},onSubmit:s.onSubmit},{default:W(()=>[s.shouldShowHeaderMessage?D((d(),h("div",{key:0,class:v(["mb-4 text-sm leading-5 pre-chat-header-message",a.getThemeClass("text-black-800","dark:text-slate-50")])},null,2)),[[C,a.formatMessage(s.headerMessage,!1)]]):R("",!0),(d(!0),h(te,null,ae(s.enabledPreChatFields,i=>(d(),w(u,Fe({key:i.name,name:i.name,type:i.type,label:s.getLabel(i),placeholder:s.getPlaceHolder(i),validation:s.getValidation(i),ref_for:!0},i.type==="select"?{options:s.getOptions(i)}:void 0,{"label-class":k=>s.labelClass(k),"input-class":k=>s.inputClass(k),"validation-messages":{startsWithPlus:e.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DIAL_CODE_VALID_ERROR"),isValidPhoneNumber:e.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.VALID_ERROR"),email:e.$t("PRE_CHAT_FORM.FIELDS.EMAIL_ADDRESS.VALID_ERROR"),required:e.$t("PRE_CHAT_FORM.REQUIRED"),matches:i.regex_cue?i.regex_cue:e.$t("PRE_CHAT_FORM.REGEX_ERROR")},"has-error-in-phone-input":n.hasErrorInPhoneInput}),null,16,["name","type","label","placeholder","validation","label-class","input-class","validation-messages","has-error-in-phone-input"]))),128)),s.hasActiveCampaign?R("",!0):(d(),w(u,{key:1,name:"message",type:"textarea","label-class":i=>s.labelClass(i),"input-class":i=>s.inputClass(i),label:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.LABEL"),placeholder:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.PLACEHOLDER"),validation:"required","validation-messages":{required:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.ERROR")}},null,8,["label-class","input-class","label","placeholder","validation-messages"])),N(f,{class:"mt-2 mb-5 font-medium",block:"","bg-color":e.widgetColor,"text-color":s.textColor,disabled:e.isCreating},{default:W(()=>[e.isCreating?(d(),w(b,{key:0,class:"p-0"})):R("",!0),Pe(" "+x(e.$t("START_CONVERSATION")),1)]),_:1},8,["bg-color","text-color","disabled"])]),_:1},8,["modelValue","onSubmit"])}const Ge=M(Ke,[["render",ze]]),We={components:{PreChatForm:Ge},mixins:[J,Y],mounted(){K.on(xe,()=>{this.replaceRoute("messages")})},methods:{onSubmit({fullName:e,emailAddress:t,message:o,activeCampaignId:a,phoneNumber:n,contactCustomAttributes:s,conversationCustomAttributes:u}){a?(K.emit("execute-campaign",{campaignId:a,customAttributes:u}),this.$store.dispatch("contacts/update",{user:{email:t,name:e,phone_number:n}})):this.$store.dispatch("conversation/createConversation",{fullName:e,emailAddress:t,message:o,phoneNumber:n,customAttributes:u}),Z(s)||this.$store.dispatch("contacts/setCustomAttributes",s)}}},Qe={class:"flex flex-1 overflow-auto"};function Xe(e,t,o,a,n,s){const u=F("PreChatForm",!0);return d(),h("div",Qe,[N(u,{options:e.preChatFormOptions,onSubmitPreChat:s.onSubmit},null,8,["options","onSubmitPreChat"])])}const yt=M(We,[["render",Xe]]);export{yt as default};
