import{m as k,u as $}from"./globalConfig-DaGjiImb.js";import{u as I}from"./index-BaHWIRRA.js";import{g as y}from"./globalConfigMixin-BNbqaRx5.js";import{u as L,r as A,m as K,b as F}from"./index-C2DForDf.js";import{w as M}from"./DashboardIcon-CPXNa31t.js";import{g as v}from"./settingsHelper-B3R9d9Ag.js";import{_ as w,u,o as a,n as p,p as n,q as G,m as N,t as m,g as f,U as x,k as _,F as g,i as R,a1 as U,e as E,l as T,f as W,c as V,H as q,a as O}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{_ as j}from"./ShowMore-ClZZrHvu.js";import{_ as X}from"./BaseSettingsHeader-CxIYpdLq.js";import{_ as z}from"./SettingsLayout-CbuFko1M.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./vue-router-CNCrM2WK.js";import"./index-BP-sUqpX.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./exports-CsC-x4VI.js";import"./Icon-Dtj3LCzD.js";import"./mutationHelpers-3VTcoJiD.js";import"./index-DaWXXnfb.js";import"./BackButton-YZy1EtJv.js";import"./dashboard-CGLIihvy.js";import"./axios-CCb-kr4I.js";import"./timeHelper-BT38nsET.js";import"./Spinner-B-aSVz3z.js";import"./Thumbnail-DLjRBBx8.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";const{EXAMPLE_WEBHOOK_URL:Y}=M,J=["conversation_created","conversation_status_changed","conversation_updated","message_created","message_updated","webwidget_triggered","contact_created","contact_updated"],Q={props:{value:{type:Object,default:()=>({})},isSubmitting:{type:Boolean,default:!1},submitLabel:{type:String,required:!0}},emits:["submit","cancel"],setup(){return{v$:L()}},validations:{url:{required:A,minLength:K(7),url:F},subscriptions:{required:A}},data(){return{url:this.value.url||"",subscriptions:this.value.subscriptions||[],supportedWebhookEvents:J}},computed:{webhookURLInputPlaceholder(){return this.$t("INTEGRATION_SETTINGS.WEBHOOK.FORM.END_POINT.PLACEHOLDER",{webhookExampleURL:Y})}},methods:{onSubmit(){this.$emit("submit",{url:this.url,subscriptions:this.subscriptions})},getI18nKey:v}},Z={class:"w-full"},ee=["placeholder"],te={key:0,class:"message"},oe={class:"flex flex-col gap-2.5 mb-4"},se=["id","value"],ie=["for"],ne={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"},le={class:"w-full"};function re(e,t,l,r,i,s){const d=u("woot-button");return a(),p("form",{class:"flex flex-col w-full",onSubmit:t[4]||(t[4]=W((...o)=>s.onSubmit&&s.onSubmit(...o),["prevent"]))},[n("div",Z,[n("label",{class:G({error:r.v$.url.$error})},[N(m(e.$t("INTEGRATION_SETTINGS.WEBHOOK.FORM.END_POINT.LABEL"))+" ",1),f(n("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.url=o),type:"text",name:"url",placeholder:s.webhookURLInputPlaceholder,onInput:t[1]||(t[1]=(...o)=>r.v$.url.$touch&&r.v$.url.$touch(...o))},null,40,ee),[[x,i.url]]),r.v$.url.$error?(a(),p("span",te,m(e.$t("INTEGRATION_SETTINGS.WEBHOOK.FORM.END_POINT.ERROR")),1)):_("",!0)],2),n("label",{class:G([{error:r.v$.url.$error},"mb-2"])},m(e.$t("INTEGRATION_SETTINGS.WEBHOOK.FORM.SUBSCRIPTIONS.LABEL")),3),n("div",oe,[(a(!0),p(g,null,R(i.supportedWebhookEvents,o=>(a(),p("div",{key:o,class:"flex items-center"},[f(n("input",{id:o,"onUpdate:modelValue":t[2]||(t[2]=h=>i.subscriptions=h),type:"checkbox",value:o,name:"subscriptions",class:"mr-2"},null,8,se),[[U,i.subscriptions]]),n("label",{for:o,class:"text-sm"},m(`${e.$t(s.getI18nKey("INTEGRATION_SETTINGS.WEBHOOK.FORM.SUBSCRIPTIONS.EVENTS",o))} (${o})`),9,ie)]))),128))])]),n("div",ne,[n("div",le,[E(d,{disabled:r.v$.$invalid||l.isSubmitting,"is-loading":l.isSubmitting},{default:T(()=>[N(m(l.submitLabel),1)]),_:1},8,["disabled","is-loading"]),E(d,{class:"button clear",onClick:t[3]||(t[3]=W(o=>e.$emit("cancel"),["prevent"]))},{default:T(()=>[N(m(e.$t("INTEGRATION_SETTINGS.WEBHOOK.FORM.CANCEL")),1)]),_:1})])])],32)}const B=w(Q,[["render",re]]),ae={components:{WebhookForm:B},mixins:[y],props:{onClose:{type:Function,required:!0}},computed:{...k({globalConfig:"globalConfig/get",uiFlags:"webhooks/getUIFlags"})},methods:{async onSubmit(e){try{await this.$store.dispatch("webhooks/create",{webhook:e}),I(this.$t("INTEGRATION_SETTINGS.WEBHOOK.ADD.API.SUCCESS_MESSAGE")),this.onClose()}catch(t){const l=t.response.data.message||this.$t("INTEGRATION_SETTINGS.WEBHOOK.EDIT.API.ERROR_MESSAGE");I(l)}}}},de={class:"h-auto overflow-auto flex flex-col"};function ue(e,t,l,r,i,s){const d=u("woot-modal-header"),o=u("WebhookForm");return a(),p("div",de,[E(d,{"header-title":e.$t("INTEGRATION_SETTINGS.WEBHOOK.ADD.TITLE"),"header-content":e.useInstallationName(e.$t("INTEGRATION_SETTINGS.WEBHOOK.FORM.DESC"),"Altores")},null,8,["header-title","header-content"]),E(o,{"is-submitting":e.uiFlags.creatingItem,"submit-label":e.$t("INTEGRATION_SETTINGS.WEBHOOK.FORM.ADD_SUBMIT"),onSubmit:s.onSubmit,onCancel:l.onClose},null,8,["is-submitting","submit-label","onSubmit","onCancel"])])}const Ee=w(ae,[["render",ue]]),ce={components:{WebhookForm:B},props:{value:{type:Object,required:!0},id:{type:[Number,String],required:!0},onClose:{type:Function,required:!0}},computed:{...k({uiFlags:"webhooks/getUIFlags"})},methods:{async onSubmit(e){var t,l;try{await this.$store.dispatch("webhooks/update",{webhook:e,id:this.id}),I(this.$t("INTEGRATION_SETTINGS.WEBHOOK.EDIT.API.SUCCESS_MESSAGE")),this.onClose()}catch(r){const i=((l=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:l.message)||this.$t("INTEGRATION_SETTINGS.WEBHOOK.EDIT.API.ERROR_MESSAGE");I(i)}}}},me={class:"flex flex-col h-auto overflow-auto"};function pe(e,t,l,r,i,s){const d=u("woot-modal-header"),o=u("WebhookForm");return a(),p("div",me,[E(d,{"header-title":e.$t("INTEGRATION_SETTINGS.WEBHOOK.EDIT.TITLE")},null,8,["header-title"]),E(o,{value:l.value,"is-submitting":e.uiFlags.updatingItem,"submit-label":e.$t("INTEGRATION_SETTINGS.WEBHOOK.FORM.EDIT_SUBMIT"),onSubmit:s.onSubmit,onCancel:l.onClose},null,8,["value","is-submitting","submit-label","onSubmit","onCancel"])])}const Te=w(ce,[["render",pe]]),he={class:"py-4 ltr:pr-4 rtl:pl-4"},Ie={class:"font-medium break-words text-slate-700 dark:text-slate-100"},Oe={class:"block mt-1 text-sm text-slate-500 dark:text-slate-400"},Se={class:"font-medium"},be={class:"py-4 min-w-xs"},Ne={class:"flex justify-end gap-1"},_e={__name:"WebhookRow",props:{webhook:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["edit","delete"],setup(e,{emit:t}){const l=e,r=t,{t:i}=$(),s=V(()=>{const{subscriptions:d}=l.webhook;return d.map(o=>i(v("INTEGRATION_SETTINGS.WEBHOOK.FORM.SUBSCRIPTIONS.EVENTS",o))).join(", ")});return(d,o)=>{const h=u("woot-button"),S=q("tooltip");return a(),p("tr",null,[n("td",he,[n("div",Ie,m(e.webhook.url),1),n("div",Oe,[n("span",Se,m(d.$t("INTEGRATION_SETTINGS.WEBHOOK.SUBSCRIBED_EVENTS"))+": ",1),E(j,{text:s.value,limit:60},null,8,["text"])])]),n("td",be,[n("div",Ne,[f(E(h,{variant:"smooth",size:"tiny","color-scheme":"secondary",icon:"edit",onClick:o[0]||(o[0]=b=>r("edit",e.webhook))},null,512),[[S,d.$t("INTEGRATION_SETTINGS.WEBHOOK.EDIT.BUTTON_TEXT"),void 0,{top:!0}]]),f(E(h,{variant:"smooth","color-scheme":"alert",size:"tiny",icon:"dismiss-circle",onClick:o[1]||(o[1]=b=>r("delete",e.webhook,e.index))},null,512),[[S,d.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.BUTTON_TEXT"),void 0,{top:!0}]])])])])}}},fe={components:{SettingsLayout:z,BaseSettingsHeader:X,NewWebhook:Ee,EditWebhook:Te,WebhookRow:_e},data(){return{loading:{},showAddPopup:!1,showEditPopup:!1,showDeleteConfirmationPopup:!1,selectedWebHook:{}}},computed:{...k({records:"webhooks/getWebhooks",uiFlags:"webhooks/getUIFlags"}),integration(){return this.$store.getters["integrations/getIntegration"]("webhook")},tableHeaders(){return[this.$t("INTEGRATION_SETTINGS.WEBHOOK.LIST.TABLE_HEADER.WEBHOOK_ENDPOINT"),this.$t("INTEGRATION_SETTINGS.WEBHOOK.LIST.TABLE_HEADER.ACTIONS")]}},mounted(){this.$store.dispatch("webhooks/get")},methods:{openAddPopup(){this.showAddPopup=!0},hideAddPopup(){this.showAddPopup=!1},openDeletePopup(e){this.showDeleteConfirmationPopup=!0,this.selectedWebHook=e},closeDeletePopup(){this.showDeleteConfirmationPopup=!1},openEditPopup(e){this.showEditPopup=!0,this.selectedWebHook=e},hideEditPopup(){this.showEditPopup=!1},confirmDeletion(){this.loading[this.selectedWebHook.id]=!0,this.closeDeletePopup(),this.deleteWebhook(this.selectedWebHook.id)},async deleteWebhook(e){try{await this.$store.dispatch("webhooks/delete",e),I(this.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.API.SUCCESS_MESSAGE"))}catch{I(this.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.API.ERROR_MESSAGE"))}}}},we={class:"min-w-full divide-y divide-slate-75 dark:divide-slate-700"},ge={class:"divide-y divide-slate-25 dark:divide-slate-800 flex-1 text-slate-700 dark:text-slate-100"};function Re(e,t,l,r,i,s){const d=u("woot-button"),o=u("BaseSettingsHeader"),h=u("WebhookRow"),S=u("NewWebhook"),b=u("woot-modal"),H=u("EditWebhook"),P=u("woot-delete-modal"),D=u("SettingsLayout");return a(),O(D,{"is-loading":e.uiFlags.fetchingList,"loading-message":e.$t("INTEGRATION_SETTINGS.WEBHOOK.LOADING"),"no-records-message":e.$t("INTEGRATION_SETTINGS.WEBHOOK.LIST.404"),"no-records-found":!e.records.length},{header:T(()=>[s.integration.name?(a(),O(o,{key:0,title:s.integration.name,description:s.integration.description,"link-text":e.$t("INTEGRATION_SETTINGS.WEBHOOK.LEARN_MORE"),"feature-name":"webhook","back-button-label":e.$t("INTEGRATION_SETTINGS.HEADER")},{actions:T(()=>[E(d,{class:"button nice rounded-md",icon:"add-circle",onClick:s.openAddPopup},{default:T(()=>[N(m(e.$t("INTEGRATION_SETTINGS.WEBHOOK.HEADER_BTN_TXT")),1)]),_:1},8,["onClick"])]),_:1},8,["title","description","link-text","back-button-label"])):_("",!0)]),body:T(()=>[n("table",we,[n("thead",null,[(a(!0),p(g,null,R(s.tableHeaders,c=>(a(),p("th",{key:c,class:"py-4 pr-4 text-left font-semibold text-slate-700 dark:text-slate-300 last:text-right last:pr-4"},m(c),1))),128))]),n("tbody",ge,[(a(!0),p(g,null,R(e.records,(c,C)=>(a(),O(h,{key:c.id,index:C,webhook:c,onEdit:s.openEditPopup,onDelete:s.openDeletePopup},null,8,["index","webhook","onEdit","onDelete"]))),128))])])]),default:T(()=>[E(b,{show:i.showAddPopup,"onUpdate:show":t[0]||(t[0]=c=>i.showAddPopup=c),"on-close":s.hideAddPopup},{default:T(()=>[i.showAddPopup?(a(),O(S,{key:0,"on-close":s.hideAddPopup},null,8,["on-close"])):_("",!0)]),_:1},8,["show","on-close"]),E(b,{show:i.showEditPopup,"onUpdate:show":t[1]||(t[1]=c=>i.showEditPopup=c),"on-close":s.hideEditPopup},{default:T(()=>[i.showEditPopup?(a(),O(H,{key:0,id:i.selectedWebHook.id,value:i.selectedWebHook,"on-close":s.hideEditPopup},null,8,["id","value","on-close"])):_("",!0)]),_:1},8,["show","on-close"]),E(P,{show:i.showDeleteConfirmationPopup,"onUpdate:show":t[2]||(t[2]=c=>i.showDeleteConfirmationPopup=c),"on-close":s.closeDeletePopup,"on-confirm":s.confirmDeletion,title:e.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.CONFIRM.TITLE"),message:e.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.CONFIRM.MESSAGE",{webhookURL:i.selectedWebHook.url}),"confirm-text":e.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.CONFIRM.YES"),"reject-text":e.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.CONFIRM.NO")},null,8,["show","on-close","on-confirm","title","message","confirm-text","reject-text"])]),_:1},8,["is-loading","loading-message","no-records-message","no-records-found"])}const nt=w(fe,[["render",Re]]);export{nt as default};
