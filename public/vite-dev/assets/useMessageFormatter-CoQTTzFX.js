import{g as f}from"./_commonjsHelpers-BosuxZz1.js";import{M as h}from"./index-BO4rcqbh.js";function g(e,r){var s,t,n=e.attrs[e.attrIndex("href")][1];for(s=0;s<r.length;++s){if(t=r[s],typeof t.matcher=="function"){if(t.matcher(n,t))return t;continue}return t}}function p(e,r,s){Object.keys(s).forEach(function(t){var n,a=s[t];t==="className"&&(t="class"),n=r[e].attrIndex(t),n<0?r[e].attrPush([t,a]):r[e].attrs[n][1]=a})}function m(e,r){r?r=Array.isArray(r)?r:[r]:r=[],Object.freeze(r);var s=e.renderer.rules.link_open||this.defaultRender;e.renderer.rules.link_open=function(t,n,a,o,l){var i=g(t[n],r),u=i&&i.attrs;return u&&p(n,t,u),s(t,n,a,o,l)}}m.defaultRender=function(e,r,s,t,n){return n.renderToken(e,r,s)};var d=m;const E=f(d),M=/mention:\/\/(user|team)\/(\d+)\/(.+)/gm,T=()=>(e,r)=>{var s,t,n,a,o,l,i="",u=e.posMax;return e.src.charCodeAt(e.pos)!==91||(n=e.pos+1,t=e.md.helpers.parseLinkLabel(e,e.pos,!0),t<0)||(s=e.src.slice(n,t),a=t+1,a<u&&e.src.charCodeAt(a)===40&&(a+=1,o=e.md.helpers.parseLinkDestination(e.src,a,e.posMax),o.ok&&(i=e.md.normalizeLink(o.str),e.md.validateLink(i)?a=o.pos:i=""),a+=1),!i.match(new RegExp(M)))?!1:(r||(e.pos=n,e.posMax=t,l=e.push("mention",""),l.href=i,l.content=s),e.pos=a,e.posMax=u,!0)},v=()=>(e,r)=>`<span class="prosemirror-mention-node">${e[r].content}</span>`;function x(e){e.renderer.rules.mention=v(),e.inline.ruler.before("link","mention",T())}const R=e=>{const r=e.attrGet("src");if(!r)return;const t=new URL(r).searchParams.get("cw_image_height");t&&e.attrSet("style",`height: ${t};`)},w=e=>{e.children.forEach(r=>{r.type==="image"&&R(r)})},A=e=>{e.core.ruler.after("inline","add-image-height",r=>{r.tokens.forEach(s=>{s.type==="inline"&&w(s)})})},b=h({html:!1,xhtmlOut:!0,breaks:!0,langPrefix:"language-",linkify:!0,typographer:!0,quotes:"“”‘’",maxNesting:20}).use(x).use(A).use(E,{attrs:{class:"link",rel:"noreferrer noopener nofollow",target:"_blank"}}),_=/(^|[^@\w])@(\w{1,15})\b/g,k="$1[@$2](http://twitter.com/$2)",$=/(^|\s)#(\w+)/g,I="$1[#$2](https://twitter.com/hashtag/$2)";class c{constructor(r,s=!1,t=!1){this.message=r||"",this.isAPrivateNote=t,this.isATweet=s}formatMessage(){let r=this.message;return this.isATweet&&!this.isAPrivateNote&&(r=r.replace(_,k),r=r.replace($,I)),b.render(r)}get formattedMessage(){return this.formatMessage()}get plainText(){return new DOMParser().parseFromString(this.formattedMessage,"text/html").body.textContent||""}}const C=()=>{const e=(n,a,o)=>new c(n,a,o).formattedMessage,r=(n,a)=>new c(n,a).plainText;return{formatMessage:e,getPlainText:r,truncateMessage:(n="")=>n.length<100?n:`${n.slice(0,97)}...`,highlightContent:(n="",a="",o="")=>{const l=r(n),i=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return l.replace(new RegExp(`(${i})`,"ig"),`<span class="${o}">$1</span>`)}}};export{C as u};
