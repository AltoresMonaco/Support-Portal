import{a as f,u as I}from"./index-BaHWIRRA.js";import{w as D}from"./DashboardIcon-CPXNa31t.js";import{a9 as P,u as y,ah as $,ai as V}from"./dashboard-CGLIihvy.js";import{_ as g,u as S,H as b,o as A,n as _,p as r,e as c,l as h,m as u,t as d,k as R,g as C,a as L,c as w,L as B,U as O,T as F}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{d as U}from"./utils.esm-CA3tRshB.js";import{P as G,h as z,k as Y,S as j,E as x,H as K,I as H,g as Z,J as W,R as J}from"./timeHelper-BT38nsET.js";import{k as X}from"./keyboardEventListenerMixins-Du6EPVcl.js";import{M as q}from"./MultiselectDropdown-Cp046MCC.js";import{m as Q}from"./globalConfig-DaGjiImb.js";const{ARTICLE_STATUS_TYPES:ee}=D,te={props:{isSidebarOpen:{type:Boolean,default:!0},backButtonLabel:{type:String,default:""},isUpdating:{type:Boolean,default:!1},isSaved:{type:Boolean,default:!1},enableOpenSidebarButton:{type:Boolean,default:!1}},emits:["back","show","add","updateMeta","open","close"],data(){return{showActionsDropdown:!1,alertMessage:"",ARTICLE_STATUS_TYPES:ee}},computed:{statusText(){return this.isUpdating?this.$t("HELP_CENTER.EDIT_HEADER.SAVING"):this.$t("HELP_CENTER.EDIT_HEADER.SAVED")},articleSlug(){return this.$route.params.articleSlug},currentPortalSlug(){return this.$route.params.portalSlug},currentArticleStatus(){return this.$store.getters["articles/articleStatus"](this.articleSlug)},isPublishedArticle(){return this.currentArticleStatus==="published"},isArchivedArticle(){return this.currentArticleStatus==="archived"}},methods:{onClickGoBack(){this.$emit("back")},showPreview(){this.$emit("show")},onClickAdd(){this.$emit("add")},async updateArticleStatus(e){try{await this.$store.dispatch("articles/update",{portalSlug:this.currentPortalSlug,articleId:this.articleSlug,status:e}),this.$emit("updateMeta"),this.statusUpdateSuccessMessage(e),this.closeActionsDropdown(),e===this.ARTICLE_STATUS_TYPES.ARCHIVE?f(P.ARCHIVE_ARTICLE,{uiFrom:"header"}):e===this.ARTICLE_STATUS_TYPES.PUBLISH&&f(P.PUBLISH_ARTICLE)}catch(t){this.alertMessage=(t==null?void 0:t.message)||this.statusUpdateErrorMessage(e)}finally{I(this.alertMessage)}},statusUpdateSuccessMessage(e){e===this.ARTICLE_STATUS_TYPES.PUBLISH?this.alertMessage=this.$t("HELP_CENTER.PUBLISH_ARTICLE.API.SUCCESS"):e===this.ARTICLE_STATUS_TYPES.ARCHIVE&&(this.alertMessage=this.$t("HELP_CENTER.ARCHIVE_ARTICLE.API.SUCCESS"))},statusUpdateErrorMessage(e){e===this.ARTICLE_STATUS_TYPES.PUBLISH?this.alertMessage=this.$t("HELP_CENTER.PUBLISH_ARTICLE.API.ERROR"):e===this.ARTICLE_STATUS_TYPES.ARCHIVE&&(this.alertMessage=this.$t("HELP_CENTER.ARCHIVE_ARTICLE.API.ERROR"))},openSidebar(){this.$emit("open")},closeSidebar(){this.$emit("close")},openActionsDropdown(){this.showActionsDropdown=!this.showActionsDropdown},closeActionsDropdown(){this.showActionsDropdown=!1}}},ae={class:"flex items-center justify-between w-full h-16"},se={class:"flex items-center"},ie={class:"flex items-center gap-1"},le={key:0,class:"items-center ml-4 mr-1 text-xs draft-status rtl:ml-2 rtl:mr-4 text-slate-400 dark:text-slate-300"},oe={class:"relative article--buttons"},re={class:"button-group"},ne={key:0,class:"dropdown-pane dropdown-pane--open"};function ce(e,t,s,o,l,a){const i=S("woot-button"),p=S("woot-dropdown-item"),m=S("woot-dropdown-menu"),E=b("tooltip"),k=b("on-clickaway");return A(),_("div",ae,[r("div",se,[c(i,{icon:"chevron-left",variant:"clear",size:"small","color-scheme":"primary",class:"back-button",onClick:a.onClickGoBack},{default:h(()=>[u(d(s.backButtonLabel),1)]),_:1},8,["onClick"])]),r("div",ie,[s.isUpdating||s.isSaved?(A(),_("span",le,d(a.statusText),1)):R("",!0),c(i,{"class-names":"article--buttons relative",icon:"globe","color-scheme":"secondary",variant:"hollow",size:"small",onClick:a.showPreview},{default:h(()=>[u(d(e.$t("HELP_CENTER.EDIT_HEADER.PREVIEW")),1)]),_:1},8,["onClick"]),s.isSidebarOpen?R("",!0):C((A(),L(i,{key:1,icon:"pane-open","class-names":"article--buttons relative sidebar-button",variant:"hollow",size:"small","color-scheme":"secondary","is-disabled":s.enableOpenSidebarButton,onClick:a.openSidebar},null,8,["is-disabled","onClick"])),[[E,e.$t("HELP_CENTER.EDIT_HEADER.OPEN_SIDEBAR"),void 0,{"top-end":!0}]]),s.isSidebarOpen?C((A(),L(i,{key:2,icon:"pane-close","class-names":"article--buttons relative",variant:"hollow",size:"small","color-scheme":"secondary",onClick:a.closeSidebar},null,8,["onClick"])),[[E,e.$t("HELP_CENTER.EDIT_HEADER.CLOSE_SIDEBAR"),void 0,{"top-end":!0}]]):R("",!0),r("div",oe,[r("div",re,[c(i,{"class-names":"publish-button",size:"small",icon:"checkmark","color-scheme":"primary","is-disabled":!a.articleSlug||a.isPublishedArticle,onClick:t[0]||(t[0]=M=>a.updateArticleStatus(l.ARTICLE_STATUS_TYPES.PUBLISH))},{default:h(()=>[u(d(e.$t("HELP_CENTER.EDIT_HEADER.PUBLISH_BUTTON")),1)]),_:1},8,["is-disabled"]),c(i,{size:"small",icon:"chevron-down","is-disabled":!a.articleSlug||a.isArchivedArticle,onClick:a.openActionsDropdown},null,8,["is-disabled","onClick"])]),l.showActionsDropdown?C((A(),_("div",ne,[c(m,null,{default:h(()=>[c(p,null,{default:h(()=>[c(i,{variant:"clear","color-scheme":"secondary",size:"small",icon:"book-clock",onClick:t[1]||(t[1]=M=>a.updateArticleStatus(l.ARTICLE_STATUS_TYPES.ARCHIVE))},{default:h(()=>[u(d(e.$t("HELP_CENTER.EDIT_HEADER.MOVE_TO_ARCHIVE_BUTTON")),1)]),_:1})]),_:1})]),_:1})])),[[k,a.closeActionsDropdown]]):R("",!0)])])])}const De=g(te,[["render",ce],["__scopeId","data-v-2b772092"]]);function de(e,t,s){s.state.doc.descendants((o,l)=>{if(o.type.name==="image"&&o.attrs.src===e){const a=s.state.tr.setNodeMarkup(l,null,{...o.attrs,src:t});s.dispatch(a)}})}const Ee=e=>new G({props:{handlePaste(t,s,o){const l=[];o.content.descendants(a=>{a.type.name==="image"&&l.push(a.attrs.src)}),Promise.all(l.map(async a=>{try{const i=await e(a);de(a,i,t)}catch(i){console.error("Error uploading image:",i)}}))}}}),v=4,N=(e,t,s=[],o={},l)=>x.create({doc:new K(H).parse(e),plugins:Z({schema:H,placeholder:t,methods:o,plugins:s,enabledMenuOptions:l})});let n=null,T;const ue={mixins:[X],props:{modelValue:{type:String,default:""},editorId:{type:String,default:""},placeholder:{type:String,default:""},enabledMenuOptions:{type:Array,default:()=>[]}},emits:["blur","input","update:modelValue","keyup","focus","keydown"],setup(){const{uiSettings:e,updateUISettings:t}=y();return{uiSettings:e,updateUISettings:t}},data(){return{plugins:[Ee(this.handleImageUpload)]}},watch:{modelValue(e=""){e!==this.contentFromEditor()&&this.reloadState()},editorId(){this.reloadState()}},created(){T=N(this.modelValue,this.placeholder,this.plugins,{onImageUpload:this.openFileBrowser},this.enabledMenuOptions)},mounted(){this.createEditorView(),n.updateState(T),this.focusEditorInputField()},methods:{contentFromEditor(){return n?W.serialize(n.state.doc):""},openFileBrowser(){this.$refs.imageUploadInput.click()},async handleImageUpload(e){try{return await this.$store.dispatch("articles/uploadExternalImage",{portalSlug:this.$route.params.portalSlug,url:e})}catch{return I(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.UN_AUTHORIZED_ERROR")),""}},onFileChange(){const e=this.$refs.imageUploadInput.files[0];z(e,v)?this.uploadImageToStorage(e):I(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.ERROR_FILE_SIZE",{size:v})),this.$refs.imageUploadInput.value=""},async uploadImageToStorage(e){try{const t=await this.$store.dispatch("articles/attachImage",{portalSlug:this.$route.params.portalSlug,file:e});t&&this.onImageUploadStart(t)}catch{I(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.ERROR"))}},onImageUploadStart(e){const{selection:t}=n.state,s=t.from,o=n.state.schema.nodes.image.create({src:e}),l=n.state.schema.node("paragraph");if(o){const a=n.state.tr.replaceSelectionWith(l).insert(s+1,o);n.dispatch(a.scrollIntoView()),this.focusEditorInputField()}},reloadState(){T=N(this.modelValue,this.placeholder,this.plugins,{onImageUpload:this.openFileBrowser},this.enabledMenuOptions),n.updateState(T),this.focusEditorInputField()},createEditorView(){n=new Y(this.$refs.editor,{state:T,dispatchTransaction:e=>{T=T.apply(e),n.updateState(T),e.docChanged&&this.emitOnChange()},handleDOMEvents:{keyup:this.onKeyup,focus:this.onFocus,blur:this.onBlur,keydown:this.onKeydown,paste:(e,t)=>{const s=t.clipboardData.files;s.length>0&&(s.forEach(o=>{o.type.includes("image")&&this.uploadImageToStorage(o)}),t.preventDefault())}}})},handleKeyEvents(){},focusEditorInputField(){const{tr:e}=n.state,t=j.atEnd(e.doc);n.dispatch(e.setSelection(t)),n.focus()},emitOnChange(){this.$emit("update:modelValue",this.contentFromEditor()),this.$emit("input",this.contentFromEditor())},onKeyup(){this.$emit("keyup")},onKeydown(){this.$emit("keydown")},onBlur(){this.$emit("blur")},onFocus(){this.$emit("focus")}}},he={class:"editor-root editor--article"},pe={ref:"editor"};function me(e,t,s,o,l,a){return A(),_("div",null,[r("div",he,[r("input",{ref:"imageUploadInput",type:"file",accept:"image/png, image/jpeg, image/jpg, image/gif, image/webp",hidden:"",onChange:t[0]||(t[0]=(...i)=>a.onFileChange&&a.onFileChange(...i))},null,544),r("div",pe,null,512)])])}const Te=g(ue,[["render",me]]),Ae={class:"edit-article--container"},Se={__name:"ArticleEditor",props:{article:{type:Object,default:()=>({})}},emits:["saveArticle"],setup(e,{emit:t}){const s=t,o=U(i=>s("saveArticle",i),400,!1),l=w({get:()=>e.article.title,set:i=>{o({title:i})}}),a=w({get:()=>e.article.content,set:i=>{o({content:i})}});return(i,p)=>(A(),_("div",Ae,[c(J,{modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=m=>l.value=m),type:"text",rows:1,class:"article-heading",placeholder:i.$t("HELP_CENTER.EDIT_ARTICLE.TITLE_PLACEHOLDER")},null,8,["modelValue","placeholder"]),c(Te,{modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=m=>a.value=m),class:"article-content",placeholder:i.$t("HELP_CENTER.EDIT_ARTICLE.CONTENT_PLACEHOLDER"),"enabled-menu-options":B($)},null,8,["modelValue","placeholder","enabled-menu-options"])]))}},ye=g(Se,[["__scopeId","data-v-f60c71bf"]]),_e={components:{MultiselectDropdown:q},props:{article:{type:Object,default:()=>({})}},emits:["saveArticle","archiveArticle","deleteArticle","updateMeta","saveArticle"],data(){return{metaTitle:"",metaDescription:"",metaTags:[],metaOptions:[],tagInputValue:""}},computed:{...Q({categories:"categories/allCategories",agents:"agents/getAgents"}),assignedAuthor(){var e;return(e=this.article)==null?void 0:e.author},selectedCategory(){var e;return(e=this.article)==null?void 0:e.category},allTags(){return this.metaTags.map(e=>e.name)}},watch:{article:{handler(){if(!V(this.article.meta||{})){const{meta:{title:e="",description:t="",tags:s=[]}}=this.article;this.metaTitle=e,this.metaDescription=t,this.metaTags=this.formattedTags({tags:s})}},deep:!0,immediate:!0}},mounted(){this.saveArticle=U(()=>{this.$emit("saveArticle",{meta:{title:this.metaTitle,description:this.metaDescription,tags:this.allTags}})},1e3,!1)},methods:{formattedTags({tags:e}){return e.map(t=>({name:t}))},addTagValue(e){const t=e.split(",").map(s=>s.trim()).filter(s=>s&&!this.allTags.includes(s));this.metaTags.push(...this.formattedTags({tags:[...new Set(t)]})),this.saveArticle()},removeTag(){this.saveArticle()},handleSearchChange(e){this.tagInputValue=e},onBlur(){this.tagInputValue&&this.addTagValue(this.tagInputValue)},onClickSelectCategory({id:e}){this.$emit("saveArticle",{category_id:e})},onClickAssignAuthor({id:e}){this.$emit("saveArticle",{author_id:e}),this.updateMeta()},onChangeMetaInput(){this.saveArticle()},onClickArchiveArticle(){this.$emit("archiveArticle"),this.updateMeta()},onClickDeleteArticle(){this.$emit("deleteArticle"),this.updateMeta()},updateMeta(){this.$emit("updateMeta")}}},Ce={class:"min-w-[15rem] max-w-[22.5rem] p-6 overflow-y-auto border-l rtl:border-r rtl:border-l-0 border-solid border-slate-50 dark:border-slate-700"},Re={class:"text-base text-slate-800 dark:text-slate-100"},Ie={class:"mt-4 mb-6"},ge=["placeholder"],Le=["placeholder"],fe={class:"flex flex-col"};function Pe(e,t,s,o,l,a){const i=S("MultiselectDropdown"),p=S("multiselect"),m=S("woot-button");return A(),L(F,{name:"popover-animation"},{default:h(()=>[r("div",Ce,[r("h3",Re,d(e.$t("HELP_CENTER.ARTICLE_SETTINGS.TITLE")),1),r("div",Ie,[r("label",null,[u(d(e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.CATEGORY.LABEL"))+" ",1),c(i,{options:e.categories,"selected-item":a.selectedCategory,"has-thumbnail":!1,"multiselector-title":e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.CATEGORY.TITLE"),"multiselector-placeholder":e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.CATEGORY.PLACEHOLDER"),"no-search-result":e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.CATEGORY.NO_RESULT"),"input-placeholder":e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.CATEGORY.SEARCH_PLACEHOLDER"),onSelect:a.onClickSelectCategory},null,8,["options","selected-item","multiselector-title","multiselector-placeholder","no-search-result","input-placeholder","onSelect"])]),r("label",null,[u(d(e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.AUTHOR.LABEL"))+" ",1),c(i,{options:e.agents,"selected-item":a.assignedAuthor,"multiselector-title":e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.AUTHOR.TITLE"),"multiselector-placeholder":e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.AUTHOR.PLACEHOLDER"),"no-search-result":e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.AUTHOR.NO_RESULT"),"input-placeholder":e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.AUTHOR.SEARCH_PLACEHOLDER"),onSelect:a.onClickAssignAuthor},null,8,["options","selected-item","multiselector-title","multiselector-placeholder","no-search-result","input-placeholder","onSelect"])]),r("label",null,[u(d(e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.META_TITLE.LABEL"))+" ",1),C(r("textarea",{"onUpdate:modelValue":t[0]||(t[0]=E=>l.metaTitle=E),rows:"3",type:"text",placeholder:e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.META_TITLE.PLACEHOLDER"),onInput:t[1]||(t[1]=(...E)=>a.onChangeMetaInput&&a.onChangeMetaInput(...E))},null,40,ge),[[O,l.metaTitle]])]),r("label",null,[u(d(e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.META_DESCRIPTION.LABEL"))+" ",1),C(r("textarea",{"onUpdate:modelValue":t[2]||(t[2]=E=>l.metaDescription=E),class:"text-sm",rows:"3",type:"text",placeholder:e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.META_DESCRIPTION.PLACEHOLDER"),onInput:t[3]||(t[3]=(...E)=>a.onChangeMetaInput&&a.onChangeMetaInput(...E))},null,40,Le),[[O,l.metaDescription]])]),r("label",null,[u(d(e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.META_TAGS.LABEL"))+" ",1),c(p,{modelValue:l.metaTags,"onUpdate:modelValue":t[4]||(t[4]=E=>l.metaTags=E),placeholder:e.$t("HELP_CENTER.ARTICLE_SETTINGS.FORM.META_TAGS.PLACEHOLDER"),class:"min-w-[300px]",label:"name",options:l.metaOptions,"track-by":"name",multiple:"",taggable:"","close-on-select":!1,onSearchChange:a.handleSearchChange,onClose:a.onBlur,onTag:a.addTagValue,onRemove:a.removeTag},null,8,["modelValue","placeholder","options","onSearchChange","onClose","onTag","onRemove"])])]),r("div",fe,[c(m,{icon:"archive",size:"small",variant:"clear","color-scheme":"secondary",onClick:a.onClickArchiveArticle},{default:h(()=>[u(d(e.$t("HELP_CENTER.ARTICLE_SETTINGS.BUTTONS.ARCHIVE")),1)]),_:1},8,["onClick"]),c(m,{icon:"delete",size:"small",variant:"clear","color-scheme":"alert",onClick:a.onClickDeleteArticle},{default:h(()=>[u(d(e.$t("HELP_CENTER.ARTICLE_SETTINGS.BUTTONS.DELETE")),1)]),_:1},8,["onClick"])])])]),_:1})}const $e=g(_e,[["render",Pe],["__scopeId","data-v-0b5bb61f"]]);export{ye as A,De as E,$e as a};
