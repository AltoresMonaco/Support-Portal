import{c as e,P as O}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{v as f,c as C,u as E}from"./mutationHelpers-3VTcoJiD.js";import{g as k,a as x,b as F}from"./agentHelper-C7QvnyM_.js";import{a as N,u as P}from"./index-BaHWIRRA.js";import{u as R}from"./globalConfig-DaGjiImb.js";import{z as U,O as w}from"./dashboard-CGLIihvy.js";function H(u=!0){const n=f("getCurrentUser"),i=f("getSelectedChat"),a=f("getCurrentAccountId"),o=f("inboxAssignableAgents/getAssignableAgents"),r=e(()=>{var l;return(l=i.value)==null?void 0:l.inbox_id}),c=e(()=>{var l,p;return(p=(l=i.value)==null?void 0:l.meta)==null?void 0:p.assignee}),g=e(()=>r.value?o.value(r.value):[]);return{agentsList:e(()=>{const l=g.value||[],p=k(l,n.value,a.value),t=x(p);return F(t,u,c.value)}),assignableAgents:g}}function J(){const u=C(),n=E(),i=e(()=>n.getSelectedChat.value),a=e(()=>{var t;return(t=i.value)==null?void 0:t.id}),o=e(()=>n["labels/getLabels"].value),r=e(()=>u.getters["conversationLabels/getConversationLabels"](a.value)),c=e(()=>o.value.filter(({title:t})=>r.value.includes(t))),g=e(()=>o.value.filter(({title:t})=>!r.value.includes(t))),m=async t=>{await u.dispatch("conversationLabels/update",{conversationId:a.value,labels:t})};return{accountLabels:o,savedLabels:r,activeLabels:c,inactiveLabels:g,addLabelToConversation:t=>{const v=c.value.map(b=>b.title);v.push(t.title),m(v)},removeLabelFromConversation:t=>{const v=c.value.map(b=>b.title).filter(b=>b!==t);m(v)},onUpdateLabels:m}}class G extends U{constructor(){super("integrations",{accountScoped:!0}),this.conversation_events=["summarize","reply_suggestion","label_suggestion"],this.message_events=["rephrase"]}processEvent({type:n="rephrase",content:i,tone:a,conversationId:o,hookId:r}){let c={tone:a,content:i};return this.conversation_events.includes(n)&&(c={conversation_display_id:o}),axios.post(`${this.url}/hooks/${r}/process_event`,{event:{name:n,data:c}})}}const y=new G,B=u=>u.toLowerCase().split(",").filter(n=>n.trim()).map(n=>n.trim()).filter((n,i,a)=>a.indexOf(n)===i);function Q(){const u=C(),n=E(),{t:i}=R(),a=e(()=>n["integrations/getUIFlags"].value),o=f("integrations/getAppIntegrations"),r=f("getSelectedChat"),c=f("draftMessages/getReplyEditorMode"),g=e(()=>{var s;return(s=o.value.find(d=>d.id==="openai"&&!!d.hooks.length))==null?void 0:s.hooks[0]}),m=e(()=>!!g.value),l=e(()=>{if(g.value){const{settings:s={}}=g.value||{};return s.label_suggestion}return!1}),p=e(()=>a.value.isFetching),t=e(()=>{var s;return(s=g.value)==null?void 0:s.id}),v=e(()=>{var s;return(s=r.value)==null?void 0:s.id}),b=e(()=>`draft-${v.value}-${c.value}`),A=e(()=>n["draftMessages/get"].value(b.value)),L=async()=>{o.value.length||await u.dispatch("integrations/get")},_=async(s,d)=>{const h=w[s.toUpperCase()];h&&N(h,{type:s,...d})},S=async()=>{if(!v.value)return[];try{const s=await y.processEvent({type:"label_suggestion",hookId:t.value,conversationId:v.value}),{data:{message:d}}=s;return B(d)}catch{return[]}},M=async(s="rephrase")=>{var d;try{const h=await y.processEvent({hookId:t.value,type:s,content:A.value,conversationId:v.value}),{data:{message:I}}=h;return I}catch(h){const I=h.response.data.error,T=((d=I==null?void 0:I.error)==null?void 0:d.message)||i("INTEGRATION_SETTINGS.OPEN_AI.GENERATE_ERROR");return P(T),""}};return O(()=>{L()}),{draftMessage:A,uiFlags:a,appIntegrations:o,currentChat:r,replyMode:c,isAIIntegrationEnabled:m,isLabelSuggestionFeatureEnabled:l,isFetchingAppIntegrations:p,fetchIntegrationsIfRequired:L,recordAnalytics:_,fetchLabelSuggestions:S,processEvent:M}}export{H as a,Q as b,J as u};
