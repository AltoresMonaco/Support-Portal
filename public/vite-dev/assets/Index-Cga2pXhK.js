import{l as C}from"./auth-DDr_qkNO.js";import{m as S}from"./globalConfig-DaGjiImb.js";import{p as _}from"./utils.esm-CA3tRshB.js";import{u as w}from"./index-BaHWIRRA.js";import{u as k,r as A,e as N}from"./index-C2DForDf.js";import{g as E}from"./globalConfigMixin-BNbqaRx5.js";import{_ as G}from"./Input-BujGHd2I.js";import{G as x}from"./Button-D9Wvo8PQ.js";import{S as y}from"./Spinner-B-aSVz3z.js";import{S as U}from"./SubmitButton-DD7GmEA-.js";import{_ as T,o as s,n as i,p as n,k as u,t as h,m as p,e as a,l as g,a as B,f as v,q as R,u as d}from"./_plugin-vue_export-helper-CvYNw_mv.js";import"./DashboardIcon-CPXNa31t.js";import"./vue-router-CNCrM2WK.js";import"./index-BP-sUqpX.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./exports-CsC-x4VI.js";import"./Icon-Dtj3LCzD.js";import"./axios-CCb-kr4I.js";import"./WithLabel-DjXD7ol1.js";const M={"no-account-found":"LOGIN.OAUTH.NO_ACCOUNT_FOUND","business-account-only":"LOGIN.OAUTH.BUSINESS_ACCOUNTS_ONLY"},$={components:{FormInput:G,GoogleOAuthButton:x,Spinner:y,SubmitButton:U},mixins:[E],props:{ssoAuthToken:{type:String,default:""},ssoAccountId:{type:String,default:""},ssoConversationId:{type:String,default:""},email:{type:String,default:""},authError:{type:String,default:""}},setup(){return{v$:k()}},data(){return{credentials:{email:"",password:""},loginApi:{message:"",showLoading:!1,hasErrored:!1},error:""}},validations(){return{credentials:{password:{required:A},email:{required:A,email:N}}}},computed:{...S({globalConfig:"globalConfig/get"}),showGoogleOAuth(){return!!window.chatwootConfig.googleOAuthClientId},showSignupLink(){return _(window.chatwootConfig.signupEnabled)}},created(){if(this.ssoAuthToken&&this.submitLogin(),this.authError){const e=M[this.authError]??"LOGIN.API.UNAUTH";w(this.$t(e)),this.requestIdleCallbackPolyfill(()=>{const{query:t}=this.$route;this.$router.replace({query:{...t,error:void 0}})})}},methods:{requestIdleCallbackPolyfill(e){window.requestIdleCallback?window.requestIdleCallback(e):setTimeout(e,0)},showAlertMessage(e){this.loginApi.showLoading=!1,this.loginApi.message=e,w(this.loginApi.message)},submitLogin(){this.loginApi.hasErrored=!1,this.loginApi.showLoading=!0;const e={email:this.email?decodeURIComponent(this.email):this.credentials.email,password:this.credentials.password,sso_auth_token:this.ssoAuthToken,ssoAccountId:this.ssoAccountId,ssoConversationId:this.ssoConversationId};C(e).then(()=>{this.showAlertMessage(this.$t("LOGIN.API.SUCCESS_MESSAGE"))}).catch(t=>{this.email&&(window.location="/app/login"),this.loginApi.hasErrored=!0,this.showAlertMessage((t==null?void 0:t.message)||this.$t("LOGIN.API.UNAUTH"))})},submitFormLogin(){if(this.v$.credentials.email.$invalid&&!this.email){this.showAlertMessage(this.$t("LOGIN.EMAIL.ERROR"));return}this.submitLogin()}}},P={class:"flex flex-col w-full min-h-screen py-20 bg-woot-25 sm:px-6 lg:px-8 dark:bg-slate-900"},V={class:"max-w-5xl mx-auto"},q=["src","alt"],D=["src","alt"],F={class:"mt-6 text-3xl font-medium text-center text-slate-900 dark:text-woot-50"},H={key:1,class:"mt-3 text-sm text-center text-slate-600 dark:text-slate-400"},W={key:0},z={key:0},j={key:1,class:"flex items-center justify-center"};function Y(e,t,b,m,o,l){const c=d("router-link"),I=d("GoogleOAuthButton"),f=d("FormInput"),O=d("SubmitButton"),L=d("Spinner");return s(),i("main",P,[n("section",V,[n("img",{src:e.globalConfig.logo,alt:e.globalConfig.installationName,class:"block w-auto h-8 mx-auto dark:hidden"},null,8,q),e.globalConfig.logoDark?(s(),i("img",{key:0,src:e.globalConfig.logoDark,alt:e.globalConfig.installationName,class:"hidden w-auto h-8 mx-auto dark:block"},null,8,D)):u("",!0),n("h2",F,h(e.useInstallationName(e.$t("LOGIN.TITLE"),"Altores")),1),l.showSignupLink?(s(),i("p",H,[p(h(e.$t("COMMON.OR"))+" ",1),a(c,{to:"auth/signup",class:"lowercase text-link"},{default:g(()=>[p(h(e.$t("LOGIN.CREATE_NEW_ACCOUNT")),1)]),_:1})])):u("",!0)]),n("section",{class:R(["bg-white shadow sm:mx-auto mt-11 sm:w-full sm:max-w-lg dark:bg-slate-800 p-11 sm:shadow-lg sm:rounded-lg",{"mb-8 mt-15":!l.showGoogleOAuth,"animate-wiggle":o.loginApi.hasErrored}])},[b.email?(s(),i("div",j,[a(L,{"color-scheme":"primary",size:""})])):(s(),i("div",W,[l.showGoogleOAuth?(s(),B(I,{key:0})):u("",!0),n("form",{class:"space-y-5",onSubmit:t[2]||(t[2]=v((...r)=>l.submitFormLogin&&l.submitFormLogin(...r),["prevent"]))},[a(f,{modelValue:o.credentials.email,"onUpdate:modelValue":t[0]||(t[0]=r=>o.credentials.email=r),name:"email_address",type:"text","data-testid":"email_input",tabindex:1,required:"",label:e.$t("LOGIN.EMAIL.LABEL"),placeholder:e.$t("LOGIN.EMAIL.PLACEHOLDER"),"has-error":m.v$.credentials.email.$error,onInput:m.v$.credentials.email.$touch},null,8,["modelValue","label","placeholder","has-error","onInput"]),a(f,{modelValue:o.credentials.password,"onUpdate:modelValue":t[1]||(t[1]=r=>o.credentials.password=r),type:"password",name:"password","data-testid":"password_input",required:"",tabindex:2,label:e.$t("LOGIN.PASSWORD.LABEL"),placeholder:e.$t("LOGIN.PASSWORD.PLACEHOLDER"),"has-error":m.v$.credentials.password.$error,onInput:m.v$.credentials.password.$touch},{default:g(()=>[e.globalConfig.disableUserProfileUpdate?u("",!0):(s(),i("p",z,[a(c,{to:"auth/reset/password",class:"text-sm text-link",tabindex:"4"},{default:g(()=>[p(h(e.$t("LOGIN.FORGOT_PASSWORD")),1)]),_:1})]))]),_:1},8,["modelValue","label","placeholder","has-error","onInput"]),a(O,{disabled:o.loginApi.showLoading,tabindex:3,"button-text":e.$t("LOGIN.SUBMIT"),loading:o.loginApi.showLoading},null,8,["disabled","button-text","loading"])],32)]))],2)])}const fe=T($,[["render",Y]]);export{fe as default};
