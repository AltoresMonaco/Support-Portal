import{_ as y,u as i,o as n,n as l,p as r,e as d,q as E,l as g,F as b,i as C,a as S,t as m,k as _,b as k,m as v,f as q,H as O,g as B}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{m as T}from"./globalConfig-DaGjiImb.js";import{j as x,b as H,C as L,R as M,a as D,x as w}from"./DashboardIcon-CPXNa31t.js";import{u as U}from"./timeHelper-BT38nsET.js";import{I as V}from"./InboxName-DzICaIqB.js";import{u as z}from"./useMessageFormatter-CoQTTzFX.js";import{a as G}from"./index-BaHWIRRA.js";import{h as Q,C as Y}from"./dashboard-CGLIihvy.js";import"./vue-router-CNCrM2WK.js";import"./index-BP-sUqpX.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./exports-CsC-x4VI.js";import"./Icon-Dtj3LCzD.js";import"./Spinner-B-aSVz3z.js";import"./Thumbnail-DLjRBBx8.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./mutationHelpers-3VTcoJiD.js";import"./index-DaWXXnfb.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./index-C2DForDf.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";const j={emits:["search"],data(){return{searchQuery:"",isInputFocused:!1}},mounted(){this.$refs.searchInput.focus(),document.addEventListener("keydown",this.handler)},unmounted(){document.removeEventListener("keydown",this.handler)},methods:{handler(e){e.key==="/"&&document.activeElement.tagName!=="INPUT"?(e.preventDefault(),this.$refs.searchInput.focus()):e.key==="Escape"&&document.activeElement.tagName==="INPUT"&&(e.preventDefault(),this.$refs.searchInput.blur())},debounceSearch(e){this.searchQuery=e.target.value,clearTimeout(this.debounce),this.debounce=setTimeout(async()=>{this.searchQuery.length>2||this.searchQuery.match(/^[0-9]+$/)?this.$emit("search",this.searchQuery):this.$emit("search","")},500)},onFocus(){this.isInputFocused=!0},onBlur(){this.isInputFocused=!1}}},K={class:"icon-container"},W=["placeholder","value"];function J(e,o,t,f,c,s){const u=i("fluent-icon"),h=i("woot-label");return n(),l("div",{class:E(["input-container",{"is-focused":c.isInputFocused}])},[r("div",K,[d(u,{icon:"search",class:"icon","aria-hidden":"true"})]),r("input",{ref:"searchInput",type:"search",class:"dark:bg-slate-900",placeholder:e.$t("SEARCH.INPUT_PLACEHOLDER"),value:c.searchQuery,onFocus:o[0]||(o[0]=(...a)=>s.onFocus&&s.onFocus(...a)),onBlur:o[1]||(o[1]=(...a)=>s.onBlur&&s.onBlur(...a)),onInput:o[2]||(o[2]=(...a)=>s.debounceSearch&&s.debounceSearch(...a))},null,40,W),d(h,{title:e.$t("SEARCH.PLACEHOLDER_KEYBINDING"),"show-close":!1,small:"",class:"helper-label"},null,8,["title"])],2)}const X=y(j,[["render",J],["__scopeId","data-v-786fc10e"]]),Z={props:{tabs:{type:Array,default:()=>[]},selectedTab:{type:Number,default:0}},emits:["tabChange"],data(){return{activeTab:0}},watch:{selectedTab(e,o){e!==o&&(this.activeTab=this.selectedTab)}},methods:{onTabChange(e){this.activeTab=e,this.$emit("tabChange",this.tabs[e].key)}}},ee={class:"tab-container"};function te(e,o,t,f,c,s){const u=i("woot-tabs-item"),h=i("woot-tabs");return n(),l("div",ee,[d(h,{index:c.activeTab,border:!1,onChange:s.onTabChange},{default:g(()=>[(n(!0),l(b,null,C(t.tabs,(a,p)=>(n(),S(u,{key:a.key,index:p,name:a.name,count:a.count},null,8,["index","name","count"]))),128))]),_:1},8,["index","onChange"])])}const se=y(Z,[["render",te],["__scopeId","data-v-949771e2"]]),ne={props:{title:{type:String,default:""},empty:{type:Boolean,default:!1},query:{type:String,default:""},showTitle:{type:Boolean,default:!0},isFetching:{type:Boolean,default:!0}},computed:{titleCase(){return this.title.toLowerCase()}}},oe={class:"result-section"},ae={key:0,class:"header"},ie={class:"text-sm text-slate-800 dark:text-slate-100"},re={key:3,class:"empty"},ce={class:"empty-state__text"};function le(e,o,t,f,c,s){const u=i("woot-loading-state"),h=i("fluent-icon");return n(),l("section",oe,[t.showTitle?(n(),l("div",ae,[r("h3",ie,m(t.title),1)])):_("",!0),t.isFetching?(n(),S(u,{key:1,message:e.$t("SEARCH.SEARCHING_DATA")},null,8,["message"])):k(e.$slots,"default",{key:2},void 0,!0),t.empty&&!t.isFetching?(n(),l("div",re,[d(h,{icon:"info",size:"16px",class:"icon"}),r("p",ce,m(e.$t("SEARCH.EMPTY_STATE",{item:s.titleCase,query:t.query})),1)])):_("",!0)])}const I=y(ne,[["render",le],["__scopeId","data-v-8da80d02"]]),ue={components:{InboxName:V},props:{id:{type:Number,default:0},inbox:{type:Object,default:()=>({})},name:{type:String,default:""},email:{type:String,default:""},accountId:{type:[String,Number],default:""},createdAt:{type:[String,Date,Number],default:""},messageId:{type:Number,default:0}},computed:{navigateTo(){const e={};return this.messageId&&(e.messageId=this.messageId),x(`accounts/${this.accountId}/conversations/${this.id}`,e)},createdAtTime(){return U(this.createdAt)}}},he={class:"icon-wrap"},de={class:"conversation-details"},me={class:"meta-wrap"},_e={class:"flex"},fe={class:"inbox-name-wrap"},pe={class:"created-at"},ge={class:"user-details"},Se={key:0,class:"text-sm name text-slate-800 dark:text-slate-100"},ye={class:"pre-text"},ve={key:1,class:"overflow-hidden text-sm email text-slate-700 dark:text-slate-200 whitespace-nowrap text-ellipsis"},be={class:"pre-text"};function Ce(e,o,t,f,c,s){const u=i("fluent-icon"),h=i("woot-label"),a=i("InboxName"),p=i("router-link");return n(),S(p,{to:s.navigateTo,class:"conversation-item"},{default:g(()=>[r("div",he,[d(u,{icon:"chat-multiple",size:14})]),r("div",de,[r("div",me,[r("div",_e,[d(h,{class:"conversation-id",title:`#${t.id}`,"show-close":!1,small:""},null,8,["title"]),r("div",fe,[d(a,{inbox:t.inbox,class:"mr-2 rtl:mr-0 rtl:ml-2"},null,8,["inbox"])])]),r("div",null,[r("span",pe,m(s.createdAtTime),1)])]),r("div",ge,[t.name?(n(),l("h5",Se,[r("span",ye,m(e.$t("SEARCH.FROM"))+": ",1),v(" "+m(t.name),1)])):_("",!0),t.email?(n(),l("h5",ve,[r("span",be,m(e.$t("SEARCH.EMAIL"))+":",1),v(" "+m(t.email),1)])):_("",!0)]),k(e.$slots,"default",{},void 0,!0)])]),_:3},8,["to"])}const $=y(ue,[["render",Ce],["__scopeId","data-v-be652173"]]),Te={components:{SearchResultSection:I,SearchResultConversationItem:$},props:{conversations:{type:Array,default:()=>[]},query:{type:String,default:""},isFetching:{type:Boolean,default:!1},showTitle:{type:Boolean,default:!0}},computed:{...T({accountId:"getCurrentAccountId"})}},Re={key:0,class:"search-list"};function ke(e,o,t,f,c,s){const u=i("SearchResultConversationItem"),h=i("SearchResultSection");return n(),S(h,{title:e.$t("SEARCH.SECTION.CONVERSATIONS"),empty:!t.conversations.length,query:t.query,"show-title":t.showTitle||t.isFetching,"is-fetching":t.isFetching},{default:g(()=>[t.conversations.length?(n(),l("ul",Re,[(n(!0),l(b,null,C(t.conversations,a=>(n(),l("li",{key:a.id},[d(u,{id:a.id,name:a.contact.name,email:a.contact.email,"account-id":e.accountId,inbox:a.inbox,"created-at":a.created_at},null,8,["id","name","email","account-id","inbox","created-at"])]))),128))])):_("",!0)]),_:1},8,["title","empty","query","show-title","is-fetching"])}const Ie=y(Te,[["render",ke]]),Ae={props:{shrink:{type:Boolean,default:!1}},emits:["expand"]},we={class:"read-more"};function Ee(e,o,t,f,c,s){const u=i("woot-button");return n(),l("div",we,[r("div",{class:E({"shrink-container after:shrink-gradient-light dark:after:shrink-gradient-dark":t.shrink})},[k(e.$slots,"default",{},void 0,!0),t.shrink?(n(),S(u,{key:0,size:"tiny",variant:"smooth","color-scheme":"primary",class:"read-more-button",onClick:o[0]||(o[0]=q(h=>e.$emit("expand"),["prevent"]))},{default:g(()=>[v(m(e.$t("SEARCH.READ_MORE")),1)]),_:1})):_("",!0)],2)])}const xe=y(Ae,[["render",Ee],["__scopeId","data-v-470cec0e"]]),$e={components:{ReadMore:xe},props:{author:{type:String,default:""},content:{type:String,default:""},searchTerm:{type:String,default:""}},setup(){const{formatMessage:e,highlightContent:o}=z();return{formatMessage:e,highlightContent:o}},data(){return{isOverflowing:!1}},computed:{messageContent(){return this.formatMessage(this.content)}},mounted(){this.$watch(()=>this.$refs.messageContainer,this.setOverflow),this.$nextTick(this.setOverflow)},methods:{setOverflow(){const e=this.$refs.messageContainer;if(e){const o=e.querySelector(".message-content");this.isOverflowing=o.offsetHeight>150}},escapeHtml(e){var o=document.createTextNode(e),t=document.createElement("p");return t.appendChild(o),t.innerText},prepareContent(e=""){const o=this.escapeHtml(e);return this.highlightContent(o,this.searchTerm,"searchkey--highlight")}}},Ne={ref:"messageContainer",class:"message border-l-2 border-slate-100 dark:border-slate-700"},Pe={class:"header"},Fe={class:"text-slate-700 dark:text-slate-100"},qe={class:"message-content"};function Oe(e,o,t,f,c,s){const u=i("ReadMore"),h=O("dompurify-html");return n(),l("blockquote",Ne,[r("p",Pe,[r("strong",Fe,m(t.author),1),v(" "+m(e.$t("SEARCH.WROTE")),1)]),d(u,{shrink:c.isOverflowing,onExpand:o[0]||(o[0]=a=>c.isOverflowing=!1)},{default:g(()=>[B(r("div",qe,null,512),[[h,s.prepareContent(t.content)]])]),_:1},8,["shrink"])],512)}const Be=y($e,[["render",Oe],["__scopeId","data-v-31999b76"]]),He={components:{SearchResultConversationItem:$,SearchResultSection:I,MessageContent:Be},props:{messages:{type:Array,default:()=>[]},query:{type:String,default:""},isFetching:{type:Boolean,default:!1},showTitle:{type:Boolean,default:!0}},computed:{...T({accountId:"getCurrentAccountId"})},methods:{getName(e){return e&&e.sender&&e.sender.name?e.sender.name:this.$t("SEARCH.BOT_LABEL")}}},Le={key:0,class:"search-list"};function Me(e,o,t,f,c,s){const u=i("MessageContent"),h=i("SearchResultConversationItem"),a=i("SearchResultSection");return n(),S(a,{title:e.$t("SEARCH.SECTION.MESSAGES"),empty:!t.messages.length,query:t.query,"show-title":t.showTitle,"is-fetching":t.isFetching},{default:g(()=>[t.messages.length?(n(),l("ul",Le,[(n(!0),l(b,null,C(t.messages,p=>(n(),l("li",{key:p.id},[d(h,{id:p.conversation_id,"account-id":e.accountId,inbox:p.inbox,"created-at":p.created_at,"message-id":p.id},{default:g(()=>[d(u,{author:s.getName(p),content:p.content,"search-term":t.query},null,8,["author","content","search-term"])]),_:2},1032,["id","account-id","inbox","created-at","message-id"])]))),128))])):_("",!0)]),_:1},8,["title","empty","query","show-title","is-fetching"])}const De=y(He,[["render",Me]]),Ue={props:{id:{type:[String,Number],default:0},email:{type:String,default:""},phone:{type:String,default:""},name:{type:String,default:""},thumbnail:{type:String,default:""},accountId:{type:[String,Number],default:0}},computed:{navigateTo(){return x(`accounts/${this.accountId}/contacts/${this.id}`)}}},Ve={class:"ml-2 rtl:mr-2 rtl:ml-0"},ze={class:"text-sm name text-slate-800 dark:text-slate-200"},Ge={class:"m-0 text-slate-600 dark:text-slate-200 gap-1 text-sm flex items-center"},Qe={key:0,class:"email text-slate-800 dark:text-slate-200"},Ye={key:1,class:"separator text-slate-700 dark:text-slate-200"},je={key:2,class:"phone text-slate-800 dark:text-slate-200"};function Ke(e,o,t,f,c,s){const u=i("woot-thumbnail"),h=i("router-link");return n(),S(h,{to:s.navigateTo,class:"contact-item"},{default:g(()=>[d(u,{src:t.thumbnail,username:t.name,size:"24px"},null,8,["src","username"]),r("div",Ve,[r("h5",ze,m(t.name),1),r("p",Ge,[t.email?(n(),l("span",Qe,m(t.email),1)):_("",!0),t.phone?(n(),l("span",Ye," â€¢ ")):_("",!0),t.phone?(n(),l("span",je,m(t.phone),1)):_("",!0)])])]),_:1},8,["to"])}const We=y(Ue,[["render",Ke],["__scopeId","data-v-eaad44b7"]]),Je={components:{SearchResultSection:I,SearchResultContactItem:We},props:{contacts:{type:Array,default:()=>[]},query:{type:String,default:""},isFetching:{type:Boolean,default:!1},showTitle:{type:Boolean,default:!0}},computed:{...T({accountId:"getCurrentAccountId"})}},Xe={key:0,class:"search-list"};function Ze(e,o,t,f,c,s){const u=i("SearchResultContactItem"),h=i("SearchResultSection");return n(),S(h,{title:e.$t("SEARCH.SECTION.CONTACTS"),empty:!t.contacts.length,query:t.query,"show-title":t.showTitle,"is-fetching":t.isFetching},{default:g(()=>[t.contacts.length?(n(),l("ul",Xe,[(n(!0),l(b,null,C(t.contacts,a=>(n(),l("li",{key:a.id},[d(u,{id:a.id,name:a.name,email:a.email,phone:a.phone_number,"account-id":e.accountId,thumbnail:a.thumbnail},null,8,["id","name","email","phone","account-id","thumbnail"])]))),128))])):_("",!0)]),_:1},8,["title","empty","query","show-title","is-fetching"])}const et=y(Je,[["render",Ze]]),tt={components:{SearchHeader:X,SearchTabs:se,SearchResultContactsList:et,SearchResultConversationsList:Ie,SearchResultMessagesList:De,Policy:Q},data(){return{selectedTab:"all",query:"",contactPermissions:H,conversationPermissions:L,rolePermissions:M}},computed:{...T({currentUser:"getCurrentUser",currentAccountId:"getCurrentAccountId",contactRecords:"conversationSearch/getContactRecords",conversationRecords:"conversationSearch/getConversationRecords",messageRecords:"conversationSearch/getMessageRecords",uiFlags:"conversationSearch/getUIFlags"}),contacts(){return this.contactRecords.map(e=>({...e,type:"contact"}))},conversations(){return this.conversationRecords.map(e=>({...e,type:"conversation"}))},messages(){return this.messageRecords.map(e=>({...e,type:"message"}))},all(){return[...this.contacts,...this.conversations,...this.messages]},filterContacts(){return this.selectedTab==="contacts"||this.isSelectedTabAll},filterConversations(){return this.selectedTab==="conversations"||this.isSelectedTabAll},filterMessages(){return this.selectedTab==="messages"||this.isSelectedTabAll},userPermissions(){return D(this.currentUser,this.currentAccountId)},totalSearchResultsCount(){const e={contacts:{permissions:[...this.rolePermissions,this.contactPermissions],count:()=>this.contacts.length},conversations:{permissions:[...this.rolePermissions,...this.conversationPermissions],count:()=>this.conversations.length+this.messages.length}};return w(e,this.userPermissions,t=>t.permissions,(t,f)=>f.count).reduce((t,f)=>t+f(),0)},tabs(){const e={all:{key:"all",name:this.$t("SEARCH.TABS.ALL"),count:this.totalSearchResultsCount,permissions:[this.contactPermissions,...this.rolePermissions,...this.conversationPermissions]},contacts:{key:"contacts",name:this.$t("SEARCH.TABS.CONTACTS"),count:this.contacts.length,permissions:[...this.rolePermissions,this.contactPermissions]},conversations:{key:"conversations",name:this.$t("SEARCH.TABS.CONVERSATIONS"),count:this.conversations.length,permissions:[...this.rolePermissions,...this.conversationPermissions]},messages:{key:"messages",name:this.$t("SEARCH.TABS.MESSAGES"),count:this.messages.length,permissions:[...this.rolePermissions,...this.conversationPermissions]}};return w(e,this.userPermissions,o=>o.permissions)},activeTabIndex(){const e=this.tabs.findIndex(o=>o.key===this.selectedTab);return e>=0?e:0},showEmptySearchResults(){return this.totalSearchResultsCount===0&&this.uiFlags.isSearchCompleted&&!this.uiFlags.isFetching&&this.query},showResultsSection(){return this.uiFlags.isSearchCompleted&&this.totalSearchResultsCount!==0||this.uiFlags.isFetching},isSelectedTabAll(){return this.selectedTab==="all"}},unmounted(){this.query="",this.$store.dispatch("conversationSearch/clearSearchResults")},mounted(){this.$store.dispatch("conversationSearch/clearSearchResults")},methods:{onSearch(e){if(this.selectedTab="all",this.query=e,!e){this.$store.dispatch("conversationSearch/clearSearchResults");return}G(Y.SEARCH_CONVERSATION),this.$store.dispatch("conversationSearch/fullSearch",{q:e})},onBack(){window.history.length>2?this.$router.go(-1):this.$router.push({name:"home"})}}},st={class:"search-page"},nt={class:"page-header"},ot={class:"search-root"},at={class:"search-results"},it={key:0},rt={key:1,class:"empty"},ct={class:"empty-state__text"},lt={key:2,class:"text-center empty"},ut={class:"text-center margin-bottom-0"},ht={class:"empty-state__text"};function dt(e,o,t,f,c,s){const u=i("woot-button"),h=i("SearchHeader"),a=i("SearchTabs"),p=i("SearchResultContactsList"),R=i("Policy"),N=i("SearchResultMessagesList"),P=i("SearchResultConversationsList"),A=i("fluent-icon");return n(),l("div",st,[r("div",nt,[d(u,{icon:"chevron-left",variant:"smooth",size:"small ",class:"back-button",onClick:s.onBack},{default:g(()=>[v(m(e.$t("GENERAL_SETTINGS.BACK")),1)]),_:1},8,["onClick"])]),r("section",ot,[r("header",null,[d(h,{onSearch:s.onSearch},null,8,["onSearch"]),c.query?(n(),S(a,{key:0,tabs:s.tabs,"selected-tab":s.activeTabIndex,onTabChange:o[0]||(o[0]=F=>c.selectedTab=F)},null,8,["tabs","selected-tab"])):_("",!0)]),r("div",at,[s.showResultsSection?(n(),l("div",it,[d(R,{permissions:[...c.rolePermissions,c.contactPermissions]},{default:g(()=>[s.filterContacts?(n(),S(p,{key:0,"is-fetching":e.uiFlags.contact.isFetching,contacts:s.contacts,query:c.query,"show-title":s.isSelectedTabAll},null,8,["is-fetching","contacts","query","show-title"])):_("",!0)]),_:1},8,["permissions"]),d(R,{permissions:[...c.rolePermissions,...c.conversationPermissions]},{default:g(()=>[s.filterMessages?(n(),S(N,{key:0,"is-fetching":e.uiFlags.message.isFetching,messages:s.messages,query:c.query,"show-title":s.isSelectedTabAll},null,8,["is-fetching","messages","query","show-title"])):_("",!0)]),_:1},8,["permissions"]),d(R,{permissions:[...c.rolePermissions,...c.conversationPermissions]},{default:g(()=>[s.filterConversations?(n(),S(P,{key:0,"is-fetching":e.uiFlags.conversation.isFetching,conversations:s.conversations,query:c.query,"show-title":s.isSelectedTabAll},null,8,["is-fetching","conversations","query","show-title"])):_("",!0)]),_:1},8,["permissions"])])):s.showEmptySearchResults?(n(),l("div",rt,[d(A,{icon:"info",size:"16px",class:"icon"}),r("p",ct,m(e.$t("SEARCH.EMPTY_STATE_FULL",{query:c.query})),1)])):(n(),l("div",lt,[r("p",ut,[d(A,{icon:"search",size:"24px",class:"icon"})]),r("p",ht,m(e.$t("SEARCH.EMPTY_STATE_DEFAULT")),1)]))])])])}const Ut=y(tt,[["render",dt],["__scopeId","data-v-3b9fd116"]]);export{Ut as default};
