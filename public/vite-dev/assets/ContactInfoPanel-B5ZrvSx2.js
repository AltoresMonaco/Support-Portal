import{A as E,L as O,_ as T,b as N,c as k,d as D}from"./CustomAttributes-CrR_sV2i.js";import{m as R}from"./globalConfig-DaGjiImb.js";import{u as B}from"./index-BaHWIRRA.js";import{r as U,c as P,u as r,H as V,g as F,o as c,n as i,e as l,F as j,i as x,a as h,p as L,q as S,L as q,k as _,_ as A,l as C}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{j as K,u as z}from"./dashboard-CGLIihvy.js";import{u as G}from"./useKeyboardNavigableList-Cfstgo2Q.js";import{D as H}from"./vuedraggable.umd-rGNd3eNJ.js";const J={class:"relative leading-6"},M={class:"absolute w-full top-7"},Q={__name:"LabelSelector",props:{allLabels:{type:Array,default:()=>[]},savedLabels:{type:Array,default:()=>[]}},emits:["add","remove"],setup(t,{emit:e}){const o=t,s=e,{isAdmin:d}=K(),n=U(!1),b=P(()=>o.savedLabels.map(a=>a.title)),f=a=>{s("add",a)},m=a=>{s("remove",a)},p=()=>{n.value=!n.value},v=()=>{n.value=!1};return G({KeyL:{action:a=>{p(),a.preventDefault()}},Escape:{action:()=>v(),allowOnFocusedInput:!0}}),(a,u)=>{const y=r("woot-label"),w=V("on-clickaway");return F((c(),i("div",J,[l(E,{onAdd:p}),(c(!0),i(j,null,x(t.savedLabels,g=>(c(),h(y,{key:g.id,title:g.title,description:g.description,"show-close":"",color:g.color,variant:"smooth",onRemove:m},null,8,["title","description","color"]))),128)),L("div",M,[L("div",{class:S([{"dropdown-pane--open":n.value},"!box-border !w-full dropdown-pane"])},[n.value?(c(),h(O,{key:0,"account-labels":t.allLabels,"selected-labels":b.value,"allow-creation":q(d),onAdd:f,onRemove:m},null,8,["account-labels","selected-labels","allow-creation"])):_("",!0)],2)])])),[[w,v]])}}},W={components:{LabelSelector:Q},props:{contactId:{type:[String,Number],required:!0}},computed:{savedLabels(){const t=this.$store.getters["contactLabels/getContactLabels"](this.contactId);return this.allLabels.filter(({title:e})=>t.includes(e))},...R({allLabels:"labels/getLabels"})},watch:{contactId(t,e){t&&t!==e&&this.fetchLabels(t)}},mounted(){const{contactId:t}=this;this.fetchLabels(t)},methods:{async onUpdateLabels(t){try{await this.$store.dispatch("contactLabels/update",{contactId:this.contactId,labels:t})}catch{B(this.$t("CONTACT_PANEL.LABELS.CONTACT.ERROR"))}},addItem(t){const e=this.savedLabels.map(o=>o.title);e.push(t.title),this.onUpdateLabels(e)},removeItem(t){const e=this.savedLabels.map(o=>o.title).filter(o=>o!==t);this.onUpdateLabels(e)},async fetchLabels(t){t&&this.$store.dispatch("contactLabels/get",t)}}};function X(t,e,o,s,d,n){const b=r("LabelSelector");return c(),h(b,{"all-labels":t.allLabels,"saved-labels":n.savedLabels,onAdd:n.addItem,onRemove:n.removeItem},null,8,["all-labels","saved-labels","onAdd","onRemove"])}const Y=A(W,[["render",X]]),Z={components:{AccordionItem:T,ContactConversations:N,ContactInfo:k,ContactLabel:Y,CustomAttributes:D,Draggable:H},props:{contact:{type:Object,default:()=>({})},onClose:{type:Function,default:()=>{}},showAvatar:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0}},setup(){const{updateUISettings:t,isContactSidebarItemOpen:e,contactSidebarItemsOrder:o,toggleSidebarUIState:s}=z();return{updateUISettings:t,isContactSidebarItemOpen:e,contactSidebarItemsOrder:o,toggleSidebarUIState:s}},data(){return{dragEnabled:!0,contactSidebarItems:[],dragging:!1}},computed:{hasContactAttributes(){const{custom_attributes:t}=this.contact;return t&&Object.keys(t).length}},mounted(){this.contactSidebarItems=this.contactSidebarItemsOrder},methods:{onDragEnd(){this.dragging=!1,this.updateUISettings({contact_sidebar_items_order:this.contactSidebarItems})}}},$={class:"list-group"},tt={key:0},et={key:1},ot={key:2};function at(t,e,o,s,d,n){const b=r("ContactInfo"),f=r("CustomAttributes"),m=r("AccordionItem"),p=r("ContactLabel"),v=r("ContactConversations"),I=r("Draggable");return c(),i("div",{class:S(["relative w-1/4 h-full min-h-screen overflow-y-auto text-sm bg-white dark:bg-slate-900 border-slate-50 dark:border-slate-800/50",o.showAvatar?"border-l border-solid ":"border-r border-solid"])},[l(b,{"show-close-button":o.showCloseButton,"show-avatar":o.showAvatar,contact:o.contact,"close-icon-name":"dismiss",onPanelClose:o.onClose,onTogglePanel:o.onClose},null,8,["show-close-button","show-avatar","contact","onPanelClose","onTogglePanel"]),L("div",$,[l(I,{list:d.contactSidebarItems,disabled:!d.dragEnabled,"ghost-class":"ghost","item-key":"name",onStart:e[3]||(e[3]=a=>d.dragging=!0),onEnd:n.onDragEnd},{item:C(({element:a})=>[(c(),i("div",{key:a.name,class:"list-group-item"},[a.name==="contact_attributes"?(c(),i("div",tt,[l(m,{title:t.$t("CONVERSATION_SIDEBAR.ACCORDION.CONTACT_ATTRIBUTES"),"is-open":s.isContactSidebarItemOpen("is_ct_custom_attr_open"),compact:"",onToggle:e[0]||(e[0]=u=>s.toggleSidebarUIState("is_ct_custom_attr_open",u))},{default:C(()=>[l(f,{"contact-id":o.contact.id,"attribute-type":"contact_attribute","attribute-from":"contact_panel","custom-attributes":o.contact.custom_attributes,"empty-state-message":t.$t("CONTACT_PANEL.SIDEBAR_SECTIONS.NO_RECORDS_FOUND")},null,8,["contact-id","custom-attributes","empty-state-message"])]),_:1},8,["title","is-open"])])):_("",!0),a.name==="contact_labels"?(c(),i("div",et,[l(m,{title:t.$t("CONTACT_PANEL.SIDEBAR_SECTIONS.CONTACT_LABELS"),"is-open":s.isContactSidebarItemOpen("is_ct_labels_open"),onToggle:e[1]||(e[1]=u=>s.toggleSidebarUIState("is_ct_labels_open",u))},{default:C(()=>[l(p,{"contact-id":o.contact.id,class:"contact-labels"},null,8,["contact-id"])]),_:1},8,["title","is-open"])])):_("",!0),a.name==="previous_conversation"?(c(),i("div",ot,[l(m,{title:t.$t("CONTACT_PANEL.SIDEBAR_SECTIONS.PREVIOUS_CONVERSATIONS"),"is-open":s.isContactSidebarItemOpen("is_ct_prev_conv_open"),compact:"",onToggle:e[2]||(e[2]=u=>s.toggleSidebarUIState("is_ct_prev_conv_open",u))},{default:C(()=>[o.contact.id?(c(),h(v,{key:0,"contact-id":o.contact.id,"conversation-id":""},null,8,["contact-id"])):_("",!0)]),_:1},8,["title","is-open"])])):_("",!0)]))]),_:1},8,["list","disabled","onEnd"])])],2)}const mt=A(Z,[["render",at],["__scopeId","data-v-ad36816c"]]);export{mt as C};
