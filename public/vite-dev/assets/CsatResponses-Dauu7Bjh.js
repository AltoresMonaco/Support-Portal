import{f as C,m as I,u as L}from"./globalConfig-DaGjiImb.js";import{u as w,a as M}from"./index-BaHWIRRA.js";import{_ as D}from"./ReportMetricCard-nHZIFoTF.js";import{_ as $}from"./BarChart-Cyq4Hy7M.js";import{_ as A,u as p,o as d,n as m,e as o,p as h,F as B,i as j,t as _,k as y,H as V,l as N,m as b,g as k,c as v,h as T,L as E,v as G}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{v as O}from"./mutationHelpers-3VTcoJiD.js";import{u as H,K as q}from"./timeHelper-BT38nsET.js";import{u as K,_ as W,c as z,g as U}from"./Table-qO3GIpbk.js";import{_ as X}from"./Pagination-CWdWh8jn.js";import{_ as P}from"./UserAvatarWithName-BHDu0HJS.js";import{R as J}from"./FilterSelector-B06zYLqE.js";import{F as Q,aw as Y,av as Z}from"./dashboard-CGLIihvy.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./vue-router-CNCrM2WK.js";import"./index-BP-sUqpX.js";import"./index-DaWXXnfb.js";import"./Spinner-B-aSVz3z.js";import"./Thumbnail-DLjRBBx8.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./exports-CsC-x4VI.js";import"./DateRangePicker-BS8Sn4en.js";import"./index.es-CaHyKWHu.js";import"./constants-CvJgIWgr.js";import"./DateHelper-D7GM2F2-.js";import"./index-CbMJaKeB.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./index-C2DForDf.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./DashboardIcon-CPXNa31t.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./Icon-Dtj3LCzD.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";const tt={components:{BarChart:$,CsatMetricCard:D},props:{filters:{type:Object,required:!0}},data(){return{csatRatings:C}},computed:{...I({metrics:"csat/getMetrics",ratingPercentage:"csat/getRatingPercentage",satisfactionScore:"csat/getSatisfactionScore",responseRate:"csat/getResponseRate"}),ratingFilterEnabled(){return!!this.filters.rating},chartData(){const t=[...C].sort((s,u)=>u.value-s.value);return{labels:["Rating"],datasets:t.map(s=>({label:s.emoji,data:[this.ratingPercentage[s.value]],backgroundColor:s.color}))}},responseCount(){return this.metrics.totalResponseCount?this.metrics.totalResponseCount.toLocaleString():"--"},chartOptions(){return{indexAxis:"y",responsive:!0,plugins:{legend:{display:!1},title:{display:!1},tooltip:{enabled:!1}},scales:{x:{display:!1,stacked:!0},y:{display:!1,stacked:!0}}}}},methods:{formatToPercent(t){return t?`${t}%`:"--"},ratingToEmoji(t){return C.find(s=>s.value===Number(t)).emoji}}},et={class:"flex-col lg:flex-row flex flex-wrap mx-0 bg-white dark:bg-slate-800 rounded-[4px] p-4 mb-5 border border-solid border-slate-75 dark:border-slate-700"},at={key:0,ref:"csatBarChart",class:"w-full md:w-1/2 md:max-w-[50%] flex-1 rtl:[direction:initial] p-4"},st={class:"flex items-center m-0 text-xs font-medium md:text-sm text-slate-800 dark:text-slate-100"},rt={class:"flex flex-row-reverse justify-end"},ot={class:"my-0 mx-0.5"},nt={class:"mt-2 h-6"};function it(t,s,u,r,n,e){const i=p("CsatMetricCard"),f=p("BarChart");return d(),m("div",et,[o(i,{label:t.$t("CSAT_REPORTS.METRIC.TOTAL_RESPONSES.LABEL"),"info-text":t.$t("CSAT_REPORTS.METRIC.TOTAL_RESPONSES.TOOLTIP"),value:e.responseCount,class:"xs:w-full sm:max-w-[50%] lg:w-1/6 lg:max-w-[16%]"},null,8,["label","info-text","value"]),o(i,{disabled:e.ratingFilterEnabled,label:t.$t("CSAT_REPORTS.METRIC.SATISFACTION_SCORE.LABEL"),"info-text":t.$t("CSAT_REPORTS.METRIC.SATISFACTION_SCORE.TOOLTIP"),value:e.ratingFilterEnabled?"--":e.formatToPercent(t.satisfactionScore),class:"xs:w-full sm:max-w-[50%] lg:w-1/6 lg:max-w-[16%]"},null,8,["disabled","label","info-text","value"]),o(i,{label:t.$t("CSAT_REPORTS.METRIC.RESPONSE_RATE.LABEL"),"info-text":t.$t("CSAT_REPORTS.METRIC.RESPONSE_RATE.TOOLTIP"),value:e.formatToPercent(t.responseRate),class:"xs:w-full sm:max-w-[50%] lg:w-1/6 lg:max-w-[16%]"},null,8,["label","info-text","value"]),t.metrics.totalResponseCount&&!e.ratingFilterEnabled?(d(),m("div",at,[h("h3",st,[h("div",rt,[(d(!0),m(B,null,j(t.ratingPercentage,(l,g,R)=>(d(),m("div",{key:l+g+R,class:"ltr:pr-4 rtl:pl-4"},[h("span",ot,_(e.ratingToEmoji(g)),1),h("span",null,_(e.formatToPercent(l)),1)]))),128))])]),h("div",nt,[o(f,{collection:e.chartData,"chart-options":e.chartOptions},null,8,["collection","chart-options"])])],512)):y("",!0)])}const lt=A(tt,[["render",it]]),ct={class:"text-right"},dt={class:"text-slate-600 dark:text-slate-200 text-sm"},mt={__name:"ConversationCell",props:{row:{type:Object,required:!0}},setup(t){const s={name:"inbox_conversation",params:{conversation_id:t.row.original.conversationId}};return(u,r)=>{const n=p("router-link"),e=V("tooltip");return d(),m("div",ct,[o(n,{to:s,class:"hover:underline"},{default:N(()=>[b(_(`#${t.row.original.conversationId}`),1)]),_:1}),k((d(),m("div",dt,[b(_(t.row.original.createdAgo),1)])),[[e,t.row.original.createdAt]])])}}},ut={class:"csat--table-container"},pt={key:0,class:"table-pagination"},gt={__name:"CsatTable",props:{pageIndex:{type:Number,default:0}},emits:["pageChange"],setup(t,{emit:s}){const u=s,{t:r}=L(),n=O("csat/getCSATResponses"),e=O("csat/getMetrics"),i=v(()=>n.value.map(a=>({contact:a.contact,assignedAgent:a.assigned_agent,rating:a.rating,feedbackText:a.feedback_message||"---",conversationId:a.conversation_id,createdAgo:H(a.created_at),createdAt:q(a.created_at,"LLL d yyyy, h:mm a")}))),f=a=>T("span",{class:a.getValue()?"":"text-slate-300 dark:text-slate-700"},a.getValue()?a.getValue():"---"),l=z(),g=[l.accessor("contact",{header:r("CSAT_REPORTS.TABLE.HEADER.CONTACT_NAME"),width:200,cell:a=>{const{contact:c}=a.row.original;return c?T(P,{user:c}):"--"}}),l.accessor("assignedAgent",{header:r("CSAT_REPORTS.TABLE.HEADER.AGENT_NAME"),width:200,cell:a=>{const{assignedAgent:c}=a.row.original;return c?T(P,{user:c}):"--"}}),l.accessor("rating",{header:r("CSAT_REPORTS.TABLE.HEADER.RATING"),align:"center",width:80,cell:a=>{const{rating:c}=a.row.original,[x={}]=C.filter(F=>F.value===c);return T("span",{class:x.emoji?"emoji-response text-lg":"text-slate-300 dark:text-slate-700"},x.emoji||"---")}}),l.accessor("feedbackText",{header:r("CSAT_REPORTS.TABLE.HEADER.FEEDBACK_TEXT"),width:400,cell:f}),l.accessor("conversationId",{header:"",width:100,cell:a=>T(mt,a)})],R=v(()=>({pageIndex:t.pageIndex,pageSize:25})),S=K({get data(){return i.value},columns:g,manualPagination:!0,enableSorting:!1,getCoreRowModel:U(),get rowCount(){return e.value.totalResponseCount},state:{get pagination(){return R.value}},onPaginationChange:a=>{const c=a(R.value);u("pageChange",c.pageIndex)}});return(a,c)=>(d(),m("div",ut,[o(W,{table:E(S),class:"max-h-[calc(100vh-21.875rem)] border bg-white dark:bg-slate-900 border-slate-50 dark:border-slate-800"},null,8,["table"]),k(h("div",{class:"csat--empty-records text-slate-600 dark:text-slate-200 bg-white dark:bg-slate-900 border border-t-0 border-solid border-slate-75 dark:border-slate-700"},_(a.$t("CSAT_REPORTS.NO_RECORDS")),513),[[G,!i.value.length]]),E(e).totalResponseCount?(d(),m("div",pt,[o(X,{class:"mt-2",table:E(S)},null,8,["table"])])):y("",!0)]))}},ht=A(gt,[["__scopeId","data-v-eae779e6"]]),_t={name:"CsatResponses",components:{CsatMetrics:lt,CsatTable:ht,ReportFilterSelector:J},data(){return{pageIndex:0,from:0,to:0,userIds:[],inbox:null,team:null,rating:null}},computed:{...I({accountId:"getCurrentAccountId",isFeatureEnabledOnAccount:"accounts/isFeatureEnabledonAccount"}),requestPayload(){return{from:this.from,to:this.to,user_ids:this.userIds,inbox_id:this.inbox,team_id:this.team,rating:this.rating}},isTeamsEnabled(){return this.isFeatureEnabledOnAccount(this.accountId,Q.TEAM_MANAGEMENT)}},methods:{getAllData(){try{this.$store.dispatch("csat/getMetrics",this.requestPayload),this.getResponses()}catch{w(this.$t("REPORT.DATA_FETCHING_FAILED"))}},getResponses(){this.$store.dispatch("csat/get",{page:this.pageIndex+1,...this.requestPayload})},downloadReports(){const t="csat";try{this.$store.dispatch("csat/downloadCSATReports",{fileName:Y({type:t,to:this.to}),...this.requestPayload})}catch{w(this.$t("REPORT.CSAT_REPORTS.DOWNLOAD_FAILED"))}},onPageNumberChange(t){this.pageIndex=t,this.getResponses()},onFilterChange({from:t,to:s,selectedAgents:u,selectedInbox:r,selectedTeam:n,selectedRating:e}){this.from!==0&&this.to!==0&&M(Z.FILTER_REPORT,{filterType:"date",reportType:"csat"}),this.from=t,this.to=s,this.userIds=u.map(i=>i.id),this.inbox=r==null?void 0:r.id,this.team=n==null?void 0:n.id,this.rating=e==null?void 0:e.value,this.getAllData()}}},ft={class:"flex-1 p-4 overflow-auto"};function Tt(t,s,u,r,n,e){const i=p("ReportFilterSelector"),f=p("woot-button"),l=p("CsatMetrics"),g=p("CsatTable");return d(),m("div",ft,[o(i,{"show-agents-filter":"","show-inbox-filter":"","show-rating-filter":"","show-team-filter":e.isTeamsEnabled,"show-business-hours-switch":!1,onFilterChange:e.onFilterChange},null,8,["show-team-filter","onFilterChange"]),o(f,{"color-scheme":"success","class-names":"button--fixed-top",icon:"arrow-download",onClick:e.downloadReports},{default:N(()=>[b(_(t.$t("CSAT_REPORTS.DOWNLOAD")),1)]),_:1},8,["onClick"]),o(l,{filters:e.requestPayload},null,8,["filters"]),o(g,{"page-index":n.pageIndex,onPageChange:e.onPageNumberChange},null,8,["page-index","onPageChange"])])}const se=A(_t,[["render",Tt]]);export{se as default};
