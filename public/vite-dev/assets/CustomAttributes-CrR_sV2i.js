import{_ as v,u,o as n,n as r,F as P,a as C,k as p,e as m,m as S,t as c,B as be,p as l,b as ae,q as y,f as k,i as U,l as E,H as B,g as O,ag as Be,U as V,c as M,r as fe,P as ge,v as Ce,T as We,a1 as He,j as je,ai as Ge,L as ze}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as H,v as le,C as re,F as Te,h as ce,G as Ye,p as Xe,q as qe}from"./timeHelper-BT38nsET.js";import{p as Ke,m as W,k as ee,q as de,r as ue,n as Ze,e as ne,u as Je}from"./globalConfig-DaGjiImb.js";import{T as q}from"./Thumbnail-DLjRBBx8.js";import{M as me}from"./constants-lVAyZKq6.js";import{u as Qe}from"./useMessageFormatter-CoQTTzFX.js";import{B as Ee,Y as et,H as tt,G as Ae,Z as st,T as at,U as ve,r as nt,$ as ot,o as it,P as lt,u as ye,a0 as he,a1 as rt,a2 as ct,m as dt,j as ut,a3 as mt,a4 as ht,a5 as pt,y as _t}from"./dashboard-CGLIihvy.js";import{w as z,j as bt,D as ft,E as pe}from"./DashboardIcon-CPXNa31t.js";import{I as gt}from"./InboxName-DzICaIqB.js";import{g as Ct,a as Tt}from"./agentHelper-C7QvnyM_.js";import{S as Se}from"./Spinner-B-aSVz3z.js";import{_ as Et,a as At,j as vt}from"./index-Cq2yv_RT.js";import{e as yt}from"./utils.esm-CA3tRshB.js";import{_ as St}from"./ContextMenu-CbEc-VsQ.js";import{A as Ot}from"./AddLabel-CnIX2z1Y.js";import{u as N,a as Nt}from"./index-BaHWIRRA.js";import{u as Y,r as j,e as Oe,a as Ne,b as wt}from"./index-C2DForDf.js";import{c as It}from"./helper-DcGaBm2u.js";import{c as _e,g as xt}from"./Validators-eX6_8wdj.js";import{a as Mt,F as kt}from"./vue-upload-component-ChbSM2aG.js";import{B as oe,u as Rt}from"./vue-router-CNCrM2WK.js";import{f as Lt,c as $t,u as Pt}from"./mutationHelpers-3VTcoJiD.js";import{M as Ut}from"./MultiselectDropdown-Cp046MCC.js";import{r as Dt,a as Ft}from"./index-BP-sUqpX.js";var we=36e5,Ie=6e4,Vt=2,Z={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Bt=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Wt=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Ht=/^([+-])(\d{2})(?::?(\d{2}))?$/;function jt(e,t){Dt(1,arguments);var a={},o=a.additionalDigits==null?Vt:Ft(a.additionalDigits);if(o!==2&&o!==1&&o!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var i=Gt(e),s;if(i.date){var d=zt(i.date,o);s=Yt(d.restDateString,d.year)}if(isNaN(s)||!s)return new Date(NaN);var h=s.getTime(),f=0,_;if(i.time&&(f=Xt(i.time),isNaN(f)||f===null))return new Date(NaN);if(i.timezone){if(_=qt(i.timezone),isNaN(_))return new Date(NaN)}else{var T=new Date(h+f),b=new Date(0);return b.setFullYear(T.getUTCFullYear(),T.getUTCMonth(),T.getUTCDate()),b.setHours(T.getUTCHours(),T.getUTCMinutes(),T.getUTCSeconds(),T.getUTCMilliseconds()),b}return new Date(h+f+_)}function Gt(e){var t={},a=e.split(Z.dateTimeDelimiter),o;if(a.length>2)return t;if(/:/.test(a[0])?(t.date=null,o=a[0]):(t.date=a[0],o=a[1],Z.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Z.timeZoneDelimiter)[0],o=e.substr(t.date.length,e.length))),o){var i=Z.timezone.exec(o);i?(t.time=o.replace(i[1],""),t.timezone=i[1]):t.time=o}return t}function zt(e,t){var a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),o=e.match(a);if(!o)return{year:null};var i=o[1]&&parseInt(o[1]),s=o[2]&&parseInt(o[2]);return{year:s==null?i:s*100,restDateString:e.slice((o[1]||o[2]).length)}}function Yt(e,t){if(t===null)return null;var a=e.match(Bt);if(!a)return null;var o=!!a[4],i=X(a[1]),s=X(a[2])-1,d=X(a[3]),h=X(a[4]),f=X(a[5])-1;if(o)return es(t,h,f)?Kt(t,h,f):new Date(NaN);var _=new Date(0);return!Jt(t,s,d)||!Qt(t,i)?new Date(NaN):(_.setUTCFullYear(t,s,Math.max(i,d)),_)}function X(e){return e?parseInt(e):1}function Xt(e){var t=e.match(Wt);if(!t)return null;var a=te(t[1]),o=te(t[2]),i=te(t[3]);return ts(a,o,i)?a*we+o*Ie+i*1e3:NaN}function te(e){return e&&parseFloat(e.replace(",","."))||0}function qt(e){if(e==="Z")return 0;var t=e.match(Ht);if(!t)return 0;var a=t[1]==="+"?-1:1,o=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return ss(o,i)?a*(o*we+i*Ie):NaN}function Kt(e,t,a){var o=new Date(0);o.setUTCFullYear(e,0,4);var i=o.getUTCDay()||7,s=(t-1)*7+a+1-i;return o.setUTCDate(o.getUTCDate()+s),o}var Zt=[31,null,31,30,31,30,31,31,30,31,30,31];function xe(e){return e%400===0||e%4===0&&e%100}function Jt(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(Zt[t]||(xe(e)?29:28))}function Qt(e,t){return t>=1&&t<=(xe(e)?366:365)}function es(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function ts(e,t,a){return e===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function ss(e,t){return t>=0&&t<=59}const as=(e,t)=>e&&t?e.created_at>=t.created_at?e:t:e||t,ar=(e=[])=>{const t=[];return e.forEach(a=>{a.source_id?t.findIndex(i=>a.source_id===i.source_id)<0&&t.push(a):t.push(a)}),t},ns=e=>{const t=e.messages[e.messages.length-1],a=e.messages.filter(s=>s.message_type!==2),o=a[a.length-1],i=e.last_non_activity_message;return!o&&!i?t:as(o,i)},nr=(e,t)=>e.filter(a=>a.created_at*1e3<=t*1e3),or=(e,t)=>e.filter(a=>a.created_at*1e3>t*1e3),os={name:"MessagePreview",props:{message:{type:Object,required:!0},showMessageType:{type:Boolean,default:!0},defaultEmptyMessage:{type:String,default:""}},setup(){const{getPlainText:e}=Qe();return{getPlainText:e}},computed:{messageByAgent(){const{message_type:e}=this.message;return e===me.OUTGOING},isMessageAnActivity(){const{message_type:e}=this.message;return e===me.ACTIVITY},isMessagePrivate(){const{private:e}=this.message;return e},parsedLastMessage(){const{content_attributes:e}=this.message,{email:{subject:t}={}}=e||{};return this.getPlainText(t||this.message.content)},lastMessageFileType(){const[{file_type:e}={}]=this.message.attachments;return e},attachmentIcon(){return Ke[this.lastMessageFileType]},attachmentMessageContent(){return`CHAT_LIST.ATTACHMENTS.${this.lastMessageFileType}.CONTENT`},isMessageSticker(){return this.message&&this.message.content_type==="sticker"}}},is={class:"overflow-hidden text-ellipsis whitespace-nowrap"},ls={key:1},rs={key:2},cs={key:3},ds={key:4};function us(e,t,a,o,i,s){const d=u("fluent-icon");return n(),r("div",is,[a.showMessageType?(n(),r(P,{key:0},[s.isMessagePrivate?(n(),C(d,{key:0,size:"16",class:"-mt-0.5 align-middle text-slate-600 dark:text-slate-300 inline-block",icon:"lock-closed"})):s.messageByAgent?(n(),C(d,{key:1,size:"16",class:"-mt-0.5 align-middle text-slate-600 dark:text-slate-300 inline-block",icon:"arrow-reply"})):s.isMessageAnActivity?(n(),C(d,{key:2,size:"16",class:"-mt-0.5 align-middle text-slate-600 dark:text-slate-300 inline-block",icon:"info"})):p("",!0)],64)):p("",!0),a.message.content&&s.isMessageSticker?(n(),r("span",ls,[m(d,{size:"16",class:"-mt-0.5 align-middle inline-block text-slate-600 dark:text-slate-300",icon:"image"}),S(" "+c(e.$t("CHAT_LIST.ATTACHMENTS.image.CONTENT")),1)])):a.message.content?(n(),r("span",rs,c(s.parsedLastMessage),1)):a.message.attachments?(n(),r("span",cs,[s.attachmentIcon&&a.showMessageType?(n(),C(d,{key:0,size:"16",class:"-mt-0.5 align-middle inline-block text-slate-600 dark:text-slate-300",icon:s.attachmentIcon},null,8,["icon"])):p("",!0),S(" "+c(e.$t(`${s.attachmentMessageContent}`)),1)])):(n(),r("span",ds,c(a.defaultEmptyMessage||e.$t("CHAT_LIST.NO_CONTENT")),1))])}const ms=v(os,[["render",us]]),hs={components:{Thumbnail:q},props:{option:{type:Object,default:()=>{}},variant:{type:String,default:"default"}}},ps={class:"menu text-slate-800 dark:text-slate-100",role:"button"},_s={class:"menu-label overflow-hidden whitespace-nowrap text-ellipsis"};function bs(e,t,a,o,i,s){const d=u("fluent-icon"),h=u("Thumbnail");return n(),r("div",ps,[a.variant==="icon"&&a.option.icon?(n(),C(d,{key:0,icon:a.option.icon,size:"14",class:"menu-icon"},null,8,["icon"])):p("",!0),a.variant==="label"&&a.option.color?(n(),r("span",{key:1,class:"label-pill",style:be({backgroundColor:a.option.color})},null,4)):p("",!0),a.variant==="agent"?(n(),C(h,{key:2,username:a.option.label,src:a.option.thumbnail,status:a.option.status,size:"20px",class:"agent-thumbnail"},null,8,["username","src","status"])):p("",!0),l("p",_s,c(a.option.label),1)])}const fs=v(hs,[["render",bs],["__scopeId","data-v-8cac7164"]]),gs={props:{option:{type:Object,default:()=>{}},subMenuAvailable:{type:Boolean,default:!0}}},Cs={class:"flex items-center"},Ts={class:"my-0 mx-2 text-xs"},Es={key:0,class:"submenu bg-white dark:bg-slate-700 p-1 shadow-lg rounded-md absolute left-full top-0 hidden min-h-min max-h-[15rem] overflow-y-auto overflow-x-hidden cursor-pointer"};function As(e,t,a,o,i,s){const d=u("fluent-icon");return n(),r("div",{class:y(["text-slate-800 dark:text-slate-100 menu-with-submenu min-width-calc w-full p-1 flex items-center h-7 rounded-md relative bg-white dark:bg-slate-700 justify-between hover:bg-woot-75 cursor-pointer dark:hover:bg-slate-800",a.subMenuAvailable?"":"opacity-50 cursor-not-allowed"])},[l("div",Cs,[m(d,{icon:a.option.icon,size:"14",class:"menu-icon"},null,8,["icon"]),l("p",Ts,c(a.option.label),1)]),m(d,{icon:"chevron-right",size:"12"}),a.subMenuAvailable?(n(),r("div",Es,[ae(e.$slots,"default",{},void 0,!0)])):p("",!0)],2)}const vs=v(gs,[["render",As],["__scopeId","data-v-cf1e8634"]]),ys={components:{Spinner:Se}},Ss={class:"agent-placeholder"};function Os(e,t,a,o,i,s){const d=u("Spinner");return n(),r("div",Ss,[m(d),l("p",null,c(e.$t("CONVERSATION.CARD_CONTEXT_MENU.AGENTS_LOADING")),1)])}const Ns=v(ys,[["render",Os],["__scopeId","data-v-96965fb6"]]),ws={components:{MenuItem:fs,MenuItemWithSubmenu:vs,AgentLoadingPlaceholder:Ns},props:{chatId:{type:Number,default:null},status:{type:String,default:""},hasUnreadMessages:{type:Boolean,default:!1},inboxId:{type:Number,default:null},priority:{type:String,default:null}},emits:["updateConversation","assignPriority","markAsUnread","assignAgent","assignTeam","assignLabel"],data(){return{STATUS_TYPE:z.STATUS_TYPE,unreadOption:{label:this.$t("CONVERSATION.CARD_CONTEXT_MENU.MARK_AS_UNREAD"),icon:"mail"},statusMenuConfig:[{key:z.STATUS_TYPE.RESOLVED,label:this.$t("CONVERSATION.CARD_CONTEXT_MENU.RESOLVED"),icon:"checkmark"},{key:z.STATUS_TYPE.PENDING,label:this.$t("CONVERSATION.CARD_CONTEXT_MENU.PENDING"),icon:"book-clock"},{key:z.STATUS_TYPE.OPEN,label:this.$t("CONVERSATION.CARD_CONTEXT_MENU.REOPEN"),icon:"arrow-redo"}],snoozeOption:{key:z.STATUS_TYPE.SNOOZED,label:this.$t("CONVERSATION.CARD_CONTEXT_MENU.SNOOZE.TITLE"),icon:"snooze"},priorityConfig:{key:"priority",label:this.$t("CONVERSATION.PRIORITY.TITLE"),icon:"warning",options:[{label:this.$t("CONVERSATION.PRIORITY.OPTIONS.NONE"),key:null},{label:this.$t("CONVERSATION.PRIORITY.OPTIONS.URGENT"),key:"urgent"},{label:this.$t("CONVERSATION.PRIORITY.OPTIONS.HIGH"),key:"high"},{label:this.$t("CONVERSATION.PRIORITY.OPTIONS.MEDIUM"),key:"medium"},{label:this.$t("CONVERSATION.PRIORITY.OPTIONS.LOW"),key:"low"}].filter(e=>e.key!==this.priority)},labelMenuConfig:{key:"label",icon:"tag",label:this.$t("CONVERSATION.CARD_CONTEXT_MENU.ASSIGN_LABEL")},agentMenuConfig:{key:"agent",icon:"person-add",label:this.$t("CONVERSATION.CARD_CONTEXT_MENU.ASSIGN_AGENT")},teamMenuConfig:{key:"team",icon:"people-team-add",label:this.$t("CONVERSATION.CARD_CONTEXT_MENU.ASSIGN_TEAM")}}},computed:{...W({labels:"labels/getLabels",teams:"teams/getTeams",assignableAgentsUiFlags:"inboxAssignableAgents/getUIFlags",currentUser:"getCurrentUser",currentAccountId:"getCurrentAccountId"}),filteredAgentOnAvailability(){const e=this.$store.getters["inboxAssignableAgents/getAssignableAgents"](this.inboxId),t=Ct(e,this.currentUser,this.currentAccountId);return Tt(t)},assignableAgents(){return[{confirmed:!0,name:"None",id:null,role:"agent",account_id:0,email:"None"},...this.filteredAgentOnAvailability]},showSnooze(){return this.status===z.STATUS_TYPE.OPEN}},mounted(){this.$store.dispatch("inboxAssignableAgents/fetch",[this.inboxId])},methods:{toggleStatus(e,t){this.$emit("updateConversation",e,t)},async snoozeConversation(){await this.$store.dispatch("setContextMenuChatId",this.chatId),document.querySelector("ninja-keys").open({parent:"snooze_conversation"})},assignPriority(e){this.$emit("assignPriority",e)},show(e){return this.status!==e},generateMenuLabelConfig(e,t="text"){return{key:e.id,...t==="icon"&&{icon:e.icon},...t==="label"&&{color:e.color},...t==="agent"&&{thumbnail:e.thumbnail},...t==="agent"&&{status:e.availability_status},...t==="text"&&{label:e.label},...t==="label"&&{label:e.title},...t==="agent"&&{label:e.name},...t==="team"&&{label:e.name}}}}},Is={class:"p-1 bg-white rounded-md shadow-xl dark:bg-slate-700"};function xs(e,t,a,o,i,s){const d=u("MenuItem"),h=u("MenuItemWithSubmenu"),f=u("AgentLoadingPlaceholder");return n(),r("div",Is,[a.hasUnreadMessages?p("",!0):(n(),C(d,{key:0,option:i.unreadOption,variant:"icon",onClick:t[0]||(t[0]=k(_=>e.$emit("markAsUnread"),["stop"]))},null,8,["option"])),(n(!0),r(P,null,U(i.statusMenuConfig,_=>(n(),r(P,null,[s.show(_.key)?(n(),C(d,{key:_.key,option:_,variant:"icon",onClick:k(T=>s.toggleStatus(_.key,null),["stop"])},null,8,["option","onClick"])):p("",!0)],64))),256)),s.showSnooze?(n(),C(d,{key:1,option:i.snoozeOption,variant:"icon",onClick:t[1]||(t[1]=k(_=>s.snoozeConversation(),["stop"]))},null,8,["option"])):p("",!0),m(h,{option:i.priorityConfig},{default:E(()=>[(n(!0),r(P,null,U(i.priorityConfig.options,(_,T)=>(n(),C(d,{key:T,option:_,onClick:k(b=>s.assignPriority(_.key),["stop"])},null,8,["option","onClick"]))),128))]),_:1},8,["option"]),m(h,{option:i.labelMenuConfig,"sub-menu-available":!!e.labels.length},{default:E(()=>[(n(!0),r(P,null,U(e.labels,_=>(n(),C(d,{key:_.id,option:s.generateMenuLabelConfig(_,"label"),variant:"label",onClick:k(T=>e.$emit("assignLabel",_),["stop"])},null,8,["option","onClick"]))),128))]),_:1},8,["option","sub-menu-available"]),m(h,{option:i.agentMenuConfig,"sub-menu-available":!!s.assignableAgents.length},{default:E(()=>[e.assignableAgentsUiFlags.isFetching?(n(),C(f,{key:0})):(n(!0),r(P,{key:1},U(s.assignableAgents,_=>(n(),C(d,{key:_.id,option:s.generateMenuLabelConfig(_,"agent"),variant:"agent",onClick:k(T=>e.$emit("assignAgent",_),["stop"])},null,8,["option","onClick"]))),128))]),_:1},8,["option","sub-menu-available"]),m(h,{option:i.teamMenuConfig,"sub-menu-available":!!e.teams.length},{default:E(()=>[(n(!0),r(P,null,U(e.teams,_=>(n(),C(d,{key:_.id,option:s.generateMenuLabelConfig(_,"team"),onClick:k(T=>e.$emit("assignTeam",_),["stop"])},null,8,["option","onClick"]))),128))]),_:1},8,["option","sub-menu-available"])])}const Ms=v(ws,[["render",xs]]),Me=6e4,ie=Me*60,J=ie*24,ks={name:"TimeAgo",props:{isAutoRefreshEnabled:{type:Boolean,default:!0},lastActivityTimestamp:{type:[String,Date,Number],default:""},createdAtTimestamp:{type:[String,Date,Number],default:""}},data(){return{lastActivityAtTimeAgo:H(this.lastActivityTimestamp),createdAtTimeAgo:H(this.createdAtTimestamp),timer:null}},computed:{lastActivityTime(){return le(this.lastActivityAtTimeAgo)},createdAtTime(){return le(this.createdAtTimeAgo)},createdAt(){return Date.now()-this.createdAtTimestamp*1e3>J*30?`${this.$t("CHAT_LIST.CHAT_TIME_STAMP.CREATED.OLDEST")} ${re(this.createdAtTimestamp)}`:`${this.$t("CHAT_LIST.CHAT_TIME_STAMP.CREATED.LATEST")} ${this.createdAtTimeAgo}`},lastActivity(){return Date.now()-this.lastActivityTimestamp*1e3>J*30?`${this.$t("CHAT_LIST.CHAT_TIME_STAMP.LAST_ACTIVITY.NOT_ACTIVE")} ${re(this.lastActivityTimestamp)}`:`${this.$t("CHAT_LIST.CHAT_TIME_STAMP.LAST_ACTIVITY.ACTIVE")} ${this.lastActivityAtTimeAgo}`},tooltipText(){return`${this.createdAt}
              ${this.lastActivity}`}},watch:{lastActivityTimestamp(){this.lastActivityAtTimeAgo=H(this.lastActivityTimestamp)},createdAtTimestamp(){this.createdAtTimeAgo=H(this.createdAtTimestamp)}},mounted(){this.isAutoRefreshEnabled&&this.createTimer()},unmounted(){clearTimeout(this.timer)},methods:{createTimer(){this.timer=setTimeout(()=>{this.lastActivityAtTimeAgo=H(this.lastActivityTimestamp),this.createdAtTimeAgo=H(this.createdAtTimestamp),this.createTimer()},this.refreshTime())},refreshTime(){const e=Date.now()-this.lastActivityTimestamp*1e3;return e>J?J:e>ie?ie:Me}}},Rs={class:"ml-auto leading-4 text-xxs text-slate-500 dark:text-slate-500 hover:text-slate-900 dark:hover:text-slate-100"};function Ls(e,t,a,o,i,s){const d=B("tooltip");return O((n(),r("div",Rs,[l("span",null,c(`${s.createdAtTime} • ${s.lastActivityTime}`),1)])),[[d,{content:s.tooltipText,delay:{show:1500,hide:0},hideOnClick:!0},void 0,{top:!0}]])}const $s=v(ks,[["render",Ls]]),Ps={name:"PriorityMark",props:{priority:{type:String,default:"",validate:e=>[...Object.values(ee),""].includes(e)}},data(){return{CONVERSATION_PRIORITY:ee}},computed:{tooltipText(){return this.$t(`CONVERSATION.PRIORITY.OPTIONS.${this.priority.toUpperCase()}`)},isUrgent(){return this.priority===ee.URGENT}}};function Us(e,t,a,o,i,s){const d=u("fluent-icon"),h=B("tooltip");return a.priority?O((n(),r("span",{key:0,class:y(["shrink-0 rounded-sm inline-flex w-3.5 h-3.5",{"bg-red-50 dark:bg-red-700 dark:bg-opacity-30 text-red-500 dark:text-red-600":s.isUrgent,"bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-200":!s.isUrgent}])},[m(d,{icon:`priority-${a.priority.toLowerCase()}`,size:"14","view-box":"0 0 14 14"},null,8,["icon"])],2)),[[h,{content:s.tooltipText,delay:{show:1500,hide:0},hideOnClick:!0}]]):p("",!0)}const Ds=v(Ps,[["render",Us]]),Fs=6e4,Vs={components:{SLAPopoverCard:Et},props:{chat:{type:Object,default:()=>({})},showExtendedInfo:{type:Boolean,default:!1}},data(){return{timer:null,showSlaPopover:!1,slaStatus:{threshold:null,isSlaMissed:!1,type:null,icon:null}}},computed:{slaPolicyId(){var e;return(e=this.chat)==null?void 0:e.sla_policy_id},appliedSLA(){var e;return(e=this.chat)==null?void 0:e.applied_sla},slaEvents(){var e;return(e=this.chat)==null?void 0:e.sla_events},hasSlaThreshold(){var e;return(e=this.slaStatus)==null?void 0:e.threshold},isSlaMissed(){var e;return(e=this.slaStatus)==null?void 0:e.isSlaMissed},slaTextStyles(){return this.isSlaMissed?"text-red-400 dark:text-red-300":"text-yellow-600 dark:text-yellow-500"},slaStatusText(){var a,o;const e=(o=(a=this.slaStatus)==null?void 0:a.type)==null?void 0:o.toUpperCase(),t=this.isSlaMissed?"MISSED":"DUE";return this.$t(`CONVERSATION.HEADER.SLA_STATUS.${e}`,{status:this.$t(`CONVERSATION.HEADER.SLA_STATUS.${t}`)})},showSlaPopoverCard(){return this.showExtendedInfo&&this.showSlaPopover&&this.slaEvents.length}},watch:{chat(){this.updateSlaStatus()}},mounted(){this.updateSlaStatus(),this.createTimer()},unmounted(){this.timer&&clearTimeout(this.timer)},methods:{createTimer(){this.timer=setTimeout(()=>{this.updateSlaStatus(),this.createTimer()},Fs)},updateSlaStatus(){this.slaStatus=yt({appliedSla:this.appliedSLA,chat:this.chat})},openSlaPopover(){this.showExtendedInfo&&(this.showSlaPopover=!0)},closeSlaPopover(){this.showSlaPopover=!1}}};function Bs(e,t,a,o,i,s){const d=u("fluent-icon"),h=u("SLAPopoverCard"),f=B("on-clickaway");return s.hasSlaThreshold?(n(),r("div",{key:0,class:y(["relative flex items-center border cursor-pointer min-w-fit border-slate-100 dark:border-slate-700",a.showExtendedInfo?"h-[26px] rounded-lg":"rounded h-5"])},[O((n(),r("div",{class:y(["flex items-center w-full truncate",a.showExtendedInfo?"px-1.5":"px-2 gap-1"]),onMouseover:t[0]||(t[0]=_=>s.openSlaPopover())},[l("div",{class:y(["flex items-center gap-1",a.showExtendedInfo&&"ltr:pr-1.5 rtl:pl-1.5 ltr:border-r rtl:border-l border-solid border-slate-100 dark:border-slate-700"])},[m(d,{size:"14",icon:i.slaStatus.icon,type:"outline","icon-lib":s.isSlaMissed?"lucide":"fluent",class:y(["flex-shrink-0",s.slaTextStyles])},null,8,["icon","icon-lib","class"]),a.showExtendedInfo?(n(),r("span",{key:0,class:y(["text-xs font-medium",s.slaTextStyles])},c(s.slaStatusText),3)):p("",!0)],2),l("span",{class:y(["text-xs font-medium",[s.slaTextStyles,a.showExtendedInfo&&"ltr:pl-1.5 rtl:pr-1.5"]])},c(i.slaStatus.threshold),3)],34)),[[f,s.closeSlaPopover]]),s.showSlaPopoverCard?(n(),C(h,{key:0,"sla-missed-events":s.slaEvents,class:"right-0 top-7"},null,8,["sla-missed-events"])):p("",!0)],2)):p("",!0)}const Ws=v(Vs,[["render",Bs]]),Hs={components:{CardLabels:At,InboxName:gt,Thumbnail:q,ConversationContextMenu:Ms,TimeAgo:$s,MessagePreview:ms,PriorityMark:Ds,SLACardLabel:Ws,ContextMenu:St},mixins:[Ee],props:{activeLabel:{type:String,default:""},chat:{type:Object,default:()=>{}},hideInboxName:{type:Boolean,default:!1},hideThumbnail:{type:Boolean,default:!1},teamId:{type:[String,Number],default:0},foldersId:{type:[String,Number],default:0},showAssignee:{type:Boolean,default:!1},conversationType:{type:String,default:""},selected:{type:Boolean,default:!1},enableContextMenu:{type:Boolean,default:!1}},emits:["contextMenuToggle","assignAgent","assignLabel","assignTeam","markAsUnread","assignPriority","updateConversationStatus"],data(){return{hovered:!1,showContextMenu:!1,contextMenu:{x:null,y:null}}},computed:{...W({currentChat:"getSelectedChat",inboxesList:"inboxes/getInboxes",activeInbox:"getSelectedInbox",accountId:"getCurrentAccountId"}),bulkActionCheck(){return!this.hideThumbnail&&!this.hovered&&!this.selected},chatMetadata(){return this.chat.meta||{}},assignee(){return this.chatMetadata.assignee||{}},currentContact(){return this.$store.getters["contacts/getContact"](this.chatMetadata.sender.id)},isActiveChat(){return this.currentChat.id===this.chat.id},unreadCount(){return this.chat.unread_count},hasUnread(){return this.unreadCount>0},isInboxNameVisible(){return!this.activeInbox},lastMessageInChat(){return ns(this.chat)},inbox(){const{inbox_id:e}=this.chat;return this.$store.getters["inboxes/getInbox"](e)},showInboxName(){return!this.hideInboxName&&this.isInboxNameVisible&&this.inboxesList.length>1},inboxName(){return this.inbox.name||""},hasSlaPolicyId(){var e;return(e=this.chat)==null?void 0:e.sla_policy_id}},methods:{onCardClick(e){const{activeInbox:t,chat:a}=this,o=bt(ft({accountId:this.accountId,activeInbox:t,id:a.id,label:this.activeLabel,teamId:this.teamId,foldersId:this.foldersId,conversationType:this.conversationType}));if(e.metaKey||e.ctrlKey){window.open(window.chatwootConfig.hostURL+o,"_blank","noopener noreferrer nofollow");return}this.isActiveChat||et.push({path:o})},onCardHover(){this.hovered=!this.hideThumbnail},onCardLeave(){this.hovered=!1},onSelectConversation(e){const t=e?"selectConversation":"deSelectConversation";this.$emit(t,this.chat.id,this.inbox.id)},openContextMenu(e){this.enableContextMenu&&(e.preventDefault(),this.$emit("contextMenuToggle",!0),this.contextMenu.x=e.pageX||e.clientX,this.contextMenu.y=e.pageY||e.clientY,this.showContextMenu=!0)},closeContextMenu(){this.$emit("contextMenuToggle",!1),this.showContextMenu=!1,this.contextMenu.x=null,this.contextMenu.y=null},onUpdateConversation(e,t){this.closeContextMenu(),this.$emit("updateConversationStatus",this.chat.id,e,t)},async onAssignAgent(e){this.$emit("assignAgent",e,[this.chat.id]),this.closeContextMenu()},async onAssignLabel(e){this.$emit("assignLabel",[e.title],[this.chat.id]),this.closeContextMenu()},async onAssignTeam(e){this.$emit("assignTeam",e,this.chat.id),this.closeContextMenu()},async markAsUnread(){this.$emit("markAsUnread",this.chat.id),this.closeContextMenu()},async assignPriority(e){this.$emit("assignPriority",e,this.chat.id),this.closeContextMenu()}}},js=["value","checked"],Gs={class:"px-0 py-3 border-b group-hover:border-transparent flex-1 border-slate-50 dark:border-slate-800/75 w-[calc(100%-40px)]"},zs={class:"flex justify-between"},Ys={class:"flex gap-2 ml-2 rtl:mr-2 rtl:ml-0"},Xs={key:0,class:"text-slate-500 dark:text-slate-400 text-xs font-medium leading-3 py-0.5 px-0 inline-flex text-ellipsis overflow-hidden whitespace-nowrap"},qs={class:"conversation--user text-sm my-0 mx-2 capitalize pt-0.5 text-ellipsis font-medium overflow-hidden whitespace-nowrap w-[calc(100%-70px)] text-slate-900 dark:text-slate-100"},Ks={key:1,class:"conversation--message text-slate-700 dark:text-slate-200 text-sm my-0 mx-2 leading-6 h-6 max-w-[96%] w-[16.875rem] overflow-hidden text-ellipsis whitespace-nowrap"},Zs={class:"absolute flex flex-col conversation--meta right-4 top-4"},Js={class:"ml-auto font-normal leading-4 text-black-600 text-xxs"},Qs={class:"unread shadow-lg rounded-full hidden text-xxs font-semibold h-4 leading-4 ml-auto mt-1 min-w-[1rem] px-1 py-0 text-center text-white bg-green-400"};function ea(e,t,a,o,i,s){const d=u("Thumbnail"),h=u("InboxName"),f=u("fluent-icon"),_=u("PriorityMark"),T=u("MessagePreview"),b=u("TimeAgo"),g=u("SLACardLabel"),I=u("CardLabels"),w=u("ConversationContextMenu"),R=u("ContextMenu");return n(),r("div",{class:y(["relative flex items-start flex-grow-0 flex-shrink-0 w-auto max-w-full px-4 py-0 border-t-0 border-b-0 border-l-2 border-r-0 border-transparent border-solid cursor-pointer conversation hover:bg-slate-25 dark:hover:bg-slate-800 group",{"active animate-card-select bg-slate-25 dark:bg-slate-800 border-woot-500":s.isActiveChat,"unread-chat":s.hasUnread,"has-inbox-name":s.showInboxName,"conversation-selected":a.selected}]),onMouseenter:t[2]||(t[2]=(...L)=>s.onCardHover&&s.onCardHover(...L)),onMouseleave:t[3]||(t[3]=(...L)=>s.onCardLeave&&s.onCardLeave(...L)),onClick:t[4]||(t[4]=(...L)=>s.onCardClick&&s.onCardClick(...L)),onContextmenu:t[5]||(t[5]=L=>s.openContextMenu(L))},[i.hovered||a.selected?(n(),r("label",{key:0,class:"checkbox-wrapper",onClick:t[1]||(t[1]=k(()=>{},["stop"]))},[l("input",{value:a.selected,checked:a.selected,class:"checkbox",type:"checkbox",onChange:t[0]||(t[0]=L=>s.onSelectConversation(L.target.checked))},null,40,js)])):p("",!0),s.bulkActionCheck?(n(),C(d,{key:1,src:s.currentContact.thumbnail,badge:e.inboxBadge,username:s.currentContact.name,status:s.currentContact.availability_status,size:"40px"},null,8,["src","badge","username","status"])):p("",!0),l("div",Gs,[l("div",zs,[s.showInboxName?(n(),C(h,{key:0,inbox:s.inbox},null,8,["inbox"])):p("",!0),l("div",Ys,[a.showAssignee&&s.assignee.name?(n(),r("span",Xs,[m(f,{icon:"person",size:"12",class:"text-slate-500 dark:text-slate-400"}),S(" "+c(s.assignee.name),1)])):p("",!0),m(_,{priority:a.chat.priority},null,8,["priority"])])]),l("h4",qs,c(s.currentContact.name),1),s.lastMessageInChat?(n(),C(T,{key:0,message:s.lastMessageInChat,class:"conversation--message my-0 mx-2 leading-6 h-6 max-w-[96%] w-[16.875rem] text-sm text-slate-700 dark:text-slate-200"},null,8,["message"])):(n(),r("p",Ks,[m(f,{size:"16",class:"-mt-0.5 align-middle inline-block text-slate-600 dark:text-slate-300",icon:"info"}),l("span",null,c(e.$t("CHAT_LIST.NO_MESSAGES")),1)])),l("div",Zs,[l("span",Js,[m(b,{"last-activity-timestamp":a.chat.timestamp,"created-at-timestamp":a.chat.created_at},null,8,["last-activity-timestamp","created-at-timestamp"])]),l("span",Qs,c(s.unreadCount>9?"9+":s.unreadCount),1)]),m(I,{"conversation-labels":a.chat.labels,class:"mt-0.5 mx-2 mb-0"},Be({_:2},[s.hasSlaPolicyId?{name:"before",fn:E(()=>[m(g,{chat:a.chat,class:"ltr:mr-1 rtl:ml-1"},null,8,["chat"])]),key:"0"}:void 0]),1032,["conversation-labels"])]),i.showContextMenu?(n(),C(R,{key:2,x:i.contextMenu.x,y:i.contextMenu.y,onClose:s.closeContextMenu},{default:E(()=>[m(w,{status:a.chat.status,"inbox-id":s.inbox.id,priority:a.chat.priority,"chat-id":a.chat.id,"has-unread-messages":s.hasUnread,onUpdateConversation:s.onUpdateConversation,onAssignAgent:s.onAssignAgent,onAssignLabel:s.onAssignLabel,onAssignTeam:s.onAssignTeam,onMarkAsUnread:s.markAsUnread,onAssignPriority:s.assignPriority},null,8,["status","inbox-id","priority","chat-id","has-unread-messages","onUpdateConversation","onAssignAgent","onAssignLabel","onAssignTeam","onMarkAsUnread","onAssignPriority"])]),_:1},8,["x","y","onClose"])):p("",!0)],34)}const ta=v(Hs,[["render",ea],["__scopeId","data-v-86edc92e"]]),sa={class:"-mt-px text-sm"},aa={class:"flex justify-between mb-0.5"},na={class:"text-slate-800 text-sm dark:text-slate-100 mb-0 py-0 pr-2 pl-0"},oa={class:"flex flex-row"},ia={class:"flex justify-end w-3 text-woot-500"},ir={__name:"AccordionItem",props:{title:{type:String,required:!0},compact:{type:Boolean,default:!1},icon:{type:String,default:""},emoji:{type:String,default:""},isOpen:{type:Boolean,default:!0}},emits:["toggle"],setup(e,{emit:t}){const a=t,o=()=>{a("toggle")};return(i,s)=>{const d=u("fluent-icon");return n(),r("div",sa,[l("button",{class:"flex items-center select-none w-full rounded-none bg-slate-50 dark:bg-slate-800 border border-l-0 border-r-0 border-solid m-0 border-slate-100 dark:border-slate-700/50 cursor-grab justify-between py-2 px-4 drag-handle",onClick:k(o,["stop"])},[l("div",aa,[m(Te,{class:"inline-block w-5",icon:e.icon,emoji:e.emoji},null,8,["icon","emoji"]),l("h5",na,c(e.title),1)]),l("div",oa,[ae(i.$slots,"button"),l("div",ia,[e.isOpen?(n(),C(d,{key:0,size:"24",icon:"subtract",type:"solid"})):(n(),C(d,{key:1,size:"24",icon:"add",type:"solid"}))])])]),e.isOpen?(n(),r("div",{key:0,class:y(["bg-white dark:bg-slate-900",e.compact?"p-0":"p-4"])},[ae(i.$slots,"default")],2)):p("",!0)])}}},la={components:{ConversationCard:ta,Spinner:Se},props:{contactId:{type:[String,Number],required:!0},conversationId:{type:[String,Number],required:!0}},computed:{conversations(){return this.$store.getters["contactConversations/getContactConversation"](this.contactId)},previousConversations(){return this.conversations.filter(e=>e.id!==Number(this.conversationId))},...W({uiFlags:"contactConversations/getUIFlags"})},watch:{contactId(e,t){e&&e!==t&&this.$store.dispatch("contactConversations/get",e)}},mounted(){this.$store.dispatch("contactConversations/get",this.contactId)}},ra={class:"contact-conversation--panel"},ca={key:0,class:"contact-conversation__wrap"},da={key:0,class:"no-label-message px-4 p-3"},ua={key:1,class:"contact-conversation--list"};function ma(e,t,a,o,i,s){const d=u("ConversationCard"),h=u("Spinner");return n(),r("div",ra,[e.uiFlags.isFetching?(n(),C(h,{key:1})):(n(),r("div",ca,[s.previousConversations.length?(n(),r("div",ua,[(n(!0),r(P,null,U(s.previousConversations,f=>(n(),C(d,{key:f.id,chat:f,"hide-inbox-name":!1,"hide-thumbnail":"",class:"compact"},null,8,["chat"]))),128))])):(n(),r("div",da,[l("span",null,c(e.$t("CONTACT_PANEL.CONVERSATIONS.NO_RECORDS_FOUND")),1)]))]))])}const lr=v(la,[["render",ma],["__scopeId","data-v-a1e1f1ab"]]),ha={props:{title:{type:String,default:""},color:{type:String,default:""},selected:{type:Boolean,default:!1}},emits:["selectLabel"],methods:{onClick(){this.$emit("selectLabel",this.title)}}},pa={class:"item-wrap"},_a={class:"button-wrap"},ba={class:"name-label-wrap"},fa=["title"],ga={key:0,class:"i-lucide-circle-check"};function Ca(e,t,a,o,i,s){const d=u("woot-button"),h=u("woot-dropdown-item");return n(),C(h,null,{default:E(()=>[l("div",pa,[m(d,{variant:"clear",onClick:s.onClick},{default:E(()=>[l("div",_a,[l("div",ba,[a.color?(n(),r("div",{key:0,class:"label-color--display",style:be({backgroundColor:a.color})},null,4)):p("",!0),l("span",{class:"label-text",title:a.title},c(a.title),9,fa)]),l("div",null,[a.selected?(n(),r("i",ga)):p("",!0)])])]),_:1},8,["onClick"])])]),_:1})}const Ta=v(ha,[["render",Ca],["__scopeId","data-v-8cf26e81"]]),Ea=/[^a-zA-Z0-9_-]/g,Aa=/\s+/g,va=(e="")=>e?e.trim().toLowerCase().replace(Aa,"-").replace(Ea,""):"",ya={components:{LabelDropdownItem:Ta,AddLabelModal:Ot,Hotkey:tt},props:{accountLabels:{type:Array,default:()=>[]},selectedLabels:{type:Array,default:()=>[]},allowCreation:{type:Boolean,default:!1}},emits:["update","add","remove"],data(){return{search:"",createModalVisible:!1}},computed:{createLabelPlaceholder(){const e=this.$t("CONTACT_PANEL.LABELS.LABEL_SELECT.CREATE_LABEL");return this.search?`${e}:`:e},filteredActiveLabels(){return this.search?vt(this.accountLabels,this.search,["title"],{threshold:.9}):this.accountLabels},noResult(){return this.filteredActiveLabels.length===0},hasExactMatchInResults(){return this.filteredActiveLabels.some(e=>e.title===this.search)},shouldShowCreate(){return this.allowCreation&&this.filteredActiveLabels.length<3},parsedSearch(){return va(this.search)}},mounted(){this.focusInput()},methods:{focusInput(){this.$refs.searchbar.focus()},updateLabels(e){this.$emit("update",e)},onAdd(e){this.$emit("add",e)},onRemove(e){this.$emit("remove",e)},onAddRemove(e){this.selectedLabels.includes(e.title)?this.onRemove(e.title):this.onAdd(e)},showCreateModal(){this.createModalVisible=!0},hideCreateModal(){this.createModalVisible=!1}}},Sa={class:"flex flex-col w-full max-h-[12.5rem]"},Oa={class:"flex items-center justify-center mb-1"},Na={class:"flex-grow m-0 overflow-hidden text-sm text-slate-800 dark:text-slate-100 whitespace-nowrap text-ellipsis"},wa={class:"flex-auto flex-grow-0 flex-shrink-0 mb-2 max-h-8"},Ia=["placeholder"],xa={class:"flex items-start justify-start flex-auto flex-grow flex-shrink overflow-auto"},Ma={class:"w-full"},ka={key:0,class:"flex justify-center py-4 px-2.5 font-medium text-xs text-slate-700 dark:text-slate-200"},Ra={key:1,class:"flex pt-1 border-t border-solid border-slate-100 dark:border-slate-900"};function La(e,t,a,o,i,s){const d=u("Hotkey"),h=u("LabelDropdownItem"),f=u("woot-dropdown-menu"),_=u("woot-button"),T=u("AddLabelModal"),b=u("woot-modal");return n(),r("div",Sa,[l("div",Oa,[l("h4",Na,c(e.$t("CONTACT_PANEL.LABELS.LABEL_SELECT.TITLE")),1),m(d,{"custom-class":"border border-solid text-slate-800 dark:text-slate-100 bg-slate-50 dark:bg-slate-600 text-xxs border-slate-75 dark:border-slate-600"},{default:E(()=>t[2]||(t[2]=[S(c("L"))])),_:1})]),l("div",wa,[O(l("input",{ref:"searchbar","onUpdate:modelValue":t[0]||(t[0]=g=>i.search=g),type:"text",class:"search-input",autofocus:"true",placeholder:e.$t("CONTACT_PANEL.LABELS.LABEL_SELECT.PLACEHOLDER")},null,8,Ia),[[V,i.search]])]),l("div",xa,[l("div",Ma,[m(f,null,{default:E(()=>[(n(!0),r(P,null,U(s.filteredActiveLabels,g=>(n(),C(h,{key:g.title,title:g.title,color:g.color,selected:a.selectedLabels.includes(g.title),onSelectLabel:I=>s.onAddRemove(g)},null,8,["title","color","selected","onSelectLabel"]))),128))]),_:1}),s.noResult?(n(),r("div",ka,c(e.$t("CONTACT_PANEL.LABELS.LABEL_SELECT.NO_RESULT")),1)):p("",!0),a.allowCreation&&s.shouldShowCreate?(n(),r("div",Ra,[m(_,{size:"small",variant:"clear","color-scheme":"secondary",icon:"add","is-expanded":"",class:"button-new-label","is-disabled":s.hasExactMatchInResults,onClick:s.showCreateModal},{default:E(()=>[S(c(s.createLabelPlaceholder)+" "+c(s.parsedSearch),1)]),_:1},8,["is-disabled","onClick"]),m(b,{show:i.createModalVisible,"onUpdate:show":t[1]||(t[1]=g=>i.createModalVisible=g),"on-close":s.hideCreateModal},{default:E(()=>[m(T,{"prefill-title":s.parsedSearch,onClose:s.hideCreateModal},null,8,["prefill-title","onClose"])]),_:1},8,["show","on-close"])])):p("",!0)])])])}const rr=v(ya,[["render",La],["__scopeId","data-v-2cb8ce2c"]]),$a={emits:["add"],methods:{addLabel(){this.$emit("add")}}};function Pa(e,t,a,o,i,s){const d=u("woot-button");return n(),C(d,{variant:"smooth",class:"label--add",icon:"add",size:"tiny",onClick:s.addLabel},{default:E(()=>[S(c(e.$t("CONTACT_PANEL.LABELS.CONVERSATION.ADD_BUTTON")),1)]),_:1},8,["onClick"])}const cr=v($a,[["render",Pa],["__scopeId","data-v-bb8c6938"]]),Ua={components:{EmojiOrIcon:Te},props:{href:{type:String,default:""},icon:{type:String,required:!0},emoji:{type:String,required:!0},value:{type:String,default:""},showCopy:{type:Boolean,default:!1}},methods:{async onCopy(e){e.preventDefault(),await Ae(this.value),N(this.$t("CONTACT_PANEL.COPY_SUCCESSFUL"))}}},Da={class:"w-full h-5 ltr:-ml-1 rtl:-mr-1"},Fa=["href"],Va=["title"],Ba={key:1,class:"text-sm text-slate-300 dark:text-slate-600"},Wa={key:1,class:"flex items-center gap-2 text-slate-800 dark:text-slate-100"},Ha={key:0,class:"overflow-hidden text-sm whitespace-nowrap text-ellipsis"},ja={key:1,class:"text-sm text-slate-300 dark:text-slate-600"};function Ga(e,t,a,o,i,s){const d=u("EmojiOrIcon"),h=u("woot-button");return n(),r("div",Da,[a.href?(n(),r("a",{key:0,href:a.href,class:"flex items-center gap-2 text-slate-800 dark:text-slate-100 hover:underline"},[m(d,{icon:a.icon,emoji:a.emoji,"icon-size":"14",class:"flex-shrink-0 ltr:ml-1 rtl:mr-1"},null,8,["icon","emoji"]),a.value?(n(),r("span",{key:0,class:"overflow-hidden text-sm whitespace-nowrap text-ellipsis",title:a.value},c(a.value),9,Va)):(n(),r("span",Ba,c(e.$t("CONTACT_PANEL.NOT_AVAILABLE")),1)),a.showCopy?(n(),C(h,{key:2,type:"submit",variant:"clear",size:"tiny","color-scheme":"secondary",icon:"clipboard","class-names":"p-0",onClick:s.onCopy},null,8,["onClick"])):p("",!0)],8,Fa)):(n(),r("div",Wa,[m(d,{icon:a.icon,emoji:a.emoji,"icon-size":"14",class:"flex-shrink-0 ltr:ml-1 rtl:mr-1"},null,8,["icon","emoji"]),a.value?(n(),r("span",Ha,c(a.value),1)):(n(),r("span",ja,c(e.$t("CONTACT_PANEL.NOT_AVAILABLE")),1))]))])}const za=v(Ua,[["render",Ga]]),Ya={props:{socialProfiles:{type:Object,default:()=>({})}},data(){return{socialMediaLinks:[{key:"facebook",icon:"facebook",link:"https://facebook.com/"},{key:"twitter",icon:"twitter",link:"https://twitter.com/"},{key:"linkedin",icon:"linkedin",link:"https://linkedin.com/"},{key:"github",icon:"github",link:"https://github.com/"},{key:"instagram",icon:"instagram",link:"https://instagram.com/"},{key:"telegram",icon:"telegram",link:"https://t.me/"}]}},computed:{availableProfiles(){return this.socialMediaLinks.filter(e=>!!this.socialProfiles[e.key])}}},Xa={key:0,class:"flex items-end gap-3 mx-0 my-2"},qa=["href"];function Ka(e,t,a,o,i,s){const d=u("fluent-icon");return s.availableProfiles.length?(n(),r("div",Xa,[(n(!0),r(P,null,U(s.availableProfiles,h=>(n(),r("a",{key:h.key,href:`${h.link}${a.socialProfiles[h.key]}`,target:"_blank",rel:"noopener noreferrer nofollow"},[m(d,{icon:`brand-${h.key}`,size:"16",class:"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"},null,8,["icon"])],8,qa))),128))])):p("",!0)}const Za=v(Ya,[["render",Ka]]),Ja={props:{contact:{type:Object,default:()=>({})},inProgress:{type:Boolean,default:!1},onSubmit:{type:Function,default:()=>{}}},emits:["cancel","success"],setup(){return{v$:Y()}},data(){return{countries:It,companyName:"",description:"",email:"",name:"",phoneNumber:"",activeDialCode:"",avatarFile:null,avatarUrl:"",country:{id:"",name:""},city:"",socialProfileUserNames:{facebook:"",twitter:"",linkedin:"",github:""},socialProfileKeys:[{key:"facebook",prefixURL:"https://facebook.com/"},{key:"twitter",prefixURL:"https://twitter.com/"},{key:"linkedin",prefixURL:"https://linkedin.com/"},{key:"github",prefixURL:"https://github.com/"}]}},validations:{name:{required:j},description:{},email:{email:Oe},companyName:{},phoneNumber:{},bio:{}},computed:{parsePhoneNumber(){return st(this.phoneNumber)},isPhoneNumberNotValid(){return this.phoneNumber!==""?!_e(this.phoneNumber,this.activeDialCode)||(this.phoneNumber!==""?this.activeDialCode==="":!1):!1},phoneNumberError(){return this.activeDialCode===""?this.$t("CONTACT_FORM.FORM.PHONE_NUMBER.DIAL_CODE_ERROR"):_e(this.phoneNumber,this.activeDialCode)?"":this.$t("CONTACT_FORM.FORM.PHONE_NUMBER.ERROR")},setPhoneNumber(){return this.parsePhoneNumber&&this.parsePhoneNumber.countryCallingCode?this.phoneNumber:this.phoneNumber===""&&this.activeDialCode!==""?"":this.activeDialCode?`${this.activeDialCode}${this.phoneNumber}`:""}},watch:{contact(){this.setContactObject()}},mounted(){this.setContactObject(),this.setDialCode()},methods:{onCancel(){this.$emit("cancel")},onSuccess(){this.$emit("success")},countryNameWithCode({name:e,id:t}){return t?!e&&!t?"":`${e} (${t})`:e},setDialCode(){if(this.phoneNumber!==""&&this.parsePhoneNumber&&this.parsePhoneNumber.countryCallingCode){const e=this.parsePhoneNumber.countryCallingCode;this.activeDialCode=`+${e}`}},setContactObject(){const{email:e,phone_number:t,name:a}=this.contact,o=this.contact.additional_attributes||{};this.name=a||"",this.email=e||"",this.phoneNumber=t||"",this.companyName=o.company_name||"",this.country={id:o.country_code||"",name:o.country||this.$t("CONTACT_FORM.FORM.COUNTRY.SELECT_COUNTRY")},this.city=o.city||"",this.description=o.description||"",this.avatarUrl=this.contact.thumbnail||"";const{social_profiles:i={},screen_name:s}=o;this.socialProfileUserNames={twitter:i.twitter||s||"",facebook:i.facebook||"",linkedin:i.linkedin||"",github:i.github||"",instagram:i.instagram||""}},getContactObject(){this.country===null&&(this.country={id:"",name:""});const e={id:this.contact.id,name:this.name,email:this.email,phone_number:this.setPhoneNumber,additional_attributes:{...this.contact.additional_attributes,description:this.description,company_name:this.companyName,country_code:this.country.id,country:this.country.name===this.$t("CONTACT_FORM.FORM.COUNTRY.SELECT_COUNTRY")?"":this.country.name,city:this.city,social_profiles:this.socialProfileUserNames}};return this.avatarFile&&(e.avatar=this.avatarFile,e.isFormData=!0),e},setPhoneCode(e){if(this.phoneNumber!==""&&this.parsePhoneNumber){const t=this.parsePhoneNumber.countryCallingCode;if(t===e)return;this.activeDialCode=`+${t}`;const a=this.phoneNumber.replace(`+${t}`,`${e}`);this.phoneNumber=a}else this.activeDialCode=e},async handleSubmit(){if(this.v$.$touch(),!(this.v$.$invalid||this.isPhoneNumberNotValid))try{await this.onSubmit(this.getContactObject()),this.onSuccess(),N(this.$t("CONTACT_FORM.SUCCESS_MESSAGE"))}catch(e){e instanceof at?e.data.includes("email")?N(this.$t("CONTACT_FORM.FORM.EMAIL_ADDRESS.DUPLICATE")):e.data.includes("phone_number")&&N(this.$t("CONTACT_FORM.FORM.PHONE_NUMBER.DUPLICATE")):e instanceof ve?N(e.data):N(this.$t("CONTACT_FORM.ERROR_MESSAGE"))}},handleImageUpload({file:e,url:t}){this.avatarFile=e,this.avatarUrl=t},async handleAvatarDelete(){try{this.contact&&this.contact.id&&(await this.$store.dispatch("contacts/deleteAvatar",this.contact.id),N(this.$t("CONTACT_FORM.DELETE_AVATAR.API.SUCCESS_MESSAGE"))),this.avatarFile=null,this.avatarUrl="",this.activeDialCode=""}catch(e){N(e.message?e.message:this.$t("CONTACT_FORM.DELETE_AVATAR.API.ERROR_MESSAGE"))}}}},Qa={class:"w-full"},en={class:"w-full"},tn=["placeholder"],sn=["placeholder"],an={key:0,class:"message"},nn={class:"w-full"},on=["placeholder"],ln={class:"w-full"},rn={key:0,class:"message"},cn={key:0,class:"relative mx-0 mt-0 mb-2.5 p-2 rounded-md text-sm border border-solid border-yellow-500 text-yellow-700 dark:border-yellow-700 bg-yellow-200/60 dark:bg-yellow-200/20 dark:text-yellow-400"},dn={class:"w-full"},un={class:"w-full"},mn={class:"flex items-center h-10 px-2 text-sm border-solid bg-slate-50 border-y ltr:border-l rtl:border-r ltr:rounded-l-md rtl:rounded-r-md dark:bg-slate-700 text-slate-800 dark:text-slate-100 border-slate-200 dark:border-slate-600"},hn=["onUpdate:modelValue"],pn={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"},_n={class:"w-full"};function bn(e,t,a,o,i,s){const d=u("woot-avatar-uploader"),h=u("woot-phone-input"),f=u("woot-input"),_=u("multiselect"),T=u("woot-submit-button");return n(),r("form",{class:"w-full px-8 pt-6 pb-8 contact--form",onSubmit:t[11]||(t[11]=k((...b)=>s.handleSubmit&&s.handleSubmit(...b),["prevent"]))},[l("div",null,[l("div",Qa,[m(d,{label:e.$t("CONTACT_FORM.FORM.AVATAR.LABEL"),src:i.avatarUrl,"username-avatar":i.name,"delete-avatar":!!i.avatarUrl,class:"settings-item",onOnAvatarSelect:s.handleImageUpload,onOnAvatarDelete:s.handleAvatarDelete},null,8,["label","src","username-avatar","delete-avatar","onOnAvatarSelect","onOnAvatarDelete"])])]),l("div",null,[l("div",en,[l("label",{class:y({error:o.v$.name.$error})},[S(c(e.$t("CONTACT_FORM.FORM.NAME.LABEL"))+" ",1),O(l("input",{"onUpdate:modelValue":t[0]||(t[0]=b=>i.name=b),type:"text",placeholder:e.$t("CONTACT_FORM.FORM.NAME.PLACEHOLDER"),onInput:t[1]||(t[1]=(...b)=>o.v$.name.$touch&&o.v$.name.$touch(...b))},null,40,tn),[[V,i.name]])],2),l("label",{class:y({error:o.v$.email.$error})},[S(c(e.$t("CONTACT_FORM.FORM.EMAIL_ADDRESS.LABEL"))+" ",1),O(l("input",{"onUpdate:modelValue":t[2]||(t[2]=b=>i.email=b),type:"text",placeholder:e.$t("CONTACT_FORM.FORM.EMAIL_ADDRESS.PLACEHOLDER"),onInput:t[3]||(t[3]=(...b)=>o.v$.email.$touch&&o.v$.email.$touch(...b))},null,40,sn),[[V,i.email]]),o.v$.email.$error?(n(),r("span",an,c(e.$t("CONTACT_FORM.FORM.EMAIL_ADDRESS.ERROR")),1)):p("",!0)],2)])]),l("div",nn,[l("label",{class:y({error:o.v$.description.$error})},[S(c(e.$t("CONTACT_FORM.FORM.BIO.LABEL"))+" ",1),O(l("textarea",{"onUpdate:modelValue":t[4]||(t[4]=b=>i.description=b),type:"text",placeholder:e.$t("CONTACT_FORM.FORM.BIO.PLACEHOLDER"),onInput:t[5]||(t[5]=(...b)=>o.v$.description.$touch&&o.v$.description.$touch(...b))},null,40,on),[[V,i.description]])],2)]),l("div",null,[l("div",ln,[l("label",{class:y({error:s.isPhoneNumberNotValid})},[S(c(e.$t("CONTACT_FORM.FORM.PHONE_NUMBER.LABEL"))+" ",1),m(h,{modelValue:i.phoneNumber,"onUpdate:modelValue":t[6]||(t[6]=b=>i.phoneNumber=b),value:i.phoneNumber,error:s.isPhoneNumberNotValid,placeholder:e.$t("CONTACT_FORM.FORM.PHONE_NUMBER.PLACEHOLDER"),onBlur:o.v$.phoneNumber.$touch,onSetCode:s.setPhoneCode},null,8,["modelValue","value","error","placeholder","onBlur","onSetCode"]),s.isPhoneNumberNotValid?(n(),r("span",rn,c(s.phoneNumberError),1)):p("",!0)],2),s.isPhoneNumberNotValid||!i.phoneNumber?(n(),r("div",cn,c(e.$t("CONTACT_FORM.FORM.PHONE_NUMBER.HELP")),1)):p("",!0)])]),m(f,{modelValue:i.companyName,"onUpdate:modelValue":t[7]||(t[7]=b=>i.companyName=b),class:"w-full",label:e.$t("CONTACT_FORM.FORM.COMPANY_NAME.LABEL"),placeholder:e.$t("CONTACT_FORM.FORM.COMPANY_NAME.PLACEHOLDER")},null,8,["modelValue","label","placeholder"]),l("div",null,[l("div",dn,[l("label",null,c(e.$t("CONTACT_FORM.FORM.COUNTRY.LABEL")),1),m(_,{modelValue:i.country,"onUpdate:modelValue":t[8]||(t[8]=b=>i.country=b),"track-by":"id",label:"name",placeholder:e.$t("CONTACT_FORM.FORM.COUNTRY.PLACEHOLDER"),"selected-label":"","select-label":e.$t("CONTACT_FORM.FORM.COUNTRY.SELECT_PLACEHOLDER"),"deselect-label":e.$t("CONTACT_FORM.FORM.COUNTRY.REMOVE"),"custom-label":s.countryNameWithCode,"max-height":160,options:i.countries,"allow-empty":"","option-height":104},null,8,["modelValue","placeholder","select-label","deselect-label","custom-label","options"])])]),m(f,{modelValue:i.city,"onUpdate:modelValue":t[9]||(t[9]=b=>i.city=b),class:"w-full",label:e.$t("CONTACT_FORM.FORM.CITY.LABEL"),placeholder:e.$t("CONTACT_FORM.FORM.CITY.PLACEHOLDER")},null,8,["modelValue","label","placeholder"]),l("div",un,[l("label",null,c(e.$t("CONTACTS_PAGE.LIST.TABLE_HEADER.SOCIAL_PROFILES")),1),(n(!0),r(P,null,U(i.socialProfileKeys,b=>(n(),r("div",{key:b.key,class:"flex items-stretch w-full mb-4"},[l("span",mn,c(b.prefixURL),1),O(l("input",{"onUpdate:modelValue":g=>i.socialProfileUserNames[b.key]=g,class:"input-group-field ltr:!rounded-l-none rtl:rounded-r-none !mb-0",type:"text"},null,8,hn),[[V,i.socialProfileUserNames[b.key]]])]))),128))]),l("div",pn,[l("div",_n,[m(T,{loading:a.inProgress,"button-text":e.$t("CONTACT_FORM.FORM.SUBMIT")},null,8,["loading","button-text"]),l("button",{class:"button clear",onClick:t[10]||(t[10]=k((...b)=>s.onCancel&&s.onCancel(...b),["prevent"]))},c(e.$t("CONTACT_FORM.FORM.CANCEL")),1)])])],32)}const fn=v(Ja,[["render",bn],["__scopeId","data-v-3c3f3e1b"]]),gn={components:{ContactForm:fn},props:{show:{type:Boolean,default:!1},contact:{type:Object,default:()=>({})}},emits:["cancel","update:show"],computed:{...W({uiFlags:"contacts/getUIFlags"}),localShow:{get(){return this.show},set(e){this.$emit("update:show",e)}}},methods:{onCancel(){this.$emit("cancel")},onSuccess(){this.$emit("cancel")},async onSubmit(e){await this.$store.dispatch("contacts/update",e),await this.$store.dispatch("contacts/fetchContactableInbox",this.contact.id)}}},Cn={class:"flex flex-col h-auto overflow-auto"};function Tn(e,t,a,o,i,s){const d=u("woot-modal-header"),h=u("ContactForm"),f=u("woot-modal");return n(),C(f,{show:s.localShow,"onUpdate:show":t[0]||(t[0]=_=>s.localShow=_),"on-close":s.onCancel,"modal-type":"right-aligned"},{default:E(()=>[l("div",Cn,[m(d,{"header-title":`${e.$t("EDIT_CONTACT.TITLE")} - ${a.contact.name||a.contact.email}`,"header-content":e.$t("EDIT_CONTACT.DESC")},null,8,["header-title","header-content"]),m(h,{contact:a.contact,"in-progress":e.uiFlags.isUpdating,"on-submit":s.onSubmit,onSuccess:s.onSuccess,onCancel:s.onCancel},null,8,["contact","in-progress","on-submit","onSuccess","onCancel"])])]),_:1},8,["show","on-close"])}const En=v(gn,[["render",Tn]]),An={computed:{...W({accountId:"getCurrentAccountId"})},methods:{onFileUpload(e){this.globalConfig.directUploadsEnabled?this.onDirectFileUpload(e):this.onIndirectFileUpload(e)},onDirectFileUpload(e){const t=this.isATwilioSMSChannel?de:ue;e&&(ce(e,t)?new Mt.DirectUpload(e.file,`/api/v1/accounts/${this.accountId}/conversations/${this.currentChat.id}/direct_uploads`,{directUploadWillCreateBlobWithXHR:o=>{o.setRequestHeader("api_access_token",this.currentUser.access_token)}}).create((o,i)=>{o?N(o):this.attachFile({file:e,blob:i})}):N(this.$t("CONVERSATION.FILE_SIZE_LIMIT",{MAXIMUM_SUPPORTED_FILE_UPLOAD_SIZE:t})))},onIndirectFileUpload(e){const t=this.isATwilioSMSChannel?de:ue;e&&(ce(e,t)?this.attachFile({file:e}):N(this.$t("CONVERSATION.FILE_SIZE_LIMIT",{MAXIMUM_SUPPORTED_FILE_UPLOAD_SIZE:t})))}}},vn={class:"flex overflow-auto max-h-[12.5rem]"},yn={class:"max-w-[4rem] flex-shrink-0 w-6 flex items-center"},Sn=["src"],On={key:1,class:"relative w-6 h-6 text-lg text-left -top-px"},Nn={class:"max-w-3/5 min-w-[50%] overflow-hidden text-ellipsis"},wn={class:"h-4 overflow-hidden text-sm font-medium text-ellipsis whitespace-nowrap"},In={class:"w-[30%] justify-center"},xn={class:"overflow-hidden text-xs text-ellipsis whitespace-nowrap"},Mn={class:"flex items-center justify-center"},kn={__name:"AttachmentsPreview",props:{attachments:{type:Array,default:()=>[]}},emits:["removeAttachment"],setup(e,{emit:t}){const a=e,o=t,i=M(()=>a.attachments.filter(T=>!(T!=null&&T.isRecordedAudio))),s=M(()=>a.attachments.filter(T=>T.isRecordedAudio)),d=T=>{o("removeAttachment",i.value.filter((b,g)=>g!==T).concat(s.value))},h=T=>{const b=T.byte_size||T.size;return Ye(b,0)},f=T=>(T.content_type||T.type).includes("image"),_=T=>T.filename||T.name;return(T,b)=>{const g=u("woot-button");return n(),r("div",vn,[(n(!0),r(P,null,U(i.value,(I,w)=>(n(),r("div",{key:I.id,class:"preview-item flex items-center p-1 bg-slate-50 dark:bg-slate-800 gap-1 rounded-md w-[15rem] mb-1"},[l("div",yn,[f(I.resource)?(n(),r("img",{key:0,class:"object-cover w-6 h-6 rounded-sm",src:I.thumb},null,8,Sn)):(n(),r("span",On," 📄 "))]),l("div",Nn,[l("span",wn,c(_(I.resource)),1)]),l("div",In,[l("span",xn,c(h(I.resource)),1)]),l("div",Mn,[m(g,{class:"!w-6 !h-6 text-sm rounded-md hover:bg-slate-50 dark:hover:bg-slate-800 clear secondary",icon:"dismiss",onClick:R=>d(w)},null,8,["onClick"])])]))),128))])}}},Rn={components:{},props:{name:{type:String,default:""},inboxIdentifier:{type:String,default:""},channelType:{type:String,default:""}},computed:{computedInboxIcon(){return this.channelType?nt(this.channelType,this.inboxIdentifier):"chat"},computedInboxType(){return this.channelType?ot(this.channelType,this.inboxIdentifier):"chat"}}},Ln={class:"flex items-center h-[2.375rem] min-w-0 py-0 px-1"},$n={class:"inline-flex rounded mr-1 rtl:ml-1 rtl:mr-0 bg-slate-25 dark:bg-slate-700 p-0.5 items-center flex-shrink-0 justify-center w-6 h-6"},Pn={class:"flex flex-col w-full min-w-0 ml-1 mr-1"},Un={class:"option__title"},Dn=["title"];function Fn(e,t,a,o,i,s){const d=u("fluent-icon");return n(),r("div",Ln,[l("span",$n,[m(d,{icon:s.computedInboxIcon,size:"14",class:"text-slate-800 dark:text-slate-200"},null,8,["icon"])]),l("div",Pn,[l("h5",Un,c(a.name),1),l("p",{class:"option__body overflow-hidden whitespace-nowrap text-ellipsis",title:a.inboxIdentifier},c(a.inboxIdentifier||s.computedInboxType),9,Dn)])])}const Vn=v(Rn,[["render",Fn],["__scopeId","data-v-28a914ac"]]),Bn={methods:{openProfileSettings(){return this.$router.push({name:"profile_settings_index"})}}},Wn={class:"my-0 mx-4 px-1 flex max-h-[8vh] items-baseline justify-between hover:bg-slate-25 dark:hover:bg-slate-800 border border-dashed border-slate-100 dark:border-slate-700 rounded-sm overflow-auto"},Hn={class:"w-fit !m-0"};function jn(e,t,a,o,i,s){const d=u("woot-button");return n(),r("div",Wn,[l("p",Hn,[S(c(e.$t("CONVERSATION.FOOTER.MESSAGE_SIGNATURE_NOT_CONFIGURED"))+" ",1),m(d,{"color-scheme":"primary",variant:"link",onClick:s.openProfileSettings},{default:E(()=>[S(c(e.$t("CONVERSATION.FOOTER.CLICK_HERE")),1)]),_:1},8,["onClick"])])])}const Gn=v(Bn,[["render",jn]]),se=e=>e.length?e.replace(/\s+/g,"").split(",").every(a=>Oe.$validator(a)):!0,zn={props:{ccEmails:{type:String,default:""},bccEmails:{type:String,default:""},toEmails:{type:String,default:""}},emits:["update:bccEmails","update:ccEmails","update:toEmails"],setup(){return{v$:Y()}},data(){return{showBcc:!1,ccEmailsVal:"",bccEmailsVal:"",toEmailsVal:""}},watch:{bccEmails(e){e!==this.bccEmailsVal&&(this.bccEmailsVal=e)},ccEmails(e){e!==this.ccEmailsVal&&(this.ccEmailsVal=e)},toEmails(e){e!==this.toEmailsVal&&(this.toEmailsVal=e)}},mounted(){this.ccEmailsVal=this.ccEmails,this.bccEmailsVal=this.bccEmails,this.toEmailsVal=this.toEmails},validations:{ccEmailsVal:{hasValidEmails(e){return se(e)}},bccEmailsVal:{hasValidEmails(e){return se(e)}},toEmailsVal:{hasValidEmails(e){return se(e)}}},methods:{handleAddBcc(){this.showBcc=!0},onBlur(){this.v$.$touch(),this.$emit("update:bccEmails",this.bccEmailsVal),this.$emit("update:ccEmails",this.ccEmailsVal),this.$emit("update:toEmails",this.toEmailsVal)}}},Yn={key:0},Xn={class:"input-group-label"},qn={class:"rounded-none flex-1 min-w-0 m-0 whitespace-nowrap"},Kn={class:"input-group-wrap"},Zn={class:"input-group-label"},Jn={class:"rounded-none flex-1 min-w-0 m-0 whitespace-nowrap"},Qn={key:0,class:"message"},eo={key:1,class:"input-group-wrap"},to={class:"input-group-label"},so={class:"rounded-none flex-1 min-w-0 m-0 whitespace-nowrap"},ao={key:0,class:"message"};function no(e,t,a,o,i,s){const d=u("woot-input"),h=u("woot-button");return n(),r("div",null,[a.toEmails?(n(),r("div",Yn,[l("div",{class:y(["input-group small",{error:o.v$.toEmailsVal.$error}])},[l("label",Xn,c(e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.TO")),1),l("div",qn,[m(d,{modelValue:o.v$.toEmailsVal.$model,"onUpdate:modelValue":t[0]||(t[0]=f=>o.v$.toEmailsVal.$model=f),type:"text",class:y(["[&>input]:!mb-0 [&>input]:border-transparent [&>input]:h-8 [&>input]:text-sm [&>input]:!border-0 [&>input]:border-none",{error:o.v$.toEmailsVal.$error}]),placeholder:e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.CC.PLACEHOLDER"),onBlur:s.onBlur},null,8,["modelValue","class","placeholder","onBlur"])])],2)])):p("",!0),l("div",Kn,[l("div",{class:y(["input-group small",{error:o.v$.ccEmailsVal.$error}])},[l("label",Zn,c(e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.CC.LABEL")),1),l("div",Jn,[m(d,{modelValue:o.v$.ccEmailsVal.$model,"onUpdate:modelValue":t[1]||(t[1]=f=>o.v$.ccEmailsVal.$model=f),class:y(["[&>input]:!mb-0 [&>input]:border-transparent [&>input]:h-8 [&>input]:text-sm [&>input]:!border-0 [&>input]:border-none",{error:o.v$.ccEmailsVal.$error}]),type:"text",placeholder:e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.CC.PLACEHOLDER"),onBlur:s.onBlur},null,8,["modelValue","class","placeholder","onBlur"])]),i.showBcc?p("",!0):(n(),C(h,{key:0,variant:"clear",size:"small",onClick:s.handleAddBcc},{default:E(()=>[S(c(e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.ADD_BCC")),1)]),_:1},8,["onClick"]))],2),o.v$.ccEmailsVal.$error?(n(),r("span",Qn,c(e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.CC.ERROR")),1)):p("",!0)]),i.showBcc?(n(),r("div",eo,[l("div",{class:y(["input-group small",{error:o.v$.bccEmailsVal.$error}])},[l("label",to,c(e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.BCC.LABEL")),1),l("div",so,[m(d,{modelValue:o.v$.bccEmailsVal.$model,"onUpdate:modelValue":t[2]||(t[2]=f=>o.v$.bccEmailsVal.$model=f),type:"text",class:y(["[&>input]:!mb-0 [&>input]:border-transparent [&>input]:h-8 [&>input]:text-sm [&>input]:!border-0 [&>input]:border-none",{error:o.v$.bccEmailsVal.$error}]),placeholder:e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.BCC.PLACEHOLDER"),onBlur:s.onBlur},null,8,["modelValue","class","placeholder","onBlur"])])],2),o.v$.bccEmailsVal.$error?(n(),r("span",ao,c(e.$t("CONVERSATION.REPLYBOX.EMAIL_HEAD.BCC.ERROR")),1)):p("",!0)])):p("",!0)])}const oo=v(zn,[["render",no],["__scopeId","data-v-dfbb4cd7"]]),io=["DOCUMENT","IMAGE","VIDEO"],lo={props:{inboxId:{type:Number,default:void 0}},emits:["onSelect"],data(){return{query:""}},computed:{whatsAppTemplateMessages(){return this.$store.getters["inboxes/getWhatsAppTemplates"](this.inboxId).filter(e=>e.status.toLowerCase()==="approved").filter(e=>e.components.every(t=>!io.includes(t.format)))},filteredTemplateMessages(){return this.whatsAppTemplateMessages.filter(e=>e.name.toLowerCase().includes(this.query.toLowerCase()))}},methods:{getTemplatebody(e){return e.components.find(t=>t.type==="BODY").text}}},ro={class:"w-full"},co={class:"gap-1 templates__list-search"},uo=["placeholder"],mo={class:"template__list-container"},ho=["onClick"],po={class:"flex items-center justify-between mb-2.5"},_o={class:"label-title"},bo={class:"inline-block px-2 py-1 text-xs leading-none bg-white rounded-sm cursor-default dark:bg-slate-700 text-slate-800 dark:text-slate-100"},fo={class:"strong"},go={class:"label-body"},Co={class:"label-category"},To={class:"strong"},Eo={key:0};function Ao(e,t,a,o,i,s){const d=u("fluent-icon");return n(),r("div",ro,[l("div",co,[m(d,{icon:"search",class:"search-icon",size:"16"}),O(l("input",{"onUpdate:modelValue":t[0]||(t[0]=h=>i.query=h),type:"search",placeholder:e.$t("WHATSAPP_TEMPLATES.PICKER.SEARCH_PLACEHOLDER"),class:"templates__search-input"},null,8,uo),[[V,i.query]])]),l("div",mo,[(n(!0),r(P,null,U(s.filteredTemplateMessages,(h,f)=>(n(),r("div",{key:h.id},[l("button",{class:"template__list-item",onClick:_=>e.$emit("onSelect",h)},[l("div",null,[l("div",po,[l("p",_o,c(h.name),1),l("span",bo,c(e.$t("WHATSAPP_TEMPLATES.PICKER.LABELS.LANGUAGE"))+" : "+c(h.language),1)]),l("div",null,[l("p",fo,c(e.$t("WHATSAPP_TEMPLATES.PICKER.LABELS.TEMPLATE_BODY")),1),l("p",go,c(s.getTemplatebody(h)),1)]),l("div",Co,[l("p",To,c(e.$t("WHATSAPP_TEMPLATES.PICKER.LABELS.CATEGORY")),1),l("p",null,c(h.category),1)])])],8,ho),f!=s.filteredTemplateMessages.length-1?(n(),r("hr",{key:`hr-${f}`})):p("",!0)]))),128)),s.filteredTemplateMessages.length?p("",!0):(n(),r("div",Eo,[l("p",null,[S(c(e.$t("WHATSAPP_TEMPLATES.PICKER.NO_TEMPLATES_FOUND"))+" ",1),l("strong",null,c(i.query),1)])]))])])}const vo=v(lo,[["render",Ao],["__scopeId","data-v-4682fdb9"]]),yo={props:{template:{type:Object,default:()=>({})}},emits:["sendMessage","resetTemplate"],setup(e,{emit:t}){const a=g=>g.replace(/{{|}}/g,""),o=g=>Object.keys(g).every(w=>g[w]),i=fe({}),s=M(()=>e.template.components.find(g=>g.type==="BODY").text),d=M(()=>s.value.match(/{{([^}]+)}}/g)),h=M(()=>s.value.replace(/{{([^}]+)}}/g,(g,I)=>{const w=a(I);return i.value[w]||`{{${I}}}`})),f=Y({processedParams:{requiredIfKeysPresent:Ne(d),allKeysRequired:o}},{processedParams:i}),_=()=>{const g=s.value.match(/{{([^}]+)}}/g);if(!g)return;const I=g.map(w=>a(w));i.value=I.reduce((w,R)=>(w[R]="",w),{})},T=()=>{t("resetTemplate")},b=()=>{if(f.value.$touch(),f.value.$invalid)return;const g={message:h.value,templateParams:{name:e.template.name,category:e.template.category,language:e.template.language,namespace:e.template.namespace,processed_params:i.value}};t("sendMessage",g)};return ge(_),{processedParams:i,variables:d,templateString:s,processedString:h,v$:f,resetTemplate:T,sendMessage:b}}},So={class:"w-full"},Oo={key:0,class:"template__variables-container"},No={class:"variables-label"},wo={class:"variable-label"},Io={key:0,class:"error"};function xo(e,t,a,o,i,s){const d=u("woot-input"),h=u("woot-button");return n(),r("div",So,[O(l("textarea",{"onUpdate:modelValue":t[0]||(t[0]=f=>o.processedString=f),rows:"4",readonly:"",class:"template-input"},null,512),[[V,o.processedString]]),o.variables?(n(),r("div",Oo,[l("p",No,c(e.$t("WHATSAPP_TEMPLATES.PARSER.VARIABLES_LABEL")),1),(n(!0),r(P,null,U(o.processedParams,(f,_)=>(n(),r("div",{key:_,class:"template__variable-item"},[l("span",wo,c(_),1),m(d,{modelValue:o.processedParams[_],"onUpdate:modelValue":T=>o.processedParams[_]=T,type:"text",class:"variable-input",styles:{marginBottom:0}},null,8,["modelValue","onUpdate:modelValue"])]))),128)),o.v$.$dirty&&o.v$.$invalid?(n(),r("p",Io,c(e.$t("WHATSAPP_TEMPLATES.PARSER.FORM_ERROR_MESSAGE")),1)):p("",!0)])):p("",!0),l("footer",null,[m(h,{variant:"smooth",onClick:o.resetTemplate},{default:E(()=>[S(c(e.$t("WHATSAPP_TEMPLATES.PARSER.GO_BACK_LABEL")),1)]),_:1},8,["onClick"]),m(h,{type:"button",onClick:o.sendMessage},{default:E(()=>[S(c(e.$t("WHATSAPP_TEMPLATES.PARSER.SEND_MESSAGE_LABEL")),1)]),_:1},8,["onClick"])])])}const Mo=v(yo,[["render",xo],["__scopeId","data-v-80d49e89"]]),ko={components:{TemplatesPicker:vo,TemplateParser:Mo},props:{inboxId:{type:Number,default:void 0}},emits:["pickTemplate","onSend","cancel"],data(){return{selectedWaTemplate:null}},methods:{pickTemplate(e){this.$emit("pickTemplate",!0),this.selectedWaTemplate=e},onResetTemplate(){this.$emit("pickTemplate",!1),this.selectedWaTemplate=null},onSendMessage(e){this.$emit("onSend",e)},onClose(){this.$emit("cancel")}}},Ro={class:"flex flex-wrap mx-0"};function Lo(e,t,a,o,i,s){const d=u("TemplatesPicker"),h=u("TemplateParser");return n(),r("div",Ro,[i.selectedWaTemplate?(n(),C(h,{key:1,template:i.selectedWaTemplate,onResetTemplate:s.onResetTemplate,onSendMessage:s.onSendMessage},null,8,["template","onResetTemplate","onSendMessage"])):(n(),C(d,{key:0,"inbox-id":a.inboxId,onOnSelect:s.pickTemplate},null,8,["inbox-id","onOnSelect"]))])}const $o=v(ko,[["render",Lo]]),Po={components:{Thumbnail:q,WootMessageEditor:it,ReplyEmailHead:oo,CannedResponse:lt,WhatsappTemplates:$o,InboxDropdownItem:Vn,FileUpload:kt,AttachmentPreview:kn,MessageSignatureMissingAlert:Gn},mixins:[Ee,An],props:{contact:{type:Object,default:()=>({})},onSubmit:{type:Function,default:()=>{}}},emits:["cancel","success"],setup(){const{fetchSignatureFlagFromUISettings:e,setSignatureFlagForInbox:t}=ye(),a=Y(),o=fe(!1);return{fetchSignatureFlagFromUISettings:e,setSignatureFlagForInbox:t,v$:a,uploadAttachment:o}},data(){return{name:"",subject:"",message:"",showCannedResponseMenu:!1,cannedResponseSearchKey:"",bccEmails:"",ccEmails:"",targetInbox:{},whatsappTemplateSelected:!1,attachedFiles:[]}},validations(){return{subject:{required:Ne(this.isAnEmailInbox)},message:{required:j},targetInbox:{required:j}}},computed:{...W({uiFlags:"contacts/getUIFlags",conversationsUiFlags:"contactConversations/getUIFlags",currentUser:"getCurrentUser",globalConfig:"globalConfig/get",messageSignature:"getMessageSignature"}),sendWithSignature(){return this.fetchSignatureFlagFromUISettings(this.channelType)},signatureToApply(){return this.messageSignature},newMessagePayload(){const e={inboxId:this.targetInbox.id,sourceId:this.targetInbox.sourceId,contactId:this.contact.id,message:{content:this.message},mailSubject:this.subject,assigneeId:this.currentUser.id};return this.attachedFiles&&this.attachedFiles.length&&(e.files=[],this.setAttachmentPayload(e)),this.ccEmails&&(e.message.cc_emails=this.ccEmails),this.bccEmails&&(e.message.bcc_emails=this.bccEmails),e},selectedInbox:{get(){return(this.contact.contactableInboxes||[]).find(t=>{var a,o,i;return((a=t.inbox)==null?void 0:a.id)&&((o=t.inbox)==null?void 0:o.id)===((i=this.targetInbox)==null?void 0:i.id)})||{inbox:{}}},set(e){this.targetInbox=e.inbox}},showNoInboxAlert(){return this.contact.contactableInboxes?this.inboxes.length===0&&!this.uiFlags.isFetchingInboxes:!1},isSignatureEnabledForInbox(){return this.isAnEmailInbox&&this.sendWithSignature},signatureToggleTooltip(){return this.sendWithSignature?this.$t("CONVERSATION.FOOTER.DISABLE_SIGN_TOOLTIP"):this.$t("CONVERSATION.FOOTER.ENABLE_SIGN_TOOLTIP")},inboxes(){return(this.contact.contactableInboxes||[]).map(t=>({...t.inbox,sourceId:t.source_id}))},isAnEmailInbox(){return this.selectedInbox&&this.selectedInbox.inbox.channel_type===he.EMAIL},isAnWebWidgetInbox(){return this.selectedInbox&&this.selectedInbox.inbox.channel_type===he.WEB},isEmailOrWebWidgetInbox(){return this.isAnEmailInbox||this.isAnWebWidgetInbox},hasWhatsappTemplates(){var e;return!!((e=this.selectedInbox.inbox)!=null&&e.message_templates)},hasAttachments(){return this.attachedFiles.length},inbox(){return this.targetInbox},allowedFileTypes(){return Ze}},watch:{message(e){this.hasSlashCommand=e[0]==="/"&&!this.isEmailOrWebWidgetInbox;const t=e.includes(" ");this.hasSlashCommand&&!t?(this.cannedResponseSearchKey=e.substring(1),this.showCannedResponseMenu=!0):(this.cannedResponseSearchKey="",this.showCannedResponseMenu=!1)},targetInbox(){this.setSignature()}},mounted(){this.setSignature()},methods:{setSignature(){this.messageSignature&&(this.isSignatureEnabledForInbox?this.message=Xe(this.message,this.signatureToApply):this.message=qe(this.message,this.signatureToApply))},setAttachmentPayload(e){this.attachedFiles.forEach(t=>{this.globalConfig.directUploadsEnabled?e.files.push(t.blobSignedId):e.files.push(t.resource.file)})},attachFile({blob:e,file:t}){const a=new FileReader;a.readAsDataURL(t.file),a.onloadend=()=>{this.attachedFiles.push({currentChatId:this.contact.id,resource:e||t,isPrivate:this.isPrivate,thumb:a.result,blobSignedId:e?e.signed_id:void 0})}},removeAttachment(e){this.attachedFiles=e},onCancel(){this.$emit("cancel")},onSuccess(){this.$emit("success")},replaceTextWithCannedResponse(e){this.message=e},toggleCannedMenu(e){this.showCannedMenu=e},prepareWhatsAppMessagePayload({message:e,templateParams:t}){return{inboxId:this.targetInbox.id,sourceId:this.targetInbox.sourceId,contactId:this.contact.id,message:{content:e,template_params:t},assigneeId:this.currentUser.id}},onFormSubmit(){this.v$.$touch(),!this.v$.$invalid&&this.createConversation({payload:this.newMessagePayload,isFromWhatsApp:!1})},async createConversation({payload:e,isFromWhatsApp:t}){try{const a=await this.onSubmit(e,t),o={type:"link",to:`/app/accounts/${a.account_id}/conversations/${a.id}`,message:this.$t("NEW_CONVERSATION.FORM.GO_TO_CONVERSATION")};this.onSuccess(),N(this.$t("NEW_CONVERSATION.FORM.SUCCESS_MESSAGE"),o)}catch(a){a instanceof ve?N(a.data):N(this.$t("NEW_CONVERSATION.FORM.ERROR_MESSAGE"))}},toggleWaTemplate(e){this.whatsappTemplateSelected=e},async onSendWhatsAppReply(e){const a=this.prepareWhatsAppMessagePayload(e);await this.createConversation({payload:a,isFromWhatsApp:!0})},inboxReadableIdentifier(e){return`${e.name} (${e.channel_type})`},computedInboxSource(e){return e.channel_type?rt(e.channel_type,e.phone_number,e):""},toggleMessageSignature(){this.setSignatureFlagForInbox(this.channelType,!this.sendWithSignature),this.setSignature()}}},Uo={key:0,class:"relative mx-0 mt-0 mb-2.5 p-2 rounded-none text-sm border border-solid border-yellow-500 dark:border-yellow-700 bg-yellow-200/60 dark:bg-yellow-200/20 text-slate-700 dark:text-yellow-400"},Do={class:"mb-0"},Fo={key:1},Vo={class:"flex flex-row gap-2"},Bo={class:"w-[50%]"},Wo={key:1},Ho={key:0,class:"message"},jo={class:"w-[50%]"},Go={class:"flex items-center h-[2.4735rem] rounded-sm py-1 px-2 bg-slate-25 dark:bg-slate-900 border border-solid border-slate-75 dark:border-slate-600"},zo={class:"m-0 ml-2 mr-2 text-sm text-slate-700 dark:text-slate-100"},Yo={key:0,class:"w-full"},Xo={class:"w-full"},qo=["placeholder"],Ko={key:0,class:"message"},Zo={class:"w-full"},Jo={class:"w-full"},Qo={class:"relative"},ei={key:0},ti={class:"editor-wrap"},si={key:1,class:"mt-px mb-3"},ai={key:0,class:"editor-warning__message"},ni=["placeholder"],oi={key:0,class:"message"},ii={key:3,class:"flex flex-col"},li={class:"text-xs font-medium text-slate-500 ltr:ml-1 rtl:mr-1 dark:text-slate-400"},ri={key:0,class:"max-h-20 overflow-y-auto mb-4 mt-1.5"},ci={key:2,class:"flex flex-row justify-end w-full gap-2 px-0 py-2"},di={class:"absolute top-0 bottom-0 left-0 right-0 z-30 flex flex-col items-center justify-center w-full h-full gap-2 bg-white/80 dark:bg-slate-700/80"},ui={class:"text-2xl break-words text-slate-600 dark:text-slate-200"};function mi(e,t,a,o,i,s){const d=u("InboxDropdownItem"),h=u("multiselect"),f=u("Thumbnail"),_=u("CannedResponse"),T=u("ReplyEmailHead"),b=u("MessageSignatureMissingAlert"),g=u("woot-button"),I=u("WootMessageEditor"),w=u("WhatsappTemplates"),R=u("FileUpload"),L=u("AttachmentPreview"),G=u("fluent-icon"),K=B("tooltip");return n(),r("form",{class:"w-full conversation--form",onSubmit:t[9]||(t[9]=k((...A)=>s.onFormSubmit&&s.onFormSubmit(...A),["prevent"]))},[s.showNoInboxAlert?(n(),r("div",Uo,[l("p",Do,c(e.$t("NEW_CONVERSATION.NO_INBOX")),1)])):(n(),r("div",Fo,[l("div",Vo,[l("div",Bo,[l("label",null,c(e.$t("NEW_CONVERSATION.FORM.INBOX.LABEL")),1),l("div",{class:y(["multiselect-wrap--small",{"has-multi-select-error":o.v$.targetInbox.$error}])},[m(h,{modelValue:i.targetInbox,"onUpdate:modelValue":t[0]||(t[0]=A=>i.targetInbox=A),"track-by":"id",label:"name",placeholder:e.$t("FORMS.MULTISELECT.SELECT"),"selected-label":"","select-label":"",class:"reset-base","deselect-label":"","max-height":160,"close-on-select":"",options:[...s.inboxes]},{singleLabel:E(({option:A})=>[A.name?(n(),C(d,{key:0,name:A.name,"inbox-identifier":s.computedInboxSource(A),"channel-type":A.channel_type},null,8,["name","inbox-identifier","channel-type"])):(n(),r("span",Wo,c(e.$t("NEW_CONVERSATION.FORM.INBOX.PLACEHOLDER")),1))]),option:E(({option:A})=>[m(d,{name:A.name,"inbox-identifier":s.computedInboxSource(A),"channel-type":A.channel_type},null,8,["name","inbox-identifier","channel-type"])]),_:1},8,["modelValue","placeholder","options"])],2),l("label",{class:y({error:o.v$.targetInbox.$error})},[o.v$.targetInbox.$error?(n(),r("span",Ho,c(e.$t("NEW_CONVERSATION.FORM.INBOX.ERROR")),1)):p("",!0)],2)]),l("div",jo,[l("label",null,[S(c(e.$t("NEW_CONVERSATION.FORM.TO.LABEL"))+" ",1),l("div",Go,[m(f,{src:a.contact.thumbnail,size:"24px",username:a.contact.name,status:a.contact.availability_status},null,8,["src","username","status"]),l("h4",zo,c(a.contact.name),1)])])])]),s.isAnEmailInbox?(n(),r("div",Yo,[l("div",Xo,[l("label",{class:y({error:o.v$.subject.$error})},[S(c(e.$t("NEW_CONVERSATION.FORM.SUBJECT.LABEL"))+" ",1),O(l("input",{"onUpdate:modelValue":t[1]||(t[1]=A=>i.subject=A),type:"text",placeholder:e.$t("NEW_CONVERSATION.FORM.SUBJECT.PLACEHOLDER"),onInput:t[2]||(t[2]=(...A)=>o.v$.subject.$touch&&o.v$.subject.$touch(...A))},null,40,qo),[[V,i.subject]]),o.v$.subject.$error?(n(),r("span",Ko,c(e.$t("NEW_CONVERSATION.FORM.SUBJECT.ERROR")),1)):p("",!0)],2)])])):p("",!0),l("div",Zo,[l("div",Jo,[l("div",Qo,[i.showCannedResponseMenu&&e.hasSlashCommand?(n(),C(_,{key:0,"search-key":i.cannedResponseSearchKey,onReplace:s.replaceTextWithCannedResponse},null,8,["search-key","onReplace"])):p("",!0)]),s.isEmailOrWebWidgetInbox?(n(),r("div",ei,[l("label",null,c(e.$t("NEW_CONVERSATION.FORM.MESSAGE.LABEL")),1),s.isAnEmailInbox?(n(),C(T,{key:0,"cc-emails":i.ccEmails,"onUpdate:ccEmails":t[3]||(t[3]=A=>i.ccEmails=A),"bcc-emails":i.bccEmails,"onUpdate:bccEmails":t[4]||(t[4]=A=>i.bccEmails=A)},null,8,["cc-emails","bcc-emails"])):p("",!0),l("div",ti,[m(I,{modelValue:i.message,"onUpdate:modelValue":t[5]||(t[5]=A=>i.message=A),class:y(["message-editor",{editor_warning:o.v$.message.$error}]),"enable-variables":"",signature:s.signatureToApply,"allow-signature":"",placeholder:e.$t("NEW_CONVERSATION.FORM.MESSAGE.PLACEHOLDER"),onToggleCannedMenu:s.toggleCannedMenu,onBlur:o.v$.message.$touch},{footer:E(()=>[s.isSignatureEnabledForInbox&&!e.messageSignature?(n(),C(b,{key:0,class:"!mx-0 mb-1"})):p("",!0),s.isAnEmailInbox?(n(),r("div",si,[O(m(g,{icon:"signature","color-scheme":"secondary",variant:"smooth",size:"small",title:s.signatureToggleTooltip,onClick:k(s.toggleMessageSignature,["prevent"])},null,8,["title","onClick"]),[[K,s.signatureToggleTooltip,void 0,{"top-end":!0}]])])):p("",!0)]),_:1},8,["modelValue","class","signature","placeholder","onToggleCannedMenu","onBlur"]),o.v$.message.$error?(n(),r("span",ai,c(e.$t("NEW_CONVERSATION.FORM.MESSAGE.ERROR")),1)):p("",!0)])])):s.hasWhatsappTemplates?(n(),C(w,{key:1,"inbox-id":s.selectedInbox.inbox.id,onOnSelectTemplate:s.toggleWaTemplate,onOnSend:s.onSendWhatsAppReply},null,8,["inbox-id","onOnSelectTemplate","onOnSend"])):(n(),r("label",{key:2,class:y({error:o.v$.message.$error})},[S(c(e.$t("NEW_CONVERSATION.FORM.MESSAGE.LABEL"))+" ",1),O(l("textarea",{"onUpdate:modelValue":t[6]||(t[6]=A=>i.message=A),class:"min-h-[5rem]",type:"text",placeholder:e.$t("NEW_CONVERSATION.FORM.MESSAGE.PLACEHOLDER"),onInput:t[7]||(t[7]=(...A)=>o.v$.message.$touch&&o.v$.message.$touch(...A))},null,40,ni),[[V,i.message]]),o.v$.message.$error?(n(),r("span",oi,c(e.$t("NEW_CONVERSATION.FORM.MESSAGE.ERROR")),1)):p("",!0)],2)),s.isEmailOrWebWidgetInbox?(n(),r("div",ii,[m(R,{ref:"uploadAttachment","input-id":"newConversationAttachment",size:4096*4096,accept:s.allowedFileTypes,multiple:"",drop:!0,"drop-directory":!1,data:{direct_upload_url:"/rails/active_storage/direct_uploads",direct_upload:!0},onInputFile:e.onFileUpload},{default:E(()=>[m(g,{"class-names":"button--upload",icon:"attach",emoji:"📎","color-scheme":"secondary",variant:"smooth",size:"small"},{default:E(()=>[S(c(e.$t("NEW_CONVERSATION.FORM.ATTACHMENTS.SELECT")),1)]),_:1}),l("span",li,c(e.$t("NEW_CONVERSATION.FORM.ATTACHMENTS.HELP_TEXT")),1)]),_:1},8,["accept","onInputFile"]),s.hasAttachments?(n(),r("div",ri,[m(L,{class:"[&>.preview-item]:dark:bg-slate-700 flex-row flex-wrap gap-x-3 gap-y-1",attachments:i.attachedFiles,onRemoveAttachment:s.removeAttachment},null,8,["attachments","onRemoveAttachment"])])):p("",!0)])):p("",!0)])])])),s.hasWhatsappTemplates?p("",!0):(n(),r("div",ci,[l("button",{class:"button clear",onClick:t[8]||(t[8]=k((...A)=>s.onCancel&&s.onCancel(...A),["prevent"]))},c(e.$t("NEW_CONVERSATION.FORM.CANCEL")),1),m(g,{type:"submit","is-loading":e.conversationsUiFlags.isCreating},{default:E(()=>[S(c(e.$t("NEW_CONVERSATION.FORM.SUBMIT")),1)]),_:1},8,["is-loading"])])),s.isEmailOrWebWidgetInbox?(n(),C(We,{key:3,name:"modal-fade"},{default:E(()=>[O(l("div",di,[m(G,{icon:"cloud-backup",size:"40"}),l("h4",ui,c(e.$t("CONVERSATION.REPLYBOX.DRAG_DROP")),1)],512),[[Ce,o.uploadAttachment&&o.uploadAttachment.dropActive]])]),_:1})):p("",!0)],32)}const hi=v(Po,[["render",mi],["__scopeId","data-v-f3f51ab4"]]),pi={components:{ConversationForm:hi},props:{show:{type:Boolean,default:!1},contact:{type:Object,default:()=>({})}},emits:["cancel","update:show"],computed:{localShow:{get(){return this.show},set(e){this.$emit("update:show",e)}}},watch:{"contact.id"(e){this.$store.dispatch("contacts/fetchContactableInbox",e)}},mounted(){const{id:e}=this.contact;this.$store.dispatch("contacts/fetchContactableInbox",e)},methods:{onCancel(){this.$emit("cancel")},onSuccess(){this.$emit("cancel")},async onSubmit(e,t){return await this.$store.dispatch("contactConversations/create",{params:e,isFromWhatsApp:t})}}},_i={class:"flex flex-col h-auto overflow-auto"};function bi(e,t,a,o,i,s){const d=u("woot-modal-header"),h=u("ConversationForm"),f=u("woot-modal");return n(),C(f,{show:s.localShow,"onUpdate:show":t[0]||(t[0]=_=>s.localShow=_),"on-close":s.onCancel},{default:E(()=>[l("div",_i,[m(d,{"header-title":e.$t("NEW_CONVERSATION.TITLE"),"header-content":e.$t("NEW_CONVERSATION.DESC")},null,8,["header-title","header-content"]),m(h,{contact:a.contact,"on-submit":s.onSubmit,onSuccess:s.onSuccess,onCancel:s.onCancel},null,8,["contact","on-submit","onSuccess","onCancel"])])]),_:1},8,["show","on-close"])}const fi=v(pi,[["render",bi]]),gi={props:{primaryContactName:{type:String,default:""},parentContactName:{type:String,default:""}}},Ci={key:0,class:"my-4 relative p-2.5 border rounded-[4px] text-slate-800 dark:text-slate-100 border-slate-100 dark:border-slate-700 bg-white dark:bg-slate-800"},Ti={class:"text-base font-medium text-slate-900 dark:text-white"},Ei={class:"ml-0 list-none"};function Ai(e,t,a,o,i,s){const d=B("dompurify-html");return a.parentContactName?(n(),r("div",Ci,[l("h5",Ti,c(e.$t("MERGE_CONTACTS.SUMMARY.TITLE")),1),l("ul",Ei,[l("li",null,[t[0]||(t[0]=l("span",{class:"inline-block mr-1"},"❌",-1)),O(l("span",null,null,512),[[d,e.$t("MERGE_CONTACTS.SUMMARY.DELETE_WARNING",{primaryContactName:a.primaryContactName})]])]),l("li",null,[t[1]||(t[1]=l("span",{class:"inline-block mr-1"},"✅",-1)),O(l("span",null,null,512),[[d,e.$t("MERGE_CONTACTS.SUMMARY.ATTRIBUTE_WARNING",{primaryContactName:a.primaryContactName,parentContactName:a.parentContactName})]])])])])):p("",!0)}const vi=v(gi,[["render",Ai]]),yi={components:{Thumbnail:q},props:{name:{type:String,default:""},thumbnail:{type:String,default:""},email:{type:String,default:""},phoneNumber:{type:String,default:""},identifier:{type:[String,Number],required:!0}}},Si={class:"option-item--user"},Oi={class:"option__user-data"},Ni={class:"option__title"},wi={key:0,class:"user-identifier"},Ii={class:"option__body"},xi={key:0,class:"email-icon-wrap"},Mi={key:1,class:"phone-icon-wrap"},ki={key:2};function Ri(e,t,a,o,i,s){const d=u("Thumbnail"),h=u("fluent-icon");return n(),r("div",Si,[m(d,{src:a.thumbnail,size:"28px",username:a.name},null,8,["src","username"]),l("div",Oi,[l("h5",Ni,[S(c(a.name)+" ",1),a.identifier?(n(),r("span",wi,c(e.$t("MERGE_CONTACTS.DROPDOWN_ITEM.ID",{identifier:a.identifier})),1)):p("",!0)]),l("p",Ii,[a.email?(n(),r("span",xi,[m(h,{class:"merge-contact--icon",icon:"mail",size:"12"}),S(" "+c(a.email),1)])):p("",!0),a.phoneNumber?(n(),r("span",Mi,[m(h,{class:"merge-contact--icon",icon:"call",size:"12"}),S(" "+c(a.phoneNumber),1)])):p("",!0),!a.phoneNumber&&!a.email?(n(),r("span",ki,c("---"))):p("",!0)])])])}const Li=v(yi,[["render",Ri],["__scopeId","data-v-3bcd22e2"]]),$i={components:{MergeContactSummary:vi,ContactDropdownItem:Li},props:{primaryContact:{type:Object,required:!0},isSearching:{type:Boolean,default:!1},isMerging:{type:Boolean,default:!1},searchResults:{type:Array,default:()=>[]}},emits:["search","submit","cancel"],setup(){return{v$:Y()}},validations:{primaryContact:{required:j},parentContact:{required:j}},data(){return{parentContact:void 0}},computed:{parentContactName(){return this.parentContact?this.parentContact.name:""}},methods:{searchChange(e){this.$emit("search",e)},onSubmit(){this.v$.$touch(),!this.v$.$invalid&&this.$emit("submit",this.parentContact.id)},onCancel(){this.$emit("cancel")}}},Pi={class:"multiselect__label"},Ui={key:0,class:"message"},Di={class:"flex multiselect-wrap--medium"},Fi={class:"w-8 relative text-base text-slate-100 dark:text-slate-600 after:content-[''] after:h-12 after:w-0 after:left-4 after:absolute after:border-l after:border-solid after:border-slate-100 after:dark:border-slate-600 before:content-[''] before:h-0 before:w-4 before:left-4 before:top-12 before:absolute before:border-b before:border-solid before:border-slate-100 before:dark:border-slate-600"},Vi={class:"flex flex-col w-full"},Bi={class:"multiselect__label"},Wi={class:"flex justify-end gap-2 mt-6"};function Hi(e,t,a,o,i,s){const d=u("woot-label"),h=u("ContactDropdownItem"),f=u("multiselect"),_=u("fluent-icon"),T=u("MergeContactSummary"),b=u("woot-button");return n(),r("form",{onSubmit:t[1]||(t[1]=k((...g)=>s.onSubmit&&s.onSubmit(...g),["prevent"]))},[l("div",null,[l("div",null,[l("div",{class:y(["mt-1 multiselect-wrap--medium",{error:o.v$.parentContact.$error}])},[l("label",Pi,[S(c(e.$t("MERGE_CONTACTS.PARENT.TITLE"))+" ",1),m(d,{title:e.$t("MERGE_CONTACTS.PARENT.HELP_LABEL"),"color-scheme":"success",small:"",class:"ml-2"},null,8,["title"])]),m(f,{modelValue:i.parentContact,"onUpdate:modelValue":t[0]||(t[0]=g=>i.parentContact=g),options:a.searchResults,label:"name","track-by":"id","internal-search":!1,"clear-on-select":!1,"show-labels":!1,placeholder:e.$t("MERGE_CONTACTS.PARENT.PLACEHOLDER"),"allow-empty":"",loading:a.isSearching,"max-height":150,"open-direction":"top",onSearchChange:s.searchChange},{singleLabel:E(g=>[m(h,{thumbnail:g.option.thumbnail,identifier:g.option.id,name:g.option.name,email:g.option.email,"phone-number":g.option.phone_number},null,8,["thumbnail","identifier","name","email","phone-number"])]),option:E(g=>[m(h,{thumbnail:g.option.thumbnail,identifier:g.option.id,name:g.option.name,email:g.option.email,"phone-number":g.option.phone_number},null,8,["thumbnail","identifier","name","email","phone-number"])]),noResult:E(()=>[l("span",null,c(e.$t("AGENT_MGMT.SEARCH.NO_RESULTS")),1)]),_:1},8,["modelValue","options","placeholder","loading","onSearchChange"]),o.v$.parentContact.$error?(n(),r("span",Ui,c(e.$t("MERGE_CONTACTS.FORM.CHILD_CONTACT.ERROR")),1)):p("",!0)],2)]),l("div",Di,[l("div",Fi,[m(_,{icon:"arrow-up",class:"absolute -top-1 left-2",size:"17"})]),l("div",Vi,[l("label",Bi,[S(c(e.$t("MERGE_CONTACTS.PRIMARY.TITLE"))+" ",1),m(d,{title:e.$t("MERGE_CONTACTS.PRIMARY.HELP_LABEL"),"color-scheme":"alert",small:"",class:"ml-2"},null,8,["title"])]),m(f,{"model-value":a.primaryContact,disabled:"",options:[],"show-labels":!1,label:"name","track-by":"id"},{singleLabel:E(g=>[m(h,{thumbnail:g.option.thumbnail,name:g.option.name,identifier:g.option.id,email:g.option.email,"phone-number":g.option.phoneNumber},null,8,["thumbnail","name","identifier","email","phone-number"])]),_:1},8,["model-value"])])])]),m(T,{"primary-contact-name":a.primaryContact.name,"parent-contact-name":s.parentContactName},null,8,["primary-contact-name","parent-contact-name"]),l("div",Wi,[m(b,{variant:"clear",onClick:k(s.onCancel,["prevent"])},{default:E(()=>[S(c(e.$t("MERGE_CONTACTS.FORM.CANCEL")),1)]),_:1},8,["onClick"]),m(b,{type:"submit","is-loading":a.isMerging},{default:E(()=>[S(c(e.$t("MERGE_CONTACTS.FORM.SUBMIT")),1)]),_:1},8,["is-loading"])])],32)}const ji=v($i,[["render",Hi],["__scopeId","data-v-f0dbae77"]]),Gi={components:{MergeContact:ji},props:{show:{type:Boolean,default:!1},primaryContact:{type:Object,required:!0}},emits:["close","update:show"],data(){return{isSearching:!1,searchResults:[]}},computed:{...W({uiFlags:"contacts/getUIFlags"}),localShow:{get(){return this.show},set(e){this.$emit("update:show",e)}}},methods:{onClose(){this.$emit("close")},async onContactSearch(e){this.isSearching=!0,this.searchResults=[];try{const{data:{payload:t}}=await ct.search(e);this.searchResults=t.filter(a=>a.id!==this.primaryContact.id)}catch{N(this.$t("MERGE_CONTACTS.SEARCH.ERROR_MESSAGE"))}finally{this.isSearching=!1}},async onMergeContacts(e){Nt(dt.MERGED_CONTACTS);try{await this.$store.dispatch("contacts/merge",{childId:this.primaryContact.id,parentId:e}),N(this.$t("MERGE_CONTACTS.FORM.SUCCESS_MESSAGE")),this.onClose()}catch{N(this.$t("MERGE_CONTACTS.FORM.ERROR_MESSAGE"))}}}};function zi(e,t,a,o,i,s){const d=u("woot-modal-header"),h=u("MergeContact"),f=u("woot-modal");return n(),C(f,{show:s.localShow,"onUpdate:show":t[0]||(t[0]=_=>s.localShow=_),"on-close":s.onClose},{default:E(()=>[m(d,{"header-title":e.$t("MERGE_CONTACTS.TITLE"),"header-content":e.$t("MERGE_CONTACTS.DESCRIPTION")},null,8,["header-title","header-content"]),m(h,{"primary-contact":a.primaryContact,"is-searching":i.isSearching,"is-merging":e.uiFlags.isMerging,"search-results":i.searchResults,onSearch:s.onContactSearch,onCancel:s.onClose,onSubmit:s.onMergeContacts},null,8,["primary-contact","is-searching","is-merging","search-results","onSearch","onCancel","onSubmit"])]),_:1},8,["show","on-close"])}const Yi=v(Gi,[["render",zi]]),Xi=127397,qi=e=>{const t=e.toUpperCase().split("").map(a=>Xi+a.charCodeAt());return String.fromCodePoint(...t)},Ki={components:{ContactInfoRow:za,EditContact:En,Thumbnail:q,SocialIcons:Za,NewConversation:fi,ContactMergeModal:Yi},props:{contact:{type:Object,default:()=>({})},showAvatar:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},closeIconName:{type:String,default:"chevron-right"}},emits:["togglePanel","panelClose"],setup(){const{isAdmin:e}=ut();return{isAdmin:e}},data(){return{showEditModal:!1,showConversationModal:!1,showMergeModal:!1,showDeleteModal:!1}},computed:{...W({uiFlags:"contacts/getUIFlags"}),contactProfileLink(){return`/app/accounts/${this.$route.params.accountId}/contacts/${this.contact.id}`},additionalAttributes(){return this.contact.additional_attributes||{}},location(){const{country:e="",city:t="",country_code:a}=this.additionalAttributes,o=[t,e].filter(i=>!!i).join(", ");return o?this.findCountryFlag(a,o):""},socialProfiles(){const{social_profiles:e,screen_name:t,social_telegram_user_name:a}=this.additionalAttributes;return{twitter:t,telegram:a,...e||{}}},confirmDeleteMessage(){return` ${this.contact.name}?`}},methods:{dynamicTime:H,toggleEditModal(){this.showEditModal=!this.showEditModal},onPanelToggle(){this.$emit("togglePanel")},toggleConversationModal(){this.showConversationModal=!this.showConversationModal,ne.emit(oe.NEW_CONVERSATION_MODAL,this.showConversationModal)},toggleDeleteModal(){this.showDeleteModal=!this.showDeleteModal},confirmDeletion(){this.deleteContact(this.contact),this.closeDelete()},closeDelete(){this.showDeleteModal=!1,this.showConversationModal=!1,this.showEditModal=!1},findCountryFlag(e,t){try{const a=e?qi(e):"🌎";return`${t} ${a}`}catch{return""}},async deleteContact({id:e}){try{await this.$store.dispatch("contacts/delete",e),this.$emit("panelClose"),N(this.$t("DELETE_CONTACT.API.SUCCESS_MESSAGE")),mt(this.$route.name)?this.$router.push({name:ht(this.$route.name)}):pt(this.$route.name)?this.$router.push({name:"inbox_view"}):this.$route.name!=="contacts_dashboard"&&this.$router.push({name:"contacts_dashboard"})}catch(t){N(t.message?t.message:this.$t("DELETE_CONTACT.API.ERROR_MESSAGE"))}},closeMergeModal(){this.showMergeModal=!1},openMergeModal(){this.showMergeModal=!0}}},Zi={class:"relative items-center w-full p-4 bg-white dark:bg-slate-900"},Ji={class:"flex flex-col w-full gap-2 text-left rtl:text-right"},Qi={class:"flex flex-row justify-between"},el={class:"flex flex-col items-start gap-1.5 min-w-0 w-full"},tl={key:0,class:"flex items-start w-full min-w-0 gap-2"},sl={class:"flex-shrink max-w-full min-w-0 my-0 text-base capitalize break-words text-slate-800 dark:text-slate-100"},al={class:"flex flex-row items-center gap-1"},nl=["href"],ol={key:1,class:"break-words mb-0.5"},il={class:"flex flex-col items-start w-full gap-2"},ll={class:"flex items-center w-full mt-0.5 gap-2"};function rl(e,t,a,o,i,s){const d=u("Thumbnail"),h=u("woot-button"),f=u("fluent-icon"),_=u("ContactInfoRow"),T=u("SocialIcons"),b=u("EditContact"),g=u("NewConversation"),I=u("ContactMergeModal"),w=u("woot-delete-modal"),R=B("tooltip");return n(),r("div",Zi,[l("div",Ji,[l("div",Qi,[a.showAvatar?(n(),C(d,{key:0,src:a.contact.thumbnail,size:"56px",username:a.contact.name,status:a.contact.availability_status},null,8,["src","username","status"])):p("",!0),a.showCloseButton?(n(),C(h,{key:1,icon:a.closeIconName,class:"clear secondary rtl:rotate-180",onClick:s.onPanelToggle},null,8,["icon","onClick"])):p("",!0)]),l("div",el,[a.showAvatar?(n(),r("div",tl,[l("h3",sl,c(a.contact.name),1),l("div",al,[a.contact.created_at?O((n(),C(f,{key:0,icon:"info",size:"14",class:"mt-0.5"},null,512)),[[R,`${e.$t("CONTACT_PANEL.CREATED_AT_LABEL")} ${s.dynamicTime(a.contact.created_at)}`,void 0,{left:!0}]]):p("",!0),l("a",{href:s.contactProfileLink,class:"text-base",target:"_blank",rel:"noopener nofollow noreferrer"},[m(h,{size:"tiny",icon:"open",variant:"clear","color-scheme":"secondary"})],8,nl)])])):p("",!0),s.additionalAttributes.description?(n(),r("p",ol,c(s.additionalAttributes.description),1)):p("",!0),l("div",il,[m(_,{href:a.contact.email?`mailto:${a.contact.email}`:"",value:a.contact.email,icon:"mail",emoji:"✉️",title:e.$t("CONTACT_PANEL.EMAIL_ADDRESS"),"show-copy":""},null,8,["href","value","title"]),m(_,{href:a.contact.phone_number?`tel:${a.contact.phone_number}`:"",value:a.contact.phone_number,icon:"call",emoji:"📞",title:e.$t("CONTACT_PANEL.PHONE_NUMBER"),"show-copy":""},null,8,["href","value","title"]),a.contact.identifier?(n(),C(_,{key:0,value:a.contact.identifier,icon:"contact-identify",emoji:"🪪",title:e.$t("CONTACT_PANEL.IDENTIFIER")},null,8,["value","title"])):p("",!0),m(_,{value:s.additionalAttributes.company_name,icon:"building-bank",emoji:"🏢",title:e.$t("CONTACT_PANEL.COMPANY")},null,8,["value","title"]),s.location||s.additionalAttributes.location?(n(),C(_,{key:1,value:s.location||s.additionalAttributes.location,icon:"map",emoji:"🌍",title:e.$t("CONTACT_PANEL.LOCATION")},null,8,["value","title"])):p("",!0),m(T,{"social-profiles":s.socialProfiles},null,8,["social-profiles"])])]),l("div",ll,[O(m(h,{title:e.$t("CONTACT_PANEL.NEW_MESSAGE"),icon:"chat",size:"small",onClick:s.toggleConversationModal},null,8,["title","onClick"]),[[R,e.$t("CONTACT_PANEL.NEW_MESSAGE")]]),O(m(h,{title:e.$t("EDIT_CONTACT.BUTTON_LABEL"),icon:"edit",variant:"smooth",size:"small",onClick:s.toggleEditModal},null,8,["title","onClick"]),[[R,e.$t("EDIT_CONTACT.BUTTON_LABEL")]]),O(m(h,{title:e.$t("CONTACT_PANEL.MERGE_CONTACT"),icon:"merge",variant:"smooth",size:"small","color-scheme":"secondary",disabled:e.uiFlags.isMerging,onClick:s.openMergeModal},null,8,["title","disabled","onClick"]),[[R,e.$t("CONTACT_PANEL.MERGE_CONTACT")]]),o.isAdmin?O((n(),C(h,{key:0,title:e.$t("DELETE_CONTACT.BUTTON_LABEL"),icon:"delete",variant:"smooth",size:"small","color-scheme":"alert",disabled:e.uiFlags.isDeleting,onClick:s.toggleDeleteModal},null,8,["title","disabled","onClick"])),[[R,e.$t("DELETE_CONTACT.BUTTON_LABEL")]]):p("",!0)]),i.showEditModal?(n(),C(b,{key:0,show:i.showEditModal,contact:a.contact,onCancel:s.toggleEditModal},null,8,["show","contact","onCancel"])):p("",!0),a.contact.id?(n(),C(g,{key:1,show:i.showConversationModal,contact:a.contact,onCancel:s.toggleConversationModal},null,8,["show","contact","onCancel"])):p("",!0),i.showMergeModal?(n(),C(I,{key:2,"primary-contact":a.contact,show:i.showMergeModal,onClose:s.closeMergeModal},null,8,["primary-contact","show","onClose"])):p("",!0)]),i.showDeleteModal?(n(),C(w,{key:0,show:i.showDeleteModal,"onUpdate:show":t[0]||(t[0]=L=>i.showDeleteModal=L),"on-close":s.closeDelete,"on-confirm":s.confirmDeletion,title:e.$t("DELETE_CONTACT.CONFIRM.TITLE"),message:e.$t("DELETE_CONTACT.CONFIRM.MESSAGE"),"message-value":s.confirmDeleteMessage,"confirm-text":e.$t("DELETE_CONTACT.CONFIRM.YES"),"reject-text":e.$t("DELETE_CONTACT.CONFIRM.NO")},null,8,["show","on-close","on-confirm","title","message","message-value","confirm-text","reject-text"])):p("",!0)])}const dr=v(Ki,[["render",rl]]),cl={class:"relative group w-[inherit] whitespace-normal z-20"},dl={class:"bg-white dark:bg-slate-900 w-fit ltr:left-4 rtl:right-4 top-0 border p-2.5 group-hover:flex items-center hidden absolute border-slate-75 dark:border-slate-800 rounded-lg shadow-md"},ul={class:"text-slate-800 dark:text-slate-75 mb-0 text-xs"},ml={__name:"HelperTextPopup",props:{message:{type:String,default:""}},setup(e){return(t,a)=>{const o=u("fluent-icon");return n(),r("div",cl,[m(o,{icon:"info",size:"14",class:"mt-0.5 text-slate-600 absolute dark:text-slate-400"}),l("div",dl,[l("p",ul,c(e.message),1)])])}}},hl="yyyy-MM-dd",pl={components:{MultiselectDropdown:Ut,HelperTextPopup:ml},props:{label:{type:String,required:!0},description:{type:String,default:""},values:{type:Array,default:()=>[]},value:{type:[String,Number,Boolean],default:""},showActions:{type:Boolean,default:!1},attributeType:{type:String,default:"text"},attributeRegex:{type:String,default:null},regexCue:{type:String,default:null},attributeKey:{type:String,required:!0},contactId:{type:Number,default:null}},emits:["update","delete","copy"],setup(){return{v$:Y()}},data(){return{isEditing:!1,editedValue:null}},computed:{displayValue(){return this.isAttributeTypeDate?this.value?new Date(this.value||new Date).toLocaleDateString():"":this.isAttributeTypeCheckbox?this.value==="false"?!1:this.value:this.value},formattedValue(){return this.isAttributeTypeDate?Lt(this.value?new Date(this.value):new Date,hl):this.value},listOptions(){return this.values.map((e,t)=>({id:t+1,name:e}))},selectedItem(){return{id:this.values.indexOf(this.editedValue)+1,name:this.editedValue}},isAttributeTypeCheckbox(){return this.attributeType==="checkbox"},isAttributeTypeList(){return this.attributeType==="list"},isAttributeTypeLink(){return this.attributeType==="link"},isAttributeTypeDate(){return this.attributeType==="date"},urlValue(){return pe(this.value)?this.value:"---"},hrefURL(){return pe(this.value)?this.value:""},notAttributeTypeCheckboxAndList(){return!this.isAttributeTypeCheckbox&&!this.isAttributeTypeList},inputType(){return this.isAttributeTypeLink?"url":this.attributeType},shouldShowErrorMessage(){return this.v$.editedValue.$error},errorMessage(){return this.v$.editedValue.url?this.$t("CUSTOM_ATTRIBUTES.VALIDATIONS.INVALID_URL"):this.v$.editedValue.regexValidation?this.$t("CUSTOM_ATTRIBUTES.VALIDATIONS.REQUIRED"):this.regexCue?this.regexCue:this.$t("CUSTOM_ATTRIBUTES.VALIDATIONS.INVALID_INPUT")}},watch:{value(){this.isEditing=!1,this.editedValue=this.formattedValue},contactId(){this.v$.$reset()}},validations(){return this.isAttributeTypeLink?{editedValue:{required:j,url:wt}}:{editedValue:{required:j,regexValidation:e=>!(this.attributeRegex&&!xt(this.attributeRegex).test(e))}}},mounted(){this.editedValue=this.formattedValue,ne.on(oe.FOCUS_CUSTOM_ATTRIBUTE,this.onFocusAttribute)},unmounted(){ne.off(oe.FOCUS_CUSTOM_ATTRIBUTE,this.onFocusAttribute)},methods:{onFocusAttribute(e){this.attributeKey===e&&this.onEdit()},focusInput(){this.$refs.inputfield&&this.$refs.inputfield.focus()},onClickAway(){this.v$.$reset(),this.isEditing=!1},onEdit(){this.isEditing=!0,this.$nextTick(()=>{this.focusInput()})},onUpdateListValue(e){e&&(this.editedValue=e.name,this.onUpdate())},onUpdate(){const e=this.attributeType==="date"?jt(this.editedValue):this.editedValue;this.v$.$touch(),!this.v$.$invalid&&(this.isEditing=!1,this.$emit("update",this.attributeKey,e))},onDelete(){this.isEditing=!1,this.v$.$reset(),this.$emit("delete",this.attributeKey)},onCopy(){this.$emit("copy",this.value)}}},_l={class:"px-4 py-3"},bl={class:"flex items-center mb-1"},fl={class:"flex items-center w-full m-0 text-sm error"},gl={key:0,class:"flex items-center"},Cl={class:"flex items-center justify-between w-full"},Tl={key:0},El={key:0},Al={class:"flex items-center w-full mb-2"},vl=["type"],yl={key:0,class:"block w-full -mt-px text-sm font-normal text-red-400 dark:text-red-500"},Sl=["href"],Ol={key:1,class:"group-hover:bg-slate-50 group-hover:dark:bg-slate-700 inline-block rounded-sm mb-0 break-all py-0.5 px-1"},Nl={class:"flex max-w-[2rem] gap-1 ml-1 rtl:mr-1 rtl:ml-0"},wl={key:1};function Il(e,t,a,o,i,s){const d=u("HelperTextPopup"),h=u("woot-button"),f=u("MultiselectDropdown"),_=B("tooltip"),T=B("on-clickaway");return n(),r("div",_l,[l("div",bl,[l("h4",fl,[s.isAttributeTypeCheckbox?(n(),r("div",gl,[O(l("input",{"onUpdate:modelValue":t[0]||(t[0]=b=>i.editedValue=b),class:"!my-0 mr-2 ml-0",type:"checkbox",onChange:t[1]||(t[1]=(...b)=>s.onUpdate&&s.onUpdate(...b))},null,544),[[He,i.editedValue]])])):p("",!0),l("div",Cl,[l("span",{class:y(["w-full inline-flex gap-1.5 items-start font-medium whitespace-nowrap text-sm mb-0",o.v$.editedValue.$error?"text-red-400 dark:text-red-500":"text-slate-800 dark:text-slate-100"])},[S(c(a.label)+" ",1),a.description?(n(),C(d,{key:0,message:a.description,class:"mt-0.5"},null,8,["message"])):p("",!0)],2),a.showActions&&a.value?O((n(),C(h,{key:0,variant:"link",size:"medium","color-scheme":"secondary",icon:"delete","class-names":"flex justify-end w-4",onClick:s.onDelete},null,8,["onClick"])),[[_,e.$t("CUSTOM_ATTRIBUTES.ACTIONS.DELETE"),void 0,{left:!0}]]):p("",!0)])])]),s.notAttributeTypeCheckboxAndList?(n(),r("div",Tl,[i.isEditing?O((n(),r("div",El,[l("div",Al,[O(l("input",{ref:"inputfield","onUpdate:modelValue":t[2]||(t[2]=b=>i.editedValue=b),type:s.inputType,class:y(["!h-8 ltr:!rounded-r-none rtl:!rounded-l-none !mb-0 !text-sm",{error:o.v$.editedValue.$error}]),autofocus:"true",onBlur:t[3]||(t[3]=(...b)=>o.v$.editedValue.$touch&&o.v$.editedValue.$touch(...b)),onKeyup:t[4]||(t[4]=je((...b)=>s.onUpdate&&s.onUpdate(...b),["enter"]))},null,42,vl),[[Ge,i.editedValue]]),l("div",null,[m(h,{size:"small",icon:"checkmark",class:"rounded-l-none rtl:rounded-r-none",onClick:s.onUpdate},null,8,["onClick"])])]),s.shouldShowErrorMessage?(n(),r("span",yl,c(s.errorMessage),1)):p("",!0)])),[[T,s.onClickAway]]):p("",!0),O(l("div",{class:y(["flex group",{"is-editable":a.showActions}])},[s.isAttributeTypeLink?(n(),r("a",{key:0,href:s.hrefURL,target:"_blank",rel:"noopener noreferrer",class:"group-hover:bg-slate-50 group-hover:dark:bg-slate-700 inline-block rounded-sm mb-0 break-all py-0.5 px-1"},c(s.urlValue),9,Sl)):(n(),r("p",Ol,c(s.displayValue||"---"),1)),l("div",Nl,[a.showActions&&a.value?O((n(),C(h,{key:0,variant:"link",size:"small","color-scheme":"secondary",icon:"clipboard","class-names":"hidden group-hover:flex !w-6 flex-shrink-0",onClick:s.onCopy},null,8,["onClick"])),[[_,e.$t("CUSTOM_ATTRIBUTES.ACTIONS.COPY")]]):p("",!0),a.showActions?O((n(),C(h,{key:1,variant:"link",size:"small","color-scheme":"secondary",icon:"edit","class-names":"hidden group-hover:flex !w-6 flex-shrink-0",onClick:s.onEdit},null,8,["onClick"])),[[_,e.$t("CUSTOM_ATTRIBUTES.ACTIONS.EDIT"),void 0,{right:!0}]]):p("",!0)])],2),[[Ce,!i.isEditing]])])):p("",!0),s.isAttributeTypeList?(n(),r("div",wl,[m(f,{options:s.listOptions,"selected-item":s.selectedItem,"has-thumbnail":!1,"multiselector-placeholder":e.$t("CUSTOM_ATTRIBUTES.FORM.ATTRIBUTE_TYPE.LIST.PLACEHOLDER"),"no-search-result":e.$t("CUSTOM_ATTRIBUTES.FORM.ATTRIBUTE_TYPE.LIST.NO_RESULT"),"input-placeholder":e.$t("CUSTOM_ATTRIBUTES.FORM.ATTRIBUTE_TYPE.LIST.SEARCH_INPUT_PLACEHOLDER"),onSelect:s.onUpdateListValue},null,8,["options","selected-item","multiselector-placeholder","no-search-result","input-placeholder","onSelect"])])):p("",!0)])}const xl=v(pl,[["render",Il],["__scopeId","data-v-66ce8384"]]),Ml={key:0,class:"p-3 text-center"},kl={key:1,class:"flex px-2 py-2"},ur={__name:"CustomAttributes",props:{attributeType:{type:String,default:"conversation_attribute"},contactId:{type:Number,default:null},attributeFrom:{type:String,required:!0},emptyStateMessage:{type:String,default:""},startAt:{type:String,default:"even",validator:e=>e==="even"||e==="odd"}},setup(e){const t=e,a=$t(),o=Pt(),i=Rt(),{t:s}=Je(),{uiSettings:d,updateUISettings:h}=ye(),[f,_]=_t(!1),T=M(()=>o.getSelectedChat.value),b=M(()=>o["attributes/getAttributesByModel"].value(t.attributeType)),g=M(()=>{var $,D;return((D=($=T.value.meta)==null?void 0:$.sender)==null?void 0:D.id)||i.params.contactId||t.contactId}),I=M(()=>o["contacts/getContact"].value(g.value)),w=M(()=>t.attributeType==="conversation_attribute"?T.value.custom_attributes||{}:I.value.custom_attributes||{}),R=M(()=>T.value.id),L=M(()=>f.value?s("CUSTOM_ATTRIBUTES.SHOW_LESS"):s("CUSTOM_ATTRIBUTES.SHOW_MORE")),G=M(()=>b.value.map($=>{const D=Object.hasOwnProperty.call(w.value,$.attribute_key),x=$.attribute_display_type==="checkbox"?!1:"";return{...$,value:D?w.value[$.attribute_key]:x}})),K=M(()=>f.value||G.value.length<=5?G.value:G.value.slice(0,5)),A=M(()=>`show_all_attributes_${t.attributeFrom}`),ke=()=>{f.value=d.value[A.value]||!1},Re=()=>{_(),h({[A.value]:f.value})},Le=async($,D)=>{var x;const F={...w.value,[$]:D};try{t.attributeType==="conversation_attribute"?await a.dispatch("updateCustomAttributes",{conversationId:R.value,customAttributes:F}):a.dispatch("contacts/update",{id:t.contactId,custom_attributes:F}),N(s("CUSTOM_ATTRIBUTES.FORM.UPDATE.SUCCESS"))}catch(Q){const Ve=((x=Q==null?void 0:Q.response)==null?void 0:x.message)||s("CUSTOM_ATTRIBUTES.FORM.UPDATE.ERROR");N(Ve)}},$e=async $=>{var D;try{const{[$]:F,...x}=w.value;t.attributeType==="conversation_attribute"?await a.dispatch("updateCustomAttributes",{conversationId:R.value,customAttributes:x}):a.dispatch("contacts/deleteCustomAttributes",{id:t.contactId,customAttributes:[$]}),N(s("CUSTOM_ATTRIBUTES.FORM.DELETE.SUCCESS"))}catch(F){const x=((D=F==null?void 0:F.response)==null?void 0:D.message)||s("CUSTOM_ATTRIBUTES.FORM.DELETE.ERROR");N(x)}},Pe=async $=>{await Ae($),N(s("CUSTOM_ATTRIBUTES.COPY_SUCCESSFUL"))};ge(()=>{ke()});const Ue=["[&>*:nth-child(odd)]:!bg-white [&>*:nth-child(even)]:!bg-slate-25","dark:[&>*:nth-child(odd)]:!bg-slate-900 dark:[&>*:nth-child(even)]:!bg-slate-800/50"],De=["[&>*:nth-child(odd)]:!bg-slate-25 [&>*:nth-child(even)]:!bg-white","dark:[&>*:nth-child(odd)]:!bg-slate-800/50 dark:[&>*:nth-child(even)]:!bg-slate-900"],Fe=M(()=>t.startAt==="even"?Ue:De);return($,D)=>{const F=u("woot-button");return n(),r("div",{class:y(Fe.value)},[(n(!0),r(P,null,U(K.value,x=>(n(),C(xl,{key:x.id,"attribute-key":x.attribute_key,"attribute-type":x.attribute_display_type,values:x.attribute_values,label:x.attribute_display_name,description:x.attribute_description,value:x.value,"show-actions":"","attribute-regex":x.regex_pattern,"regex-cue":x.regex_cue,"contact-id":e.contactId,class:"border-b border-solid border-slate-50 dark:border-slate-700/50",onUpdate:Le,onDelete:$e,onCopy:Pe},null,8,["attribute-key","attribute-type","values","label","description","value","attribute-regex","regex-cue","contact-id"]))),128)),!K.value.length&&e.emptyStateMessage?(n(),r("p",Ml,c(e.emptyStateMessage),1)):p("",!0),G.value.length>5?(n(),r("div",kl,[m(F,{size:"small",icon:ze(f)?"chevron-up":"chevron-down",variant:"clear","color-scheme":"primary",class:"!px-2 hover:!bg-transparent dark:hover:!bg-transparent",onClick:Re},{default:E(()=>[S(c(L.value),1)]),_:1},8,["icon"])])):p("",!0)],2)}}};export{cr as A,ta as C,rr as L,ms as M,oo as R,Ws as S,vo as T,ir as _,fn as a,lr as b,dr as c,ur as d,Mo as e,kn as f,qi as g,Gn as h,An as i,fs as j,ar as k,nr as l,or as m};
