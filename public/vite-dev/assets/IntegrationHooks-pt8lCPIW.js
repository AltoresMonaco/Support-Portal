import{ai as H}from"./dashboard-CGLIihvy.js";import{m as x}from"./globalConfig-DaGjiImb.js";import{u as O}from"./index-BaHWIRRA.js";import{c as f,_ as A,u as g,o as i,n as r,e as u,l as _,F as b,i as E,a as P,C as D,k as p,p as a,m as k,t as c,f as v,H as S,g as C}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{v as M,F as R}from"./mutationHelpers-3VTcoJiD.js";import"./axios-CCb-kr4I.js";import"./_commonjsHelpers-BosuxZz1.js";import"./globalConfigMixin-BNbqaRx5.js";import"./timeHelper-BT38nsET.js";import"./Spinner-B-aSVz3z.js";import"./Thumbnail-DLjRBBx8.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./exports-CsC-x4VI.js";import"./vue-router-CNCrM2WK.js";import"./index-BP-sUqpX.js";import"./index-C2DForDf.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./DashboardIcon-CPXNa31t.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./index-Y4OjWrJ-.js";import"./Icon-Dtj3LCzD.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";import"./index-DaWXXnfb.js";const N=e=>{const t=M("integrations/getIntegration"),o=f(()=>t.value(e)),n=f(()=>o.value.hook_type==="inbox"),d=f(()=>!!o.value.hooks.length),s=f(()=>o.value.allow_multiple_hooks?"multiple":"single"),h=f(()=>s.value==="multiple"),m=f(()=>s.value==="single");return{integration:o,integrationType:s,isIntegrationMultiple:h,isIntegrationSingle:m,isHookTypeInbox:n,hasConnectedHooks:d}},G={components:{FormKit:R},props:{integrationId:{type:String,required:!0}},emits:["close"],setup(e){const{integration:t,isHookTypeInbox:o}=N(e.integrationId);return{integration:t,isHookTypeInbox:o}},data(){return{endPoint:"",alertMessage:"",values:{}}},computed:{...x({uiFlags:"integrations/getUIFlags",dialogFlowEnabledInboxes:"inboxes/dialogFlowEnabledInboxes"}),inboxes(){return this.dialogFlowEnabledInboxes.filter(e=>this.isIntegrationDialogflow?!this.connectedDialogflowInboxIds.includes(e.id):!0).map(e=>({label:e.name,value:e.id}))},connectedDialogflowInboxIds(){return this.isIntegrationDialogflow?this.integration.hooks.map(e=>{var t;return(t=e.inbox)==null?void 0:t.id}):[]},formItems(){return this.integration.settings_form_schema},isIntegrationDialogflow(){return this.integration.id==="dialogflow"}},methods:{onClose(){this.$emit("close")},buildHookPayload(){const e={app_id:this.integration.id,settings:{}};return e.settings=Object.keys(this.values).reduce((t,o)=>(o!=="inbox"&&(t[o]=this.values[o]),t),{}),this.formItems.forEach(t=>{t.validation.includes("JSON")&&(e.settings[t.name]=JSON.parse(e.settings[t.name]))}),this.isHookTypeInbox&&this.values.inbox&&(e.inbox_id=this.values.inbox),e},async submitForm(){var e,t;try{await this.$store.dispatch("integrations/createHook",this.buildHookPayload()),this.alertMessage=this.$t("INTEGRATION_APPS.ADD.API.SUCCESS_MESSAGE"),this.onClose()}catch(o){const n=(t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message;this.alertMessage=n||this.$t("INTEGRATION_APPS.ADD.API.ERROR_MESSAGE")}finally{O(this.alertMessage)}}}},F={class:"flex flex-col h-auto overflow-auto integration-hooks"},$={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"};function B(e,t,o,n,d,s){const h=g("woot-modal-header"),m=g("FormKit"),I=g("woot-button");return i(),r("div",F,[u(h,{"header-title":n.integration.name,"header-content":n.integration.description},null,8,["header-title","header-content"]),u(m,{modelValue:d.values,"onUpdate:modelValue":t[0]||(t[0]=l=>d.values=l),type:"form","form-class":"w-full grid gap-4","submit-attrs":{inputClass:"hidden",wrapperClass:"hidden"},"incomplete-message":!1,onSubmit:s.submitForm},{default:_(()=>[(i(!0),r(b,null,E(s.formItems,l=>(i(),P(m,D({key:l.name,ref_for:!0},l),null,16))),128)),n.isHookTypeInbox?(i(),P(m,{key:0,options:s.inboxes,type:"select",name:"inbox","input-class":"reset-base",placeholder:e.$t("INTEGRATION_APPS.ADD.FORM.INBOX.LABEL"),label:e.$t("INTEGRATION_APPS.ADD.FORM.INBOX.PLACEHOLDER"),validation:"required","validation-name":"Inbox"},null,8,["options","placeholder","label"])):p("",!0),a("div",$,[u(I,{type:"submit",loading:e.uiFlags.isCreatingHook},{default:_(()=>[k(c(e.$t("INTEGRATION_APPS.ADD.FORM.SUBMIT")),1)]),_:1},8,["loading"]),u(I,{type:"reset",class:"button clear",onClick:v(s.onClose,["prevent"])},{default:_(()=>[k(c(e.$t("INTEGRATION_APPS.ADD.FORM.CANCEL")),1)]),_:1},8,["onClick"])])]),_:1},8,["modelValue","onSubmit"])])}const L=A(G,[["render",B]]),U={props:{integrationId:{type:String,required:!0}},emits:["add","delete"],setup(e){const{integration:t,hasConnectedHooks:o}=N(e.integrationId);return{integration:t,hasConnectedHooks:o}}},X={class:"flex-shrink flex-grow overflow-auto p-4"},j={class:"flex flex-col"},V={class:"bg-white dark:bg-slate-800 border border-solid border-slate-75 dark:border-slate-700/50 rounded-xl mb-4 p-4"},q={class:"flex"},K={class:"flex h-[6.25rem] w-[6.25rem]"},J=["src"],z=["src"],Q={class:"flex flex-col justify-center m-0 mx-4 flex-1"},W={class:"text-xl font-medium mb-1 text-slate-800 dark:text-slate-100"},Y={class:"text-slate-700 dark:text-slate-200"},Z={class:"flex justify-center items-center mb-0 w-[15%]"},ee={key:0},te={key:1};function oe(e,t,o,n,d,s){const h=g("woot-button");return i(),r("div",X,[a("div",j,[a("div",V,[a("div",q,[a("div",K,[a("img",{src:`/dashboard/images/integrations/${n.integration.id}.png`,class:"max-w-full rounded-md border border-slate-50 dark:border-slate-700/50 shadow-sm block dark:hidden bg-white dark:bg-slate-900"},null,8,J),a("img",{src:`/dashboard/images/integrations/${n.integration.id}-dark.png`,class:"max-w-full rounded-md border border-slate-50 dark:border-slate-700/50 shadow-sm hidden dark:block bg-white dark:bg-slate-900"},null,8,z)]),a("div",Q,[a("h3",W,c(n.integration.name),1),a("p",Y,c(n.integration.description),1)]),a("div",Z,[n.hasConnectedHooks?(i(),r("div",ee,[a("div",{onClick:t[0]||(t[0]=m=>e.$emit("delete",n.integration.hooks[0]))},[u(h,{class:"nice alert"},{default:_(()=>[k(c(e.$t("INTEGRATION_APPS.DISCONNECT.BUTTON_TEXT")),1)]),_:1})])])):(i(),r("div",te,[u(h,{class:"button nice",onClick:t[1]||(t[1]=m=>e.$emit("add"))},{default:_(()=>[k(c(e.$t("INTEGRATION_APPS.CONNECT.BUTTON_TEXT")),1)]),_:1})]))])])])])])}const ne=A(U,[["render",oe]]),se={props:{integrationId:{type:String,required:!0}},emits:["delete"],setup(e){const{integration:t,isHookTypeInbox:o,hasConnectedHooks:n}=N(e.integrationId);return{integration:t,isHookTypeInbox:o,hasConnectedHooks:n}},computed:{...x({globalConfig:"globalConfig/get"}),hookHeaders(){return this.integration.visible_properties},hooks(){if(!this.hasConnectedHooks)return[];const{hooks:e}=this.integration;return e.map(t=>({...t,id:t.id,properties:this.hookHeaders.map(o=>t.settings[o]?t.settings[o]:"--")}))}},mounted(){},methods:{inboxName(e){return e.inbox?e.inbox.name:""}}},ie={class:"flex flex-row gap-4"},re={class:"w-full lg:w-3/5"},ae={key:0,class:"woot-table"},le={key:0},de={key:0,class:"break-words"},ce={class:"flex justify-end gap-1"},ue={key:1,class:"flex flex-col items-center justify-center h-full"},me={class:"hidden w-1/3 lg:block"};function ge(e,t,o,n,d,s){const h=g("woot-button"),m=S("tooltip"),I=S("dompurify-html");return i(),r("div",ie,[a("div",re,[n.hasConnectedHooks?(i(),r("table",ae,[a("thead",null,[(i(!0),r(b,null,E(s.hookHeaders,l=>(i(),r("th",{key:l},c(l),1))),128)),n.isHookTypeInbox?(i(),r("th",le,c(e.$t("INTEGRATION_APPS.LIST.INBOX")),1)):p("",!0)]),a("tbody",null,[(i(!0),r(b,null,E(s.hooks,l=>(i(),r("tr",{key:l.id},[(i(!0),r(b,null,E(l.properties,T=>(i(),r("td",{key:T,class:"break-words"},c(T),1))),128)),n.isHookTypeInbox?(i(),r("td",de,c(s.inboxName(l)),1)):p("",!0),a("td",ce,[C(u(h,{variant:"smooth","color-scheme":"alert",size:"tiny",icon:"dismiss-circle","class-names":"grey-btn",onClick:T=>e.$emit("delete",l)},null,8,["onClick"]),[[m,e.$t("INTEGRATION_APPS.LIST.DELETE.BUTTON_TEXT"),void 0,{top:!0}]])])]))),128))])])):(i(),r("p",ue,c(e.$t("INTEGRATION_APPS.NO_HOOK_CONFIGURED",{integrationId:n.integration.id})),1))]),a("div",me,[a("p",null,[a("b",null,c(n.integration.name),1)]),C(a("p",null,null,512),[[I,e.$t(`INTEGRATION_APPS.SIDEBAR_DESCRIPTION.${n.integration.name.toUpperCase()}`,{installationName:e.globalConfig.installationName})]])])])}const he=A(se,[["render",ge]]),pe={components:{NewHook:L,SingleIntegrationHooks:ne,MultipleIntegrationHooks:he},props:{integrationId:{type:[String,Number],required:!0}},setup(e){const{integrationId:t}=e,{integration:o,isIntegrationMultiple:n,isIntegrationSingle:d,isHookTypeInbox:s}=N(t);return{integration:o,isIntegrationMultiple:n,isIntegrationSingle:d,isHookTypeInbox:s}},data(){return{loading:{},showAddHookModal:!1,showDeleteConfirmationPopup:!1,selectedHook:{},alertMessage:""}},computed:{...x({uiFlags:"integrations/getUIFlags"}),showIntegrationHooks(){return!this.uiFlags.isFetching&&!H(this.integration)},showAddButton(){return this.showIntegrationHooks&&this.isIntegrationMultiple},deleteTitle(){return this.isHookTypeInbox?this.$t("INTEGRATION_APPS.DELETE.TITLE.INBOX"):this.$t("INTEGRATION_APPS.DELETE.TITLE.ACCOUNT")},deleteMessage(){return this.isHookTypeInbox?this.$t("INTEGRATION_APPS.DELETE.MESSAGE.INBOX"):this.$t("INTEGRATION_APPS.DELETE.MESSAGE.ACCOUNT")},confirmText(){return this.isHookTypeInbox?this.$t("INTEGRATION_APPS.DELETE.CONFIRM_BUTTON_TEXT.INBOX"):this.$t("INTEGRATION_APPS.DELETE.CONFIRM_BUTTON_TEXT.ACCOUNT")},cancelText(){return this.$t("INTEGRATION_APPS.DELETE.CANCEL_BUTTON_TEXT")}},methods:{openAddHookModal(){this.showAddHookModal=!0},hideAddHookModal(){this.showAddHookModal=!1},openDeletePopup(e){this.showDeleteConfirmationPopup=!0,this.selectedHook=e},closeDeletePopup(){this.showDeleteConfirmationPopup=!1},async confirmDeletion(){var e,t;try{await this.$store.dispatch("integrations/deleteHook",{hookId:this.selectedHook.id,appId:this.selectedHook.app_id}),this.alertMessage=this.$t("INTEGRATION_APPS.DELETE.API.SUCCESS_MESSAGE"),this.closeDeletePopup()}catch(o){const n=(t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message;this.alertMessage=n||this.$t("INTEGRATION_APPS.DELETE.API.ERROR_MESSAGE")}finally{O(this.alertMessage)}}}},_e={class:"overflow-auto p-4 max-w-full my-auto flex flex-wrap h-full"},Ie={key:1,class:"w-full"},fe={key:0},Te={key:1};function ke(e,t,o,n,d,s){const h=g("woot-button"),m=g("MultipleIntegrationHooks"),I=g("SingleIntegrationHooks"),l=g("NewHook"),T=g("woot-modal"),y=g("woot-delete-modal");return i(),r("div",_e,[s.showAddButton?(i(),P(h,{key:0,"color-scheme":"success","class-names":"button--fixed-top",icon:"add-circle",onClick:s.openAddHookModal},{default:_(()=>[k(c(e.$t("INTEGRATION_APPS.ADD_BUTTON")),1)]),_:1},8,["onClick"])):p("",!0),s.showIntegrationHooks?(i(),r("div",Ie,[n.isIntegrationMultiple?(i(),r("div",fe,[u(m,{"integration-id":o.integrationId,onDelete:s.openDeletePopup},null,8,["integration-id","onDelete"])])):p("",!0),n.isIntegrationSingle?(i(),r("div",Te,[u(I,{"integration-id":o.integrationId,onAdd:s.openAddHookModal,onDelete:s.openDeletePopup},null,8,["integration-id","onAdd","onDelete"])])):p("",!0)])):p("",!0),u(T,{show:d.showAddHookModal,"onUpdate:show":t[0]||(t[0]=w=>d.showAddHookModal=w),"on-close":s.hideAddHookModal},{default:_(()=>[u(l,{"integration-id":o.integrationId,onClose:s.hideAddHookModal},null,8,["integration-id","onClose"])]),_:1},8,["show","on-close"]),u(y,{show:d.showDeleteConfirmationPopup,"onUpdate:show":t[1]||(t[1]=w=>d.showDeleteConfirmationPopup=w),"on-close":s.closeDeletePopup,"on-confirm":s.confirmDeletion,title:s.deleteTitle,message:s.deleteMessage,"confirm-text":s.confirmText,"reject-text":s.cancelText},null,8,["show","on-close","on-confirm","title","message","confirm-text","reject-text"])])}const Je=A(pe,[["render",ke]]);export{Je as default};
