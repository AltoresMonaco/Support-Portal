import{m as T,r as $,n as ae,e as F,h as W,f as oe,a as re}from"./globalConfig-DaGjiImb.js";import{g as L}from"./utils.esm-CA3tRshB.js";import{C as ie}from"./Button-BlM3GDIn.js";import{F as I}from"./Index-CtF_0wrY.js";import{_,o as a,n as r,p as c,t as b,m as D,e as f,u as d,a as h,l as P,k as m,B as C,q as p,g as M,j,H as U,b as le,F as v,i as S,ai as q,U as z,a0 as ce,f as H}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{F as de,a as ue}from"./vue-upload-component-ChbSM2aG.js";import{S as V}from"./Spinner-B-aSVz3z.js";import{h as G,R as me,K as X}from"./timeHelper-BT38nsET.js";import{B as O}from"./vue-router-CNCrM2WK.js";import{c as Y,u as E,r as he,I as ge,s as pe,A as _e}from"./widget-CI6WQx7h.js";import be from"./EmojiInput-CQAMhbBI.js";import{f as fe,d as ye}from"./sharedFrameEvents-CcDS0bVP.js";import{u as N}from"./useMessageFormatter-CoQTTzFX.js";import{u as Ce,r as Te,e as ke}from"./index-C2DForDf.js";import{b as ve,_ as Se}from"./typing-cGLaWCAF.js";import{T as Ie}from"./Thumbnail-DLjRBBx8.js";import{M as K}from"./constants-lVAyZKq6.js";import{i as Ee}from"./MessageTypeHelper-CjbF8VpS.js";import{d as Ae}from"./DateHelper-D7GM2F2-.js";import"./Icon-Dtj3LCzD.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-BO4rcqbh.js";import"./exports-CsC-x4VI.js";import"./mutationHelpers-3VTcoJiD.js";import"./index-BP-sUqpX.js";import"./index-DaWXXnfb.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./axios-CCb-kr4I.js";import"./index-BGZqnxRy.js";import"./businessHour-BNp1n6b4.js";import"./Branding-CyqV4wcK.js";import"./globalConfigMixin-BNbqaRx5.js";import"./module-CGzIBJZi.js";import"./Validators-eX6_8wdj.js";import"./index-CbMJaKeB.js";const we={name:"FooterReplyTo",components:{FluentIcon:I},props:{inReplyTo:{type:Object,default:()=>{}}},emits:["dismiss"],computed:{replyToAttachment(){var n,s;if(!((s=(n=this.inReplyTo)==null?void 0:n.attachments)!=null&&s.length))return"";const[{file_type:e}={}]=this.inReplyTo.attachments;return this.$t(`ATTACHMENTS.${e}.CONTENT`)}}},xe={class:"mb-2.5 rounded-[7px] dark:bg-slate-900 dark:text-slate-100 bg-slate-100 px-2 py-1.5 text-sm text-slate-700 flex items-center gap-2"},Me={class:"items-center flex-grow truncate"};function Re(e,n,s,l,i,t){const o=d("FluentIcon");return a(),r("div",xe,[c("div",Me,[c("strong",null,b(e.$t("FOOTER_REPLY_TO.REPLY_TO")),1),D(" "+b(s.inReplyTo.content||t.replyToAttachment),1)]),c("button",{class:"items-end flex-shrink-0 p-1 rounded-md hover:bg-slate-200 dark:hover:bg-slate-800",onClick:n[0]||(n[0]=u=>e.$emit("dismiss"))},[f(o,{icon:"dismiss",size:"12"})])])}const Fe=_(we,[["render",Re]]),Oe={components:{FluentIcon:I,FileUpload:de,Spinner:V},props:{onAttach:{type:Function,default:()=>{}}},data(){return{isUploading:!1}},computed:{...T({globalConfig:"globalConfig/get"}),fileUploadSizeLimit(){return $},allowedFileTypes(){return ae}},mounted(){document.addEventListener("paste",this.handleClipboardPaste)},unmounted(){document.removeEventListener("paste",this.handleClipboardPaste)},methods:{handleClipboardPaste(e){const n=(e.clipboardData||e.originalEvent.clipboardData).items;Array.from(n).forEach(l=>{if(l.kind==="file"){e.preventDefault();const i=l.getAsFile();this.$refs.upload.add(i)}})},getFileType(e){return e.includes("image")?"image":"file"},async onFileUpload(e){this.globalConfig.directUploadsEnabled?await this.onDirectFileUpload(e):await this.onIndirectFileUpload(e)},async onDirectFileUpload(e){if(e){this.isUploading=!0;try{if(G(e,$)){const{websiteToken:n}=window.chatwootWebChannel;new ue.DirectUpload(e.file,`/api/v1/widget/direct_uploads?website_token=${n}`,{directUploadWillCreateBlobWithXHR:l=>{l.setRequestHeader("X-Auth-Token",window.authToken)}}).create((l,i)=>{l?F.emit(O.SHOW_ALERT,{message:l}):this.onAttach({file:i.signed_id,...this.getLocalFileAttributes(e)})})}else F.emit(O.SHOW_ALERT,{message:this.$t("FILE_SIZE_LIMIT",{MAXIMUM_FILE_UPLOAD_SIZE:this.fileUploadSizeLimit})})}catch{}this.isUploading=!1}},async onIndirectFileUpload(e){if(e){this.isUploading=!0;try{G(e,$)?await this.onAttach({file:e.file,...this.getLocalFileAttributes(e)}):F.emit(O.SHOW_ALERT,{message:this.$t("FILE_SIZE_LIMIT",{MAXIMUM_FILE_UPLOAD_SIZE:this.fileUploadSizeLimit})})}catch{}this.isUploading=!1}},getLocalFileAttributes(e){return{thumbUrl:window.URL.createObjectURL(e.file),fileType:this.getFileType(e.type)}}}},Le={class:"icon-button flex items-center justify-center"};function Be(e,n,s,l,i,t){const o=d("FluentIcon"),u=d("Spinner"),g=d("FileUpload");return a(),h(g,{ref:"upload",size:4096*2048,accept:t.allowedFileTypes,data:{direct_upload_url:"/api/v1/widget/direct_uploads",direct_upload:!0},onInputFile:t.onFileUpload},{default:P(()=>[c("button",Le,[i.isUploading.image?m("",!0):(a(),h(o,{key:0,icon:"attach"})),i.isUploading?(a(),h(u,{key:1,size:"small"})):m("",!0)])]),_:1},8,["accept","onInputFile"])}const Ue=_(Oe,[["render",Be]]),Ve={components:{FluentIcon:I,Spinner:V},props:{loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},color:{type:String,default:"#6e6f73"}}},De=["disabled"];function Pe(e,n,s,l,i,t){const o=d("FluentIcon"),u=d("Spinner");return a(),r("button",{type:"submit",disabled:s.disabled,class:"icon-button flex items-center justify-center ml-1"},[s.loading?(a(),h(u,{key:1,size:"small"})):(a(),h(o,{key:0,icon:"send",style:C(`color: ${s.color}`)},null,8,["style"]))],8,De)}const je=_(Ve,[["render",Pe]]),Ne={name:"ChatInputWrap",components:{ChatAttachmentButton:Ue,ChatSendButton:je,EmojiInput:be,FluentIcon:I,ResizableTextArea:me},mixins:[Y],props:{onSendMessage:{type:Function,default:()=>{}},onSendAttachment:{type:Function,default:()=>{}}},setup(){const{getThemeClass:e}=E();return{getThemeClass:e}},data(){return{userInput:"",showEmojiPicker:!1,isFocused:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor",isWidgetOpen:"appConfig/getIsWidgetOpen"}),showAttachment(){return this.hasAttachmentsEnabled&&this.userInput.length===0},showSendButton(){return this.userInput.length>0},inputColor(){return`${this.getThemeClass("bg-white","dark:bg-slate-600")}
        ${this.getThemeClass("text-black-900","dark:text-slate-50")}`},emojiIconColor(){return this.showEmojiPicker?`text-woot-500 ${this.getThemeClass("text-black-900","dark:text-slate-100")}`:`${this.getThemeClass("text-black-900","dark:text-slate-100")}`}},watch:{isWidgetOpen(e){e&&this.focusInput()}},unmounted(){document.removeEventListener("keypress",this.handleEnterKeyPress)},mounted(){document.addEventListener("keypress",this.handleEnterKeyPress),this.isWidgetOpen&&this.focusInput()},methods:{onBlur(){this.isFocused=!1},onFocus(){this.isFocused=!0},handleButtonClick(){this.userInput&&this.userInput.trim()&&this.onSendMessage(this.userInput),this.userInput="",this.focusInput()},handleEnterKeyPress(e){e.keyCode===13&&!e.shiftKey&&(e.preventDefault(),this.handleButtonClick())},toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker},hideEmojiPicker(e){this.showEmojiPicker&&(e.stopPropagation(),this.toggleEmojiPicker())},emojiOnClick(e){this.userInput=`${this.userInput}${e} `},onTypingOff(){this.toggleTyping("off")},onTypingOn(){this.toggleTyping("on")},toggleTyping(e){this.$store.dispatch("conversation/toggleUserTyping",{typingStatus:e})},focusInput(){this.$refs.chatInput.focus()}}},$e={class:"button-wrap"},We=["aria-label"];function ze(e,n,s,l,i,t){const o=d("ResizableTextArea"),u=d("ChatAttachmentButton"),g=d("FluentIcon"),A=d("EmojiInput"),w=d("ChatSendButton"),R=U("on-clickaway");return a(),r("div",{class:p(["chat-message--input is-focused",l.getThemeClass("bg-white ","dark:bg-slate-600")]),onKeydown:n[2]||(n[2]=j((...x)=>t.hideEmojiPicker&&t.hideEmojiPicker(...x),["esc"]))},[f(o,{id:"chat-input",ref:"chatInput",modelValue:i.userInput,"onUpdate:modelValue":n[0]||(n[0]=x=>i.userInput=x),rows:1,"aria-label":e.$t("CHAT_PLACEHOLDER"),placeholder:e.$t("CHAT_PLACEHOLDER"),class:p(["form-input user-message-input is-focused",t.inputColor]),onTypingOff:t.onTypingOff,onTypingOn:t.onTypingOn,onFocus:t.onFocus,onBlur:t.onBlur},null,8,["modelValue","aria-label","placeholder","class","onTypingOff","onTypingOn","onFocus","onBlur"]),c("div",$e,[t.showAttachment?(a(),h(u,{key:0,class:p(l.getThemeClass("text-black-900","dark:text-slate-100")),"on-attach":s.onSendAttachment},null,8,["class","on-attach"])):m("",!0),e.hasEmojiPickerEnabled?(a(),r("button",{key:1,class:"flex items-center justify-center icon-button","aria-label":e.$t("EMOJI.ARIA_LABEL"),onClick:n[1]||(n[1]=(...x)=>t.toggleEmojiPicker&&t.toggleEmojiPicker(...x))},[f(g,{icon:"emoji",class:p(t.emojiIconColor)},null,8,["class"])],8,We)):m("",!0),i.showEmojiPicker?M((a(),h(A,{key:2,"on-click":t.emojiOnClick,onKeydown:j(t.hideEmojiPicker,["esc"])},null,8,["on-click","onKeydown"])),[[R,t.hideEmojiPicker]]):m("",!0),t.showSendButton?(a(),h(w,{key:3,color:e.widgetColor,onClick:t.handleButtonClick},null,8,["color","onClick"])):m("",!0)])],34)}const He=_(Ne,[["render",ze],["__scopeId","data-v-b3793b97"]]),qe={components:{ChatInputWrap:He,CustomButton:ie,FooterReplyTo:Fe},mixins:[he],data(){return{inReplyTo:null}},computed:{...T({conversationAttributes:"conversationAttributes/getConversationParams",widgetColor:"appConfig/getWidgetColor",conversationSize:"conversation/getConversationSize",currentUser:"contacts/getCurrentUser",isWidgetStyleFlat:"appConfig/isWidgetStyleFlat"}),textColor(){return L(this.widgetColor)},hideReplyBox(){const{allowMessagesAfterResolved:e}=window.chatwootWebChannel,{status:n}=this.conversationAttributes;return!e&&n==="resolved"},showEmailTranscriptButton(){return this.hasEmail},hasEmail(){return this.currentUser&&this.currentUser.has_email},hasReplyTo(){return this.inReplyTo&&(this.inReplyTo.content||this.inReplyTo.attachments)}},mounted(){F.on(O.TOGGLE_REPLY_TO_MESSAGE,this.toggleReplyTo)},methods:{...W("conversation",["sendMessage","sendAttachment","clearConversations"]),...W("conversationAttributes",["getAttributes","clearConversationAttributes"]),async handleSendMessage(e){await this.sendMessage({content:e,replyTo:this.inReplyTo?this.inReplyTo.id:null}),this.inReplyTo=null,this.conversationSize===0&&this.getAttributes()},async handleSendAttachment(e){await this.sendAttachment({attachment:e,replyTo:this.inReplyTo?this.inReplyTo.id:null}),this.inReplyTo=null},startNewConversation(){this.clearConversations(),this.clearConversationAttributes(),this.replaceRoute("prechat-form"),ge.sendMessage({event:"onEvent",eventIdentifier:fe,data:{hasConversation:!0}})},toggleReplyTo(e){this.inReplyTo=e},async sendTranscript(){if(this.hasEmail)try{await pe(),F.emit(O.SHOW_ALERT,{message:this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_SUCCESS"),type:"success"})}catch{F.$emit(O.SHOW_ALERT,{message:this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_ERROR")})}}}},Ge={key:1};function Xe(e,n,s,l,i,t){const o=d("FooterReplyTo"),u=d("ChatInputWrap"),g=d("CustomButton");return t.hideReplyBox?(a(),r("div",Ge,[f(g,{class:"font-medium",block:"","bg-color":e.widgetColor,"text-color":t.textColor,onClick:t.startNewConversation},{default:P(()=>[D(b(e.$t("START_NEW_CONVERSATION")),1)]),_:1},8,["bg-color","text-color","onClick"]),t.showEmailTranscriptButton?(a(),h(g,{key:0,type:"clear",class:"font-normal",onClick:t.sendTranscript},{default:P(()=>[D(b(e.$t("EMAIL_TRANSCRIPT.BUTTON_TEXT")),1)]),_:1},8,["onClick"])):m("",!0)])):(a(),r("footer",{key:0,class:p(["relative z-50 mb-1",{"rounded-lg":!e.isWidgetStyleFlat,"pt-2.5 shadow-[0px_-20px_20px_1px_rgba(0,_0,_0,_0.05)] dark:shadow-[0px_-20px_20px_1px_rgba(0,_0,_0,_0.15)] rounded-t-none":t.hasReplyTo}])},[t.hasReplyTo?(a(),h(o,{key:0,"in-reply-to":i.inReplyTo,onDismiss:n[0]||(n[0]=A=>i.inReplyTo=null)},null,8,["in-reply-to"])):m("",!0),f(u,{class:"shadow-sm","on-send-message":t.handleSendMessage,"on-send-attachment":t.handleSendAttachment},null,8,["on-send-message","on-send-attachment"])],2))}const Ye=_(qe,[["render",Xe],["__scopeId","data-v-98e082e0"]]),Ke={name:"UserMessageBubble",props:{message:{type:String,default:""},widgetColor:{type:String,default:""}},setup(){const{formatMessage:e}=N();return{formatMessage:e}},computed:{textColor(){return L(this.widgetColor)}}};function Ze(e,n,s,l,i,t){const o=U("dompurify-html");return M((a(),r("div",{class:"chat-bubble user",style:C({background:s.widgetColor,color:t.textColor})},null,4)),[[o,l.formatMessage(s.message,!1)]])}const Je=_(Ke,[["render",Ze],["__scopeId","data-v-3107b2d5"]]),Qe={name:"MessageReplyButton",components:{FluentIcon:I}},et={class:"p-1 mb-1 rounded-full dark:text-slate-500 dark:bg-slate-900 text-slate-600 bg-slate-100 hover:text-slate-800"};function tt(e,n,s,l,i,t){const o=d("FluentIcon");return a(),r("button",et,[f(o,{icon:"arrow-reply",size:"11",class:"flex-shrink-0"})])}const Z=_(Qe,[["render",tt]]),st={props:{url:{type:String,default:""},thumb:{type:String,default:""},readableTime:{type:String,default:""}},emits:["error"],methods:{onImgError(){this.$emit("error")}}},nt=["href"],at={class:"wrap"},ot=["src"],rt={class:"time"};function it(e,n,s,l,i,t){return a(),r("a",{href:s.url,target:"_blank",rel:"noreferrer noopener nofollow",class:"image"},[c("div",at,[c("img",{src:s.thumb,alt:"Picture message",onError:n[0]||(n[0]=(...o)=>t.onImgError&&t.onImgError(...o))},null,40,ot),c("span",rt,b(s.readableTime),1)])],8,nt)}const J=_(st,[["render",it],["__scopeId","data-v-c13a6a7a"]]),lt={class:"relative block max-w-full"},ct=["src"],dt={class:"absolute text-xs text-white dark:text-white right-3 bottom-1 whitespace-nowrap"},Q={__name:"VideoBubble",props:{url:{type:String,default:""},readableTime:{type:String,default:""}},emits:["error"],setup(e,{emit:n}){const s=n,l=()=>{s("error")};return(i,t)=>(a(),r("div",lt,[c("video",{class:"w-full max-w-[250px] h-auto",src:e.url,controls:"",onError:l},null,40,ct),c("span",dt,b(e.readableTime),1)]))}},ut={components:{FluentIcon:I},props:{url:{type:String,default:""},isInProgress:{type:Boolean,default:!1},widgetColor:{type:String,default:""},isUserBubble:{type:Boolean,default:!1}},setup(){const{getThemeClass:e}=E();return{getThemeClass:e}},computed:{title(){return this.isInProgress?this.$t("COMPONENTS.FILE_BUBBLE.UPLOADING"):decodeURI(this.fileName)},fileName(){return this.url.substring(this.url.lastIndexOf("/")+1)},contrastingTextColor(){return L(this.widgetColor)},textColor(){return this.isUserBubble&&this.widgetColor?this.contrastingTextColor:""},titleColor(){return this.isUserBubble?"":this.getThemeClass("text-black-900","dark:text-slate-50")}},methods:{openLink(){window.open(this.url,"_blank").focus()}}},mt={class:"file flex flex-row items-center p-3 cursor-pointer"},ht={class:"meta"},gt={class:"link-wrap mb-1"},pt=["href"];function _t(e,n,s,l,i,t){const o=d("FluentIcon");return a(),r("div",mt,[c("div",{class:"icon-wrap",style:C({color:t.textColor})},[f(o,{icon:"document",size:"28"})],4),c("div",ht,[c("div",{class:p(["title",t.titleColor]),style:C({color:t.textColor})},b(t.title),7),c("div",gt,[c("a",{class:"download",rel:"noreferrer noopener nofollow",target:"_blank",style:C({color:t.textColor}),href:s.url},b(e.$t("COMPONENTS.FILE_BUBBLE.DOWNLOAD")),13,pt)])])])}const ee=_(ut,[["render",_t],["__scopeId","data-v-3a0b4a9b"]]),te={computed:{messageContentAttributes(){const{content_attributes:e={}}=this.message;return e},hasAttachments(){return!!(this.message.attachments&&this.message.attachments.length>0)}}},bt={name:"AgentMessage",components:{FluentIcon:I},props:{replyTo:{type:Object,default:()=>{}}},data(){return{timeOutID:null}},computed:{replyToAttachment(){var n,s;if(!((s=(n=this.replyTo)==null?void 0:n.attachments)!=null&&s.length))return"";const[{file_type:e}={}]=this.replyTo.attachments;return this.$t(`ATTACHMENTS.${e}.CONTENT`)}},unmounted(){clearTimeout(this.timeOutID)},methods:{navigateTo(e){const n=`cwmsg-${e}`;this.$nextTick(()=>{const s=document.getElementById(n);s.scrollIntoView(),s.classList.add("bg-slate-100","dark:bg-slate-900"),this.timeOutID=setTimeout(()=>{s.classList.remove("bg-slate-100","dark:bg-slate-900")},500)})}}},ft={class:"truncate max-w-[8rem]"};function yt(e,n,s,l,i,t){const o=d("FluentIcon");return a(),r("button",{class:"px-1.5 py-0.5 rounded-md text-slate-500 bg-slate-50 dark:bg-slate-900 opacity-60 hover:opacity-100 cursor-pointer flex items-center gap-1.5",onClick:n[0]||(n[0]=u=>t.navigateTo(s.replyTo.id))},[f(o,{icon:"arrow-reply",size:"12",class:"flex-shrink-0"}),c("div",ft,b(s.replyTo.content||t.replyToAttachment),1)])}const se=_(bt,[["render",yt]]),Ct={name:"DragWrapper",props:{direction:{type:String,required:!0,validator:e=>["left","right"].includes(e)},disabled:{type:Boolean,default:!1}},emits:["dragged"],data(){return{startX:null,dragDistance:0,threshold:50}},methods:{handleTouchStart(e){this.disabled||(this.startX=e.touches[0].clientX)},handleTouchMove(e){if(this.disabled)return;let s=e.touches[0].clientX-this.startX;this.direction==="right"?this.dragDistance=Math.min(this.threshold,s):this.direction==="left"&&(this.dragDistance=Math.max(-this.threshold,s))},resetPosition(){(this.dragDistance>=this.threshold&&this.direction==="right"||this.dragDistance<=-this.threshold&&this.direction==="left")&&this.$emit("dragged",this.direction),this.dragDistance=0}}};function Tt(e,n,s,l,i,t){return a(),r("div",{style:C({transform:`translateX(${i.dragDistance}px)`}),class:"will-change-transform",onTouchstart:n[0]||(n[0]=(...o)=>t.handleTouchStart&&t.handleTouchStart(...o)),onTouchmove:n[1]||(n[1]=(...o)=>t.handleTouchMove&&t.handleTouchMove(...o)),onTouchend:n[2]||(n[2]=(...o)=>t.resetPosition&&t.resetPosition(...o))},[le(e.$slots,"default")],36)}const kt=_(Ct,[["render",Tt]]),vt={name:"UserMessage",components:{UserMessageBubble:Je,MessageReplyButton:Z,ImageBubble:J,VideoBubble:Q,FileBubble:ee,FluentIcon:I,ReplyToChip:se,DragWrapper:kt},mixins:[te],props:{message:{type:Object,default:()=>{}},replyTo:{type:Object,default:()=>{}}},data(){return{hasImageError:!1,hasVideoError:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),isInProgress(){const{status:e=""}=this.message;return e==="in_progress"},showTextBubble(){const{message:e}=this;return!!e.content},readableTime(){const{created_at:e=""}=this.message;return X(e)},isFailed(){const{status:e=""}=this.message;return e==="failed"},errorMessage(){const{meta:e}=this.message;return e?e.error:this.$t("COMPONENTS.MESSAGE_BUBBLE.ERROR_MESSAGE")},hasReplyTo(){return this.replyTo&&(this.replyTo.content||this.replyTo.attachments)}},watch:{message(){this.hasImageError=!1,this.hasVideoError=!1}},mounted(){this.hasImageError=!1,this.hasVideoError=!1},methods:{async retrySendMessage(){await this.$store.dispatch("conversation/sendMessageWithData",this.message)},onImageLoadError(){this.hasImageError=!0},onVideoLoadError(){this.hasVideoError=!0},toggleReply(){F.emit(O.TOGGLE_REPLY_TO_MESSAGE,this.message)}}},St={class:"user-message-wrap group"},It={class:"flex gap-1 user-message"},Et={key:0,class:"flex justify-end mt-2 mb-1 text-xs"},At={class:"flex justify-end gap-1"},wt={class:"flex flex-col justify-end"},xt={key:1,class:"flex justify-end px-4 py-2 text-red-700 align-middle"},Mt=["title"];function Rt(e,n,s,l,i,t){const o=d("ReplyToChip"),u=d("MessageReplyButton"),g=d("UserMessageBubble"),A=d("ImageBubble"),w=d("VideoBubble"),R=d("FileBubble"),x=d("DragWrapper"),B=d("FluentIcon");return a(),r("div",St,[c("div",It,[c("div",{class:p(["message-wrap",{"in-progress":t.isInProgress,"is-failed":t.isFailed}])},[t.hasReplyTo?(a(),r("div",Et,[f(o,{"reply-to":s.replyTo},null,8,["reply-to"])])):m("",!0),c("div",At,[c("div",wt,[!t.isInProgress&&!t.isFailed?(a(),h(u,{key:0,class:"transition-opacity delay-75 opacity-0 group-hover:opacity-100 sm:opacity-0",onClick:t.toggleReply},null,8,["onClick"])):m("",!0)]),f(x,{direction:"left",onDragged:t.toggleReply},{default:P(()=>[t.showTextBubble?(a(),h(g,{key:0,message:s.message.content,status:s.message.status,"widget-color":e.widgetColor},null,8,["message","status","widget-color"])):m("",!0),e.hasAttachments?(a(),r("div",{key:1,class:"chat-bubble has-attachment user",style:C({backgroundColor:e.widgetColor})},[(a(!0),r(v,null,S(s.message.attachments,y=>(a(),r("div",{key:y.id},[y.file_type==="image"&&!i.hasImageError?(a(),h(A,{key:0,url:y.data_url,thumb:y.data_url,"readable-time":t.readableTime,onError:t.onImageLoadError},null,8,["url","thumb","readable-time","onError"])):m("",!0),y.file_type==="video"&&!i.hasVideoError?(a(),h(w,{key:1,url:y.data_url,"readable-time":t.readableTime,onError:t.onVideoLoadError},null,8,["url","readable-time","onError"])):(a(),h(R,{key:2,url:y.data_url,"is-in-progress":t.isInProgress,"widget-color":e.widgetColor,"is-user-bubble":""},null,8,["url","is-in-progress","widget-color"]))]))),128))],4)):m("",!0)]),_:1},8,["onDragged"])]),t.isFailed?(a(),r("div",xt,[e.hasAttachments?m("",!0):(a(),r("button",{key:0,title:e.$t("COMPONENTS.MESSAGE_BUBBLE.RETRY"),class:"inline-flex items-center justify-center ml-2",onClick:n[0]||(n[0]=(...y)=>t.retrySendMessage&&t.retrySendMessage(...y))},[f(B,{icon:"arrow-clockwise",size:"14"})],8,Mt))])):m("",!0)],2)])])}const ne=_(vt,[["render",Rt]]),Ft={components:{},props:{action:{type:Object,default:()=>{}}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return L(this.widgetColor)},isLink(){return this.action.type==="link"}},methods:{onClick(){}}},Ot=["href"];function Lt(e,n,s,l,i,t){return t.isLink?(a(),r("a",{key:s.action.uri,class:"action-button button",href:s.action.uri,style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),target:"_blank",rel:"noopener nofollow noreferrer"},b(s.action.text),13,Ot)):(a(),r("button",{key:s.action.payload,class:"action-button button",style:C({borderColor:e.widgetColor,color:e.widgetColor}),onClick:n[0]||(n[0]=(...o)=>t.onClick&&t.onClick(...o))},b(s.action.text),5))}const Bt=_(Ft,[["render",Lt],["__scopeId","data-v-2bf2a336"]]),Ut={components:{CardButton:Bt},props:{title:{type:String,default:""},description:{type:String,default:""},mediaUrl:{type:String,default:""},actions:{type:Array,default:()=>[]}},setup(){const{getThemeClass:e}=E();return{getThemeClass:e}}},Vt=["src"],Dt={class:"card-body"};function Pt(e,n,s,l,i,t){const o=d("CardButton");return a(),r("div",{class:p(["card-message chat-bubble agent",l.getThemeClass("bg-white","dark:bg-slate-700")])},[c("img",{class:"media",src:s.mediaUrl},null,8,Vt),c("div",Dt,[c("h4",{class:p(["title",l.getThemeClass("text-black-900","dark:text-slate-50")])},b(s.title),3),c("p",{class:p(["body",l.getThemeClass("text-black-700","dark:text-slate-100")])},b(s.description),3),(a(!0),r(v,null,S(s.actions,u=>(a(),h(o,{key:u.id,action:u},null,8,["action"]))),128))])],2)}const jt=_(Ut,[["render",Pt],["__scopeId","data-v-d5c68f6a"]]),Nt={props:{buttonLabel:{type:String,default:""},items:{type:Array,default:()=>[]},submittedValues:{type:Array,default:()=>[]}},emits:["submit"],setup(){const{getThemeClass:e}=E();return{getThemeClass:e}},data(){return{formValues:{},hasSubmitted:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return L(this.widgetColor)},inputColor(){return`${this.getThemeClass("bg-white","dark:bg-slate-600")}
        ${this.getThemeClass("text-black-900","dark:text-slate-50")}`},isFormValid(){return this.items.reduce((e,{name:n})=>!!this.formValues[n]&&e,!0)}},mounted(){this.submittedValues.length?this.updateFormValues():this.setFormDefaults()},methods:{onSubmitClick(){this.hasSubmitted=!0},onSubmit(){this.isFormValid&&this.$emit("submit",this.formValues)},buildFormObject(e){return e.reduce((n,s)=>({...n,[s.name]:s.value||s.default}),{})},updateFormValues(){this.formValues=this.buildFormObject(this.submittedValues)},setFormDefaults(){this.formValues=this.buildFormObject(this.items)}}},$t=["onUpdate:modelValue","type","pattern","title","required","name","placeholder","disabled"],Wt=["onUpdate:modelValue","required","pattern","title","type","name","placeholder","disabled"],zt=["onUpdate:modelValue","required","title","name","placeholder","disabled"],Ht=["onUpdate:modelValue","required"],qt=["value"],Gt={class:"error-message"};function Xt(e,n,s,l,i,t){return a(),r("div",{class:p(["form chat-bubble agent",l.getThemeClass("bg-white","dark:bg-slate-700")])},[c("form",{onSubmit:n[1]||(n[1]=H((...o)=>t.onSubmit&&t.onSubmit(...o),["prevent"]))},[(a(!0),r(v,null,S(s.items,o=>(a(),r("div",{key:o.key,class:p(["form-block",{"has-submitted":i.hasSubmitted}])},[c("label",{class:p(l.getThemeClass("text-black-900","dark:text-slate-50"))},b(o.label),3),o.type==="email"?M((a(),r("input",{key:0,"onUpdate:modelValue":u=>i.formValues[o.name]=u,class:p(t.inputColor),type:o.type,pattern:o.regex,title:o.title,required:o.required&&"required",name:o.name,placeholder:o.placeholder,disabled:!!s.submittedValues.length},null,10,$t)),[[q,i.formValues[o.name]]]):o.type==="text"?M((a(),r("input",{key:1,"onUpdate:modelValue":u=>i.formValues[o.name]=u,class:p(t.inputColor),required:o.required&&"required",pattern:o.pattern,title:o.title,type:o.type,name:o.name,placeholder:o.placeholder,disabled:!!s.submittedValues.length},null,10,Wt)),[[q,i.formValues[o.name]]]):o.type==="text_area"?M((a(),r("textarea",{key:2,"onUpdate:modelValue":u=>i.formValues[o.name]=u,class:p(t.inputColor),required:o.required&&"required",title:o.title,name:o.name,placeholder:o.placeholder,disabled:!!s.submittedValues.length},null,10,zt)),[[z,i.formValues[o.name]]]):o.type==="select"?M((a(),r("select",{key:3,"onUpdate:modelValue":u=>i.formValues[o.name]=u,class:p(t.inputColor),required:o.required&&"required"},[(a(!0),r(v,null,S(o.options,u=>(a(),r("option",{key:u.key,value:u.value},b(u.label),9,qt))),128))],10,Ht)),[[ce,i.formValues[o.name]]]):m("",!0),c("span",Gt,b(o.pattern_error||e.$t("CHAT_FORM.INVALID.FIELD")),1)],2))),128)),s.submittedValues.length?m("",!0):(a(),r("button",{key:0,class:"button block",type:"submit",style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),onClick:n[0]||(n[0]=(...o)=>t.onSubmitClick&&t.onSubmitClick(...o))},b(s.buttonLabel||e.$t("COMPONENTS.FORM_BUBBLE.SUBMIT")),5))],32)],2)}const Yt=_(Nt,[["render",Xt],["__scopeId","data-v-95ff06a6"]]),Kt={components:{},props:{action:{type:Object,default:()=>{}},isSelected:{type:Boolean,default:!1}},emits:["optionSelect"],computed:{...T({widgetColor:"appConfig/getWidgetColor"})},methods:{onClick(){this.$emit("optionSelect",this.action)}}};function Zt(e,n,s,l,i,t){return a(),r("li",{class:p(["option",{"is-selected":s.isSelected}]),style:C({borderColor:e.widgetColor})},[c("button",{class:"option-button button",onClick:n[0]||(n[0]=(...o)=>t.onClick&&t.onClick(...o))},[c("span",{style:C({color:e.widgetColor})},b(s.action.title),5)])],6)}const Jt=_(Kt,[["render",Zt],["__scopeId","data-v-5e4c1796"]]),Qt={components:{ChatOption:Jt},props:{title:{type:String,default:""},options:{type:Array,default:()=>[]},selected:{type:String,default:""},hideFields:{type:Boolean,default:!1}},emits:["optionSelect"],setup(){const{formatMessage:e}=N();return{formatMessage:e}},methods:{isSelected(e){return this.selected===e.id},onClick(e){this.$emit("optionSelect",e)}}},es={class:"options-message chat-bubble agent bg-white dark:bg-slate-700"},ts={class:"card-body"},ss={class:"title text-black-900 dark:text-slate-50"},ns={class:"message-content text-black-900 dark:text-slate-50"};function as(e,n,s,l,i,t){const o=d("ChatOption"),u=U("dompurify-html");return a(),r("div",es,[c("div",ts,[c("h4",ss,[M(c("div",ns,null,512),[[u,l.formatMessage(s.title,!1)]])]),s.hideFields?m("",!0):(a(),r("ul",{key:0,class:p(["options",{"has-selected":!!s.selected}])},[(a(!0),r(v,null,S(s.options,g=>(a(),h(o,{key:g.id,action:g,"is-selected":t.isSelected(g),onOptionSelect:t.onClick},null,8,["action","is-selected","onOptionSelect"]))),128))],2))])])}const os=_(Qt,[["render",as],["__scopeId","data-v-6515c1e5"]]),rs={components:{FluentIcon:I},props:{items:{type:Array,default:()=>[]}},setup(){const{truncateMessage:e}=N(),{getThemeClass:n}=E();return{getThemeClass:n,truncateMessage:e}}},is=["href"],ls={class:"title flex items-center text-black-900 font-medium"};function cs(e,n,s,l,i,t){const o=d("FluentIcon");return s.items.length?(a(),r("div",{key:0,class:p(["chat-bubble agent",l.getThemeClass("bg-white","dark:bg-slate-700")])},[(a(!0),r(v,null,S(s.items,u=>(a(),r("div",{key:u.link,class:"article-item"},[c("a",{href:u.link,target:"_blank",rel:"noopener noreferrer nofollow"},[c("span",ls,[f(o,{icon:"link",class:p(["mr-1",l.getThemeClass("text-black-900","dark:text-slate-50")])},null,8,["class"]),c("span",{class:p(l.getThemeClass("text-slate-900","dark:text-slate-50"))},b(u.title),3)]),c("span",{class:p(["description",l.getThemeClass("text-slate-700","dark:text-slate-200")])},b(l.truncateMessage(u.description)),3)],8,is)]))),128))],2)):m("",!0)}const ds=_(rs,[["render",cs],["__scopeId","data-v-9d1b494b"]]),us={components:{FluentIcon:I,Spinner:V},props:{messageId:{type:Number,required:!0},messageContentAttributes:{type:Object,default:()=>{}}},setup(){const{getThemeClass:e}=E();return{v$:Ce(),getThemeClass:e}},data(){return{email:"",isUpdating:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return L(this.widgetColor)},hasSubmitted(){return this.messageContentAttributes&&this.messageContentAttributes.submitted_email},inputColor(){return`${this.getThemeClass("bg-white","dark:bg-slate-600")}
        ${this.getThemeClass("text-black-900","dark:text-slate-50")}
        ${this.getThemeClass("border-black-200","dark:border-black-500")}`},inputHasError(){return this.v$.email.$error?`${this.inputColor} error`:`${this.inputColor}`}},validations:{email:{required:Te,email:ke}},methods:{async onSubmit(){if(!this.v$.$invalid){this.isUpdating=!0;try{await this.$store.dispatch("message/update",{email:this.email,messageId:this.messageId})}catch{}finally{this.isUpdating=!1}}}}},ms=["placeholder"],hs=["disabled"];function gs(e,n,s,l,i,t){const o=d("FluentIcon"),u=d("Spinner");return a(),r("div",null,[t.hasSubmitted?m("",!0):(a(),r("form",{key:0,class:"email-input-group",onSubmit:n[3]||(n[3]=H((...g)=>t.onSubmit&&t.onSubmit(...g),["prevent"]))},[M(c("input",{"onUpdate:modelValue":n[0]||(n[0]=g=>i.email=g),class:p(["form-input",t.inputHasError]),placeholder:e.$t("EMAIL_PLACEHOLDER"),onInput:n[1]||(n[1]=(...g)=>l.v$.email.$touch&&l.v$.email.$touch(...g)),onKeydown:n[2]||(n[2]=j((...g)=>t.onSubmit&&t.onSubmit(...g),["enter"]))},null,42,ms),[[z,i.email]]),c("button",{class:"button small",disabled:l.v$.email.$invalid,style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor})},[i.isUpdating?(a(),h(u,{key:1,class:"mx-2"})):(a(),h(o,{key:0,icon:"chevron-right"}))],12,hs)],32))])}const ps=_(us,[["render",gs],["__scopeId","data-v-3c77164a"]]),_s={components:{Spinner:V,FluentIcon:I},props:{messageContentAttributes:{type:Object,default:()=>{}},messageId:{type:Number,required:!0}},setup(){const{getThemeClass:e}=E();return{getThemeClass:e}},data(){return{email:"",ratings:oe,selectedRating:null,isUpdating:!1,feedback:""}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),isRatingSubmitted(){var e,n;return(n=(e=this.messageContentAttributes)==null?void 0:e.csat_survey_response)==null?void 0:n.rating},isFeedbackSubmitted(){var e,n;return(n=(e=this.messageContentAttributes)==null?void 0:e.csat_survey_response)==null?void 0:n.feedback_message},isButtonDisabled(){return!(this.selectedRating&&this.feedback)},inputColor(){return`${this.getThemeClass("bg-white","dark:bg-slate-600")}
        ${this.getThemeClass("text-black-900","dark:text-slate-50")}`},textColor(){return L(this.widgetColor)},title(){return this.isRatingSubmitted?this.$t("CSAT.SUBMITTED_TITLE"):this.$t("CSAT.TITLE")}},mounted(){if(this.isRatingSubmitted){const{csat_survey_response:{rating:e,feedback_message:n}}=this.messageContentAttributes;this.selectedRating=e,this.feedback=n}},methods:{buttonClass(e){return[{selected:e.value===this.selectedRating},{disabled:this.isRatingSubmitted},{hover:this.isRatingSubmitted},"emoji-button"]},async onSubmit(){this.isUpdating=!0;try{await this.$store.dispatch("message/update",{submittedValues:{csat_survey_response:{rating:this.selectedRating,feedback_message:this.feedback}},messageId:this.messageId})}catch{}finally{this.isUpdating=!1}},selectRating(e){this.selectedRating=e.value,this.onSubmit()}}},bs={class:"ratings"},fs=["onClick"],ys=["placeholder"],Cs=["disabled"];function Ts(e,n,s,l,i,t){const o=d("Spinner"),u=d("FluentIcon");return a(),r("div",{class:p(["customer-satisfaction",l.getThemeClass("bg-white","dark:bg-slate-700")]),style:C({borderColor:e.widgetColor})},[c("h6",{class:p(["title",l.getThemeClass("text-slate-900","dark:text-slate-50")])},b(t.title),3),c("div",bs,[(a(!0),r(v,null,S(i.ratings,g=>(a(),r("button",{key:g.key,class:p(t.buttonClass(g)),onClick:A=>t.selectRating(g)},b(g.emoji),11,fs))),128))]),t.isFeedbackSubmitted?m("",!0):(a(),r("form",{key:0,class:"feedback-form",onSubmit:n[2]||(n[2]=H(g=>t.onSubmit(),["prevent"]))},[M(c("input",{"onUpdate:modelValue":n[0]||(n[0]=g=>i.feedback=g),class:p(["form-input",t.inputColor]),placeholder:e.$t("CSAT.PLACEHOLDER"),onKeydown:n[1]||(n[1]=j((...g)=>t.onSubmit&&t.onSubmit(...g),["enter"]))},null,42,ys),[[z,i.feedback]]),c("button",{class:"button small",disabled:t.isButtonDisabled,style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor})},[i.isUpdating&&i.feedback?(a(),h(o,{key:0})):(a(),h(u,{key:1,icon:"chevron-right"}))],12,Cs)],32))],6)}const ks=_(_s,[["render",Ts],["__scopeId","data-v-4149dd02"]]),vs={addParticipantToDyteMeeting:e=>{const s={url:`/api/v1/widget/integrations/dyte/add_participant_to_meeting${ye(window.location.search)}`};return _e.post(s.url,{message_id:e})}},Ss={components:{FluentIcon:I},props:{messageId:{type:Number,required:!0},meetingData:{type:Object,default:()=>({})}},data(){return{isLoading:!1,dyteAuthToken:"",isSDKMounted:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return L(this.widgetColor)},meetingLink(){return ve(this.meetingData.room_name,this.dyteAuthToken)}},methods:{async joinTheCall(){this.isLoading=!0;try{const{data:{authResponse:{authToken:e=""}={}}={}}=await vs.addParticipantToDyteMeeting(this.messageId);this.dyteAuthToken=e}catch{}finally{this.isLoading=!1}},leaveTheRoom(){this.dyteAuthToken=""}}},Is=["is-loading"],Es={key:0,class:"video-call--container"},As=["src"];function ws(e,n,s,l,i,t){const o=d("FluentIcon");return a(),r("div",null,[c("button",{class:"button join-call-button","color-scheme":"secondary","is-loading":i.isLoading,style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),onClick:n[0]||(n[0]=(...u)=>t.joinTheCall&&t.joinTheCall(...u))},[f(o,{icon:"video-add",class:"mr-2"}),D(" "+b(e.$t("INTEGRATIONS.DYTE.CLICK_HERE_TO_JOIN")),1)],12,Is),i.dyteAuthToken?(a(),r("div",Es,[c("iframe",{src:t.meetingLink,allow:"camera;microphone;fullscreen;display-capture;picture-in-picture;clipboard-write;"},null,8,As),c("button",{class:"button small join-call-button leave-room-button",onClick:n[1]||(n[1]=(...u)=>t.leaveTheRoom&&t.leaveTheRoom(...u))},b(e.$t("INTEGRATIONS.DYTE.LEAVE_THE_ROOM")),1)])):m("",!0)])}const xs=_(Ss,[["render",ws],["__scopeId","data-v-4d525810"]]),Ms={name:"AgentMessageBubble",components:{ChatArticle:ds,ChatCard:jt,ChatForm:Yt,ChatOptions:os,EmailInput:ps,CustomerSatisfaction:ks,IntegrationCard:xs},props:{message:{type:String,default:null},contentType:{type:String,default:null},messageType:{type:Number,default:null},messageId:{type:Number,default:null},messageContentAttributes:{type:Object,default:()=>{}}},setup(){const{formatMessage:e,getPlainText:n,truncateMessage:s,highlightContent:l}=N(),{getThemeClass:i}=E();return{formatMessage:e,getPlainText:n,truncateMessage:s,highlightContent:l,getThemeClass:i}},computed:{isTemplate(){return this.messageType===3},isTemplateEmail(){return this.contentType==="input_email"},isCards(){return this.contentType==="cards"},isOptions(){return this.contentType==="input_select"},isForm(){return this.contentType==="form"},isArticle(){return this.contentType==="article"},isCSAT(){return this.contentType==="input_csat"},isIntegrations(){return this.contentType==="integrations"}},methods:{onResponse(e){this.$store.dispatch("message/update",e)},onOptionSelect(e){this.onResponse({submittedValues:[e],messageId:this.messageId})},onFormSubmit(e){const n=Object.keys(e).map(s=>({name:s,value:e[s]}));this.onResponse({submittedValues:n,messageId:this.messageId})}}},Rs={class:"chat-bubble-wrap"},Fs={class:"message-content text-slate-900 dark:text-slate-50"},Os={key:1},Ls={key:3},Bs={key:4};function Us(e,n,s,l,i,t){const o=d("EmailInput"),u=d("IntegrationCard"),g=d("ChatOptions"),A=d("ChatForm"),w=d("ChatCard"),R=d("ChatArticle"),x=d("CustomerSatisfaction"),B=U("dompurify-html");return a(),r("div",Rs,[!t.isCards&&!t.isOptions&&!t.isForm&&!t.isArticle&&!t.isCards&&!t.isCSAT?(a(),r("div",{key:0,class:p(["chat-bubble agent",l.getThemeClass("bg-white","dark:bg-slate-700 has-dark-mode")])},[M(c("div",Fs,null,512),[[B,l.formatMessage(s.message,!1)]]),t.isTemplateEmail?(a(),h(o,{key:0,"message-id":s.messageId,"message-content-attributes":s.messageContentAttributes},null,8,["message-id","message-content-attributes"])):m("",!0),t.isIntegrations?(a(),h(u,{key:1,"message-id":s.messageId,"meeting-data":s.messageContentAttributes.data},null,8,["message-id","meeting-data"])):m("",!0)],2)):m("",!0),t.isOptions?(a(),r("div",Os,[f(g,{title:s.message,options:s.messageContentAttributes.items,"hide-fields":!!s.messageContentAttributes.submitted_values,onOptionSelect:t.onOptionSelect},null,8,["title","options","hide-fields","onOptionSelect"])])):m("",!0),t.isForm&&!s.messageContentAttributes.submitted_values?(a(),h(A,{key:2,items:s.messageContentAttributes.items,"button-label":s.messageContentAttributes.button_label,"submitted-values":s.messageContentAttributes.submitted_values,onSubmit:t.onFormSubmit},null,8,["items","button-label","submitted-values","onSubmit"])):m("",!0),t.isCards?(a(),r("div",Ls,[(a(!0),r(v,null,S(s.messageContentAttributes.items,y=>(a(),h(w,{key:y.title,"media-url":y.media_url,title:y.title,description:y.description,actions:y.actions},null,8,["media-url","title","description","actions"]))),128))])):m("",!0),t.isArticle?(a(),r("div",Bs,[f(R,{items:s.messageContentAttributes.items},null,8,["items"])])):m("",!0),t.isCSAT?(a(),h(x,{key:5,"message-content-attributes":s.messageContentAttributes.submitted_values,"message-id":s.messageId},null,8,["message-content-attributes","message-id"])):m("",!0)])}const Vs=_(Ms,[["render",Us]]),Ds={name:"AgentMessage",components:{AgentMessageBubble:Vs,ImageBubble:J,VideoBubble:Q,Thumbnail:Ie,UserMessage:ne,FileBubble:ee,MessageReplyButton:Z,ReplyToChip:se},mixins:[Y,te],props:{message:{type:Object,default:()=>{}},replyTo:{type:Object,default:()=>{}}},setup(){const{getThemeClass:e}=E();return{getThemeClass:e}},data(){return{hasImageError:!1,hasVideoError:!1}},computed:{shouldDisplayAgentMessage(){return this.contentType==="input_select"&&this.messageContentAttributes.submitted_values&&!this.message.content?!1:this.message.content},readableTime(){const{created_at:e=""}=this.message;return X(e,"LLL d yyyy, h:mm a")},messageType(){const{message_type:e=1}=this.message;return e},contentType(){const{content_type:e=""}=this.message;return e},agentName(){return this.message.sender?this.message.sender.available_name||this.message.sender.name:this.useInboxAvatarForBot?this.channelConfig.websiteName:this.$t("UNREAD_VIEW.BOT")},avatarUrl(){const e=this.useInboxAvatarForBot?this.inboxAvatarUrl:"/assets/images/chatwoot_bot.png";return this.message.message_type===K.TEMPLATE?e:this.message.sender?this.message.sender.avatar_url:e},hasRecordedResponse(){return this.messageContentAttributes.submitted_email||this.messageContentAttributes.submitted_values&&!["form","input_csat"].includes(this.contentType)},responseMessage(){if(this.messageContentAttributes.submitted_email)return{content:this.messageContentAttributes.submitted_email};if(this.messageContentAttributes.submitted_values&&this.contentType==="input_select"){const[e={}]=this.messageContentAttributes.submitted_values;return{content:e.title||e.value}}return""},isASubmittedForm(){return Ee(this.message)},submittedFormValues(){return this.messageContentAttributes.submitted_values.map(e=>({id:e.name,content:e.value}))},wrapClass(){return{"has-text":this.shouldDisplayAgentMessage}},hasReplyTo(){return this.replyTo&&(this.replyTo.content||this.replyTo.attachments)}},watch:{message(){this.hasImageError=!1,this.hasVideoError=!1}},mounted(){this.hasImageError=!1,this.hasVideoError=!1},methods:{onImageLoadError(){this.hasImageError=!0},onVideoLoadError(){this.hasVideoError=!0},toggleReply(){F.emit(O.TOGGLE_REPLY_TO_MESSAGE,this.message)}}},Ps={key:0,class:"agent-message"},js={class:"avatar-wrap"},Ns={class:"message-wrap"},$s={key:0,class:"flex mt-2 mb-1 text-xs"},Ws={class:"flex gap-1"},zs={class:"space-y-2"},Hs={key:2,controls:""},qs=["src"],Gs={class:"flex flex-col justify-end"},Xs={key:2};function Ys(e,n,s,l,i,t){const o=d("Thumbnail"),u=d("ReplyToChip"),g=d("AgentMessageBubble"),A=d("ImageBubble"),w=d("VideoBubble"),R=d("FileBubble"),x=d("MessageReplyButton"),B=d("UserMessage"),y=U("dompurify-html");return a(),r("div",{class:p(["agent-message-wrap group",{"has-response":t.hasRecordedResponse||t.isASubmittedForm}])},[t.isASubmittedForm?m("",!0):(a(),r("div",Ps,[c("div",js,[s.message.showAvatar||t.hasRecordedResponse?(a(),h(o,{key:0,src:t.avatarUrl,size:"24px",username:t.agentName},null,8,["src","username"])):m("",!0)]),c("div",Ns,[t.hasReplyTo?(a(),r("div",$s,[f(u,{"reply-to":s.replyTo},null,8,["reply-to"])])):m("",!0),c("div",Ws,[c("div",zs,[t.shouldDisplayAgentMessage?(a(),h(g,{key:0,"content-type":t.contentType,"message-content-attributes":e.messageContentAttributes,"message-id":s.message.id,"message-type":t.messageType,message:s.message.content},null,8,["content-type","message-content-attributes","message-id","message-type","message"])):m("",!0),e.hasAttachments?(a(),r("div",{key:1,class:p(["space-y-2 chat-bubble has-attachment agent",(t.wrapClass,l.getThemeClass("bg-white","dark:bg-slate-700"))])},[(a(!0),r(v,null,S(s.message.attachments,k=>(a(),r("div",{key:k.id},[k.file_type==="image"&&!i.hasImageError?(a(),h(A,{key:0,url:k.data_url,thumb:k.data_url,"readable-time":t.readableTime,onError:t.onImageLoadError},null,8,["url","thumb","readable-time","onError"])):m("",!0),k.file_type==="video"&&!i.hasVideoError?(a(),h(w,{key:1,url:k.data_url,"readable-time":t.readableTime,onError:t.onVideoLoadError},null,8,["url","readable-time","onError"])):k.file_type==="audio"?(a(),r("audio",Hs,[c("source",{src:k.data_url},null,8,qs)])):(a(),h(R,{key:3,url:k.data_url},null,8,["url"]))]))),128))],2)):m("",!0)]),c("div",Gs,[f(x,{class:"transition-opacity delay-75 opacity-0 group-hover:opacity-100 sm:opacity-0",onClick:t.toggleReply},null,8,["onClick"])])]),s.message.showAvatar||t.hasRecordedResponse?M((a(),r("p",{key:1,class:p(["agent-name",l.getThemeClass("text-slate-700","dark:text-slate-200")])},null,2)),[[y,t.agentName]]):m("",!0)])])),t.hasRecordedResponse?(a(),h(B,{key:1,message:t.responseMessage},null,8,["message"])):m("",!0),t.isASubmittedForm?(a(),r("div",Xs,[(a(!0),r(v,null,S(t.submittedFormValues,k=>(a(),h(B,{key:k.id,message:k},null,8,["message"]))),128))])):m("",!0)],2)}const Ks=_(Ds,[["render",Ys]]),Zs={components:{AgentMessage:Ks,UserMessage:ne},props:{message:{type:Object,default:()=>{}}},computed:{...T({allMessages:"conversation/getConversation"}),isUserMessage(){return this.message.message_type===K.INCOMING},replyTo(){var n,s;const e=(s=(n=this.message)==null?void 0:n.content_attributes)==null?void 0:s.in_reply_to;return e?this.allMessages[e]:null}}};function Js(e,n,s,l,i,t){const o=d("UserMessage"),u=d("AgentMessage");return t.isUserMessage?(a(),h(o,{key:0,id:`cwmsg-${s.message.id}`,message:s.message,"reply-to":t.replyTo},null,8,["id","message","reply-to"])):(a(),h(u,{key:1,id:`cwmsg-${s.message.id}`,message:s.message,"reply-to":t.replyTo},null,8,["id","message","reply-to"]))}const Qs=_(Zs,[["render",Js],["__scopeId","data-v-275c22e5"]]),en={name:"AgentTypingBubble",setup(){const{getThemeClass:e}=E();return{getThemeClass:e}}},tn={class:"agent-message-wrap"},sn={class:"agent-message"},nn={class:"message-wrap mt-2"};function an(e,n,s,l,i,t){return a(),r("div",tn,[c("div",sn,[n[1]||(n[1]=c("div",{class:"avatar-wrap"},null,-1)),c("div",nn,[c("div",{class:p(["typing-bubble chat-bubble agent",l.getThemeClass("bg-white","dark:bg-slate-700")])},n[0]||(n[0]=[c("img",{src:Se,alt:"Agent is typing a message"},null,-1)]),2)])])])}const on=_(en,[["render",an],["__scopeId","data-v-00b50137"]]),rn={props:{date:{type:String,required:!0}},setup(){const{getThemeClass:e}=E();return{getThemeClass:e}},computed:{formattedDate(){return Ae({date:this.date,todayText:this.$t("TODAY"),yesterdayText:this.$t("YESTERDAY")})}}};function ln(e,n,s,l,i,t){return a(),r("div",{class:p(["date--separator",l.getThemeClass("text-slate-700","dark:text-slate-200")])},b(t.formattedDate),3)}const cn=_(rn,[["render",ln],["__scopeId","data-v-3feae2d4"]]),dn={name:"ConversationWrap",components:{ChatMessage:Qs,AgentTypingBubble:on,DateSeparator:cn,Spinner:V},props:{groupedMessages:{type:Array,default:()=>[]}},setup(){const{darkMode:e}=E();return{darkMode:e}},data(){return{previousScrollHeight:0,previousConversationSize:0}},computed:{...T({earliestMessage:"conversation/getEarliestMessage",lastMessage:"conversation/getLastMessage",allMessagesLoaded:"conversation/getAllMessagesLoaded",isFetchingList:"conversation/getIsFetchingList",conversationSize:"conversation/getConversationSize",isAgentTyping:"conversation/getIsAgentTyping",conversationAttributes:"conversationAttributes/getConversationParams"}),colorSchemeClass(){return`${this.darkMode==="dark"?"dark-scheme":"light-scheme"}`},showStatusIndicator(){const{status:e}=this.conversationAttributes,n=e==="pending",s=this.lastMessage.message_type===re.INCOMING;return this.isAgentTyping||n&&s}},watch:{allMessagesLoaded(){this.previousScrollHeight=0}},mounted(){this.$el.addEventListener("scroll",this.handleScroll),this.scrollToBottom()},updated(){this.previousConversationSize!==this.conversationSize&&(this.previousConversationSize=this.conversationSize,this.scrollToBottom())},unmounted(){this.$el.removeEventListener("scroll",this.handleScroll)},methods:{...W("conversation",["fetchOldConversations"]),scrollToBottom(){const e=this.$el;e.scrollTop=e.scrollHeight-this.previousScrollHeight,this.previousScrollHeight=0},handleScroll(){this.isFetchingList||this.allMessagesLoaded||!this.conversationSize||this.$el.scrollTop<100&&(this.fetchOldConversations({before:this.earliestMessage.id}),this.previousScrollHeight=this.$el.scrollHeight)}}},un={key:0,class:"message--loader"};function mn(e,n,s,l,i,t){const o=d("Spinner"),u=d("DateSeparator"),g=d("ChatMessage"),A=d("AgentTypingBubble");return a(),r("div",{class:p(["conversation--container",t.colorSchemeClass])},[c("div",{class:p(["conversation-wrap",{"is-typing":e.isAgentTyping}])},[e.isFetchingList?(a(),r("div",un,[f(o)])):m("",!0),(a(!0),r(v,null,S(s.groupedMessages,w=>(a(),r("div",{key:w.date,class:"messages-wrap"},[f(u,{date:w.date},null,8,["date"]),(a(!0),r(v,null,S(w.messages,R=>(a(),h(g,{key:R.id,message:R},null,8,["message"]))),128))]))),128)),t.showStatusIndicator?(a(),h(A,{key:1})):m("",!0)],2)],2)}const hn=_(dn,[["render",mn],["__scopeId","data-v-f7f196d6"]]),gn={components:{ChatFooter:Ye,ConversationWrap:hn},computed:{...T({groupedMessages:"conversation/getGroupedConversation"})},mounted(){this.$store.dispatch("conversation/setUserLastSeen")}},pn={class:"flex flex-col flex-1 overflow-hidden rounded-b-lg bg-slate-25 dark:bg-slate-800"},_n={class:"flex flex-1 overflow-auto"};function bn(e,n,s,l,i,t){const o=d("ConversationWrap"),u=d("ChatFooter");return a(),r("div",pn,[c("div",_n,[f(o,{"grouped-messages":e.groupedMessages},null,8,["grouped-messages"])]),f(u,{class:"px-5"})])}const Qn=_(gn,[["render",bn]]);export{Qn as default};
