import{r as N,c as G,u as k,o as m,n as p,e as f,p as e,q as D,L as l,m as S,t as r,g as y,U as Z,a0 as ee,F as j,i as z,k as b,f as x,l as h,P as Ee,a as q,H as pe}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as P}from"./index-BaHWIRRA.js";import{T as _e}from"./Thumbnail-DLjRBBx8.js";import{u as te}from"./globalConfig-DaGjiImb.js";import{c as oe,v as H,u as Ae}from"./mutationHelpers-3VTcoJiD.js";import{u as ie,r as B,e as ve,m as Me}from"./index-C2DForDf.js";import{af as re,al as Ge}from"./dashboard-CGLIihvy.js";import{w as Ne}from"./DashboardIcon-CPXNa31t.js";import{_ as Ie}from"./BaseSettingsHeader-CxIYpdLq.js";import{_ as fe}from"./SettingsLayout-CbuFko1M.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./vue-router-CNCrM2WK.js";import"./index-BP-sUqpX.js";import"./index-DaWXXnfb.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./timeHelper-BT38nsET.js";import"./Spinner-B-aSVz3z.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./exports-CsC-x4VI.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";import"./Icon-Dtj3LCzD.js";import"./BackButton-YZy1EtJv.js";const ge={class:"flex flex-col h-auto overflow-auto"},Re={class:"w-full"},$e=["placeholder"],Se={class:"w-full"},he=["value"],be={key:0,class:"message"},De={class:"w-full"},ye=["placeholder"],Le={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"},we={class:"w-full"},Oe={__name:"AddAgent",emits:["close"],setup(K,{emit:L}){const v=L,R=oe(),{t:I}=te(),g=N(""),T=N(""),_=N("agent"),o=ie({agentName:{required:B},agentEmail:{required:B,email:ve},selectedRoleId:{required:B}},{agentName:g,agentEmail:T,selectedRoleId:_}),F=H("agents/getUIFlags"),V=H("customRole/getCustomRoles"),E=G(()=>{const n=[{id:"administrator",name:"administrator",label:I("AGENT_MGMT.AGENT_TYPES.ADMINISTRATOR")},{id:"agent",name:"agent",label:I("AGENT_MGMT.AGENT_TYPES.AGENT")}],s=V.value.map(M=>({id:M.id,name:`custom_${M.id}`,label:M.name}));return[...n,...s]}),$=G(()=>E.value.find(n=>n.id===_.value||n.name===_.value)),U=async()=>{var n;if(o.value.$touch(),!o.value.$invalid)try{const s={name:g.value,email:T.value};$.value.name.startsWith("custom_")?s.custom_role_id=$.value.id:s.role=$.value.name,await R.dispatch("agents/create",s),P(I("AGENT_MGMT.ADD.API.SUCCESS_MESSAGE")),v("close")}catch(s){const{response:{data:{error:M="",attributes:u=[],message:Y=""}={}}={}}=s;let O="";((n=s==null?void 0:s.response)==null?void 0:n.status)===422&&!u.includes("base")?O=I("AGENT_MGMT.ADD.API.EXIST_MESSAGE"):O=I("AGENT_MGMT.ADD.API.ERROR_MESSAGE"),P(M||Y||O)}};return(n,s)=>{const M=k("woot-modal-header");return m(),p("div",ge,[f(M,{"header-title":n.$t("AGENT_MGMT.ADD.TITLE"),"header-content":n.$t("AGENT_MGMT.ADD.DESC")},null,8,["header-title","header-content"]),e("form",{class:"flex flex-col items-start w-full",onSubmit:x(U,["prevent"])},[e("div",Re,[e("label",{class:D({error:l(o).agentName.$error})},[S(r(n.$t("AGENT_MGMT.ADD.FORM.NAME.LABEL"))+" ",1),y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>g.value=u),type:"text",placeholder:n.$t("AGENT_MGMT.ADD.FORM.NAME.PLACEHOLDER"),onInput:s[1]||(s[1]=(...u)=>l(o).agentName.$touch&&l(o).agentName.$touch(...u))},null,40,$e),[[Z,g.value]])],2)]),e("div",Se,[e("label",{class:D({error:l(o).selectedRoleId.$error})},[S(r(n.$t("AGENT_MGMT.ADD.FORM.AGENT_TYPE.LABEL"))+" ",1),y(e("select",{"onUpdate:modelValue":s[2]||(s[2]=u=>_.value=u),onChange:s[3]||(s[3]=(...u)=>l(o).selectedRoleId.$touch&&l(o).selectedRoleId.$touch(...u))},[(m(!0),p(j,null,z(E.value,u=>(m(),p("option",{key:u.id,value:u.id},r(u.label),9,he))),128))],544),[[ee,_.value]]),l(o).selectedRoleId.$error?(m(),p("span",be,r(n.$t("AGENT_MGMT.ADD.FORM.AGENT_TYPE.ERROR")),1)):b("",!0)],2)]),e("div",De,[e("label",{class:D({error:l(o).agentEmail.$error})},[S(r(n.$t("AGENT_MGMT.ADD.FORM.EMAIL.LABEL"))+" ",1),y(e("input",{"onUpdate:modelValue":s[4]||(s[4]=u=>T.value=u),type:"email",placeholder:n.$t("AGENT_MGMT.ADD.FORM.EMAIL.PLACEHOLDER"),onInput:s[5]||(s[5]=(...u)=>l(o).agentEmail.$touch&&l(o).agentEmail.$touch(...u))},null,40,ye),[[Z,T.value]])],2)]),e("div",Le,[e("div",we,[f(re,{disabled:l(o).$invalid||l(F).isCreating,"button-text":n.$t("AGENT_MGMT.ADD.FORM.SUBMIT"),loading:l(F).isCreating},null,8,["disabled","button-text","loading"]),e("button",{class:"button clear",onClick:s[6]||(s[6]=x(u=>v("close"),["prevent"]))},r(n.$t("AGENT_MGMT.ADD.CANCEL_BUTTON_TEXT")),1)])])],32)])}}},Ce={class:"flex flex-col h-auto overflow-auto"},Pe={class:"w-full"},Fe=["placeholder"],Ue={class:"w-full"},ke=["value"],Be={key:0,class:"message"},Ve={class:"w-full"},Ye=["value"],xe={key:0,class:"message"},je={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"},ze={class:"w-[50%]"},He={class:"w-[50%] text-right"},We={__name:"EditAgent",props:{id:{type:Number,required:!0},name:{type:String,required:!0},email:{type:String,default:""},type:{type:String,default:""},availability:{type:String,default:""},customRoleId:{type:Number,default:null}},emits:["close"],setup(K,{emit:L}){const v=K,R=L,{AVAILABILITY_STATUS_KEYS:I}=Ne,g=oe(),{t:T}=te(),_=N(v.name),w=N(v.availability),o=N(v.customRoleId||v.type),F=N({email:v.email}),V={agentName:{required:B,minLength:Me(1)},selectedRoleId:{required:B},agentAvailability:{required:B}},E=ie(V,{agentName:_,selectedRoleId:o,agentAvailability:w}),$=G(()=>`${T("AGENT_MGMT.EDIT.TITLE")} - ${v.name}`),U=H("agents/getUIFlags"),n=H("customRole/getCustomRoles"),s=G(()=>{const a=[{id:"administrator",name:"administrator",label:T("AGENT_MGMT.AGENT_TYPES.ADMINISTRATOR")},{id:"agent",name:"agent",label:T("AGENT_MGMT.AGENT_TYPES.AGENT")}],d=n.value.map(C=>({id:C.id,name:`custom_${C.id}`,label:C.name}));return[...a,...d]}),M=G(()=>s.value.find(a=>a.id===o.value||a.name===o.value)),u=G(()=>[T("PROFILE_SETTINGS.FORM.AVAILABILITY.STATUS.ONLINE"),T("PROFILE_SETTINGS.FORM.AVAILABILITY.STATUS.BUSY"),T("PROFILE_SETTINGS.FORM.AVAILABILITY.STATUS.OFFLINE")]),Y=G(()=>u.value.map((a,d)=>({label:a,value:I[d],disabled:v.availability===I[d]}))),O=async()=>{if(E.value.$touch(),!E.value.$invalid)try{const a={id:v.id,name:_.value,availability:w.value};M.value.name.startsWith("custom_")?a.custom_role_id=M.value.id:(a.role=M.value.name,a.custom_role_id=null),await g.dispatch("agents/update",a),P(T("AGENT_MGMT.EDIT.API.SUCCESS_MESSAGE")),R("close")}catch{P(T("AGENT_MGMT.EDIT.API.ERROR_MESSAGE"))}},J=async()=>{try{await Ge.resetPassword(F.value),P(T("AGENT_MGMT.EDIT.PASSWORD_RESET.ADMIN_SUCCESS_MESSAGE"))}catch{P(T("AGENT_MGMT.EDIT.PASSWORD_RESET.ERROR_MESSAGE"))}};return(a,d)=>{const C=k("woot-modal-header"),W=k("woot-button");return m(),p("div",Ce,[f(C,{"header-title":$.value},null,8,["header-title"]),e("form",{class:"w-full",onSubmit:x(O,["prevent"])},[e("div",Pe,[e("label",{class:D({error:l(E).agentName.$error})},[S(r(a.$t("AGENT_MGMT.EDIT.FORM.NAME.LABEL"))+" ",1),y(e("input",{"onUpdate:modelValue":d[0]||(d[0]=c=>_.value=c),type:"text",placeholder:a.$t("AGENT_MGMT.EDIT.FORM.NAME.PLACEHOLDER"),onInput:d[1]||(d[1]=(...c)=>l(E).agentName.$touch&&l(E).agentName.$touch(...c))},null,40,Fe),[[Z,_.value]])],2)]),e("div",Ue,[e("label",{class:D({error:l(E).selectedRoleId.$error})},[S(r(a.$t("AGENT_MGMT.EDIT.FORM.AGENT_TYPE.LABEL"))+" ",1),y(e("select",{"onUpdate:modelValue":d[2]||(d[2]=c=>o.value=c),onChange:d[3]||(d[3]=(...c)=>l(E).selectedRoleId.$touch&&l(E).selectedRoleId.$touch(...c))},[(m(!0),p(j,null,z(s.value,c=>(m(),p("option",{key:c.id,value:c.id},r(c.label),9,ke))),128))],544),[[ee,o.value]]),l(E).selectedRoleId.$error?(m(),p("span",Be,r(a.$t("AGENT_MGMT.EDIT.FORM.AGENT_TYPE.ERROR")),1)):b("",!0)],2)]),e("div",Ve,[e("label",{class:D({error:l(E).agentAvailability.$error})},[S(r(a.$t("PROFILE_SETTINGS.FORM.AVAILABILITY.LABEL"))+" ",1),y(e("select",{"onUpdate:modelValue":d[4]||(d[4]=c=>w.value=c),onChange:d[5]||(d[5]=(...c)=>l(E).agentAvailability.$touch&&l(E).agentAvailability.$touch(...c))},[(m(!0),p(j,null,z(Y.value,c=>(m(),p("option",{key:c.value,value:c.value},r(c.label),9,Ye))),128))],544),[[ee,w.value]]),l(E).agentAvailability.$error?(m(),p("span",xe,r(a.$t("AGENT_MGMT.EDIT.FORM.AGENT_AVAILABILITY.ERROR")),1)):b("",!0)],2)]),e("div",je,[e("div",ze,[f(re,{disabled:l(E).$invalid||l(U).isUpdating,"button-text":a.$t("AGENT_MGMT.EDIT.FORM.SUBMIT"),loading:l(U).isUpdating},null,8,["disabled","button-text","loading"]),e("button",{class:"button clear",onClick:d[6]||(d[6]=x(c=>R("close"),["prevent"]))},r(a.$t("AGENT_MGMT.EDIT.CANCEL_BUTTON_TEXT")),1)]),e("div",He,[f(W,{icon:"lock-closed",variant:"clear",onClick:x(J,["prevent"])},{default:h(()=>[S(r(a.$t("AGENT_MGMT.EDIT.PASSWORD_RESET.ADMIN_RESET_BUTTON")),1)]),_:1})])])],32)])}}},Xe={class:"divide-y divide-slate-75 dark:divide-slate-700"},qe={class:"divide-y divide-slate-50 dark:divide-slate-800 text-slate-700 dark:text-slate-300"},Ke={class:"py-4 ltr:pr-4 rtl:pl-4"},Je={class:"flex flex-row items-center gap-4"},Qe={class:"block font-medium capitalize"},Ze={class:"relative py-4 ltr:pr-4 rtl:pl-4"},et={class:"flex flex-col gap-1 p-4"},tt={class:"font-semibold"},ot={class:"pl-4 mb-0 list-disc"},st={class:"py-4 ltr:pr-4 rtl:pl-4"},lt={key:0},at={key:1},nt={class:"py-4"},it={class:"flex justify-end gap-1"},Ut={__name:"Index",setup(K){const L=Ae(),v=oe(),{t:R}=te(),I=N({}),g=N(!1),T=N(!1),_=N(!1),w=N({message:""}),o=N({}),F=G(()=>`${R("AGENT_MGMT.DELETE.CONFIRM.YES")} ${o.value.name}`),V=G(()=>`${R("AGENT_MGMT.DELETE.CONFIRM.NO")} ${o.value.name}`),E=G(()=>` ${o.value.name}?`),$=G(()=>L["agents/getAgents"].value),U=G(()=>L["agents/getUIFlags"].value),n=G(()=>L.getCurrentUserID.value),s=H("customRole/getCustomRoles");Ee(()=>{v.dispatch("agents/get"),v.dispatch("customRole/getCustomRole")});const M=t=>s.value.find(A=>A.id===t.custom_role_id),u=t=>{if(!t.custom_role_id)return R(`AGENT_MGMT.AGENT_TYPES.${t.role.toUpperCase()}`);const A=M(t);return A?A.name:""},Y=t=>{if(!t.custom_role_id)return[];const A=M(t);return(A==null?void 0:A.permissions)||[]},O=G(()=>$.value.filter(t=>t.role==="administrator"&&t.confirmed)),J=t=>n.value!==t.id,a=t=>n.value===t.id?!1:t.confirmed&&t.role==="administrator"?O.value.length!==1:!0,d=t=>{I.value[o.value.id]=!1,o.value={},w.value.message=t,P(t)},C=()=>{g.value=!0},W=()=>{g.value=!1},c=t=>{_.value=!0,o.value=t},se=()=>{_.value=!1},ue=t=>{T.value=!0,o.value=t},le=()=>{T.value=!1},de=async t=>{try{await v.dispatch("agents/delete",t),d(R("AGENT_MGMT.DELETE.API.SUCCESS_MESSAGE"))}catch{d(R("AGENT_MGMT.DELETE.API.ERROR_MESSAGE"))}},ce=()=>{I.value[o.value.id]=!0,le(),de(o.value.id)};return(t,A)=>{const Q=k("woot-button"),ae=k("woot-modal"),me=k("woot-delete-modal"),ne=pe("tooltip");return m(),q(fe,{"is-loading":U.value.isFetching,"loading-message":t.$t("AGENT_MGMT.LOADING"),"no-records-found":!$.value.length,"no-records-message":t.$t("AGENT_MGMT.LIST.404")},{header:h(()=>[f(Ie,{title:t.$t("AGENT_MGMT.HEADER"),description:t.$t("AGENT_MGMT.DESCRIPTION"),"link-text":t.$t("AGENT_MGMT.LEARN_MORE"),"feature-name":"agents"},{actions:h(()=>[f(Q,{class:"rounded-md button nice",icon:"add-circle",onClick:C},{default:h(()=>[S(r(t.$t("AGENT_MGMT.HEADER_BTN_TXT")),1)]),_:1})]),_:1},8,["title","description","link-text"])]),body:h(()=>[e("table",Xe,[e("tbody",qe,[(m(!0),p(j,null,z($.value,(i,Te)=>(m(),p("tr",{key:i.email},[e("td",Ke,[e("div",Je,[f(_e,{src:i.thumbnail,username:i.name,size:"40px",status:i.availability_status},null,8,["src","username","status"]),e("div",null,[e("span",Qe,r(i.name),1),e("span",null,r(i.email),1)])])]),e("td",Ze,[e("span",{class:D(["block font-medium w-fit",{"hover:text-gray-900 group cursor-pointer":i.custom_role_id}])},[S(r(u(i))+" ",1),e("div",{class:D(["absolute left-0 z-10 hidden max-w-[300px] w-auto bg-white rounded-xl border border-slate-50 shadow-lg top-14 md:top-12 dark:bg-slate-800 dark:border-slate-700",{"group-hover:block":i.custom_role_id}])},[e("div",et,[e("span",tt,r(t.$t("AGENT_MGMT.LIST.AVAILABLE_CUSTOM_ROLE")),1),e("ul",ot,[(m(!0),p(j,null,z(Y(i),X=>(m(),p("li",{key:X,class:"font-normal"},r(t.$t(`CUSTOM_ROLE.PERMISSIONS.${X.toUpperCase()}`)),1))),128))])])],2)],2)]),e("td",st,[i.confirmed?(m(),p("span",lt,r(t.$t("AGENT_MGMT.LIST.VERIFIED")),1)):b("",!0),i.confirmed?b("",!0):(m(),p("span",at,r(t.$t("AGENT_MGMT.LIST.VERIFICATION_PENDING")),1))]),e("td",nt,[e("div",it,[J(i)?y((m(),q(Q,{key:0,variant:"smooth",size:"tiny","color-scheme":"secondary",icon:"edit","class-names":"grey-btn",onClick:X=>c(i)},null,8,["onClick"])),[[ne,t.$t("AGENT_MGMT.EDIT.BUTTON_TEXT"),void 0,{top:!0}]]):b("",!0),a(i)?y((m(),q(Q,{key:1,variant:"smooth","color-scheme":"alert",size:"tiny",icon:"dismiss-circle","class-names":"grey-btn","is-loading":I.value[i.id],onClick:X=>ue(i,Te)},null,8,["is-loading","onClick"])),[[ne,t.$t("AGENT_MGMT.DELETE.BUTTON_TEXT"),void 0,{top:!0}]]):b("",!0)])])]))),128))])])]),default:h(()=>[f(ae,{show:g.value,"onUpdate:show":A[0]||(A[0]=i=>g.value=i),"on-close":W},{default:h(()=>[f(Oe,{onClose:W})]),_:1},8,["show"]),f(ae,{show:_.value,"onUpdate:show":A[1]||(A[1]=i=>_.value=i),"on-close":se},{default:h(()=>[_.value?(m(),q(We,{key:0,id:o.value.id,name:o.value.name,type:o.value.role,email:o.value.email,availability:o.value.availability_status,"custom-role-id":o.value.custom_role_id,onClose:se},null,8,["id","name","type","email","availability","custom-role-id"])):b("",!0)]),_:1},8,["show"]),f(me,{show:T.value,"onUpdate:show":A[2]||(A[2]=i=>T.value=i),"on-close":le,"on-confirm":ce,title:t.$t("AGENT_MGMT.DELETE.CONFIRM.TITLE"),message:t.$t("AGENT_MGMT.DELETE.CONFIRM.MESSAGE"),"message-value":E.value,"confirm-text":F.value,"reject-text":V.value},null,8,["show","title","message","message-value","confirm-text","reject-text"])]),_:1},8,["is-loading","loading-message","no-records-found","no-records-message"])}}};export{Ut as default};
