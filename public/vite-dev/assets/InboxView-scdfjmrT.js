import{m as g,e as C}from"./globalConfig-DaGjiImb.js";import{u as x,a as y}from"./index-BaHWIRRA.js";import{d as N}from"./events-Ch9G9t6H.js";import{w as O}from"./DashboardIcon-CPXNa31t.js";import{C as E,f as T}from"./CustomSnoozeModal-C-8tQQe1.js";import{I as S,u as B}from"./dashboard-CGLIihvy.js";import{_ as v,u as c,o as n,n as s,p as m,e as a,t as h,k as I,l as u,m as _,a as b}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{q as z}from"./mutationHelpers-3VTcoJiD.js";import{C as L}from"./ConversationBox-B7QZ3ztP.js";import A from"./InboxEmptyState-GpTfvM8b.js";import{B as M}from"./vue-router-CNCrM2WK.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./exports-CsC-x4VI.js";import"./Icon-Dtj3LCzD.js";import"./index-CbMJaKeB.js";import"./index-BP-sUqpX.js";import"./index.es-CaHyKWHu.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./timeHelper-BT38nsET.js";import"./Spinner-B-aSVz3z.js";import"./Thumbnail-DLjRBBx8.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./index-C2DForDf.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";import"./index-DaWXXnfb.js";import"./CustomAttributes-CrR_sV2i.js";import"./constants-lVAyZKq6.js";import"./useMessageFormatter-CoQTTzFX.js";import"./InboxName-DzICaIqB.js";import"./agentHelper-C7QvnyM_.js";import"./index-Cq2yv_RT.js";import"./ContextMenu-CbEc-VsQ.js";import"./AddLabel-CnIX2z1Y.js";import"./labelColor-5G4vXyDu.js";import"./vue-upload-component-ChbSM2aG.js";import"./MultiselectDropdown-Cp046MCC.js";import"./MultiselectDropdownItems-DEUXvTsY.js";import"./useAI-wLJAkZPm.js";import"./vuedraggable.umd-rGNd3eNJ.js";import"./macroHelper-BAX1mbBw.js";import"./BackButton-YZy1EtJv.js";import"./DropdownList-BAxlWPFC.js";import"./UserAvatarWithName-BHDu0HJS.js";import"./keyboardEventListenerMixins-Du6EPVcl.js";import"./IframeLoader-BAMW9xzX.js";import"./portalHelper-trLcR8pg.js";import"./index-ChSFqGPn.js";import"./MessageTypeHelper-CjbF8VpS.js";import"./typing-cGLaWCAF.js";import"./AddCanned-Cd1FYIf_.js";import"./DateHelper-D7GM2F2-.js";const P={props:{totalLength:{type:Number,default:0},currentIndex:{type:Number,default:0}},emits:["prev","next"],computed:{isUpDisabled(){return this.currentIndex===1},isDownDisabled(){return this.currentIndex===this.totalLength||this.totalLength<=1}},methods:{handleUpClick(){this.currentIndex>1&&this.$emit("prev")},handleDownClick(){this.currentIndex<this.totalLength&&this.$emit("next")}}},D={class:"flex gap-2 items-center"},U={class:"flex gap-1 items-center"},$={class:"flex items-center gap-1 whitespace-nowrap"},V={class:"text-sm font-medium text-gray-600 tabular-nums"},X={key:0,class:"text-sm text-slate-400 relative -top-px"},F={key:1,class:"text-sm text-slate-400 tabular-nums"};function R(t,o,i,l,d,e){const r=c("woot-button");return n(),s("div",D,[m("div",U,[a(r,{size:"tiny",variant:"hollow","color-scheme":"secondary",icon:"chevron-up",disabled:e.isUpDisabled,onClick:e.handleUpClick},null,8,["disabled","onClick"]),a(r,{size:"tiny",variant:"hollow","color-scheme":"secondary",icon:"chevron-down",disabled:e.isDownDisabled,onClick:e.handleDownClick},null,8,["disabled","onClick"])]),m("div",$,[m("span",V,h(i.totalLength<=1?"1":i.currentIndex),1),i.totalLength>1?(n(),s("span",X," / ")):I("",!0),i.totalLength>1?(n(),s("span",F,h(i.totalLength),1)):I("",!0)])])}const j=v(P,[["render",R]]),H={components:{PaginationButton:j,CustomSnoozeModal:E},props:{totalLength:{type:Number,default:0},currentIndex:{type:Number,default:0},activeNotification:{type:Object,default:null}},emits:["next","prev"],data(){return{showCustomSnoozeModal:!1}},computed:{...g({meta:"notifications/getMeta"})},mounted(){C.on(N,this.onCmdSnoozeNotification)},unmounted(){C.off(N,this.onCmdSnoozeNotification)},methods:{openSnoozeNotificationModal(){document.querySelector("ninja-keys").open({parent:"snooze_notification"})},hideCustomSnoozeModal(){this.showCustomSnoozeModal=!1},async snoozeNotification(t){var o;try{await this.$store.dispatch("notifications/snooze",{id:(o=this.activeNotification)==null?void 0:o.id,snoozedUntil:t}),x(this.$t("INBOX.ALERTS.SNOOZE"))}catch{}},onCmdSnoozeNotification(t){if(t===O.SNOOZE_OPTIONS.UNTIL_CUSTOM_TIME)this.showCustomSnoozeModal=!0;else{const o=T(t)||null;this.snoozeNotification(o)}},scheduleCustomSnooze(t){if(this.showCustomSnoozeModal=!1,t){const o=z(t)||null;this.snoozeNotification(o)}},deleteNotification(){y(S.DELETE_NOTIFICATION),this.$store.dispatch("notifications/delete",{notification:this.activeNotification,unread_count:this.meta.unreadCount,count:this.meta.count}).then(()=>{x(this.$t("INBOX.ALERTS.DELETE"))}),this.$router.replace({name:"inbox_view"})},onClickNext(){this.$emit("next")},onClickPrev(){this.$emit("prev")},onClickGoToInboxList(){this.$router.replace({name:"inbox_view"})}}},G={class:"flex items-center justify-between w-full gap-2 py-2 border-b ltr:pl-4 rtl:pl-2 h-14 ltr:pr-2 rtl:pr-4 rtl:border-r border-slate-50 dark:border-slate-800/50"},Z={key:1},q={class:"flex items-center gap-2"};function K(t,o,i,l,d,e){const r=c("woot-button"),p=c("PaginationButton"),f=c("CustomSnoozeModal"),w=c("woot-modal");return n(),s("div",G,[a(r,{variant:"clear link",class:"flex md:hidden !pt-1 !pb-1 rounded-md ltr:pr-1 rtl:pl-1 !no-underline",size:"medium","color-scheme":"primary",icon:"chevron-left",onClick:e.onClickGoToInboxList},{default:u(()=>[_(h(t.$t("INBOX.ACTION_HEADER.BACK")),1)]),_:1},8,["onClick"]),i.totalLength>1?(n(),b(p,{key:0,"total-length":i.totalLength,"current-index":i.currentIndex+1,onNext:e.onClickNext,onPrev:e.onClickPrev},null,8,["total-length","current-index","onNext","onPrev"])):(n(),s("div",Z)),m("div",q,[a(r,{variant:"hollow",size:"small","color-scheme":"secondary",icon:"snooze",class:"[&>span]:hidden md:[&>span]:inline-flex",onClick:e.openSnoozeNotificationModal},{default:u(()=>[_(h(t.$t("INBOX.ACTION_HEADER.SNOOZE")),1)]),_:1},8,["onClick"]),a(r,{icon:"delete",size:"small","color-scheme":"secondary",variant:"hollow",class:"[&>span]:hidden md:[&>span]:inline-flex",onClick:e.deleteNotification},{default:u(()=>[_(h(t.$t("INBOX.ACTION_HEADER.DELETE")),1)]),_:1},8,["onClick"])]),a(w,{show:d.showCustomSnoozeModal,"onUpdate:show":o[0]||(o[0]=k=>d.showCustomSnoozeModal=k),"on-close":e.hideCustomSnoozeModal},{default:u(()=>[a(f,{onClose:e.hideCustomSnoozeModal,onChooseTime:e.scheduleCustomSnooze},null,8,["onClose","onChooseTime"])]),_:1},8,["show","on-close"])])}const J=v(H,[["render",K]]),Q={components:{InboxItemHeader:J,InboxEmptyState:A,ConversationBox:L},setup(){const{uiSettings:t,updateUISettings:o}=B();return{uiSettings:t,updateUISettings:o}},data(){return{isConversationLoading:!1}},computed:{...g({notification:"notifications/getFilteredNotifications",currentChat:"getSelectedChat",activeNotificationById:"notifications/getNotificationById",conversationById:"getConversationById",uiFlags:"notifications/getUIFlags",meta:"notifications/getMeta"}),notifications(){return this.notification({sortOrder:this.activeSortOrder})},inboxId(){return Number(this.$route.params.inboxId)},notificationId(){return Number(this.$route.params.notification_id)},activeNotification(){return this.activeNotificationById(this.notificationId)},conversationId(){var t,o;return(o=(t=this.activeNotification)==null?void 0:t.primary_actor)==null?void 0:o.id},totalNotificationCount(){return this.meta.count},showEmptyState(){var t;return!this.conversationId||!((t=this.notifications)!=null&&t.length)&&this.uiFlags.isFetching},activeNotificationIndex(){var t;return(t=this.notifications)==null?void 0:t.findIndex(o=>o.id===this.notificationId)},activeSortOrder(){const{inbox_filter_by:t={}}=this.uiSettings,{sort_by:o}=t;return o||"desc"},isContactPanelOpen(){if(this.currentChat.id){const{is_contact_sidebar_open:t}=this.uiSettings;return t}return!1}},watch:{conversationId:{immediate:!0,handler(t,o){t!==o&&this.fetchConversationById()}}},mounted(){this.$store.dispatch("agents/get")},methods:{async fetchConversationById(){if(!this.notificationId||!this.conversationId)return;this.$store.dispatch("clearSelectedState");const t=this.findConversation();if(t){this.setActiveChat(t);return}this.isConversationLoading=!0,await this.$store.dispatch("getConversation",this.conversationId),this.setActiveChat(),this.isConversationLoading=!1},setActiveChat(){const t=this.findConversation();t&&this.$store.dispatch("setActiveChat",{data:t}).then(()=>{C.emit(M.SCROLL_TO_MESSAGE)})},findConversation(){return this.conversationById(this.conversationId)},navigateToConversation(t,o){let i;o==="prev"&&t?i=t-1:o==="next"&&t<this.totalNotificationCount&&(i=t+1);const l=this.notifications[i];l&&this.openNotification(l)},openNotification(t){const{id:o,primary_actor_id:i,primary_actor_type:l,primary_actor:{meta:{unreadCount:d}={}},notification_type:e}=t;y(S.OPEN_CONVERSATION_VIA_INBOX,{notificationType:e}),this.$store.dispatch("notifications/read",{id:o,primaryActorId:i,primaryActorType:l,unreadCount:d}),this.$router.push({name:"inbox_view_conversation",params:{notification_id:o}})},onClickNext(){this.navigateToConversation(this.activeNotificationIndex,"next")},onClickPrev(){this.navigateToConversation(this.activeNotificationIndex,"prev")},onToggleContactPanel(){this.updateUISettings({is_contact_sidebar_open:!this.isContactPanelOpen})}}},W={class:"h-full w-full md:w-[calc(100%-360px)]"},Y={key:0,class:"flex w-full h-full"},tt={key:1,class:"flex flex-col w-full h-full"},ot={key:0,class:"flex items-center h-[calc(100%-56px)] justify-center bg-slate-25 dark:bg-slate-800"};function et(t,o,i,l,d,e){const r=c("InboxEmptyState"),p=c("InboxItemHeader"),f=c("ConversationBox");return n(),s("div",W,[e.showEmptyState?(n(),s("div",Y,[a(r,{"empty-state-message":t.$t("INBOX.LIST.NO_MESSAGES_AVAILABLE")},null,8,["empty-state-message"])])):(n(),s("div",tt,[a(p,{class:"flex-1","total-length":e.totalNotificationCount,"current-index":e.activeNotificationIndex,"active-notification":e.activeNotification,onNext:e.onClickNext,onPrev:e.onClickPrev},null,8,["total-length","current-index","active-notification","onNext","onPrev"]),d.isConversationLoading?(n(),s("div",ot,o[0]||(o[0]=[m("span",{class:"my-4 spinner"},null,-1)]))):(n(),b(f,{key:1,class:"h-[calc(100%-56px)]","is-inbox-view":"","inbox-id":e.inboxId,"is-contact-panel-open":e.isContactPanelOpen,"is-on-expanded-layout":!1,onContactPanelToggle:e.onToggleContactPanel},null,8,["inbox-id","is-contact-panel-open","onContactPanelToggle"]))]))])}const co=v(Q,[["render",et]]);export{co as default};
