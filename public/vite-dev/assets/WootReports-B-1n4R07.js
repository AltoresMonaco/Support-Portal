import{u as P,a as y}from"./index-BaHWIRRA.js";import{s as b,q as L,e as A}from"./mutationHelpers-3VTcoJiD.js";import{s as F}from"./vue-router-CNCrM2WK.js";import{T as C}from"./Thumbnail-DLjRBBx8.js";import{W as G}from"./DateRangePicker-BS8Sn4en.js";import{G as a}from"./constants-CvJgIWgr.js";import{_ as N,u as h,o as c,n as d,p as l,t as n,e as m,l as E,B as D,F as S,m as g,k as O,a as I}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{R as w}from"./ReportContainer-Dd_ptqR_.js";import{aw as U,av as f}from"./dashboard-CGLIihvy.js";const x=5,M={components:{WootDateRangePicker:G,Thumbnail:C},props:{filterItemsList:{type:Array,default:()=>[]},groupByFilterItemsList:{type:Array,default:()=>[]},type:{type:String,default:"agent"},selectedGroupByFilter:{type:Object,default:()=>{}}},emits:["businessHoursToggle","dateRangeChange","filterChange","groupByFilterChange"],data(){return{currentSelectedFilter:null,currentDateRangeSelection:{id:0,name:this.$t("REPORT.DATE_RANGE_OPTIONS.LAST_7_DAYS")},customDateRange:[new Date,new Date],currentSelectedGroupByFilter:null,businessHoursSelected:!1}},computed:{dateRange(){return[{id:0,name:this.$t("REPORT.DATE_RANGE_OPTIONS.LAST_7_DAYS")},{id:1,name:this.$t("REPORT.DATE_RANGE_OPTIONS.LAST_30_DAYS")},{id:2,name:this.$t("REPORT.DATE_RANGE_OPTIONS.LAST_3_MONTHS")},{id:3,name:this.$t("REPORT.DATE_RANGE_OPTIONS.LAST_6_MONTHS")},{id:4,name:this.$t("REPORT.DATE_RANGE_OPTIONS.LAST_YEAR")},{id:5,name:this.$t("REPORT.DATE_RANGE_OPTIONS.CUSTOM_DATE_RANGE")}]},isDateRangeSelected(){return this.currentDateRangeSelection.id===x},to(){return this.isDateRangeSelected?this.toCustomDate(this.customDateRange[1]):this.toCustomDate(new Date)},from(){if(this.isDateRangeSelected)return this.fromCustomDate(this.customDateRange[0]);const t={0:6,1:29,2:89,3:179,4:364}[this.currentDateRangeSelection.id],i=b(new Date,t);return this.fromCustomDate(i)},multiselectLabel(){return{agent:this.$t("AGENT_REPORTS.FILTER_DROPDOWN_LABEL"),label:this.$t("LABEL_REPORTS.FILTER_DROPDOWN_LABEL"),inbox:this.$t("INBOX_REPORTS.FILTER_DROPDOWN_LABEL"),team:this.$t("TEAM_REPORTS.FILTER_DROPDOWN_LABEL")}[this.type]||this.$t("FORMS.MULTISELECT.SELECT_ONE")},groupBy(){return this.isDateRangeSelected?a[4].period:{0:a[1].period,1:a[2].period,2:a[3].period,3:a[3].period,4:a[4].period}[this.currentDateRangeSelection.id]},notLast7Days(){return this.groupBy!==a[1].period}},watch:{filterItemsList(e){this.currentSelectedFilter=e[0],this.changeFilterSelection()},groupByFilterItemsList(){this.currentSelectedGroupByFilter=this.selectedGroupByFilter},businessHoursSelected(){this.$emit("businessHoursToggle",this.businessHoursSelected)}},mounted(){this.onDateRangeChange()},methods:{onDateRangeChange(){this.$emit("dateRangeChange",{from:this.from,to:this.to,groupBy:this.groupBy})},fromCustomDate(e){return L(F(e))},toCustomDate(e){return L(A(e))},changeDateSelection(e){this.currentDateRangeSelection=e,this.onDateRangeChange()},changeFilterSelection(){this.$emit("filterChange",this.currentSelectedFilter)},onChange(e){this.customDateRange=e,this.onDateRangeChange()},changeGroupByFilterSelection(){this.$emit("groupByFilterChange",this.currentSelectedGroupByFilter)}}},k={class:"flex flex-col md:flex-row"},V={class:"flex flex-col items-center w-full md:flex-row"},H={key:0,class:"md:w-[240px] w-full multiselect-wrap--small"},v={class:"mb-2 text-xs font-medium"},W={class:"flex items-center gap-2"},K={class:"reports-option__desc"},Y={class:"my-0 text-slate-800 dark:text-slate-75"},z={class:"flex items-center gap-2"},$={class:"my-0 text-slate-800 dark:text-slate-75"},X={key:1,class:"md:w-[240px] w-full multiselect-wrap--small"},j={class:"mb-2 text-xs font-medium"},q={class:"flex items-center gap-2"},J={class:"reports-option__desc"},Q={class:"my-0 text-slate-800 dark:text-slate-75"},Z={class:"flex items-center gap-2"},ee={class:"reports-option__desc"},te={class:"my-0 text-slate-800 dark:text-slate-75"},se={key:2,class:"md:w-[240px] w-full multiselect-wrap--small"},oe={class:"mb-2 text-xs font-medium"},le={class:"mx-1 md:w-[240px] w-full multiselect-wrap--small"},ie={class:"mb-2 text-xs font-medium"},re={key:3,class:""},ne={class:"mb-2 text-xs font-medium"},ae={key:4,class:"mx-1 md:w-[240px] w-full multiselect-wrap--small"},ce={class:"mb-2 text-xs font-medium"},ue={class:"flex items-center my-2"},de={class:"mx-2 text-sm whitespace-nowrap"};function me(e,t,i,u,o,r){const R=h("Thumbnail"),p=h("multiselect"),T=h("WootDateRangePicker"),B=h("woot-switch");return c(),d("div",k,[l("div",V,[i.type==="agent"?(c(),d("div",H,[l("p",v,n(e.$t("AGENT_REPORTS.FILTER_DROPDOWN_LABEL")),1),m(p,{modelValue:o.currentSelectedFilter,"onUpdate:modelValue":[t[0]||(t[0]=s=>o.currentSelectedFilter=s),r.changeFilterSelection],placeholder:r.multiselectLabel,label:"name","track-by":"id",options:i.filterItemsList,"option-height":24,"show-labels":!1},{singleLabel:E(s=>[l("div",W,[m(R,{src:s.option.thumbnail,status:s.option.availability_status,username:s.option.name,size:"22px"},null,8,["src","status","username"]),l("span",K,[l("span",Y,n(s.option.name),1)])])]),options:E(s=>[l("div",z,[m(R,{src:s.option.thumbnail,status:s.option.availability_status,username:s.option.name,size:"22px"},null,8,["src","status","username"]),l("p",$,n(s.option.name),1)])]),_:1},8,["modelValue","placeholder","options","onUpdate:modelValue"])])):i.type==="label"?(c(),d("div",X,[l("p",j,n(e.$t("LABEL_REPORTS.FILTER_DROPDOWN_LABEL")),1),m(p,{modelValue:o.currentSelectedFilter,"onUpdate:modelValue":[t[1]||(t[1]=s=>o.currentSelectedFilter=s),r.changeFilterSelection],placeholder:r.multiselectLabel,label:"title","track-by":"id",options:i.filterItemsList,"option-height":24,"show-labels":!1},{singleLabel:E(s=>[l("div",q,[l("div",{style:D({backgroundColor:s.option.color}),class:"w-5 h-5 rounded-full"},null,4),l("span",J,[l("span",Q,n(s.option.title),1)])])]),option:E(s=>[l("div",Z,[l("div",{style:D({backgroundColor:s.option.color}),class:"flex-shrink-0 w-5 h-5 border border-solid rounded-full border-slate-100 dark:border-slate-800"},null,4),l("span",ee,[l("span",te,n(s.option.title),1)])])]),_:1},8,["modelValue","placeholder","options","onUpdate:modelValue"])])):(c(),d("div",se,[l("p",oe,[i.type==="inbox"?(c(),d(S,{key:0},[g(n(e.$t("INBOX_REPORTS.FILTER_DROPDOWN_LABEL")),1)],64)):i.type==="team"?(c(),d(S,{key:1},[g(n(e.$t("TEAM_REPORTS.FILTER_DROPDOWN_LABEL")),1)],64)):(c(),d(S,{key:2},[g(n(e.$t("FORMS.MULTISELECT.SELECT_ONE")),1)],64))]),m(p,{modelValue:o.currentSelectedFilter,"onUpdate:modelValue":[t[2]||(t[2]=s=>o.currentSelectedFilter=s),r.changeFilterSelection],"track-by":"id",label:"name",placeholder:r.multiselectLabel,"selected-label":"","select-label":e.$t("FORMS.MULTISELECT.ENTER_TO_SELECT"),"deselect-label":"",options:i.filterItemsList,searchable:!1,"allow-empty":!1},null,8,["modelValue","placeholder","select-label","options","onUpdate:modelValue"])])),l("div",le,[l("p",ie,n(e.$t("REPORT.DURATION_FILTER_LABEL")),1),m(p,{modelValue:o.currentDateRangeSelection,"onUpdate:modelValue":t[3]||(t[3]=s=>o.currentDateRangeSelection=s),"track-by":"name",label:"name",placeholder:e.$t("FORMS.MULTISELECT.SELECT_ONE"),"selected-label":"","select-label":e.$t("FORMS.MULTISELECT.ENTER_TO_SELECT"),"deselect-label":"",options:r.dateRange,searchable:!1,"allow-empty":!1,onSelect:r.changeDateSelection},null,8,["modelValue","placeholder","select-label","options","onSelect"])]),r.isDateRangeSelected?(c(),d("div",re,[l("p",ne,n(e.$t("REPORT.CUSTOM_DATE_RANGE.PLACEHOLDER")),1),m(T,{"show-range":"",value:o.customDateRange,"confirm-text":e.$t("REPORT.CUSTOM_DATE_RANGE.CONFIRM"),placeholder:e.$t("REPORT.CUSTOM_DATE_RANGE.PLACEHOLDER"),onChange:r.onChange},null,8,["value","confirm-text","placeholder","onChange"])])):O("",!0),r.notLast7Days?(c(),d("div",ae,[l("p",ce,n(e.$t("REPORT.GROUP_BY_FILTER_DROPDOWN_LABEL")),1),m(p,{modelValue:o.currentSelectedGroupByFilter,"onUpdate:modelValue":[t[4]||(t[4]=s=>o.currentSelectedGroupByFilter=s),r.changeGroupByFilterSelection],"track-by":"id",label:"groupBy",placeholder:e.$t("REPORT.GROUP_BY_FILTER_DROPDOWN_LABEL"),options:i.groupByFilterItemsList,"allow-empty":!1,"show-labels":!1},null,8,["modelValue","placeholder","options","onUpdate:modelValue"])])):O("",!0)]),l("div",ue,[l("span",de,n(e.$t("REPORT.BUSINESS_HOURS")),1),l("span",null,[m(B,{modelValue:o.businessHoursSelected,"onUpdate:modelValue":t[5]||(t[5]=s=>o.businessHoursSelected=s)},null,8,["modelValue"])])])])}const pe=N(M,[["render",me]]),he={CONVERSATIONS:"conversations_count",INCOMING_MESSAGES:"incoming_messages_count",OUTGOING_MESSAGES:"outgoing_messages_count",FIRST_RESPONSE_TIME:"avg_first_response_time",RESOLUTION_TIME:"avg_resolution_time",RESOLUTION_COUNT:"resolutions_count",REPLY_TIME:"reply_time"},_={DAY:[{id:1,groupByKey:"REPORT.GROUPING_OPTIONS.DAY"}],WEEK:[{id:1,groupByKey:"REPORT.GROUPING_OPTIONS.DAY"},{id:2,groupByKey:"REPORT.GROUPING_OPTIONS.WEEK"}],MONTH:[{id:1,groupByKey:"REPORT.GROUPING_OPTIONS.DAY"},{id:2,groupByKey:"REPORT.GROUPING_OPTIONS.WEEK"},{id:3,groupByKey:"REPORT.GROUPING_OPTIONS.MONTH"}],YEAR:[{id:2,groupByKey:"REPORT.GROUPING_OPTIONS.WEEK"},{id:3,groupByKey:"REPORT.GROUPING_OPTIONS.MONTH"},{id:4,groupByKey:"REPORT.GROUPING_OPTIONS.YEAR"}]},Re={components:{ReportFilters:pe,ReportContainer:w},props:{type:{type:String,default:"account"},getterKey:{type:String,default:""},actionKey:{type:String,default:""},downloadButtonLabel:{type:String,default:"Download Reports"}},data(){return{from:0,to:0,selectedFilter:null,groupBy:a[1],groupByfilterItemsList:_.DAY.map(this.translateOptions),selectedGroupByFilter:null,businessHours:!1}},computed:{filterItemsList(){return this.$store.getters[this.getterKey]||[]}},mounted(){this.$store.dispatch(this.actionKey)},methods:{fetchAllData(){if(this.selectedFilter){const{from:e,to:t,groupBy:i,businessHours:u}=this;this.$store.dispatch("fetchAccountSummary",{from:e,to:t,type:this.type,id:this.selectedFilter.id,groupBy:i.period,businessHours:u}),this.fetchChartData()}},fetchChartData(){["CONVERSATIONS","INCOMING_MESSAGES","OUTGOING_MESSAGES","FIRST_RESPONSE_TIME","RESOLUTION_TIME","RESOLUTION_COUNT","REPLY_TIME"].forEach(async e=>{try{const{from:t,to:i,groupBy:u,businessHours:o}=this;this.$store.dispatch("fetchAccountReport",{metric:he[e],from:t,to:i,type:this.type,id:this.selectedFilter.id,groupBy:u.period,businessHours:o})}catch{P(this.$t("REPORT.DATA_FETCHING_FAILED"))}})},downloadReports(){const{from:e,to:t,type:i,businessHours:u}=this,o={agent:"downloadAgentReports",label:"downloadLabelReports",inbox:"downloadInboxReports",team:"downloadTeamReports"};if(o[i]){const r=U({type:i,to:t,businessHours:u}),R={from:e,to:t,fileName:r,businessHours:u};this.$store.dispatch(o[i],R)}},onDateRangeChange({from:e,to:t,groupBy:i}){this.from!==0&&this.to!==0&&y(f.FILTER_REPORT,{filterType:"date",reportType:this.type}),this.from=e,this.to=t,this.groupByfilterItemsList=this.fetchFilterItems(i);const u=this.groupByfilterItemsList.filter(o=>o.id===this.groupBy.id);u.length>0?this.selectedGroupByFilter=u[0]:(this.selectedGroupByFilter=this.groupByfilterItemsList[0],this.groupBy=a[this.selectedGroupByFilter.id]),this.fetchAllData()},onFilterChange(e){e&&(this.selectedFilter=e,this.fetchAllData())},onGroupByFilterChange(e){var t;this.groupBy=a[e.id],this.fetchAllData(),y(f.FILTER_REPORT,{filterType:"groupBy",filterValue:(t=this.groupBy)==null?void 0:t.period,reportType:this.type})},fetchFilterItems(e){switch(e){case a[2].period:return _.WEEK.map(this.translateOptions);case a[3].period:return _.MONTH.map(this.translateOptions);case a[4].period:return _.YEAR.map(this.translateOptions);default:return _.DAY.map(this.translateOptions)}},translateOptions(e){return{id:e.id,groupBy:this.$t(e.groupByKey)}},onBusinessHoursToggle(e){this.businessHours=e,this.fetchAllData(),y(f.FILTER_REPORT,{filterType:"businessHours",filterValue:e,reportType:this.type})}}},_e={class:"flex-1 p-4 overflow-auto"};function Ee(e,t,i,u,o,r){const R=h("woot-button"),p=h("ReportFilters"),T=h("ReportContainer");return c(),d("div",_e,[m(R,{"color-scheme":"success","class-names":"button--fixed-top",icon:"arrow-download",onClick:r.downloadReports},{default:E(()=>[g(n(i.downloadButtonLabel),1)]),_:1},8,["onClick"]),r.filterItemsList?(c(),I(p,{key:0,type:i.type,"filter-items-list":r.filterItemsList,"group-by-filter-items-list":o.groupByfilterItemsList,"selected-group-by-filter":o.selectedGroupByFilter,onDateRangeChange:r.onDateRangeChange,onFilterChange:r.onFilterChange,onGroupByFilterChange:r.onGroupByFilterChange,onBusinessHoursToggle:r.onBusinessHoursToggle},null,8,["type","filter-items-list","group-by-filter-items-list","selected-group-by-filter","onDateRangeChange","onFilterChange","onGroupByFilterChange","onBusinessHoursToggle"])):O("",!0),r.filterItemsList.length?(c(),I(T,{key:1,"group-by":o.groupBy},null,8,["group-by"])):O("",!0)])}const Ne=N(Re,[["render",Ee]]);export{Ne as W};
