import{m as b}from"./globalConfig-DaGjiImb.js";import{v as C,f as l}from"./mutationHelpers-3VTcoJiD.js";import{f as S}from"./utils.esm-CA3tRshB.js";import{G as T,M as h}from"./constants-CvJgIWgr.js";import{f as _}from"./vue-router-CNCrM2WK.js";import{o,n as i,p,t as E,L as f,q as y,k as x,_ as N,u as g,F as K,i as A,e as $,a as R}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{_ as Y}from"./BarChart-Cyq4Hy7M.js";function M(t="getAccountSummary"){const r=C(t),s=e=>{if(!r.value.previous[e])return 0;const n=r.value[e]-r.value.previous[e];return Math.round(n/r.value.previous[e]*100)},u=e=>["avg_first_response_time","avg_resolution_time","reply_time"].includes(e);return{calculateTrend:s,isAverageMetricType:u,displayMetric:e=>u(e)?S(r.value[e]):Number(r.value[e]||"").toLocaleString()}}const P={class:"text-slate-900 dark:text-slate-100"},D={class:"text-sm"},L={class:"flex items-end"},k={class:"text-xl font-medium"},w={key:0,class:"text-xs ml-4 flex items-center mb-0.5"},B={__name:"ChartStats",props:{metric:{type:Object,default:()=>({})},accountSummaryKey:{type:String,default:"getAccountSummary"}},setup(t){const r=t,{calculateTrend:s,displayMetric:u,isAverageMetricType:a}=M(r.accountSummaryKey),e=(n,d)=>a(d)?n>0?"border-red-500 text-red-500":"border-green-500 text-green-500":n<0?"border-red-500 text-red-500":"border-green-500 text-green-500";return(n,d)=>(o(),i("div",P,[p("span",D,E(t.metric.NAME),1),p("div",L,[p("div",k,E(f(u)(t.metric.KEY)),1),t.metric.trend?(o(),i("div",w,[t.metric.trend<0?(o(),i("div",{key:0,class:y(["h-0 w-0 border-x-4 medium border-x-transparent border-t-[8px] mr-1",e(t.metric.trend,t.metric.KEY)])},null,2)):(o(),i("div",{key:1,class:y(["h-0 w-0 border-x-4 medium border-x-transparent border-b-[8px] mr-1",e(t.metric.trend,t.metric.KEY)])},null,2)),p("span",{class:y(["font-medium",e(t.metric.trend,t.metric.KEY)])},E(f(s)(t.metric.KEY))+"% ",3)])):x("",!0)])]))}},G={components:{ChartStats:B,BarChart:Y},props:{groupBy:{type:Object,default:()=>({})},accountSummaryKey:{type:String,default:"getAccountSummary"},reportKeys:{type:Object,default:()=>({CONVERSATIONS:"conversations_count",INCOMING_MESSAGES:"incoming_messages_count",OUTGOING_MESSAGES:"outgoing_messages_count",FIRST_RESPONSE_TIME:"avg_first_response_time",RESOLUTION_TIME:"avg_resolution_time",RESOLUTION_COUNT:"resolutions_count",REPLY_TIME:"reply_time"})}},setup(t){const{calculateTrend:r,isAverageMetricType:s}=M(t.accountSummaryKey);return{calculateTrend:r,isAverageMetricType:s}},computed:{...b({accountReport:"getAccountReports"}),metrics(){const t=Object.keys(this.reportKeys),r={FIRST_RESPONSE_TIME:this.$t("REPORT.METRICS.FIRST_RESPONSE_TIME.INFO_TEXT"),RESOLUTION_TIME:this.$t("REPORT.METRICS.RESOLUTION_TIME.INFO_TEXT")};return t.map(s=>({NAME:this.$t(`REPORT.METRICS.${s}.NAME`),KEY:this.reportKeys[s],DESC:this.$t(`REPORT.METRICS.${s}.DESC`),INFO_TEXT:r[s],TOOLTIP_TEXT:`REPORT.METRICS.${s}.TOOLTIP_TEXT`,trend:this.calculateTrend(this.reportKeys[s])}))}},methods:{getCollection(t){if(!this.accountReport.data[t.KEY])return{};const r=this.accountReport.data[t.KEY],s=r.map(a=>{var e,n,d;if(((e=this.groupBy)==null?void 0:e.period)===T[2].period){let m=new Date(_(a.timestamp));const c=m.getDate()-m.getDay(),O=c+6,I=new Date(m.setDate(c)),v=new Date(m.setDate(O));return`${l(I,"dd-MMM")} - ${l(v,"dd-MMM")}`}return((n=this.groupBy)==null?void 0:n.period)===T[3].period?l(_(a.timestamp),"MMM-yyyy"):((d=this.groupBy)==null?void 0:d.period)===T[4].period?l(_(a.timestamp),"yyyy"):l(_(a.timestamp),"dd-MMM")}),u=h[t.KEY].datasets.map(a=>{switch(a.type){case"bar":return{...a,yAxisID:"y",label:t.NAME,data:r.map(e=>e.value)};case"line":return{...a,yAxisID:"y",label:this.metrics[0].NAME,data:r.map(e=>e.count)};default:return a}});return{labels:s,datasets:u}},getChartOptions(t){let r={};return this.isAverageMetricType(t.KEY)&&(r.callbacks={label:s=>this.$t(t.TOOLTIP_TEXT,{metricValue:S(s.yLabel),conversationCount:this.accountReport.data[t.KEY][s.index].count})}),{scales:h[t.KEY].scales,tooltips:r}}}},F={class:"grid grid-cols-1 p-2 bg-white border rounded-md md:grid-cols-2 lg:grid-cols-3 dark:bg-slate-800 border-slate-100 dark:border-slate-700"},U={class:"mt-4 h-72"},X={key:1,class:"flex items-center justify-center h-72"},j={key:1,class:"text-sm text-slate-600"};function V(t,r,s,u,a,e){const n=g("ChartStats"),d=g("woot-loading-state"),m=g("BarChart");return o(),i("div",F,[(o(!0),i(K,null,A(e.metrics,c=>(o(),i("div",{key:c.KEY,class:"p-4 mb-3 rounded-md"},[$(n,{metric:c,"account-summary-key":s.accountSummaryKey},null,8,["metric","account-summary-key"]),p("div",U,[t.accountReport.isFetching[c.KEY]?(o(),R(d,{key:0,class:"text-xs",message:t.$t("REPORT.LOADING_CHART")},null,8,["message"])):(o(),i("div",X,[t.accountReport.data[c.KEY].length?(o(),R(m,{key:0,collection:e.getCollection(c),"chart-options":e.getChartOptions(c)},null,8,["collection","chart-options"])):(o(),i("span",j,E(t.$t("REPORT.NO_ENOUGH_DATA")),1))]))])]))),128))])}const tt=N(G,[["render",V]]);export{tt as R};
