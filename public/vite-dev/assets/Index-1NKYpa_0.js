import{c as _,P as R,w as x,o as u,n as c,e as U,p as l,a as N,t as p,F as S,i as I,u as k,L as C}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as B}from"./index-BaHWIRRA.js";import{B as w}from"./timeHelper-BT38nsET.js";import{u as $,c as H}from"./mutationHelpers-3VTcoJiD.js";import{_ as K}from"./TableFooter-DOGhqcuD.js";import{_ as V}from"./BaseSettingsHeader-CxIYpdLq.js";import{u as F}from"./globalConfig-DaGjiImb.js";import{a as X,u as j}from"./vue-router-CNCrM2WK.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Spinner-B-aSVz3z.js";import"./Thumbnail-DLjRBBx8.js";import"./index-BO4rcqbh.js";import"./utils.esm-CA3tRshB.js";import"./exports-CsC-x4VI.js";import"./index-BP-sUqpX.js";import"./index-DaWXXnfb.js";import"./BackButton-YZy1EtJv.js";import"./dashboard-CGLIihvy.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./index-C2DForDf.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./DashboardIcon-CPXNa31t.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./Icon-Dtj3LCzD.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";const h={0:"agent",1:"administrator"},W={0:"online",1:"offline",2:"busy"},q={"automationrule:create":"AUDIT_LOGS.AUTOMATION_RULE.ADD","automationrule:update":"AUDIT_LOGS.AUTOMATION_RULE.EDIT","automationrule:destroy":"AUDIT_LOGS.AUTOMATION_RULE.DELETE","webhook:create":"AUDIT_LOGS.WEBHOOK.ADD","webhook:update":"AUDIT_LOGS.WEBHOOK.EDIT","webhook:destroy":"AUDIT_LOGS.WEBHOOK.DELETE","inbox:create":"AUDIT_LOGS.INBOX.ADD","inbox:update":"AUDIT_LOGS.INBOX.EDIT","inbox:destroy":"AUDIT_LOGS.INBOX.DELETE","user:sign_in":"AUDIT_LOGS.USER_ACTION.SIGN_IN","user:sign_out":"AUDIT_LOGS.USER_ACTION.SIGN_OUT","team:create":"AUDIT_LOGS.TEAM.ADD","team:update":"AUDIT_LOGS.TEAM.EDIT","team:destroy":"AUDIT_LOGS.TEAM.DELETE","macro:create":"AUDIT_LOGS.MACRO.ADD","macro:update":"AUDIT_LOGS.MACRO.EDIT","macro:destroy":"AUDIT_LOGS.MACRO.DELETE","accountuser:create":"AUDIT_LOGS.ACCOUNT_USER.ADD","accountuser:update:self":"AUDIT_LOGS.ACCOUNT_USER.EDIT.SELF","accountuser:update:other":"AUDIT_LOGS.ACCOUNT_USER.EDIT.OTHER","accountuser:update:deleted":"AUDIT_LOGS.ACCOUNT_USER.EDIT.DELETED","inboxmember:create":"AUDIT_LOGS.INBOX_MEMBER.ADD","inboxmember:destroy":"AUDIT_LOGS.INBOX_MEMBER.REMOVE","teammember:create":"AUDIT_LOGS.TEAM_MEMBER.ADD","teammember:destroy":"AUDIT_LOGS.TEAM_MEMBER.REMOVE","account:update":"AUDIT_LOGS.ACCOUNT.EDIT"};function b(e){return Array.isArray(e)?e[e.length-1]:e}function z(e){let t=[],r=[];return e.role&&e.role.length&&(t.push("role"),r.push(h[b(e.role)])),e.availability&&e.availability.length&&(t.push("availability"),r.push(W[b(e.availability)])),{changes:t,values:r}}function m(e,t){var s;return e===null?"System":((s=t.find(i=>i.id===e))==null?void 0:s.name)||e}function Y(e,t,r){t.invitee=m(e.audited_changes.user_id,r);const s=e.audited_changes.role;return t.role=h[s]||"unknown",t}function J(e,t,r){var i,T;e.user_id!==((i=e.auditable)==null?void 0:i.user_id)&&(t.user=m((T=e.auditable)==null?void 0:T.user_id,r));const s=z(e.audited_changes);return s&&(t.attributes=s.changes,t.values=s.values),t}function Q(e,t,r){const s=e.audited_changes.user_id;return s&&s!==void 0&&(t.user=m(s,r)),t}function Z(e,t){return e.audited_changes.team_id&&(t.team_id=e.audited_changes.team_id),t}function P(e,t){return e.audited_changes.inbox_id&&(t.inbox_id=e.audited_changes.inbox_id),t}function ee(e,t,r){return e.audited_changes&&(t=Q(e,t,r),t=Z(e,t),t=P(e,t)),t}function te(e,t,r,s){return s==="create"?Y(e,t,r):s==="update"?J(e,t,r):t}function re(e,t){let r={agentName:m(e.user_id,t),id:e.auditable_id};const s=e.auditable_type.toLowerCase(),i=e.action.toLowerCase();return s==="accountuser"&&(r=te(e,r,t,i)),(s==="inboxmember"||s==="teammember")&&(r=ee(e,r,t)),r}function se(e){return e.auditable===null?":deleted":e.user_id===e.auditable.user_id?":self":":other"}const ae=e=>{const t=e.auditable_type.toLowerCase(),r=e.action.toLowerCase();let s=`${t}:${r}`;return t==="accountuser"&&r==="update"&&(s+=se(e)),q[s]||""},oe={class:"flex-1 overflow-auto"},ne={class:"mt-6 flex-1 text-slate-700 dark:text-slate-300"},ie={key:1,class:"flex flex-col items-center justify-center h-full text-base p-8"},ue={key:2,class:"min-w-full overflow-x-auto"},ce={class:"divide-y divide-slate-75 dark:divide-slate-700"},le={class:"divide-y divide-slate-50 dark:divide-slate-800 text-slate-700 dark:text-slate-300"},_e={class:"py-4 pr-4 break-all whitespace-nowrap"},de={class:"py-4 pr-4 break-all whitespace-nowrap"},Ae={class:"py-4 w-[8.75rem]"},Xe={__name:"Index",setup(e){const t=$(),r=H(),s=X(),i=_(()=>t["auditlogs/getAuditLogs"].value),T=_(()=>t["auditlogs/getUIFlags"].value),E=_(()=>t["auditlogs/getMeta"].value),g=_(()=>t["agents/getAgents"].value),{t:d}=F(),y=j(),O=_(()=>Number(y.query.page??1)),f=a=>{try{r.dispatch("auditlogs/fetch",{page:a})}catch(o){const A=(o==null?void 0:o.message)||d("AUDIT_LOGS.API.ERROR_MESSAGE");B(A)}},G=a=>{const o=re(a,g.value),A=ae(a),n=D=>Array.isArray(D)?D.join(", "):D,M={...o,attributes:n(o.attributes),values:n(o.values)};return d(A,M)},L=a=>{s.push({name:"auditlogs_list",query:{page:a}})};R(()=>{r.dispatch("agents/get"),f(O.value)}),x(O,(a,o)=>{a!==o&&f(a)});const v=_(()=>[d("AUDIT_LOGS.LIST.TABLE_HEADER.ACTIVITY"),d("AUDIT_LOGS.LIST.TABLE_HEADER.TIME"),d("AUDIT_LOGS.LIST.TABLE_HEADER.IP_ADDRESS")]);return(a,o)=>{const A=k("woot-loading-state");return u(),c("div",oe,[U(V,{title:a.$t("AUDIT_LOGS.HEADER"),description:a.$t("AUDIT_LOGS.DESCRIPTION"),"link-text":a.$t("AUDIT_LOGS.LEARN_MORE"),"feature-name":"audit_logs"},null,8,["title","description","link-text"]),l("div",ne,[T.value.fetchingList?(u(),N(A,{key:0,message:a.$t("AUDIT_LOGS.LOADING")},null,8,["message"])):i.value.length?(u(),c("div",ue,[l("table",ce,[l("thead",null,[(u(!0),c(S,null,I(v.value,n=>(u(),c("th",{key:n,class:"py-4 pr-4 text-left font-semibold text-slate-700 dark:text-slate-300"},p(n),1))),128))]),l("tbody",le,[(u(!0),c(S,null,I(i.value,n=>(u(),c("tr",{key:n.id},[l("td",_e,p(G(n)),1),l("td",de,p(C(w)(n.created_at,"MMM dd, yyyy hh:mm a")),1),l("td",Ae,p(n.remote_address),1)]))),128))])]),U(K,{"current-page":Number(E.value.currentPage),"total-count":E.value.totalEntries,"page-size":E.value.perPage,class:"border-slate-50 dark:border-slate-800 border-t !px-0 py-4",onPageChange:L},null,8,["current-page","total-count","page-size"])])):(u(),c("p",ie,p(a.$t("AUDIT_LOGS.LIST.404")),1))])])}}};export{Xe as default};
