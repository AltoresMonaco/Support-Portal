import{u as I,m as G,e as Y}from"./globalConfig-DaGjiImb.js";import{o as n,a as $,l as A,p as t,q as M,L as C,e as g,t as d,_ as y,c as R,h as N,n as r,k as H,u as O,b as S,H as B,F as m,i as E,m as P,g as U}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as j,_ as z,c as q,g as K}from"./Table-qO3GIpbk.js";import{S as W}from"./Spinner-B-aSVz3z.js";import{E as Q,ay as J}from"./dashboard-CGLIihvy.js";import{_ as X}from"./Pagination-CWdWh8jn.js";import{_ as Z}from"./BaseCell-DrTvutGD.js";import{T as ee}from"./Thumbnail-DLjRBBx8.js";import{v as te,f as ae,e as b,q as T,s as se}from"./mutationHelpers-3VTcoJiD.js";import{O as V}from"./constants-CvJgIWgr.js";import{r as ne,t as oe}from"./index-BP-sUqpX.js";import{h as re}from"./utils.esm-CA3tRshB.js";import{s as D}from"./vue-router-CNCrM2WK.js";import"./axios-CCb-kr4I.js";import"./_commonjsHelpers-BosuxZz1.js";import"./globalConfigMixin-BNbqaRx5.js";import"./timeHelper-BT38nsET.js";import"./index-BO4rcqbh.js";import"./exports-CsC-x4VI.js";import"./index-BaHWIRRA.js";import"./index-Y4OjWrJ-.js";import"./index-C2DForDf.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./DashboardIcon-CPXNa31t.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./Icon-Dtj3LCzD.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";import"./index-DaWXXnfb.js";function ie(e){ne(1,arguments);var i=oe(e),o=i.getDay();return o}const le={class:"items-start flex flex-col min-w-0 my-0 mx-2"},ce={class:"overflow-hidden text-sm m-0 leading-[1.2] text-slate-800 dark:text-slate-100 whitespace-nowrap text-ellipsis"},de={class:"text-xs text-slate-600 dark:text-slate-200"},ue={__name:"AgentCell",props:{row:{type:Object,required:!0}},setup(e){const i=te("accounts/isRTL");return(o,f)=>(n(),$(Z,null,{default:A(()=>[t("div",{class:M(["items-center flex text-left",{"flex-row-reverse":C(i)}])},[g(ee,{src:e.row.original.thumbnail,size:"32px",username:e.row.original.agent,status:e.row.original.status},null,8,["src","username","status"]),t("div",le,[t("h6",ce,d(e.row.original.agent),1),t("span",de,d(e.row.original.email),1)])],2)]),_:1}))}},me={class:"agent-table-container"},ge={key:0,class:"agents-loader"},fe={__name:"AgentTable",props:{agents:{type:Array,default:()=>[]},agentMetrics:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},pageIndex:{type:Number,default:1}},emits:["pageChange"],setup(e,{emit:i}){const o=i,{t:f}=I();function x(s){var u;return(u=e.agents)==null?void 0:u.find(k=>k.id===Number(s))}function p(s){return s?Array.from(s).reduce((L,F)=>L+F.charCodeAt(0),0)*2147483647%1e6/1e6:0}const h=R(()=>e.agents.length),w=R(()=>e.agentMetrics.filter(s=>x(s.id)).map(s=>{const u=x(s.id);return{agent:u.name||u.available_name,email:u.email,thumbnail:u.thumbnail,open:s.metric.open||Math.floor(p(u.email)*50),unattended:s.metric.unattended||Math.floor(p(u.email)*30),status:u.availability_status}})),v=s=>N("span",{class:s.getValue()?"":"text-slate-300 dark:text-slate-700"},s.getValue()?s.getValue():"---"),l=q(),c=[l.accessor("agent",{header:f("OVERVIEW_REPORTS.AGENT_CONVERSATIONS.TABLE_HEADER.AGENT"),cell:s=>N(ue,s),size:250}),l.accessor("open",{header:f("OVERVIEW_REPORTS.AGENT_CONVERSATIONS.TABLE_HEADER.OPEN"),cell:v,size:100}),l.accessor("unattended",{header:f("OVERVIEW_REPORTS.AGENT_CONVERSATIONS.TABLE_HEADER.UNATTENDED"),cell:v,size:100})],_=R(()=>({pageIndex:e.pageIndex,pageSize:25})),a=j({get data(){return w.value},columns:c,manualPagination:!0,enableSorting:!1,getCoreRowModel:K(),get rowCount(){return h.value},state:{get pagination(){return _.value}},onPaginationChange:s=>{const u=s(_.value);o("pageChange",u.pageIndex)}});return(s,u)=>(n(),r("div",me,[g(z,{table:C(a),class:"max-h-[calc(100vh-21.875rem)] border border-slate-50 dark:border-slate-800"},null,8,["table"]),g(X,{class:"mt-2",table:C(a)},null,8,["table"]),e.isLoading?(n(),r("div",ge,[g(W),t("span",null,d(s.$t("OVERVIEW_REPORTS.AGENT_CONVERSATIONS.LOADING_MESSAGE")),1)])):!e.isLoading&&!e.agentMetrics.length?(n(),$(Q,{key:1,title:s.$t("OVERVIEW_REPORTS.AGENT_CONVERSATIONS.NO_AGENTS")},null,8,["title"])):H("",!0)]))}},pe=y(fe,[["__scopeId","data-v-ffbdd572"]]),he={name:"MetricCard",components:{Spinner:W},props:{header:{type:String,default:""},isLoading:{type:Boolean,default:!1},loadingMessage:{type:String,default:""}}},_e={class:"metric-card mb-2 p flex flex-col m-2 p-4 border border-solid overflow-hidden rounded-md flex-grow shadow-sm text-slate-700 dark:text-slate-100 bg-white dark:bg-slate-800 border-slate-75 dark:border-slate-700 min-h-[10rem]"},Ee={class:"card-header grid w-full mb-6 grid-cols-[repeat(auto-fit,minmax(max-content,50%))] gap-y-2"},xe={class:"flex items-center gap-0.5 flex-row"},Ae={class:"mb-0 text-slate-800 dark:text-slate-100 font-medium text-xl"},ve={class:"flex flex-row items-center pr-2 pl-2 m-1 rounded-sm text-green-400 dark:text-green-400 text-xs bg-green-100/30 dark:bg-green-100/20"},we={class:"transition-opacity duration-200 ease-in-out opacity-20 hover:opacity-100 flex flex-row items-center justify-end gap-2"},Oe={key:0,class:"card-body max-w-full w-full ml-auto mr-auto justify-between flex"},Re={key:1,class:"items-center flex text-base justify-center px-12 py-6"},Se={class:"text-slate-300 dark:text-slate-200"};function be(e,i,o,f,x,p){const h=O("Spinner");return n(),r("div",_e,[t("div",Ee,[S(e.$slots,"header",{},()=>[t("div",xe,[t("h5",Ae,d(o.header),1),t("span",ve,[i[0]||(i[0]=t("span",{class:"bg-green-500 dark:bg-green-500 h-1 w-1 rounded-full mr-1 rtl:mr-0 rtl:ml-0"},null,-1)),t("span",null,d(e.$t("OVERVIEW_REPORTS.LIVE")),1)])]),t("div",we,[S(e.$slots,"control")])])]),o.isLoading?o.isLoading?(n(),r("div",Re,[g(h),t("span",Se,d(o.loadingMessage),1)])):H("",!0):(n(),r("div",Oe,[S(e.$slots,"default")]))])}const Te=y(he,[["render",be]]),Ce={class:"grid relative w-full gap-x-4 gap-y-2.5 overflow-y-scroll md:overflow-visible grid-cols-[80px_1fr] min-h-72"},ye={class:"grid gap-[5px] flex-shrink-0"},ke={class:"grid gap-[5px] w-full min-w-[700px]"},Ne={class:"grid grid-cols-[repeat(24,_1fr)] gap-[5px] w-full text-[8px] font-semibold h-5 text-slate-800 dark:text-slate-200"},Ve={class:"grid gap-[5px] flex-shrink-0"},De={class:"font-normal text-slate-700 dark:text-slate-200"},Ie={class:"grid gap-[5px] w-full min-w-[700px]"},$e={class:"grid grid-cols-[repeat(24,_1fr)] gap-[5px] w-full text-[8px] font-semibold h-5 text-slate-800 dark:text-slate-200"},Me={__name:"Heatmap",props:{heatData:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},setup(e){const i=e,{t:o}=I(),f=R(()=>J(i.heatData)),x=R(()=>{const l=i.heatData.map(c=>c.value);return re(l,[.2,.4,.6,.8,.9,.99])});function p(l){return l?l===1?o("OVERVIEW_REPORTS.CONVERSATION_HEATMAP.CONVERSATION",{count:l}):o("OVERVIEW_REPORTS.CONVERSATION_HEATMAP.CONVERSATIONS",{count:l}):o("OVERVIEW_REPORTS.CONVERSATION_HEATMAP.NO_CONVERSATIONS")}function h(l){return ae(new Date(l),"MMM d, yyyy")}function w(l){const c=ie(l);return[o("DAYS_OF_WEEK.SUNDAY"),o("DAYS_OF_WEEK.MONDAY"),o("DAYS_OF_WEEK.TUESDAY"),o("DAYS_OF_WEEK.WEDNESDAY"),o("DAYS_OF_WEEK.THURSDAY"),o("DAYS_OF_WEEK.FRIDAY"),o("DAYS_OF_WEEK.SATURDAY")][c]}function v(l){if(!l)return"outline-slate-100 dark:outline-slate-700 dark:bg-slate-700/40 bg-slate-50/50";let c=[...x.value,1/0].findIndex(a=>l<=a&&l>0);return c>6&&(c=5),c===0?"outline-slate-100 dark:outline-slate-700 dark:bg-slate-700/40 bg-slate-50/50":["bg-woot-50 dark:bg-woot-800/40 dark:outline-woot-800/80","bg-woot-100 dark:bg-woot-800/30 dark:outline-woot-800/80","bg-woot-200 dark:bg-woot-500/40 dark:outline-woot-700/80","bg-woot-300 dark:bg-woot-500/60 dark:outline-woot-600/80","bg-woot-600 dark:bg-woot-500/80 dark:outline-woot-500/80","bg-woot-800 dark:bg-woot-500 dark:outline-woot-400/80"][c-1]}return(l,c)=>{const _=B("tooltip");return n(),r("div",Ce,[e.isLoading?(n(),r(m,{key:0},[t("div",ye,[(n(),r(m,null,E(7,a=>t("div",{key:a,class:"w-full rounded-sm bg-slate-100 dark:bg-slate-900 animate-loader-pulse h-8 min-w-[70px]"})),64))]),t("div",ke,[(n(),r(m,null,E(7,a=>t("div",{key:a,class:"grid gap-[5px] grid-cols-[repeat(24,_1fr)]"},[(n(),r(m,null,E(24,s=>t("div",{key:s,class:"w-full h-8 rounded-sm bg-slate-100 dark:bg-slate-900 animate-loader-pulse"})),64))])),64))]),c[0]||(c[0]=t("div",null,null,-1)),t("div",Ne,[(n(),r(m,null,E(24,a=>t("div",{key:a,class:"flex items-center justify-center"},d(a-1)+" – "+d(a),1)),64))])],64)):(n(),r(m,{key:1},[t("div",Ve,[(n(!0),r(m,null,E(f.value.keys(),a=>(n(),r("div",{key:a,class:"h-8 min-w-[70px] text-slate-800 dark:text-slate-200 text-[10px] font-semibold flex flex-col items-end justify-center"},[P(d(w(new Date(a)))+" ",1),t("time",De,d(h(a)),1)]))),128))]),t("div",Ie,[(n(!0),r(m,null,E(f.value.keys(),a=>(n(),r("div",{key:a,class:"grid gap-[5px] grid-cols-[repeat(24,_1fr)]"},[(n(!0),r(m,null,E(f.value.get(a),s=>U((n(),r("div",{key:s.timestamp,class:M(["h-8 rounded-sm shadow-inner dark:outline dark:outline-1 shadow-black",v(s.value)])},null,2)),[[_,p(s.value),void 0,{top:!0}]])),128))]))),128))]),c[1]||(c[1]=t("div",null,null,-1)),t("div",$e,[(n(),r(m,null,E(24,a=>t("div",{key:a,class:"flex items-center justify-center"},d(a-1)+" – "+d(a),1)),64))])],64))])}}},He={name:"LiveReports",components:{AgentTable:pe,MetricCard:Te,ReportHeatmap:Me},data(){return{pageIndex:0}},computed:{...G({agentStatus:"agents/getAgentStatus",agents:"agents/getAgents",accountConversationMetric:"getAccountConversationMetric",agentConversationMetric:"getAgentConversationMetric",accountConversationHeatmap:"getAccountConversationHeatmapData",uiFlags:"getOverviewUIFlags"}),agentStatusMetrics(){let e={};return Object.keys(this.agentStatus).forEach(i=>{const o=this.$t(`OVERVIEW_REPORTS.AGENT_STATUS.${V[i]}`);e[o]=this.agentStatus[i]}),e},conversationMetrics(){let e={};return Object.keys(this.accountConversationMetric).forEach(i=>{const o=this.$t(`OVERVIEW_REPORTS.ACCOUNT_CONVERSATIONS.${V[i]}`);e[o]=this.accountConversationMetric[i]}),e}},mounted(){this.$store.dispatch("agents/get"),this.fetchAllData(),Y.on("fetch_overview_reports",()=>{this.fetchAllData()})},methods:{fetchAllData(){this.fetchAccountConversationMetric(),this.fetchAgentConversationMetric(),this.fetchHeatmapData()},downloadHeatmapData(){let e=b(new Date);this.$store.dispatch("downloadAccountConversationHeatmap",{to:T(e)})},fetchHeatmapData(){if(this.uiFlags.isFetchingAccountConversationsHeatmap)return;let e=b(new Date),i=D(se(e,6));this.accountConversationHeatmap.length&&(e=b(new Date),i=D(e)),this.$store.dispatch("fetchAccountConversationHeatmap",{metric:"conversations_count",from:T(i),to:T(e),groupBy:"hour",businessHours:!1})},fetchAccountConversationMetric(){this.$store.dispatch("fetchAccountConversationMetric",{type:"account"})},fetchAgentConversationMetric(){this.$store.dispatch("fetchAgentConversationMetric",{type:"agent",page:this.pageIndex+1})},onPageNumberChange(e){this.pageIndex=e,this.fetchAgentConversationMetric()}}},Pe={class:"flex-1 p-4 overflow-auto"},We={class:"flex flex-col items-center md:flex-row"},Le={class:"flex-1 w-full max-w-full md:w-[65%] md:max-w-[65%] conversation-metric"},Fe={class:"text-base text-slate-700 dark:text-slate-100"},Ge={class:"text-woot-800 dark:text-woot-300 text-3xl mb-0 mt-1"},Ye={class:"flex-1 w-full max-w-full md:w-[35%] md:max-w-[35%]"},Be={class:"text-base text-slate-700 dark:text-slate-100"},Ue={class:"text-woot-800 dark:text-woot-300 text-3xl mb-0 mt-1"},je={class:"flex flex-row flex-wrap max-w-full ml-auto mr-auto"},ze={class:"flex flex-row flex-wrap max-w-full ml-auto mr-auto"};function qe(e,i,o,f,x,p){const h=O("MetricCard"),w=O("woot-button"),v=O("ReportHeatmap"),l=O("AgentTable");return n(),r("div",Pe,[t("div",We,[t("div",Le,[g(h,{header:e.$t("OVERVIEW_REPORTS.ACCOUNT_CONVERSATIONS.HEADER"),"is-loading":e.uiFlags.isFetchingAccountConversationMetric,"loading-message":e.$t("OVERVIEW_REPORTS.ACCOUNT_CONVERSATIONS.LOADING_MESSAGE")},{default:A(()=>[(n(!0),r(m,null,E(p.conversationMetrics,(c,_,a)=>(n(),r("div",{key:a,class:"flex-1 min-w-0 pb-2"},[t("h3",Fe,d(_),1),t("p",Ge,d(c),1)]))),128))]),_:1},8,["header","is-loading","loading-message"])]),t("div",Ye,[g(h,{header:e.$t("OVERVIEW_REPORTS.AGENT_STATUS.HEADER")},{default:A(()=>[(n(!0),r(m,null,E(p.agentStatusMetrics,(c,_,a)=>(n(),r("div",{key:a,class:"flex-1 min-w-0 pb-2"},[t("h3",Be,d(_),1),t("p",Ue,d(c),1)]))),128))]),_:1},8,["header"])])]),t("div",je,[g(h,{header:e.$t("OVERVIEW_REPORTS.CONVERSATION_HEATMAP.HEADER")},{control:A(()=>[g(w,{icon:"arrow-download",size:"small",variant:"smooth","color-scheme":"secondary",onClick:p.downloadHeatmapData},{default:A(()=>[P(d(e.$t("OVERVIEW_REPORTS.CONVERSATION_HEATMAP.DOWNLOAD_REPORT")),1)]),_:1},8,["onClick"])]),default:A(()=>[g(v,{"heat-data":e.accountConversationHeatmap,"is-loading":e.uiFlags.isFetchingAccountConversationsHeatmap},null,8,["heat-data","is-loading"])]),_:1},8,["header"])]),t("div",ze,[g(h,{header:e.$t("OVERVIEW_REPORTS.AGENT_CONVERSATIONS.HEADER")},{default:A(()=>[g(l,{agents:e.agents,"agent-metrics":e.agentConversationMetric,"page-index":x.pageIndex,"is-loading":e.uiFlags.isFetchingAgentConversationMetric,onPageChange:p.onPageNumberChange},null,8,["agents","agent-metrics","page-index","is-loading","onPageChange"])]),_:1},8,["header"])])])}const Tt=y(He,[["render",qe]]);export{Tt as default};
