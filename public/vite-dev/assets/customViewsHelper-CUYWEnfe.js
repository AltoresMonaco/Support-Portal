import{w as F}from"./DashboardIcon-CPXNa31t.js";import{c as v}from"./mutationHelpers-3VTcoJiD.js";import{u as w}from"./globalConfig-DaGjiImb.js";import{u as D,r as V,m as x}from"./index-C2DForDf.js";import{a as L,u as h}from"./index-BaHWIRRA.js";import{m as K}from"./dashboard-CGLIihvy.js";import{_ as N,u as b,o as C,a as g,l as f,e as m,p as A,f as O,q as k,m as M,t as R,n as U,k as $}from"./_plugin-vue_export-helper-CvYNw_mv.js";const l=[{value:"equal_to",label:"Equal to"},{value:"not_equal_to",label:"Not equal to"}],E=[{value:"equal_to",label:"Equal to"},{value:"not_equal_to",label:"Not equal to"},{value:"is_present",label:"Is present"},{value:"is_not_present",label:"Is not present"}],y=[{value:"equal_to",label:"Equal to"},{value:"not_equal_to",label:"Not equal to"},{value:"contains",label:"Contains"},{value:"does_not_contain",label:"Does not contain"}],G=[{value:"equal_to",label:"Equal to"},{value:"not_equal_to",label:"Not equal to"},{value:"is_present",label:"Is present"},{value:"is_not_present",label:"Is not present"},{value:"is_greater_than",label:"Is greater than"},{value:"is_less_than",label:"Is less than"}],T=[{value:"is_greater_than",label:"Is greater than"},{value:"is_less_than",label:"Is less than"},{value:"days_before",label:"Is x days before"}],ce=[{attributeKey:"status",attributeI18nKey:"STATUS",inputType:"multi_select",dataType:"text",filterOperators:l,attributeModel:"standard"},{attributeKey:"assignee_id",attributeI18nKey:"ASSIGNEE_NAME",inputType:"search_select",dataType:"text",filterOperators:E,attributeModel:"standard"},{attributeKey:"inbox_id",attributeI18nKey:"INBOX_NAME",inputType:"search_select",dataType:"text",filterOperators:E,attributeModel:"standard"},{attributeKey:"team_id",attributeI18nKey:"TEAM_NAME",inputType:"search_select",dataType:"number",filterOperators:E,attributeModel:"standard"},{attributeKey:"display_id",attributeI18nKey:"CONVERSATION_IDENTIFIER",inputType:"plain_text",dataType:"Number",filterOperators:y,attributeModel:"standard"},{attributeKey:"campaign_id",attributeI18nKey:"CAMPAIGN_NAME",inputType:"search_select",dataType:"Number",filterOperators:E,attributeModel:"standard"},{attributeKey:"labels",attributeI18nKey:"LABELS",inputType:"multi_select",dataType:"text",filterOperators:E,attributeModel:"standard"},{attributeKey:"browser_language",attributeI18nKey:"BROWSER_LANGUAGE",inputType:"search_select",dataType:"text",filterOperators:l,attributeModel:"additional"},{attributeKey:"country_code",attributeI18nKey:"COUNTRY_NAME",inputType:"search_select",dataType:"text",filterOperators:l,attributeModel:"additional"},{attributeKey:"referer",attributeI18nKey:"REFERER_LINK",inputType:"plain_text",dataType:"text",filterOperators:y,attributeModel:"additional"},{attributeKey:"created_at",attributeI18nKey:"CREATED_AT",inputType:"date",dataType:"text",filterOperators:T,attributeModel:"standard"},{attributeKey:"last_activity_at",attributeI18nKey:"LAST_ACTIVITY",inputType:"date",dataType:"text",filterOperators:T,attributeModel:"standard"},{attributeKey:"referer",attributeI18nKey:"REFERER_LINK",inputType:"plain_text",dataType:"text",filterOperators:T,attributeModel:"standard"}],q=[{name:"Standard Filters",i18nGroup:"STANDARD_FILTERS",attributes:[{key:"status",i18nKey:"STATUS"},{key:"assignee_id",i18nKey:"ASSIGNEE_NAME"},{key:"inbox_id",i18nKey:"INBOX_NAME"},{key:"team_id",i18nKey:"TEAM_NAME"},{key:"display_id",i18nKey:"CONVERSATION_IDENTIFIER"},{key:"campaign_id",i18nKey:"CAMPAIGN_NAME"},{key:"labels",i18nKey:"LABELS"},{key:"created_at",i18nKey:"CREATED_AT"},{key:"last_activity_at",i18nKey:"LAST_ACTIVITY"}]},{name:"Additional Filters",i18nGroup:"ADDITIONAL_FILTERS",attributes:[{key:"browser_language",i18nKey:"BROWSER_LANGUAGE"},{key:"country_code",i18nKey:"COUNTRY_NAME"},{key:"referer",i18nKey:"REFERER_LINK"}]}],ye=[{attributeKey:"name",attributeI18nKey:"NAME",inputType:"plain_text",dataType:"text",filterOperators:l,attribute_type:"standard"},{attributeKey:"email",attributeI18nKey:"EMAIL",inputType:"plain_text",dataType:"text",filterOperators:y,attribute_type:"standard"},{attributeKey:"phone_number",attributeI18nKey:"PHONE_NUMBER",inputType:"plain_text",dataType:"text",filterOperators:y,attribute_type:"standard"},{attributeKey:"identifier",attributeI18nKey:"IDENTIFIER",inputType:"plain_text",dataType:"number",filterOperators:l,attribute_type:"standard"},{attributeKey:"country_code",attributeI18nKey:"COUNTRY",inputType:"search_select",dataType:"number",filterOperators:l,attribute_type:"standard"},{attributeKey:"city",attributeI18nKey:"CITY",inputType:"plain_text",dataType:"Number",filterOperators:y,attribute_type:"standard"},{attributeKey:"created_at",attributeI18nKey:"CREATED_AT",inputType:"date",dataType:"text",filterOperators:T,attributeModel:"standard"},{attributeKey:"last_activity_at",attributeI18nKey:"LAST_ACTIVITY",inputType:"date",dataType:"text",filterOperators:T,attributeModel:"standard"},{attributeKey:"referer",attributeI18nKey:"REFERER_LINK",inputType:"plain_text",dataType:"text",filterOperators:T,attributeModel:"standard"},{attributeKey:"blocked",attributeI18nKey:"BLOCKED",inputType:"search_select",dataType:"text",filterOperators:l,attributeModel:"standard"}],P=[{name:"Standard Filters",i18nGroup:"STANDARD_FILTERS",attributes:[{key:"name",i18nKey:"NAME"},{key:"email",i18nKey:"EMAIL"},{key:"phone_number",i18nKey:"PHONE_NUMBER"},{key:"identifier",i18nKey:"IDENTIFIER"},{key:"country_code",i18nKey:"COUNTRY"},{key:"city",i18nKey:"CITY"},{key:"created_at",i18nKey:"CREATED_AT"},{key:"last_activity_at",i18nKey:"LAST_ACTIVITY"},{key:"blocked",i18nKey:"BLOCKED"}]}],B=e=>{switch(e){case"date":return"date";case"text":return"plain_text";case"list":return"search_select";case"checkbox":return"search_select";default:return"plain_text"}},W=e=>{switch(e){case"list":return l;case"text":return y;case"number":return l;case"link":return l;case"date":return G;case"checkbox":return l;default:return l}},Te=({filteri18nKey:e,attributeModel:t})=>{const{t:r}=w(),{getters:a}=v(),s=t==="contact_attribute"?P:q;return{setFilterAttributes:()=>{const n=a["attributes/getAttributesByModel"](t),p={name:r(`${e}.GROUPS.CUSTOM_ATTRIBUTES`),attributes:n.map(o=>({key:o.attribute_key,name:o.attribute_display_name}))},u=s.map(o=>({name:r(`${e}.GROUPS.${o.i18nGroup}`),attributes:o.attributes.map(c=>({key:c.key,name:r(`${e}.ATTRIBUTES.${c.i18nKey}`)}))})),S=n.map(o=>({attributeKey:o.attribute_key,attributeI18nKey:`CUSTOM_ATTRIBUTE_${o.attribute_display_type.toUpperCase()}`,inputType:B(o.attribute_display_type),filterOperators:W(o.attribute_display_type),attributeModel:"custom_attributes"}));return{filterGroups:[...u,p],filterTypes:[...S]}},initializeStatusAndAssigneeFilterToModal:(n,p,u)=>n!==""?{attribute_key:"status",attribute_model:"standard",filter_operator:"equal_to",values:[{id:n,name:r(`CHAT_LIST.CHAT_STATUS_FILTER_ITEMS.${n}.TEXT`)}],query_operator:"and",custom_attribute_type:""}:u===F.ASSIGNEE_TYPE.ME?{attribute_key:"assignee_id",filter_operator:"equal_to",values:p,query_operator:"and",custom_attribute_type:""}:null,initializeInboxTeamAndLabelFilterToModal:(n,p,u,S,o)=>{const c=[];return n&&c.push({attribute_key:"inbox_id",attribute_model:"standard",filter_operator:"equal_to",values:[{id:n,name:p.name}],query_operator:"and",custom_attribute_type:""}),u&&c.push({attribute_key:"team_id",attribute_model:"standard",filter_operator:"equal_to",values:S,query_operator:"and",custom_attribute_type:""}),o&&c.push({attribute_key:"labels",attribute_model:"standard",filter_operator:"equal_to",values:[{id:o,name:o}],query_operator:"and",custom_attribute_type:""}),c}}},Y={props:{filterType:{type:Number,default:0},customViewsQuery:{type:Object,default:()=>{}},openLastSavedItem:{type:Function,default:()=>{}}},emits:["close"],setup(){return{v$:D()}},data(){return{show:!0,name:""}},computed:{isButtonDisabled(){return this.v$.name.$invalid}},validations:{name:{required:V,minLength:x(1)}},methods:{onClose(){this.$emit("close")},async saveCustomViews(){if(this.v$.$touch(),!this.v$.$invalid){try{await this.$store.dispatch("customViews/create",{name:this.name,filter_type:this.filterType,query:this.customViewsQuery}),this.alertMessage=this.filterType===0?this.$t("FILTER.CUSTOM_VIEWS.ADD.API_FOLDERS.SUCCESS_MESSAGE"):this.$t("FILTER.CUSTOM_VIEWS.ADD.API_SEGMENTS.SUCCESS_MESSAGE"),this.onClose(),L(K.SAVE_FILTER,{type:this.filterType===0?"folder":"segment"})}catch(e){const t=e==null?void 0:e.message;this.alertMessage=t||this.filterType===0?t:this.$t("FILTER.CUSTOM_VIEWS.ADD.API_SEGMENTS.ERROR_MESSAGE")}finally{h(this.alertMessage)}this.openLastSavedItem()}}}},j={class:"w-full"},z={class:"flex flex-row justify-end w-full gap-2 px-0 py-2"};function H(e,t,r,a,s,i){const _=b("woot-modal-header"),d=b("woot-input"),n=b("woot-button"),p=b("woot-modal");return C(),g(p,{show:s.show,"onUpdate:show":t[2]||(t[2]=u=>s.show=u),"on-close":i.onClose},{default:f(()=>[m(_,{"header-title":e.$t("FILTER.CUSTOM_VIEWS.ADD.TITLE")},null,8,["header-title"]),A("form",{class:"w-full",onSubmit:t[1]||(t[1]=O((...u)=>i.saveCustomViews&&i.saveCustomViews(...u),["prevent"]))},[A("div",j,[m(d,{modelValue:s.name,"onUpdate:modelValue":t[0]||(t[0]=u=>s.name=u),label:e.$t("FILTER.CUSTOM_VIEWS.ADD.LABEL"),type:"text",error:a.v$.name.$error?e.$t("FILTER.CUSTOM_VIEWS.ADD.ERROR_MESSAGE"):"",class:k({error:a.v$.name.$error}),placeholder:e.$t("FILTER.CUSTOM_VIEWS.ADD.PLACEHOLDER"),onBlur:a.v$.name.$touch},null,8,["modelValue","label","error","class","placeholder","onBlur"]),A("div",z,[m(n,{disabled:i.isButtonDisabled},{default:f(()=>[M(R(e.$t("FILTER.CUSTOM_VIEWS.ADD.SAVE_BUTTON")),1)]),_:1},8,["disabled"]),m(n,{variant:"clear",onClick:O(i.onClose,["prevent"])},{default:f(()=>[M(R(e.$t("FILTER.CUSTOM_VIEWS.ADD.CANCEL_BUTTON")),1)]),_:1},8,["onClick"])])])],32)]),_:1},8,["show","on-close"])}const Ee=N(Y,[["render",H]]),X={props:{show:{type:Boolean,default:!1},activeCustomView:{type:Object,default:()=>{}},customViewsId:{type:[String,Number],default:0},activeFilterType:{type:Number,default:0},openLastItemAfterDelete:{type:Function,default:()=>{}}},emits:["close","update:show"],computed:{localShow:{get(){return this.show},set(e){this.$emit("update:show",e)}},activeCustomViews(){return this.activeFilterType===0?"conversation":this.activeFilterType===1?"contact":""},deleteMessage(){return` ${this.activeCustomView&&this.activeCustomView.name}?`},deleteConfirmText(){return`${this.$t("FILTER.CUSTOM_VIEWS.DELETE.MODAL.CONFIRM.YES")}`},deleteRejectText(){return`${this.$t("FILTER.CUSTOM_VIEWS.DELETE.MODAL.CONFIRM.NO")}`},isFolderSection(){return this.activeFilterType===0&&this.$route.name!=="home"},isSegmentSection(){return this.activeFilterType===1&&this.$route.name!=="contacts_dashboard"}},methods:{async deleteSavedCustomViews(){var e;try{const t=Number(this.customViewsId),r=this.activeCustomViews;await this.$store.dispatch("customViews/delete",{id:t,filterType:r}),this.closeDeletePopup(),h(this.activeFilterType===0?this.$t("FILTER.CUSTOM_VIEWS.DELETE.API_FOLDERS.SUCCESS_MESSAGE"):this.$t("FILTER.CUSTOM_VIEWS.DELETE.API_SEGMENTS.SUCCESS_MESSAGE")),L(K.DELETE_FILTER,{type:this.filterType===0?"folder":"segment"})}catch(t){const r=(e=t==null?void 0:t.response)!=null&&e.message||this.activeFilterType===0?this.$t("FILTER.CUSTOM_VIEWS.DELETE.API_FOLDERS.SUCCESS_MESSAGE"):this.$t("FILTER.CUSTOM_VIEWS.DELETE.API_SEGMENTS.SUCCESS_MESSAGE");h(r)}this.openLastItemAfterDelete()},closeDeletePopup(){this.$emit("close")}}};function Q(e,t,r,a,s,i){const _=b("woot-delete-modal");return C(),U("div",null,[i.localShow?(C(),g(_,{key:0,show:i.localShow,"onUpdate:show":t[0]||(t[0]=d=>i.localShow=d),"on-close":i.closeDeletePopup,"on-confirm":i.deleteSavedCustomViews,title:e.$t("FILTER.CUSTOM_VIEWS.DELETE.MODAL.CONFIRM.TITLE"),message:e.$t("FILTER.CUSTOM_VIEWS.DELETE.MODAL.CONFIRM.MESSAGE"),"message-value":i.deleteMessage,"confirm-text":i.deleteConfirmText,"reject-text":i.deleteRejectText},null,8,["show","on-close","on-confirm","title","message","message-value","confirm-text","reject-text"])):$("",!0)])}const be=N(X,[["render",Q]]),J=(e,t,r)=>{if((e==="created_at"||e==="last_activity_at")&&t==="days_before")return"plain_text";const a=r.find(s=>s.attributeKey===e);return a==null?void 0:a.inputType},Z=e=>({text:"string",number:"string",date:"string",checkbox:"multi_select",list:"multi_select",link:"string"})[e],ee=(e,t)=>{const r=t.find(i=>i.attribute_key===e),{attribute_display_type:a}=r;return Z(a)},I=(e,t,r,a)=>{const s=t==null?void 0:t.find(i=>i[r]===e[0]);return{id:e[0],name:s?s[a]:e[0]}},te=e=>e.map(t=>({id:t,name:t})),ae=(e,t)=>t.filter(a=>e.includes(a.title)).map(({title:a})=>({id:a,name:a})),re=(e,t)=>t.filter(a=>e.includes(a.id)).map(({id:a,name:s})=>({id:a.toLowerCase(),name:s})),se=(e,t)=>t.filter(a=>e.includes(a.id)).map(({id:a,name:s})=>({id:a,name:s})),ie=(e,t)=>{const{attribute_key:r,values:a}=e,{languages:s,countries:i,agents:_,inboxes:d,teams:n,campaigns:p,labels:u}=t;switch(r){case"status":return te(a);case"assignee_id":return I(a,_,"id","name");case"inbox_id":return I(a,d,"id","name");case"team_id":return I(a,n,"id","name");case"campaign_id":return I(a,p,"id","title");case"labels":return ae(a,u);case"browser_language":return re(a,s);case"country_code":return se(a,i);default:return{id:a[0],name:a[0]}}},me=(e,t)=>{const{attribute_key:r,filter_operator:a,values:s}=e,{filterTypes:i,allCustomAttributes:_}=t,d=J(r,a,i);return d===void 0?ee(r,_)==="string"?s[0].toString():{id:s[0],name:s[0]}:d==="multi_select"||d==="search_select"?ie(e,t):s[0].toString()};export{Ee as A,be as D,l as O,G as a,y as b,ce as c,P as d,ye as e,q as f,me as g,Te as u};
