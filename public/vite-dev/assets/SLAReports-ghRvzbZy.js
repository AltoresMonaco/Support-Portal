import{m as P}from"./globalConfig-DaGjiImb.js";import{u as I}from"./index-BaHWIRRA.js";import{_ as y,u as p,H as A,o as a,n,p as d,m as T,t as _,g as R,e as r,l as v,a as h,k as S,c as B,F as x,i as O,ag as L,r as H,C as W}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{_ as q}from"./TableFooter-DOGhqcuD.js";import{_ as G}from"./TableHeaderCell-CHSVvL6I.js";import{_ as K}from"./UserAvatarWithName-BHDu0HJS.js";import{_ as V,a as z}from"./index-Cq2yv_RT.js";import{S as j}from"./Spinner-B-aSVz3z.js";import{_ as D,a as C,b as U,c as Y}from"./DropdownList-BAxlWPFC.js";import{s as X}from"./mutationHelpers-3VTcoJiD.js";import{D as J}from"./constants-CvJgIWgr.js";import{b as E,c as k}from"./DateHelper-D7GM2F2-.js";import{aw as Q}from"./dashboard-CGLIihvy.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Thumbnail-DLjRBBx8.js";import"./DashboardIcon-CPXNa31t.js";import"./vue-router-CNCrM2WK.js";import"./index-BP-sUqpX.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./exports-CsC-x4VI.js";import"./Icon-Dtj3LCzD.js";import"./utils.esm-CA3tRshB.js";import"./index-DaWXXnfb.js";import"./index-CbMJaKeB.js";import"./axios-CCb-kr4I.js";import"./globalConfigMixin-BNbqaRx5.js";import"./timeHelper-BT38nsET.js";import"./index-BO4rcqbh.js";import"./index-C2DForDf.js";import"./useKeyboardNavigableList-Cfstgo2Q.js";import"./helper-DcGaBm2u.js";import"./Validators-eX6_8wdj.js";import"./vue-dompurify-html-DZ5r8uTJ.js";import"./module-CGzIBJZi.js";const Z={props:{label:{type:String,required:!0},value:{type:[String,Number],required:!0},toolTip:{type:String,required:!0},isLoading:{type:Boolean,default:!1}}},ee={class:"flex flex-col gap-2 items-start justify-center min-w-[10rem]"},te={class:"inline-flex items-center gap-1 text-sm font-medium text-slate-700 dark:text-slate-200"},se={key:0,class:"w-12 h-6 mb-0.5 rounded-md bg-slate-50 dark:bg-slate-800 animate-pulse"},oe={key:1,class:"text-2xl font-medium text-slate-900 dark:text-slate-25"};function le(e,s,t,l,i,o){const c=p("fluent-icon"),u=A("tooltip");return a(),n("div",ee,[d("span",te,[T(_(t.label)+" ",1),R(r(c,{size:"14",icon:"information",type:"outline",class:"flex flex-shrink-0 text-sm font-normal sm:font-medium text-slate-500 dark:text-slate-500"},null,512),[[u,t.toolTip,void 0,{right:!0}]])]),t.isLoading?(a(),n("div",se)):(a(),n("span",oe,_(t.value),1))])}const F=y(Z,[["render",le]]),ae={class:"flex sm:flex-row flex-col w-full gap-4 sm:gap-14 bg-white dark:bg-slate-900 rounded-xl border border-slate-75 dark:border-slate-700/50 px-6 py-4"},ne={__name:"SLAMetrics",props:{hitRate:{type:String,required:!0},noOfBreaches:{type:Number,required:!0},noOfConversations:{type:Number,required:!0},isLoading:{type:Boolean,default:!1}},setup(e){return(s,t)=>(a(),n("div",ae,[r(F,{label:s.$t("SLA_REPORTS.METRICS.HIT_RATE.LABEL"),value:e.hitRate,"tool-tip":s.$t("SLA_REPORTS.METRICS.HIT_RATE.TOOLTIP"),"is-loading":e.isLoading},null,8,["label","value","tool-tip","is-loading"]),t[0]||(t[0]=d("div",{class:"w-full sm:w-px h-full border border-slate-75 dark:border-slate-700/50"},null,-1)),r(F,{label:s.$t("SLA_REPORTS.METRICS.NO_OF_MISSES.LABEL"),value:e.noOfBreaches,"tool-tip":s.$t("SLA_REPORTS.METRICS.NO_OF_MISSES.TOOLTIP"),"is-loading":e.isLoading},null,8,["label","value","tool-tip","is-loading"]),t[1]||(t[1]=d("div",{class:"w-full sm:w-px h-full border border-slate-75 dark:border-slate-700/50"},null,-1)),r(F,{label:s.$t("SLA_REPORTS.METRICS.NO_OF_CONVERSATIONS.LABEL"),value:e.noOfConversations,"tool-tip":s.$t("SLA_REPORTS.METRICS.NO_OF_CONVERSATIONS.TOOLTIP"),"is-loading":e.isLoading},null,8,["label","value","tool-tip","is-loading"])]))}},ie={components:{SLAPopoverCard:V},props:{slaEvents:{type:Array,default:()=>[]}},data(){return{showSlaPopoverCard:!1}},methods:{closeSlaEvents(){this.showSlaPopoverCard=!1},openSlaEvents(){this.showSlaPopoverCard=!this.showSlaPopoverCard}}},re={class:"label-wrap"},ce={class:"flex items-center col-span-2 px-0 py-2 text-sm tracking-[0.5] text-slate-700 dark:text-slate-100 rtl:text-right"},de={class:"relative"};function pe(e,s,t,l,i,o){const c=p("woot-button"),u=p("SLAPopoverCard"),g=A("on-clickaway");return R((a(),n("div",re,[d("div",ce,[d("div",de,[r(c,{"color-scheme":"secondary",variant:"link",onClick:o.openSlaEvents},{default:v(()=>[T(_(e.$t("SLA_REPORTS.TABLE.VIEW_DETAILS")),1)]),_:1},8,["onClick"]),i.showSlaPopoverCard?(a(),h(u,{key:0,"sla-missed-events":t.slaEvents,class:"right-0"},null,8,["sla-missed-events"])):S("",!0)])])])),[[g,o.closeSlaEvents]])}const ue=y(ie,[["render",pe]]),me={class:"grid items-center content-center w-full h-16 grid-cols-12 gap-4 px-6 py-0 bg-white border-b last:border-b-0 last:rounded-b-xl border-slate-75 dark:border-slate-800/50 dark:bg-slate-900"},he={class:"flex items-center gap-2 col-span-6 px-0 py-2 text-sm tracking-[0.5] text-slate-700 dark:text-slate-100 rtl:text-right"},ge={class:"text-slate-700 dark:text-slate-200"},fe={class:"text-slate-600 dark:text-slate-300"},_e={class:"capitalize truncate text-slate-700 dark:text-slate-200"},Se={class:"flex items-center capitalize py-2 px-0 text-sm tracking-[0.5] text-slate-700 dark:text-slate-50 text-left rtl:text-right col-span-2"},be={class:"flex items-center col-span-2 gap-2"},ve={key:1,class:"text-slate-600 dark:text-slate-200"},ye={__name:"SLAReportItem",props:{slaName:{type:String,required:!0},conversationId:{type:Number,required:!0},conversation:{type:Object,required:!0},slaEvents:{type:Array,default:()=>[]}},setup(e){const s=e,t=B(()=>s.conversation.labels?s.conversation.labels.split(",").map(l=>l.trim()):[]);return(l,i)=>(a(),n("div",me,[d("div",he,[d("span",ge,_(`#${e.conversationId} `),1),d("span",fe,_(l.$t("SLA_REPORTS.WITH")),1),d("span",_e,_(e.conversation.contact.name),1),r(z,{class:"w-[80%]","conversation-id":e.conversationId,"conversation-labels":t.value},null,8,["conversation-id","conversation-labels"])]),d("div",Se,_(e.slaName),1),d("div",be,[e.conversation.assignee?(a(),h(K,{key:0,user:e.conversation.assignee},null,8,["user"])):(a(),n("span",ve," --- "))]),r(ue,{"sla-events":e.slaEvents},null,8,["sla-events"])]))}},we={name:"SLATable",components:{SLAReportItem:ye,TableFooter:q,Spinner:j,TableHeaderCell:G},props:{slaReports:{type:Array,default:()=>[]},totalCount:{type:Number,default:0},currentPage:{type:Number,default:1},pageSize:{type:Number,default:25},isLoading:{type:Boolean,default:!1}},emits:["pageChange"],data(){return{pageNo:1}},computed:{shouldShowFooter(){return this.currentPage===1?this.totalCount>this.pageSize:this.slaReports.length>0}},methods:{onPageChange(e){this.$emit("pageChange",e)}}},Ae={class:"min-w-full border rounded-xl border-slate-75 dark:border-slate-700/50"},Re={class:"grid content-center h-12 grid-cols-12 gap-4 px-6 py-0 border-b bg-slate-25 border-slate-75 dark:border-slate-800 rounded-t-xl dark:bg-slate-900"},Fe={key:0,class:"flex items-center justify-center h-32 bg-white rounded-b-xl dark:bg-slate-900"},Le={key:1},De={key:2,class:"flex items-center justify-center h-32 bg-white rounded-b-xl dark:bg-slate-900"};function Te(e,s,t,l,i,o){const c=p("TableHeaderCell"),u=p("Spinner"),g=p("SLAReportItem"),f=p("TableFooter");return a(),n("div",null,[d("div",Ae,[d("div",Re,[r(c,{span:6,label:e.$t("SLA_REPORTS.TABLE.HEADER.CONVERSATION")},null,8,["label"]),r(c,{span:2,label:e.$t("SLA_REPORTS.TABLE.HEADER.POLICY")},null,8,["label"]),r(c,{span:2,label:e.$t("SLA_REPORTS.TABLE.HEADER.AGENT")},null,8,["label"]),r(c,{span:2,label:""})]),t.isLoading?(a(),n("div",Fe,[r(u),d("span",null,_(e.$t("SLA_REPORTS.LOADING")),1)])):t.slaReports.length>0?(a(),n("div",Le,[(a(!0),n(x,null,O(t.slaReports,m=>(a(),h(g,{key:m.applied_sla.id,"sla-name":m.applied_sla.sla_name,conversation:m.conversation,"conversation-id":m.conversation.id,"sla-events":m.sla_events},null,8,["sla-name","conversation","conversation-id","sla-events"]))),128))])):(a(),n("div",De,_(e.$t("SLA_REPORTS.NO_RECORDS")),1))]),o.shouldShowFooter?(a(),h(f,{key:0,"current-page":t.currentPage,"total-count":t.totalCount,"page-size":t.pageSize,onPageChange:o.onPageChange},null,8,["current-page","total-count","page-size","onPageChange"])):S("",!0)])}const xe=y(we,[["render",Te]]),$=(e,s)=>e.map(t=>({id:t.id,name:s==="labels"?t.title:t.name,type:s})),Oe=(e,s,t)=>e.find(l=>s==="labels"?l.title===t:l.id.toString()===t.toString()),w=(e,s)=>({keyToType:{assigned_agent_id:"agents",inbox_id:"inboxes",team_id:"teams",sla_policy_id:"sla",label_list:"labels"},typeToKey:{agents:"assigned_agent_id",inboxes:"inbox_id",teams:"team_id",sla:"sla_policy_id",labels:"label_list"}})[s][e],Ce={__name:"ActiveFilterChip",props:{name:{type:String,required:!0},id:{type:Number,required:!0},type:{type:String,required:!0},options:{type:Array,default:()=>[]},activeFilterType:{type:String,default:""},showMenu:{type:Boolean,default:!1},placeholder:{type:String,default:""},enableSearch:{type:Boolean,default:!1}},emits:["toggleDropdown","removeFilter","addFilter","closeDropdown"],setup(e,{emit:s}){const t=e,l=s,i=()=>l("toggleDropdown",t.type),o=()=>l("removeFilter",t.type),c=g=>l("addFilter",g),u=()=>l("closeDropdown");return(g,f)=>{const m=A("on-clickaway");return a(),h(C,{"right-icon":"chevron-down","button-text":e.name,class:"bg-slate-50 dark:bg-slate-800 hover:bg-slate-75 dark:hover:bg-slate-800",onClick:i},L({_:2},[e.showMenu&&e.activeFilterType===e.type?{name:"dropdown",fn:v(()=>[e.options?R((a(),h(D,{key:0,"show-clear-filter":"","list-items":e.options,"active-filter-id":e.id,"input-placeholder":e.placeholder,"enable-search":e.enableSearch,class:"flex flex-col w-[240px] overflow-y-auto left-0 md:left-auto md:right-0 top-10",onSelect:c,onRemoveFilter:o},null,8,["list-items","active-filter-id","input-placeholder","enable-search"])),[[m,u]]):S("",!0)]),key:"0"}:void 0]),1032,["button-text"])}}},Ee={__name:"AddFilterChip",props:{name:{type:String,required:!0},menuOption:{type:Array,default:()=>[]},showMenu:{type:Boolean,default:!1},placeholderI18nKey:{type:String,default:""},enableSearch:{type:Boolean,default:!0},emptyStateMessage:{type:String,default:""}},emits:["toggleDropdown","addFilter","closeDropdown"],setup(e,{emit:s}){const t=s,l=H(null),i=m=>{l.value=m},o=()=>{l.value=null},c=m=>l.value===m,u=()=>t("toggleDropdown"),g=m=>{t("addFilter",m),o()},f=()=>{o(),t("closeDropdown")};return(m,Ye)=>{const M=A("on-clickaway");return a(),h(C,{"button-text":e.name,"left-icon":"filter",onClick:u},L({_:2},[e.showMenu?{name:"dropdown",fn:v(()=>[R((a(),h(D,{class:"left-0 md:right-0 top-10"},{listItem:v(()=>[e.menuOption.length?S("",!0):(a(),h(U,{key:0,message:e.emptyStateMessage},null,8,["message"])),(a(!0),n(x,null,O(e.menuOption,b=>(a(),h(Y,{key:b.id,"button-text":b.name,onMouseenter:N=>i(b.id),onMouseleave:o,onFocus:N=>i(b.id)},L({_:2},[b.options&&c(b.id)?{name:"dropdown",fn:v(()=>[r(D,{"list-items":b.options,"input-placeholder":m.$t(`${e.placeholderI18nKey}.${b.type.toUpperCase()}`),"enable-search":e.enableSearch,class:"flex flex-col w-[216px] overflow-y-auto top-0 left-36",onSelect:g},null,8,["list-items","input-placeholder","enable-search"])]),key:"0"}:void 0]),1032,["button-text","onMouseenter","onFocus"]))),128))]),_:1})),[[M,f]])]),key:"0"}:void 0]),1032,["button-text"])}}},ke={components:{FilterButton:C,ActiveFilterChip:Ce,AddFilterChip:Ee},emits:["filterChange"],data(){return{showDropdownMenu:!1,showSubDropdownMenu:!1,activeFilterType:"",appliedFilters:{assigned_agent_id:null,inbox_id:null,team_id:null,sla_policy_id:null,label_list:null}}},computed:{...P({agents:"agents/getAgents",inboxes:"inboxes/getInboxes",teams:"teams/getTeams",labels:"labels/getLabels",sla:"sla/getSLA"}),filterListMenuItems(){const e=[{id:"1",name:this.$t("SLA_REPORTS.DROPDOWN.SLA"),type:"sla"},{id:"2",name:this.$t("SLA_REPORTS.DROPDOWN.INBOXES"),type:"inboxes"},{id:"3",name:this.$t("SLA_REPORTS.DROPDOWN.AGENTS"),type:"agents"},{id:"4",name:this.$t("SLA_REPORTS.DROPDOWN.TEAMS"),type:"teams"},{id:"5",name:this.$t("SLA_REPORTS.DROPDOWN.LABELS"),type:"labels"}],t=Object.keys(this.appliedFilters).filter(l=>this.appliedFilters[l]).map(l=>w(l,"keyToType"));return e.filter(({type:l})=>!t.includes(l)).map(({id:l,name:i,type:o})=>({id:l,name:i,type:o,options:$(this[o],o)}))},activeFilters(){return Object.keys(this.appliedFilters).filter(s=>this.appliedFilters[s]).map(s=>{const t=w(s,"keyToType"),l=Oe(this[t],t,this.appliedFilters[s]);return{id:l.id,name:t==="labels"?l.title:l.name,type:t,options:$(this[t],t)}})},hasActiveFilters(){return Object.values(this.appliedFilters).some(e=>e!==null)},isAllFilterSelected(){return!this.filterListMenuItems.length}},methods:{addFilter(e){const{type:s,id:t,name:l}=e,i=w(s,"typeToKey");this.appliedFilters[i]=s==="labels"?l:t,this.$emit("filterChange",this.appliedFilters),this.resetDropdown()},removeFilter(e){const s=w(e,"typeToKey");this.appliedFilters[s]=null,this.$emit("filterChange",this.appliedFilters)},clearAllFilters(){this.appliedFilters={assigned_agent_id:null,inbox_id:null,team_id:null,sla_policy_id:null,label_list:null},this.$emit("filterChange",this.appliedFilters),this.resetDropdown()},showDropdown(){this.showSubDropdownMenu=!1,this.showDropdownMenu=!this.showDropdownMenu},closeDropdown(){this.showDropdownMenu=!1},openActiveFilterDropdown(e){this.closeDropdown(),this.activeFilterType=e,this.showSubDropdownMenu=!this.showSubDropdownMenu},closeActiveFilterDropdown(){this.activeFilterType="",this.showSubDropdownMenu=!1},resetDropdown(){this.closeDropdown(),this.closeActiveFilterDropdown()}}},$e={class:"flex flex-col flex-wrap items-start gap-2 md:items-center md:flex-nowrap md:flex-row"},Pe={key:0,class:"flex flex-wrap gap-2 md:flex-nowrap"},Me={key:1,class:"w-full h-px border md:w-px md:h-5 border-slate-75 dark:border-slate-800"},Ne={class:"flex items-center gap-2"},Ie={key:1,class:"w-px h-5 border border-slate-75 dark:border-slate-800"};function Be(e,s,t,l,i,o){const c=p("ActiveFilterChip"),u=p("AddFilterChip"),g=p("FilterButton");return a(),n("div",$e,[o.hasActiveFilters?(a(),n("div",Pe,[(a(!0),n(x,null,O(o.activeFilters,f=>(a(),h(c,W({ref_for:!0},f,{key:f.type,placeholder:e.$t(`SLA_REPORTS.DROPDOWN.INPUT_PLACEHOLDER.${f.type.toUpperCase()}`),"active-filter-type":i.activeFilterType,"show-menu":i.showSubDropdownMenu,"enable-search":"",onToggleDropdown:o.openActiveFilterDropdown,onCloseDropdown:o.closeActiveFilterDropdown,onAddFilter:o.addFilter,onRemoveFilter:o.removeFilter}),null,16,["placeholder","active-filter-type","show-menu","onToggleDropdown","onCloseDropdown","onAddFilter","onRemoveFilter"]))),128))])):S("",!0),o.hasActiveFilters&&!o.isAllFilterSelected?(a(),n("div",Me)):S("",!0),d("div",Ne,[o.isAllFilterSelected?S("",!0):(a(),h(u,{key:0,"placeholder-i18n-key":"SLA_REPORTS.DROPDOWN.INPUT_PLACEHOLDER",name:e.$t("SLA_REPORTS.DROPDOWN.ADD_FIlTER"),"menu-option":o.filterListMenuItems,"show-menu":i.showDropdownMenu,"empty-state-message":e.$t("SLA_REPORTS.DROPDOWN.NO_FILTER"),onToggleDropdown:o.showDropdown,onCloseDropdown:o.closeDropdown,onAddFilter:o.addFilter},null,8,["name","menu-option","show-menu","empty-state-message","onToggleDropdown","onCloseDropdown","onAddFilter"])),o.hasActiveFilters?(a(),n("div",Ie)):S("",!0),o.hasActiveFilters?(a(),h(g,{key:2,"button-text":e.$t("SLA_REPORTS.DROPDOWN.CLEAR_ALL"),onClick:o.clearAllFilters},null,8,["button-text","onClick"])):S("",!0)])])}const He=y(ke,[["render",Be]]),We={components:{SLAFilter:He},emits:["filterChange"],data(){return{selectedDateRange:J.LAST_7_DAYS,selectedGroupByFilter:null,customDateRange:[new Date,new Date]}},computed:{to(){return E(this.customDateRange[1])},from(){return k(this.customDateRange[0])}},watch:{businessHoursSelected(){this.emitChange()}},mounted(){this.setInitialRange()},methods:{setInitialRange(){const{offset:e}=this.selectedDateRange,s=X(new Date,e),t=k(s),l=E(new Date);this.$emit("filterChange",{from:t,to:l,...this.selectedGroupByFilter})},emitChange(){const{from:e,to:s}=this;this.$emit("filterChange",{from:e,to:s,...this.selectedGroupByFilter})},emitFilterChange(e){this.selectedGroupByFilter=e,this.emitChange()},onDateRangeChange(e){this.customDateRange=e,this.emitChange()}}},qe={class:"flex flex-col flex-wrap w-full gap-3 md:flex-row"};function Ge(e,s,t,l,i,o){const c=p("woot-date-picker"),u=p("SLAFilter");return a(),n("div",qe,[r(c,{onDateRangeChanged:o.onDateRangeChange},null,8,["onDateRangeChanged"]),r(u,{onFilterChange:o.emitFilterChange},null,8,["onFilterChange"])])}const Ke=y(We,[["render",Ge]]),Ve={name:"SLAReports",components:{SLAMetrics:ne,SLATable:xe,SLAReportFilters:Ke},data(){return{pageNumber:1,activeFilter:{from:0,to:0,assigned_agent_id:null,inbox_id:null,team_id:null,sla_policy_id:null,label_list:null}}},computed:{...P({slaReports:"slaReports/getAll",slaMetrics:"slaReports/getMetrics",slaMeta:"slaReports/getMeta",uiFlags:"slaReports/getUIFlags"})},mounted(){this.$store.dispatch("agents/get"),this.$store.dispatch("inboxes/get"),this.$store.dispatch("teams/get"),this.$store.dispatch("labels/get"),this.$store.dispatch("sla/get"),this.fetchSLAMetrics(),this.fetchSLAReports()},methods:{fetchSLAReports({pageNumber:e}={}){this.$store.dispatch("slaReports/get",{page:e||this.pageNumber,...this.activeFilter})},fetchSLAMetrics(){this.$store.dispatch("slaReports/getMetrics",this.activeFilter)},onPageChange(e){this.fetchSLAReports({pageNumber:e})},onFilterChange(e){this.activeFilter=e,this.fetchSLAReports(),this.fetchSLAMetrics()},downloadReports(){const e="sla";try{this.$store.dispatch("slaReports/download",{fileName:Q({type:e,to:this.activeFilter.to}),...this.activeFilter})}catch{I(this.$t("SLA_REPORTS.DOWNLOAD_FAILED"))}}}},ze={class:"flex flex-col flex-1 gap-6 px-4 pt-4 overflow-auto"},je={class:"flex flex-col gap-6"};function Ue(e,s,t,l,i,o){const c=p("SLAReportFilters"),u=p("woot-button"),g=p("SLAMetrics"),f=p("SLATable");return a(),n("div",ze,[r(c,{onFilterChange:o.onFilterChange},null,8,["onFilterChange"]),r(u,{"color-scheme":"success","class-names":"button--fixed-top",icon:"arrow-download",onClick:o.downloadReports},{default:v(()=>[T(_(e.$t("SLA_REPORTS.DOWNLOAD_SLA_REPORTS")),1)]),_:1},8,["onClick"]),d("div",je,[r(g,{"hit-rate":e.slaMetrics.hitRate,"no-of-breaches":e.slaMetrics.numberOfSLAMisses,"no-of-conversations":e.slaMetrics.numberOfConversations,"is-loading":e.uiFlags.isFetchingMetrics},null,8,["hit-rate","no-of-breaches","no-of-conversations","is-loading"]),r(f,{"sla-reports":e.slaReports,"is-loading":e.uiFlags.isFetching,"current-page":Number(e.slaMeta.currentPage),"total-count":Number(e.slaMeta.count),onPageChange:o.onPageChange},null,8,["sla-reports","is-loading","current-page","total-count","onPageChange"])])])}const Ct=y(Ve,[["render",Ue]]);export{Ct as default};
