import{_ as O,u as d,o as l,n as r,p as _,e as h,g as T,U as E,q as A,k as u,a as m,t as g,a0 as V,F as M,i as N}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as S}from"./index-BaHWIRRA.js";import{S as L}from"./Spinner-B-aSVz3z.js";import{o as b}from"./dashboard-CGLIihvy.js";const C={props:{teams:{type:Array,required:!0},modelValue:{type:Object,required:!0}},emits:["update:modelValue"],data(){return{selectedTeams:[],message:""}},mounted(){const{team_ids:e}=this.modelValue;this.selectedTeams=e,this.message=this.modelValue.message},methods:{updateValue(){this.$emit("update:modelValue",{team_ids:this.selectedTeams.map(e=>e.id),message:this.message})}}},U={class:"multiselect-wrap--small"},k=["placeholder"];function w(e,t,o,n,i,a){const p=d("multiselect");return l(),r("div",null,[_("div",U,[h(p,{modelValue:i.selectedTeams,"onUpdate:modelValue":[t[0]||(t[0]=c=>i.selectedTeams=c),a.updateValue],"track-by":"id",label:"name",placeholder:e.$t("AUTOMATION.ACTION.TEAM_DROPDOWN_PLACEHOLDER"),multiple:"","selected-label":"","select-label":e.$t("FORMS.MULTISELECT.ENTER_TO_SELECT"),"deselect-label":"","max-height":160,options:o.teams,"allow-empty":!1},null,8,["modelValue","placeholder","select-label","options","onUpdate:modelValue"]),T(_("textarea",{"onUpdate:modelValue":t[1]||(t[1]=c=>i.message=c),rows:"4",placeholder:e.$t("AUTOMATION.ACTION.TEAM_MESSAGE_INPUT_PLACEHOLDER"),onInput:t[2]||(t[2]=(...c)=>a.updateValue&&a.updateValue(...c))},null,40,k),[[E,i.message]])])])}const D=O(C,[["render",w],["__scopeId","data-v-54cf5db8"]]),v={components:{Spinner:L},props:{initialFileName:{type:String,default:""}},emits:["update:modelValue"],data(){return{uploadState:"idle",label:this.$t("AUTOMATION.ATTACHMENT.LABEL_IDLE")}},mounted(){this.initialFileName&&(this.label=this.initialFileName,this.uploadState="uploaded")},methods:{async onChangeFile(e){this.uploadState="processing",this.label=this.$t("AUTOMATION.ATTACHMENT.LABEL_UPLOADING");try{const t=e.target.files[0],o=await this.$store.dispatch("automations/uploadAttachment",t);this.$emit("update:modelValue",[o]),this.uploadState="uploaded",this.label=this.$t("AUTOMATION.ATTACHMENT.LABEL_UPLOADED")}catch{this.uploadState="failed",this.label=this.$t("AUTOMATION.ATTACHMENT.LABEL_UPLOAD_FAILED"),S(this.$t("AUTOMATION.ATTACHMENT.UPLOAD_ERROR"))}}}},F={class:"file-button"};function R(e,t,o,n,i,a){const p=d("Spinner"),c=d("fluent-icon");return l(),r("label",{class:A(["input-wrapper",i.uploadState])},[i.uploadState!=="processing"?(l(),r("input",{key:0,type:"file",name:"attachment",class:A(i.uploadState==="processing"?"disabled":""),onChange:t[0]||(t[0]=(...y)=>a.onChangeFile&&a.onChangeFile(...y))},null,34)):u("",!0),i.uploadState==="processing"?(l(),m(p,{key:1})):u("",!0),i.uploadState==="idle"?(l(),m(c,{key:2,icon:"file-upload"})):u("",!0),i.uploadState==="uploaded"?(l(),m(c,{key:3,icon:"checkmark-circle",type:"outline",class:"success-icon"})):u("",!0),i.uploadState==="failed"?(l(),m(c,{key:4,icon:"dismiss-circle",type:"outline",class:"error-icon"})):u("",!0),_("p",F,g(i.label),1)],2)}const P=O(v,[["render",R],["__scopeId","data-v-9923a030"]]),H={components:{AutomationActionTeamMessageInput:D,AutomationActionFileInput:P,WootMessageEditor:b},props:{modelValue:{type:Object,default:()=>null},actionTypes:{type:Array,default:()=>[]},dropdownValues:{type:Array,default:()=>[]},errorMessage:{type:String,default:""},showActionInput:{type:Boolean,default:!0},initialFileName:{type:String,default:""},isMacro:{type:Boolean,default:!1}},emits:["update:modelValue","input","removeAction","resetAction"],computed:{action_name:{get(){return this.modelValue?this.modelValue.action_name:null},set(e){const t=this.modelValue||{};this.$emit("update:modelValue",{...t,action_name:e}),this.$emit("input",{...t,action_name:e})}},action_params:{get(){return this.modelValue?this.modelValue.action_params:null},set(e){const t=this.modelValue||{};this.$emit("update:modelValue",{...t,action_params:e}),this.$emit("input",{...t,action_params:e})}},inputType(){return this.actionTypes.find(e=>e.key===this.action_name).inputType},actionInputStyles(){return{"has-error":this.errorMessage,"is-a-macro":this.isMacro}},castMessageVmodel:{get(){return Array.isArray(this.action_params)?this.action_params[0]:this.action_params},set(e){this.action_params=e}}},methods:{removeAction(){this.$emit("removeAction")},resetAction(){this.$emit("resetAction")}}},q={class:"filter-inputs"},B=["value"],G={key:0,class:"filter__answer--wrap"},j={key:0,class:"w-full"},W={key:0,class:"multiselect-wrap--small"},x={key:1,class:"multiselect-wrap--small"},J=["placeholder"],z=["placeholder"],Y={key:2,class:"filter-error"};function K(e,t,o,n,i,a){const p=d("multiselect"),c=d("AutomationActionFileInput"),y=d("woot-button"),f=d("AutomationActionTeamMessageInput"),I=d("WootMessageEditor");return l(),r("div",{class:A(["filter",a.actionInputStyles])},[_("div",q,[T(_("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>a.action_name=s),class:A(["action__question",{"full-width":!o.showActionInput}]),onChange:t[1]||(t[1]=s=>a.resetAction())},[(l(!0),r(M,null,N(o.actionTypes,s=>(l(),r("option",{key:s.key,value:s.key},g(s.label),9,B))),128))],34),[[V,a.action_name]]),o.showActionInput?(l(),r("div",G,[a.inputType?(l(),r("div",j,[a.inputType==="search_select"?(l(),r("div",W,[h(p,{modelValue:a.action_params,"onUpdate:modelValue":t[2]||(t[2]=s=>a.action_params=s),"track-by":"id",label:"name",placeholder:e.$t("FORMS.MULTISELECT.SELECT"),"selected-label":"","select-label":e.$t("FORMS.MULTISELECT.ENTER_TO_SELECT"),"deselect-label":"","max-height":160,options:o.dropdownValues,"allow-empty":!1,"option-height":104},null,8,["modelValue","placeholder","select-label","options"])])):a.inputType==="multi_select"?(l(),r("div",x,[h(p,{modelValue:a.action_params,"onUpdate:modelValue":t[3]||(t[3]=s=>a.action_params=s),"track-by":"id",label:"name",placeholder:e.$t("FORMS.MULTISELECT.SELECT"),multiple:"","selected-label":"","select-label":e.$t("FORMS.MULTISELECT.ENTER_TO_SELECT"),"deselect-label":"","max-height":160,options:o.dropdownValues,"allow-empty":!1,"option-height":104},null,8,["modelValue","placeholder","select-label","options"])])):a.inputType==="email"?T((l(),r("input",{key:2,"onUpdate:modelValue":t[4]||(t[4]=s=>a.action_params=s),type:"email",class:"answer--text-input",placeholder:e.$t("AUTOMATION.ACTION.EMAIL_INPUT_PLACEHOLDER")},null,8,J)),[[E,a.action_params]]):a.inputType==="url"?T((l(),r("input",{key:3,"onUpdate:modelValue":t[5]||(t[5]=s=>a.action_params=s),type:"url",class:"answer--text-input",placeholder:e.$t("AUTOMATION.ACTION.URL_INPUT_PLACEHOLDER")},null,8,z)),[[E,a.action_params]]):u("",!0),a.inputType==="attachment"?(l(),m(c,{key:4,modelValue:a.action_params,"onUpdate:modelValue":t[6]||(t[6]=s=>a.action_params=s),"initial-file-name":o.initialFileName},null,8,["modelValue","initial-file-name"])):u("",!0)])):u("",!0)])):u("",!0),o.isMacro?u("",!0):(l(),m(y,{key:1,icon:"dismiss",variant:"clear","color-scheme":"secondary",onClick:a.removeAction},null,8,["onClick"]))]),a.inputType==="team_message"?(l(),m(f,{key:0,modelValue:a.action_params,"onUpdate:modelValue":t[7]||(t[7]=s=>a.action_params=s),teams:o.dropdownValues},null,8,["modelValue","teams"])):u("",!0),a.inputType==="textarea"?(l(),m(I,{key:1,modelValue:a.castMessageVmodel,"onUpdate:modelValue":t[8]||(t[8]=s=>a.castMessageVmodel=s),rows:"4","enable-variables":"",placeholder:e.$t("AUTOMATION.ACTION.TEAM_MESSAGE_INPUT_PLACEHOLDER"),class:"action-message"},null,8,["modelValue","placeholder"])):u("",!0),o.errorMessage?(l(),r("p",Y,g(o.errorMessage),1)):u("",!0)],2)}const se=O(H,[["render",K],["__scopeId","data-v-42f98ac4"]]),oe=[{attribute_key:"message_type",filter_operator:"equal_to",values:"",query_operator:"and",custom_attribute_type:""}],ne=[{attribute_key:"browser_language",filter_operator:"equal_to",values:"",query_operator:"and",custom_attribute_type:""}],ie=[{attribute_key:"status",filter_operator:"equal_to",values:"",query_operator:"and",custom_attribute_type:""}],re=[{action_name:"assign_agent",action_params:[]}],ue=[{id:"incoming",name:"Incoming Message"},{id:"outgoing",name:"Outgoing Message"}],ce=[{id:"nil",name:"None"},{id:"low",name:"Low"},{id:"medium",name:"Medium"},{id:"high",name:"High"},{id:"urgent",name:"Urgent"}],Q=e=>e.every(t=>typeof t=="string"),X=e=>e.every(t=>typeof t=="number"),Z=e=>(e.length<=0?e=[]:Q(e)||X(e)?e=[...e]:e=e.map(t=>t.id),e),$=e=>(e.action_params.id?e.action_params=[e.action_params.id]:e.action_params=[e.action_params],e.action_params),de=e=>JSON.parse(JSON.stringify(e)).map(n=>(Array.isArray(n.action_params)?n.action_params=Z(n.action_params):typeof n.action_params=="object"?n.action_params=$(n):n.action_params?n.action_params=[n.action_params]:n.action_params=[],n));export{se as A,oe as D,ue as M,ce as P,ne as a,ie as b,re as c,de as g};
