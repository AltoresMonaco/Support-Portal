import{m as S}from"./globalConfig-DaGjiImb.js";import{g as f}from"./globalConfigMixin-BNbqaRx5.js";import{j as b}from"./DashboardIcon-CPXNa31t.js";import{u as _}from"./index-BaHWIRRA.js";import{_ as I,u as c,o as i,n as s,p as e,t as d,e as u,l as k,k as g,H as p,g as N,a as C,a0 as O,F as G,i as L}from"./_plugin-vue_export-helper-CvYNw_mv.js";import{u as A}from"./useMessageFormatter-CoQTTzFX.js";import{S as y}from"./Spinner-B-aSVz3z.js";import"./vue-router-CNCrM2WK.js";import"./index-BP-sUqpX.js";import"./AudioNotificationHelper-CDrFIep2.js";import"./index-Y4OjWrJ-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./exports-CsC-x4VI.js";import"./Icon-Dtj3LCzD.js";import"./index-BO4rcqbh.js";const x={mixins:[f],props:{integrationId:{type:[String,Number],required:!0},integrationName:{type:String,default:""},integrationDescription:{type:String,default:""},integrationEnabled:{type:Boolean,default:!1},integrationAction:{type:String,default:""},actionButtonText:{type:String,default:""},deleteConfirmationText:{type:Object,default:()=>({})}},data(){return{showDeleteConfirmationPopup:!1}},computed:{...S({accountId:"getCurrentAccountId",globalConfig:"globalConfig/get"})},methods:{frontendURL:b,openDeletePopup(){this.showDeleteConfirmationPopup=!0},closeDeletePopup(){this.showDeleteConfirmationPopup=!1},confirmDeletion(){this.closeDeletePopup(),this.deleteIntegration(this.deleteIntegration),this.$router.push({name:"settings_integrations"})},async deleteIntegration(){try{await this.$store.dispatch("integrations/deleteIntegration",this.integrationId),_(this.$t("INTEGRATION_SETTINGS.DELETE.API.SUCCESS_MESSAGE"))}catch{_(this.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.API.ERROR_MESSAGE"))}}}},R={class:"flex flex-col items-start justify-between md:flex-row md:items-center"},v={class:"flex items-center justify-start flex-1 m-0 mx-4"},w=["src"],D={class:"mb-1 text-xl font-medium text-slate-800 dark:text-slate-100"},$={class:"text-slate-700 dark:text-slate-200"},H={class:"flex justify-center items-center mb-0 w-[15%]"},K={key:0},P={key:0},B={key:1},F={class:"button nice"},M={key:0},U=["href"];function W(t,a,o,m,l,n){const h=c("woot-submit-button"),T=c("router-link"),E=c("woot-delete-modal");return i(),s("div",R,[e("div",v,[e("img",{src:`/dashboard/images/integrations/${o.integrationId}.png`,class:"w-16 h-16 p-2 mr-4"},null,8,w),e("div",null,[e("h3",D,d(o.integrationName),1),e("p",$,d(t.useInstallationName(o.integrationDescription,"Altores")),1)])]),e("div",H,[u(T,{to:n.frontendURL(`accounts/${t.accountId}/settings/integrations/`+o.integrationId)},{default:k(()=>[o.integrationEnabled?(i(),s("div",K,[o.integrationAction==="disconnect"?(i(),s("div",P,[e("div",{onClick:a[0]||(a[0]=(...r)=>n.openDeletePopup&&n.openDeletePopup(...r))},[u(h,{"button-text":o.actionButtonText||t.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.BUTTON_TEXT"),"button-class":"smooth alert"},null,8,["button-text"])])])):(i(),s("div",B,[e("button",F,d(t.$t("INTEGRATION_SETTINGS.WEBHOOK.CONFIGURE")),1)]))])):g("",!0)]),_:1},8,["to"]),o.integrationEnabled?g("",!0):(i(),s("div",M,[e("a",{href:o.integrationAction,class:"rounded button success nice"},d(t.$t("INTEGRATION_SETTINGS.CONNECT.BUTTON_TEXT")),9,U)]))]),u(E,{show:l.showDeleteConfirmationPopup,"onUpdate:show":a[1]||(a[1]=r=>l.showDeleteConfirmationPopup=r),"on-close":n.closeDeletePopup,"on-confirm":n.confirmDeletion,title:o.deleteConfirmationText.title||t.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.CONFIRM.TITLE"),message:o.deleteConfirmationText.message||t.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.CONFIRM.MESSAGE"),"confirm-text":t.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.CONFIRM.YES"),"reject-text":t.$t("INTEGRATION_SETTINGS.WEBHOOK.DELETE.CONFIRM.NO")},null,8,["show","on-close","on-confirm","title","message","confirm-text","reject-text"])])}const j=I(x,[["render",W]]),X={mixins:[f],props:{hasConnectedAChannel:{type:Boolean,default:!0}},setup(){const{formatMessage:t}=A();return{formatMessage:t}},data(){return{selectedChannelId:"",availableChannels:[]}},computed:{...S({globalConfig:"globalConfig/get",uiFlags:"integrations/getUIFlags"}),errorDescription(){return this.hasConnectedAChannel?this.$t("INTEGRATION_SETTINGS.SLACK.SELECT_CHANNEL.EXPIRED"):this.$t("INTEGRATION_SETTINGS.SLACK.SELECT_CHANNEL.DESCRIPTION")}},methods:{async fetchChannels(){try{this.availableChannels=await this.$store.dispatch("integrations/listAllSlackChannels"),this.availableChannels.sort((t,a)=>t.name-a.name)}catch{this.$t("INTEGRATION_SETTINGS.SLACK.FAILED_TO_FETCH_CHANNELS"),this.availableChannels=[]}},async updateIntegration(){try{await this.$store.dispatch("integrations/updateSlack",{referenceId:this.selectedChannelId}),_(this.$t("INTEGRATION_SETTINGS.SLACK.UPDATE_SUCCESS"))}catch(t){_(t.message||"INTEGRATION_SETTINGS.SLACK.UPDATE_ERROR")}}}},z={class:"px-6 py-4 mb-4 border border-yellow-200 rounded-md bg-yellow-50 dark:border-slate-700 dark:bg-slate-800"},V={class:"flex"},q={class:"flex-shrink-0 mt-0.5"},Y={class:"ml-3"},Q={class:"mb-1 text-base font-semibold text-yellow-900 dark:text-yellow-500"},J={class:"mt-2 text-sm text-yellow-800 dark:text-yellow-600"},Z={key:0,class:"mt-2 ml-8"},tt={key:1,class:"inline-flex"},et={value:""},nt=["value"];function ot(t,a,o,m,l,n){const h=c("fluent-icon"),T=c("woot-submit-button"),E=p("dompurify-html");return i(),s("div",z,[e("div",V,[e("div",q,[u(h,{icon:"alert",class:"text-yellow-500 dark:text-yellow-400",size:"24"})]),e("div",Y,[e("p",Q,d(t.$t("INTEGRATION_SETTINGS.SLACK.SELECT_CHANNEL.ATTENTION_REQUIRED")),1),e("div",J,[N(e("p",null,null,512),[[E,m.formatMessage(t.useInstallationName(n.errorDescription,"Altores"),!1)]])])])]),o.hasConnectedAChannel?g("",!0):(i(),s("div",Z,[l.availableChannels.length?(i(),s("div",tt,[N(e("select",{"onUpdate:modelValue":a[0]||(a[0]=r=>l.selectedChannelId=r),class:"h-8 py-1 mr-4 text-xs leading-4 border border-yellow-300"},[e("option",et,d(t.$t("INTEGRATION_SETTINGS.SLACK.SELECT_CHANNEL.OPTION_LABEL")),1),(i(!0),s(G,null,L(l.availableChannels,r=>(i(),s("option",{key:r.id,value:r.id}," #"+d(r.name),9,nt))),128))],512),[[O,l.selectedChannelId]]),u(T,{"button-class":"smooth small success","button-text":t.$t("INTEGRATION_SETTINGS.SLACK.SELECT_CHANNEL.UPDATE"),"spinner-class":"success",loading:t.uiFlags.isUpdatingSlack,onClick:n.updateIntegration},null,8,["button-text","loading","onClick"])])):(i(),C(T,{key:0,"button-class":"smooth small warning",loading:t.uiFlags.isFetchingSlackChannels,"button-text":t.$t("INTEGRATION_SETTINGS.SLACK.SELECT_CHANNEL.BUTTON_TEXT"),"spinner-class":"warning",onClick:n.fetchChannels},null,8,["loading","button-text","onClick"]))]))])}const it=I(X,[["render",ot]]),st={props:{selectedChannelName:{type:String,required:!0}},setup(){const{formatMessage:t}=A();return{formatMessage:t}}},at={class:"flex-1 w-full p-6 bg-white rounded-md border border-slate-50 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200"},rt={class:"prose-lg max-w-5xl"},lt={class:"dark:text-slate-100"};function ct(t,a,o,m,l,n){const h=p("dompurify-html");return i(),s("div",at,[e("div",rt,[e("h5",lt,d(t.$t("INTEGRATION_SETTINGS.SLACK.HELP_TEXT.TITLE")),1),e("p",null,[N(e("span",null,null,512),[[h,m.formatMessage(t.$t("INTEGRATION_SETTINGS.SLACK.HELP_TEXT.BODY",{selectedChannelName:o.selectedChannelName}),!1)]])])])])}const dt=I(st,[["render",ct]]),ut={components:{Spinner:y,Integration:j,SelectChannelWarning:it,SlackIntegrationHelpText:dt},mixins:[f],props:{code:{type:String,default:""}},data(){return{integrationLoaded:!1}},computed:{integration(){return this.$store.getters["integrations/getIntegration"]("slack")},areHooksAvailable(){const{hooks:t=[]}=this.integration||{};return!!t.length},hook(){const{hooks:t=[]}=this.integration||{},[a]=t;return a||{}},isIntegrationHookEnabled(){return this.hook.status||!1},hasConnectedAChannel(){return!!this.hook.reference_id},selectedChannelName(){if(this.hook.status){const{settings:{channel_name:t=""}={}}=this.hook;return t||"customer-conversations"}return this.$t("INTEGRATION_SETTINGS.SLACK.HELP_TEXT.SELECTED")},...S({uiFlags:"integrations/getUIFlags"}),integrationAction(){return this.integration.enabled?"disconnect":this.integration.action}},mounted(){this.intializeSlackIntegration()},methods:{async intializeSlackIntegration(){await this.$store.dispatch("integrations/get","slack"),this.code&&(await this.$store.dispatch("integrations/connectSlack",this.code),this.$router.replace(this.$route.path)),this.integrationLoaded=!0}}},ht={key:0,class:"flex flex-col flex-1 overflow-auto"},Tt={class:"p-4 bg-white border-b border-solid rounded-sm dark:bg-slate-800 border-slate-75 dark:border-slate-700/50"},mt={key:0,class:"flex-1 p-6"},Et={key:1,class:"flex items-center justify-center flex-1"};function gt(t,a,o,m,l,n){const h=c("Integration"),T=c("SelectChannelWarning"),E=c("SlackIntegrationHelpText"),r=c("Spinner");return l.integrationLoaded&&!t.uiFlags.isCreatingSlack?(i(),s("div",ht,[e("div",Tt,[u(h,{"integration-id":n.integration.id,"integration-logo":n.integration.logo,"integration-name":n.integration.name,"integration-description":n.integration.description,"integration-enabled":n.integration.enabled,"integration-action":n.integrationAction,"action-button-text":t.$t("INTEGRATION_SETTINGS.SLACK.DELETE"),"delete-confirmation-text":{title:t.$t("INTEGRATION_SETTINGS.SLACK.DELETE_CONFIRMATION.TITLE"),message:t.$t("INTEGRATION_SETTINGS.SLACK.DELETE_CONFIRMATION.MESSAGE")}},null,8,["integration-id","integration-logo","integration-name","integration-description","integration-enabled","integration-action","action-button-text","delete-confirmation-text"])]),n.areHooksAvailable?(i(),s("div",mt,[n.isIntegrationHookEnabled?g("",!0):(i(),C(T,{key:0,"has-connected-a-channel":n.hasConnectedAChannel},null,8,["has-connected-a-channel"])),u(E,{"selected-channel-name":n.selectedChannelName},null,8,["selected-channel-name"])])):g("",!0)])):(i(),s("div",Et,[u(r,{size:"","color-scheme":"primary"})]))}const Rt=I(ut,[["render",gt]]);export{Rt as default};
